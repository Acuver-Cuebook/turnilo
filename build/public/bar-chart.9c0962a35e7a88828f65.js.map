{"version":3,"sources":["webpack:///./src/client/utils/dataset/selectors/selectors.ts","webpack:///./src/client/visualizations/line-chart/utils/splits.ts","webpack:///./src/client/components/bubble-title/bubble-title.tsx","webpack:///./src/client/utils/linear-scale/linear-scale.ts","webpack:///./src/client/components/series-bubble-content/series-bubble-content.tsx","webpack:///./src/client/components/modal-bubble/modal-bubble.tsx","webpack:///./src/client/components/highlight-modal/highlight-modal.tsx","webpack:///./src/client/components/segment-bubble/segment-bubble.tsx","webpack:///./src/client/components/measure-bubble-content/measure-bubble-content.tsx","webpack:///./src/client/components/grid-lines/grid-lines.tsx","webpack:///./src/client/utils/highlight-clause/highlight-clause.ts","webpack:///./src/client/visualizations/line-chart/utils/is-valid-clause.ts","webpack:///./src/client/components/color-swabs/color-entry.tsx","webpack:///./src/client/components/vis-measure-label/vis-measure-label.tsx","webpack:///./src/client/components/vertical-axis/vertical-axis.tsx","webpack:///./src/client/components/color-swabs/color-swabs.tsx","webpack:///./src/client/utils/extent/extent.ts","webpack:///./src/client/components/timeseries-visualization-controls/split-menu.tsx","webpack:///./src/client/components/timeseries-visualization-controls/visualization-controls.tsx","webpack:///./src/client/components/grid-border/grid-border.tsx","webpack:///./src/client/components/highlighter/highlighter.tsx","webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack:///./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack:///./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/bar-chart-model.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/hover-tooltip/tooltip-content.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/hover-tooltip/hover-tooltip.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/interactions/interaction.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/foreground/highlight-modal.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/foreground/highlight-overlay.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar/padding.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/foreground/foreground.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/layout.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/calculate-segment-stage.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/y-extent.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar/single-bar.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar/single-time-shift-bar.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/stack-layout.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar/stacked-bar.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar/stacked-time-shift-bar.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/y-axis/single-y-axis.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bars/background.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bars/bars.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bars/bars-container.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/legend/Legend.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar-charts/bar-charts.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/interactions/interaction-controller.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/spacer/spacer.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/stack-dataset.ts","webpack:///./src/client/utils/dataset/split/map-split-datums.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/transpose-dataset.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/x-scale.ts","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/x-axis/x-axis.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/y-axis/y-axis.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/bar-chart.tsx","webpack:///./src/client/visualizations/bar-chart/improved-bar-chart/utils/x-domain.ts","webpack:///./src/client/components/bucket-marks/bucket-marks.tsx","webpack:///./src/client/visualizations/bar-chart/bar-coordinates.ts","webpack:///./src/client/visualizations/bar-chart/old-bar-chart/old-bar-chart.tsx","webpack:///./src/client/visualizations/bar-chart/bar-chart.tsx"],"names":["selectMainDatum","dataset","data","selectSplitDataset","datum","SPLIT","selectDatums","selectSplitDatums","compose","selectFirstSplitDataset","selectFirstSplitDatums","dimensionForSplit","essence","split","findDimensionByName","dataCube","dimensions","reference","getContinuousSplit","splits","last","getContinuousDimension","getContinuousReference","getNominalSplit","count","first","hasNominalSplit","getNominalDimension","BubbleTitle","title","minWidth","clamp","length","className","style","pickTicks","scale","ticksCount","ticks","filter","n","getScale","min","max","height","isNaN","d3","domain","Math","nice","range","SeriesBubbleContent","props","series","showPrevious","Fragment","formatValue","currentValue","selectValue","previousValue","SeriesDerivation","PREVIOUS","formatter","lowerIsBetter","measure","current","previous","ModalBubble","React","Component","el","this","modalRef","e","target","isInside","onClose","render","children","left","top","mouseDown","onMouseDown","classNames","ref","setModalRef","direction","HighlightModal","acceptHighlight","dropHighlight","type","onClick","STRINGS","select","cancel","SegmentBubble","content","SegmentBubbleContent","MeasureBubbleContent","GridLines","orientation","stage","transform","getTransform","map","tick","value","roundToHalfPx","coordinates","x1","x2","width","y1","y2","lineCoordinates","key","String","toFilterClause","TimeRange","isTimeRange","dateRange","DateRange","values","List","of","FixedTimeFilterClause","PlywoodNumberRange","isNumberRange","numberRange","NumberRange","NumberFilterClause","Error","toPlywoodRange","clause","isValidClause","Range","fromJS","createColorEntry","color","name","hasComparison","delta","VisMeasureLabel","CURRENT","renderPrevious","VerticalAxis","tickSize","inputTicks","topLineExtend","hideZero","lines","y","labelX","labels","x","dy","ColorSwabs","colorEntries","colorSwabs","swabStyle","background","seriesSelectors","get","d","readNumber","datumsExtent","datums","selectors","reduce","acc","selector","extent","TimeSeriesContinuousSplitMenu","saveSplit","containerStage","dimension","openOn","granularity","setGranularity","useState","bucket","granularityToString","isValid","validateSplit","onSave","newSplit","createSplit","granularityChange","TimeSeriesCategorySplitMenu","sortOptions","DimensionSortOn","seriesSortOns","toArray","customization","visualizationColors","useSettingsContext","limitOptions","useMemo","colorSplitLimits","sort","setSort","limit","setLimit","selected","SortOn","fromSort","options","onChange","selectedLimit","limits","includeNone","onLimitSelect","TimeSeriesSplitMenu","equals","TimeSeriesSplitTile","splitMenuComponent","TimeSeriesSplitTilesRow","splitTileComponent","TimeSeriesVisualizationControls","splitTilesRow","BottomBorder","tickLength","RightBorder","Highlighter","bottom","right","whiteoutLeftStyle","frameStyle","whiteoutRightStyle","_typeof","obj","Symbol","iterator","constructor","prototype","_toPropertyKey","arg","input","hint","prim","toPrimitive","undefined","res","call","TypeError","Number","ModelVariantId","isStacked","model","variant","STACKED","create","commons","continuousSplit","timezone","getConcreteSeries","readCommons","BASE","nominalSplit","nominalDimension","colors","i","colorIndex","set","OrderedMap","createColorMap","Content","entries","entrySeq","find","HoverTooltip","rect","interaction","xScale","yScale","xValue","calculate","bandwidth","InteractionKind","HighlightOverlay","includePrevious","getYValue","Foreground","container","getBoundingClientRect","kind","HIGHLIGHT","isHighlight","HOVER","isHover","MARGINS","calculateLayout","visualisationStage","domainLength","seriesCount","segmentStage","bodyStage","domainSize","availableHeight","heightFromEvenDivision","floor","Stage","fromSize","calculateSegmentStage","within","scroller","bodyHeight","bodyWidth","segment","yExtent","SingleBar","maxHeight","xPos","yPos","fill","main","SingleTimeShiftBar","xStart","rangeBand","barWidth","yCurrent","yPrevious","yCurrentStart","yPreviousStart","currentFill","previousFill","alphaMain","selectBase","period","stackBaseKey","plywoodKey","stackBy","y0","stacked","baseKey","cons","maxKey","changeData","StackedBar","StackedTimeShiftBar","yPreviousBase","yPreviousPos","previousHeight","previousColor","darker","opacity","toString","yCurrentBase","yCurrentPos","currentHeight","currentColor","SingleYAxis","viewBox","getViewBox","Background","gridStage","Bar","rest","Bars","index","BarsContainer","createRef","scrollLeft","totals","chartStage","getWidthHeight","LegendValues","Legend","getTitle","BarCharts","seriesList","hasInteraction","reactKey","InteractionController","hover","scrollTop","setState","part","highlight","getValueFromEvent","isRange","getSeriesFromEvent","findDatumByValue","createHover","oldHover","state","a","b","safeEquals","saveHighlight","layout","invert","seriesHeight","clauses","createHighlight","onScroll","saveScroll","onMouseLeave","resetHover","onMouseMove","saveHover","handleClick","Spacer","reverse","slice","reverseSplitDatums","fn","mapSplitDatums","stackDataset","reversedDatums","threadConditionally","stack","constructDatum","continuousRef","splitData","Dataset","transposeDataset","flatten","coll","currentDatum","idx","findIndex","equalBy","continuousAttr","splitDatum","createInnerDatum","replaceAt","newDatum","mergeDatums","aRange","bRange","compare","rangeComparator","formatDomainValue","start","toISOString","XAxis","isContinuousSplit","_","calculateTicks","textAnchor","TICK_HEIGHT","formatShortSegment","YAxis","axisStage","BarChart","transposedDataset","getXDomain","barChartLayout","stringifiedDomain","ordinalScale","rangeRound","quantizedScale","createXScale","leftGutter","bottomLeftCorner","bottomRightCorner","body","rightGutter","bottomGutter","BucketMarks","stageWidth","addLine","push","BarCoordinates","parameters","barOffset","stepWidth","hitboxMin","hitboxMax","isXWithin","hasChildren","getFilterFromDatum","dataPath","getSplit","SplitType","boolean","BooleanFilterClause","Set","number","time","string","StringFilterClause","action","StringFilterAction","IN","BAR_CHART_MANIFEST","initState","hoverInfo","calculateMousePosition","selectionInfo","path","chartIndex","rowHighlight","currentSeries","definition","hasHighlightOn","componentDidUpdate","scrollerYPosition","scrollerXPosition","scrollerComponent","getSingleChartStage","chartHeight","getOuterChartHeight","size","getPrimaryXScale","chartCoordinates","getBarsCoordinates","findBarCoordinatesForX","findPathForIndices","indices","mySplitDataset","currentData","forEach","currentPath","getYExtent","getYScale","yAxisStage","flatData","splitLength","leafData","extentY","hasValidYExtent","yMin","yMax","getBarDimensions","xTicks","roundToPx","measures","VIS_H_PADDING","getAxisStages","xHeight","CHART_TOP_PADDING","xAxisStage","getScrollerLayout","oneChartHeight","getBubbleTopOffset","getBubbleLeftOffset","canShowBubble","leftOffset","topOffset","renderSelectionBubble","segmentLabel","middleX","segmentValue","renderHoverBubble","measureContent","renderMeasureLabel","isSelected","isFaded","hasAnySelectionGoingOn","isHovered","renderBars","splitIndex","context","bars","segmentValueStr","subPath","concat","bar","bubble","subCoordinates","subData","subRender","bubbleInfo","faded","renderSelectionHighlight","abs","SELECTION_PAD","renderXAxis","canBucketByDefault","lastIndex","ascending","SortDirection","leftThing","rightThing","coordinate","getYAxisStuff","yTicks","yGridLines","changeY","yAxis","isChartVisible","topY","viewPortHeight","renderChart","measureLabel","chart","renderedChart","coordinatesCache","dimensionKind","firstSplitDataSet","originalDataset","dimensionName","firstBucket","end","j","filledData","segmentStart","m","attributes","valueOf","padDataset","s","flattened","order","nestingName","maxNumberOfLeaves","maxima","level","firstSplit","usedWidth","padLeft","getXValues","xRangeBand","overallWidth","numPrimarySteps","minStepWidth","maxAvailableWidth","getSubCoordinates","getX","scaleY","h","subStage","subGetX","subxScale","renderRightGutter","yAxes","yAxesStage","changeHeight","renderSelectionContainer","selectionHighlight","scrollerLayout","measureCharts","xAxis","overlay","onScrollerScroll","SettingsContext","newVersionSupports","or","Predicates","areExactSplitKinds","BarChartVisualization","chartComponent","ImprovedBarChart"],"mappings":"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","file":"bar-chart.9c0962a35e7a88828f65.js","sourcesContent":["/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { compose } from \"../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const selectMainDatum = (dataset: Dataset): Datum =>\n  dataset.data[0];\n\nexport const selectSplitDataset = (datum: Datum): Dataset =>\n  datum[SPLIT] as Dataset;\n\nexport const selectDatums = (dataset: Dataset): Datum[] =>\n  dataset.data;\n\nexport const selectSplitDatums: (datum: Datum) => Datum[] =\n  compose(selectSplitDataset, selectDatums);\n\nexport const selectFirstSplitDataset: (dataset: Dataset) => Dataset =\n  compose(selectMainDatum, selectSplitDataset);\n\nexport const selectFirstSplitDatums: (dataset: Dataset) => Datum[] =\n  compose(selectFirstSplitDataset, selectDatums);\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dimension } from \"../../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { Split } from \"../../../../common/models/split/split\";\n\nfunction dimensionForSplit(essence: Essence, split: Split): Dimension {\n   return findDimensionByName(essence.dataCube.dimensions, split.reference);\n}\n\nexport function getContinuousSplit({ splits: { splits } }: Essence): Split {\n   return splits.last();\n}\n\nexport function getContinuousDimension(essence: Essence): Dimension {\n   const split = getContinuousSplit(essence);\n   return dimensionForSplit(essence, split);\n}\n\nexport function getContinuousReference(essence: Essence): string {\n   return getContinuousSplit(essence).reference;\n}\n\nexport function getNominalSplit({ splits: { splits } }: Essence): Split | null {\n   return splits.count() === 1 ? null : splits.first();\n}\n\nexport function hasNominalSplit(essence: Essence): boolean {\n   return getNominalSplit(essence) !== null;\n}\n\nexport function getNominalDimension(essence: Essence): Dimension | null {\n   const split = getNominalSplit(essence);\n   return split && dimensionForSplit(essence, split);\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { clamp } from \"../../utils/dom/dom\";\n\nconst PER_LETTER_PIXELS = 8;\nconst MIN_TITLE_WIDTH = 80;\nconst MAX_TITLE_WIDTH = 300;\n\ninterface BubbleTitleProps {\n  title: string;\n}\n\nexport const BubbleTitle: React.FunctionComponent<BubbleTitleProps> = ({ title }) => {\n  const minWidth = clamp(title.length * PER_LETTER_PIXELS, MIN_TITLE_WIDTH, MAX_TITLE_WIDTH);\n  return <div className=\"title\" style={{ minWidth }}>{title}</div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\n\nexport type LinearScale = d3.ScaleLinear<number, number>;\n\nexport const TICKS_COUNT = 5;\n\nexport function pickTicks(scale: LinearScale, ticksCount = TICKS_COUNT): number[] {\n  return scale.ticks(ticksCount).filter(n => n !== 0);\n}\n\nexport default function getScale([min, max]: number[], height: number): LinearScale | null {\n  if (isNaN(min) || isNaN(max)) {\n    return null;\n  }\n\n  return d3.scaleLinear()\n    .domain([Math.min(min, 0), Math.max(max, 0)])\n    .nice(TICKS_COUNT)\n    .range([height, 0]);\n}\n","/*\n * Copyright 2017-2020 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { MeasureBubbleContent } from \"../measure-bubble-content/measure-bubble-content\";\n\ninterface SeriesBubbleContentProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nexport const SeriesBubbleContent: React.FunctionComponent<SeriesBubbleContentProps> = props => {\n  const { series, datum, showPrevious } = props;\n  if (!showPrevious) {\n    return <React.Fragment>\n      {series.formatValue(datum)}\n    </React.Fragment>;\n  }\n  const currentValue = series.selectValue(datum);\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <MeasureBubbleContent\n    lowerIsBetter={series.measure.lowerIsBetter}\n    formatter={formatter}\n    current={currentValue}\n    previous={previousValue}\n  />;\n};\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { classNames, isInside } from \"../../utils/dom/dom\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { GlobalEventListener } from \"../global-event-listener/global-event-listener\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./modal-bubble.scss\";\n\ninterface ModalProps {\n  left: number;\n  top: number;\n  onClose: Fn;\n  className?: string;\n}\n\nexport class ModalBubble extends React.Component<ModalProps, {}> {\n\n  modalRef: HTMLDivElement;\n\n  setModalRef = (el: HTMLDivElement) => {\n    this.modalRef = el;\n  };\n\n  onMouseDown = (e: MouseEvent) => {\n    const target = e.target as Element;\n    if (isInside(target, this.modalRef)) return;\n    this.props.onClose();\n  };\n\n  render() {\n    const { className, children, left, top } = this.props;\n    return <React.Fragment>\n      <GlobalEventListener mouseDown={this.onMouseDown} />\n      <BodyPortal left={left} top={top}>\n        <div className={classNames(\"modal-bubble\", className)} ref={this.setModalRef}>\n          {children}\n          <Shpitz direction=\"up\" />\n        </div>\n      </BodyPortal>\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { STRINGS } from \"../../config/constants\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Button } from \"../button/button\";\nimport { ModalBubble } from \"../modal-bubble/modal-bubble\";\nimport \"./highlight-modal.scss\";\n\ninterface HighlightModalProps {\n  title: string;\n  left: number;\n  top: number;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\nexport const HighlightModal: React.FunctionComponent<HighlightModalProps> = ({ title, children, left, top, acceptHighlight, dropHighlight }) =>\n  <ModalBubble className=\"highlight-modal\" left={left} top={top} onClose={dropHighlight}>\n    <BubbleTitle title={title} />\n    <div className=\"value\">{children}</div>\n    <div className=\"actions\">\n      <Button type=\"primary\" className=\"accept mini\" onClick={acceptHighlight} title={STRINGS.select} />\n      <Button type=\"secondary\" className=\"drop mini\" onClick={dropHighlight} title={STRINGS.cancel} />\n    </div>\n  </ModalBubble>;\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ReactNode } from \"react\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./segment-bubble.scss\";\n\nconst OFFSET_V = -10;\n\nexport interface SegmentBubbleProps extends SegmentBubbleContentProps {\n  left: number;\n  top: number;\n}\n\nexport const SegmentBubble: React.FunctionComponent<SegmentBubbleProps> = (props: SegmentBubbleProps) => {\n  const { left, top, title, content } = props;\n  return <BodyPortal left={left} top={top + OFFSET_V}>\n    <div className=\"segment-bubble\">\n      <SegmentBubbleContent title={title} content={content} />\n      <Shpitz direction=\"up\" />\n    </div>\n  </BodyPortal>;\n};\n\nexport interface SegmentBubbleContentProps {\n  title: string;\n  content?: ReactNode;\n}\n\nexport const SegmentBubbleContent: React.FunctionComponent<SegmentBubbleContentProps> = ({ title, content }: SegmentBubbleContentProps) => (\n  <div className=\"segment-bubble-text\">\n    <BubbleTitle title={title} />\n    {content ? <div className=\"content\">{content}</div> : null}\n  </div>\n);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Delta } from \"../delta/delta\";\nimport \"./measure-bubble-content.scss\";\n\nexport interface MeasureBubbleContentProps {\n  current: number;\n  previous: number;\n  formatter: Unary<number, string>;\n  lowerIsBetter?: boolean;\n}\n\nexport const MeasureBubbleContent: React.FunctionComponent<MeasureBubbleContentProps> = ({ lowerIsBetter, formatter, current, previous }) => {\n  const currentValue = formatter(current);\n  const previousValue = formatter(previous);\n  return <React.Fragment>\n    <strong className=\"current-value\">{currentValue}</strong>\n    <span className=\"previous-value\">{previousValue}</span>\n    <Delta formatter={formatter} currentValue={current} previousValue={previous} lowerIsBetter={lowerIsBetter} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { classNames, roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./grid-lines.scss\";\n\nexport interface GridLinesProps {\n  orientation: \"horizontal\" | \"vertical\";\n  stage: Stage;\n  ticks: unknown[];\n  scale: Unary<unknown, number>;\n}\n\ninterface Coordinates {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nfunction lineCoordinates(orientation: \"horizontal\" | \"vertical\", value: number, stage: Stage): Coordinates {\n  switch (orientation) {\n    case \"horizontal\":\n      return { x1: 0, x2: stage.width, y1: value, y2: value };\n    case \"vertical\":\n      return { x1: value, x2: value, y1: 0, y2: stage.height };\n  }\n}\n\nexport const GridLines: React.FunctionComponent<GridLinesProps> = props => {\n  const { orientation, stage, ticks, scale } = props;\n\n  return <g className={classNames(\"grid-lines\", orientation)} transform={stage.getTransform()}>\n    {ticks.map((tick: unknown) => {\n      const value = roundToHalfPx(scale(tick));\n      const coordinates = lineCoordinates(orientation, value, stage);\n      return <line key={String(tick)} {...coordinates} />;\n    })}\n  </g>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { List } from \"immutable\";\nimport { NumberRange as PlywoodNumberRange, Range, TimeRange } from \"plywood\";\nimport { DateRange } from \"../../../common/models/date-range/date-range\";\nimport { FilterClause, FixedTimeFilterClause, NumberFilterClause, NumberRange } from \"../../../common/models/filter-clause/filter-clause\";\nimport { ContinuousRange } from \"../../visualizations/line-chart/utils/continuous-types\";\nimport { isValidClause } from \"../../visualizations/line-chart/utils/is-valid-clause\";\n\nexport function toFilterClause(range: ContinuousRange, reference: string): FilterClause {\n  if (TimeRange.isTimeRange(range)) {\n    const dateRange = new DateRange(range);\n    const values = List.of(dateRange);\n    return new FixedTimeFilterClause({ reference, values });\n  }\n  if (PlywoodNumberRange.isNumberRange(range)) {\n    const numberRange = new NumberRange(range);\n    const values = List.of(numberRange);\n    return new NumberFilterClause({ reference, values });\n  }\n  throw new Error(`Expected Number or Time range, got: ${range}`);\n}\n\nexport function toPlywoodRange(clause: FilterClause): ContinuousRange {\n  if (!isValidClause(clause)) {\n    throw new Error(`Expected Number or FixedTime Filter Clause. Got ${clause}`);\n  }\n  const value = clause.values.first();\n  return Range.fromJS(value) as ContinuousRange;\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FilterClause, FixedTimeFilterClause, NumberFilterClause } from \"../../../../common/models/filter-clause/filter-clause\";\n\nexport function isValidClause(clause: FilterClause): clause is FixedTimeFilterClause | NumberFilterClause {\n  return (clause instanceof FixedTimeFilterClause) || (clause instanceof NumberFilterClause);\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { Delta } from \"../delta/delta\";\n\nexport interface ColorEntry {\n  color: string;\n  name: string;\n  value: string;\n  previous?: string;\n  delta?: JSX.Element;\n}\n\ninterface Parameters {\n  color: string;\n  name: string;\n  series: ConcreteSeries;\n  datum: Datum;\n  hasComparison: boolean;\n}\n\nexport function createColorEntry({ color, name, series, datum, hasComparison }: Parameters): ColorEntry {\n  const current = {\n    color,\n    name,\n    value: series.formatValue(datum)\n  };\n\n  if (!hasComparison) return current;\n\n  return {\n    ...current,\n    previous: series.formatValue(datum, SeriesDerivation.PREVIOUS),\n    delta: <Delta\n      currentValue={series.selectValue(datum)}\n      previousValue={series.selectValue(datum, SeriesDerivation.PREVIOUS)}\n      lowerIsBetter={series.measure.lowerIsBetter}\n      formatter={series.formatter()} />\n  };\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { Delta } from \"../delta/delta\";\nimport \"./vis-measure-label.scss\";\n\nexport interface VisMeasureLabelProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nfunction renderPrevious(datum: Datum, series: ConcreteSeries): JSX.Element {\n  const current = series.selectValue(datum, SeriesDerivation.CURRENT);\n  const previous = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <React.Fragment>\n    <span className=\"measure-previous-value\">\n      {formatter(previous)}\n      </span>\n    <Delta\n      formatter={formatter}\n      lowerIsBetter={series.measure.lowerIsBetter}\n      currentValue={current}\n      previousValue={previous} />\n  </React.Fragment>;\n}\n\nexport const VisMeasureLabel: React.FunctionComponent<VisMeasureLabelProps> = ({ series, datum, showPrevious }) => {\n  return <div className=\"vis-measure-label\">\n    <span className=\"measure-title\">{series.title()}</span>\n    <span className=\"colon\">: </span>\n    <span className=\"measure-value\">{series.formatValue(datum)}</span>\n    {showPrevious && renderPrevious(datum, series)}\n  </div>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./vertical-axis.scss\";\n\nconst TEXT_OFFSET = 2;\n\nexport interface VerticalAxisProps {\n  stage: Stage;\n  ticks: number[];\n  tickSize: number;\n  scale: any;\n  formatter: Unary<number, string>;\n  topLineExtend?: number;\n  hideZero?: boolean;\n}\n\nexport const VerticalAxis: React.FunctionComponent<VerticalAxisProps> = ({ formatter, stage, tickSize, ticks: inputTicks, scale, topLineExtend = 0, hideZero }) => {\n  const ticks = hideZero ? inputTicks.filter((tick: number) => tick !== 0) : inputTicks;\n\n  const lines = ticks.map((tick: any) => {\n    const y = roundToHalfPx(scale(tick));\n    return <line className=\"tick\" key={String(tick)} x1={0} y1={y} x2={tickSize} y2={y} />;\n  });\n\n  const labelX = tickSize + TEXT_OFFSET;\n  const dy = \"0.31em\";\n\n  const labels = ticks.map((tick: any) => {\n    const y = scale(tick);\n    return <text className=\"tick\" key={String(tick)} x={labelX} y={y} dy={dy}>{formatter(tick)}</text>;\n  });\n\n  return <g className=\"vertical-axis\" transform={stage.getTransform()}>\n    <line className=\"border\" x1={0.5} y1={-topLineExtend} x2={0.5} y2={stage.height} />\n    {lines}\n    {labels}\n  </g>;\n};\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ColorEntry } from \"./color-entry\";\nimport \"./color-swabs.scss\";\n\ninterface ColorSwabsProps {\n  colorEntries: ColorEntry[];\n}\n\nexport const ColorSwabs: React.FunctionComponent<ColorSwabsProps> = ({ colorEntries }) => {\n  const colorSwabs = colorEntries.map(({ color, name, value, previous, delta }: ColorEntry) => {\n    const swabStyle = { background: color };\n    return <tr key={name}>\n      <td>\n        <div className=\"color-swab\" style={swabStyle} />\n      </td>\n      <td className=\"color-name\">{name}</td>\n      <td className=\"color-value\">{value}</td>\n      {previous && <td className=\"color-previous\">{previous}</td>}\n      {delta && <td className=\"color-delta\">{delta}</td>}\n    </tr>;\n  });\n\n  return <table className=\"color-swabs\">\n    <tbody>{colorSwabs}</tbody>\n  </table>;\n};\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { readNumber } from \"../../../common/utils/general/general\";\n\nexport type Selector = Unary<Datum, number>;\nexport type Extent = [number, number];\n\nexport function seriesSelectors(series: ConcreteSeries, hasComparison: boolean): Selector[] {\n  const get = (d: Datum) => readNumber(series.selectValue(d));\n  if (!hasComparison) return [get];\n  return [\n    get,\n    (d: Datum) => readNumber(series.selectValue(d, SeriesDerivation.PREVIOUS))\n  ];\n}\n\nexport function datumsExtent(datums: Datum[], selectors: Selector[]): Extent {\n  return selectors.reduce((acc, selector) => {\n    const extent =  d3.extent(datums, selector);\n    return d3.extent([...extent, ...acc]);\n  }, [0, 0]) as Extent;\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, useState } from \"react\";\nimport { colorSplitLimits } from \"../../../common/models/colors/colors\";\nimport { granularityToString } from \"../../../common/models/granularity/granularity\";\nimport { DimensionSortOn, SortOn } from \"../../../common/models/sort-on/sort-on\";\nimport { useSettingsContext } from \"../../views/cube-view/settings-context\";\nimport { getContinuousSplit } from \"../../visualizations/line-chart/utils/splits\";\nimport { GranularityPicker } from \"../split-menu/granularity-picker\";\nimport { LimitDropdown } from \"../split-menu/limit-dropdown\";\nimport { SortDropdown } from \"../split-menu/sort-dropdown\";\nimport { SplitMenuProps } from \"../split-menu/split-menu\";\nimport { createSplit, SplitMenuBase, validateSplit } from \"../split-menu/split-menu-base\";\n\nconst TimeSeriesContinuousSplitMenu: React.FunctionComponent<SplitMenuProps> = props => {\n  const { saveSplit, containerStage, split, dimension, onClose, openOn } = props;\n  const [granularity, setGranularity] = useState(() => split.bucket && granularityToString(split.bucket));\n\n  const onSave = () => {\n    const newSplit = createSplit({\n      dimension,\n      split,\n      granularity\n    });\n    saveSplit(split, newSplit);\n  };\n\n  const isValid = validateSplit({ split, dimension, granularity });\n\n  return <SplitMenuBase\n    openOn={openOn}\n    containerStage={containerStage}\n    onClose={onClose}\n    onSave={onSave}\n    dimension={dimension}\n    isValid={isValid}>\n    <GranularityPicker\n      granularity={granularity}\n      dimension={dimension}\n      granularityChange={setGranularity}/>\n  </SplitMenuBase>;\n};\n\nconst TimeSeriesCategorySplitMenu: React.FunctionComponent<SplitMenuProps> = props => {\n  const { openOn, containerStage, onClose, dimension, saveSplit, split, essence } = props;\n\n  const sortOptions = [\n    new DimensionSortOn(dimension),\n    ...essence.seriesSortOns(true).toArray()\n  ];\n\n  const { customization: { visualizationColors: { series } } } = useSettingsContext();\n  const limitOptions = useMemo(() => colorSplitLimits(series.length), [series.length]);\n\n  const [sort, setSort] = useState(split.sort);\n  const [limit, setLimit] = useState(split.limit);\n\n  const isValid = validateSplit({ split, dimension, limit, sort });\n\n  const onSave = () => {\n    const newSplit = createSplit({\n      dimension,\n      split,\n      limit,\n      sort\n    });\n    saveSplit(split, newSplit);\n  };\n\n  return <SplitMenuBase\n    openOn={openOn}\n    containerStage={containerStage}\n    onClose={onClose}\n    onSave={onSave}\n    dimension={dimension}\n    isValid={isValid}>\n    <SortDropdown\n      direction={sort.direction}\n      selected={SortOn.fromSort(sort, essence)}\n      options={sortOptions}\n      onChange={setSort}/>\n    <LimitDropdown\n      selectedLimit={limit}\n      limits={limitOptions}\n      includeNone={false}\n      onLimitSelect={setLimit}/>\n  </SplitMenuBase>;\n};\n\nexport const TimeSeriesSplitMenu: React.FunctionComponent<SplitMenuProps> = props => {\n  const { essence, split } = props;\n\n  const isContinuousSplit = split.equals(getContinuousSplit(essence));\n\n  if (isContinuousSplit) {\n    return <TimeSeriesContinuousSplitMenu {...props} />;\n  } else {\n    return <TimeSeriesCategorySplitMenu {...props} />;\n  }\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { VisualizationControls, VisualizationControlsBaseProps } from \"../../views/cube-view/center-panel/center-panel\";\nimport { SplitTile, SplitTileBaseProps } from \"../split-tile/split-tile\";\nimport { SplitTilesRow, SplitTilesRowBaseProps } from \"../split-tile/split-tiles-row\";\nimport { TimeSeriesSplitMenu } from \"./split-menu\";\n\nconst TimeSeriesSplitTile: React.FunctionComponent<SplitTileBaseProps> = props =>\n  <SplitTile splitMenuComponent={TimeSeriesSplitMenu} {...props} />;\n\nconst TimeSeriesSplitTilesRow: React.FunctionComponent<SplitTilesRowBaseProps> = props =>\n  <SplitTilesRow {...props} splitTileComponent={TimeSeriesSplitTile}/>;\n\nexport const TimeSeriesVisualizationControls: React.FunctionComponent<VisualizationControlsBaseProps> = props =>\n  <VisualizationControls {...props} splitTilesRow={TimeSeriesSplitTilesRow}/>;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./grid-border.scss\";\n\ninterface BottomBorderProps {\n  stage: Stage;\n  tickLength: number;\n}\n\nexport const BottomBorder: React.FunctionComponent<BottomBorderProps> = ({ stage, tickLength }) => {\n  return <line\n    className=\"grid-border grid-bottom-border\"\n    transform={stage.getTransform()}\n    x1={0}\n    x2={stage.width + tickLength}\n    y1={roundToHalfPx(stage.height - 1)}\n    y2={roundToHalfPx(stage.height - 1)}\n  />;\n};\n\ninterface RightBorderProps {\n stage: Stage;\n}\n\nexport const RightBorder: React.FunctionComponent<RightBorderProps> = ({ stage }) => {\n  return <line\n    className=\"grid-border grid-right-border\"\n    transform={stage.getTransform()}\n    x1={roundToHalfPx(stage.width - 1)}\n    x2={roundToHalfPx(stage.width - 1)}\n    y1={0}\n    y2={stage.height} />;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./highlighter.scss\";\n\nexport interface HighlighterProps {\n  left: number;\n  right: number;\n  top?: number;\n  bottom?: number;\n}\n\nexport function Highlighter(props: HighlighterProps) {\n  const { left, bottom = 0, right, top = 0 } = props;\n\n  const whiteoutLeftStyle = {\n    width: Math.max(left, 0)\n  };\n\n  const frameStyle = {\n    left,\n    top,\n    bottom,\n    width: Math.max(right - left, 0)\n  };\n\n  const whiteoutRightStyle = {\n    left: right\n  };\n\n  return <div className=\"highlighter\">\n    <div className=\"whiteout left\" style={whiteoutLeftStyle} />\n    <div className=\"frame\" style={frameStyle} />\n    <div className=\"whiteout right\" style={whiteoutRightStyle} />\n  </div>;\n}\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { List, OrderedMap } from \"immutable\";\nimport { Dataset, Datum } from \"plywood\";\nimport { VisualizationColors } from \"../../../../../common/models/colors/colors\";\nimport { ClientCustomization } from \"../../../../../common/models/customization/customization\";\nimport { Dimension } from \"../../../../../common/models/dimension/dimension\";\nimport { Essence } from \"../../../../../common/models/essence/essence\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Split } from \"../../../../../common/models/split/split\";\nimport { Omit } from \"../../../../../common/utils/functional/functional\";\nimport { selectFirstSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\nimport { getContinuousSplit, getNominalDimension, getNominalSplit, hasNominalSplit } from \"../../../line-chart/utils/splits\";\n\nenum ModelVariantId { BASE, STACKED }\n\ninterface BarChartModelCommons {\n  variant: ModelVariantId;\n  continuousSplit: Split;\n  timezone: Timezone;\n  hasComparison: boolean;\n  series: List<ConcreteSeries>;\n}\n\nexport interface BaseBarChartModel extends BarChartModelCommons {\n  variant: ModelVariantId.BASE;\n}\n\ntype Color = string;\n\ntype ColorMap = OrderedMap<string, Color>;\n\nexport interface StackedBarChartModel extends BarChartModelCommons {\n  variant: ModelVariantId.STACKED;\n  colors: ColorMap;\n  nominalSplit: Split;\n  nominalDimension: Dimension;\n}\n\nexport type BarChartModel = BaseBarChartModel | StackedBarChartModel;\n\nexport function isStacked(model: BarChartModel): model is StackedBarChartModel {\n  return model.variant === ModelVariantId.STACKED;\n}\n\nfunction readCommons(essence: Essence): Omit<BarChartModelCommons, \"variant\"> {\n  const continuousSplit = getContinuousSplit(essence);\n  const hasComparison = essence.hasComparison();\n  const timezone = essence.timezone;\n  const series = essence.getConcreteSeries();\n  return {\n    continuousSplit,\n    hasComparison,\n    timezone,\n    series\n  };\n}\n\nfunction createColorMap(nominalSplit: Split, dataset: Dataset, colors: VisualizationColors): ColorMap {\n  const datums = selectFirstSplitDatums(dataset);\n  return datums.reduce<ColorMap>((map: ColorMap, datum: Datum, i: number) => {\n    const key = String(nominalSplit.selectValue(datum));\n    const colorIndex = i % colors.series.length;\n    const color = colors.series[colorIndex];\n    return map.set(key, color);\n  }, OrderedMap<string, Color>());\n}\n\nexport function create(essence: Essence, dataset: Dataset, customization: ClientCustomization): BarChartModel {\n  const { visualizationColors } = customization;\n  const commons = readCommons(essence);\n  if (!hasNominalSplit(essence)) {\n    return {\n      ...commons,\n      variant: ModelVariantId.BASE\n    };\n  }\n  const nominalSplit = getNominalSplit(essence);\n  const nominalDimension = getNominalDimension(essence);\n  const colors = createColorMap(nominalSplit, dataset, visualizationColors);\n  return {\n    ...commons,\n    variant: ModelVariantId.STACKED,\n    nominalSplit,\n    nominalDimension,\n    colors\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { createColorEntry } from \"../../../../components/color-swabs/color-entry\";\nimport { ColorSwabs } from \"../../../../components/color-swabs/color-swabs\";\nimport { SeriesBubbleContent } from \"../../../../components/series-bubble-content/series-bubble-content\";\nimport { selectSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\nimport { BarChartModel, isStacked, StackedBarChartModel } from \"../utils/bar-chart-model\";\n\ninterface ContentProps {\n  model: BarChartModel;\n  datum: Datum;\n  series: ConcreteSeries;\n}\n\nfunction colorEntries(datum: Datum, series: ConcreteSeries, model: StackedBarChartModel) {\n  const { nominalSplit, colors, hasComparison } = model;\n  const datums = selectSplitDatums(datum);\n  const colorEntries = colors.entrySeq().toArray();\n  return colorEntries.map(([name, color]) => {\n    const datum = datums.find(d => String(nominalSplit.selectValue(d)) === name);\n\n    if (!datum) {\n      return { color, name, value: \"-\" };\n    }\n\n    return createColorEntry({ color, name, hasComparison, datum, series });\n  });\n}\n\nexport const Content: React.FunctionComponent<ContentProps> = props => {\n  const { model, series, datum } = props;\n  if (isStacked(model)) {\n    const entries = colorEntries(datum, series, model);\n    return <ColorSwabs colorEntries={entries} />;\n  }\n  return <SeriesBubbleContent series={series} datum={datum} showPrevious={model.hasComparison}/>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { SegmentBubble } from \"../../../../components/segment-bubble/segment-bubble\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { Hover } from \"../interactions/interaction\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { Content } from \"./tooltip-content\";\n\ninterface HoverTooltipProps {\n  interaction: Hover;\n  xScale: XScale;\n  yScale: LinearScale;\n  series: ConcreteSeries;\n  model: BarChartModel;\n  rect: ClientRect | DOMRect;\n}\n\nexport const HoverTooltip: React.FunctionComponent<HoverTooltipProps> = props => {\n  const {\n    model,\n    rect: { left, top },\n    interaction: { datum },\n    series,\n    xScale,\n    yScale\n  } = props;\n  const { continuousSplit, timezone } = model;\n  const y = yScale(series.selectValue(datum));\n  const xValue = continuousSplit.selectValue<DomainValue>(datum);\n  const x = xScale.calculate(xValue) + (xScale.bandwidth() / 2);\n  return <SegmentBubble\n    top={top + y}\n    left={left + x}\n    title={continuousSplit.formatValue(datum, timezone)}\n    content={<Content model={model} datum={datum} series={series}/>} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { safeEquals } from \"../../../../../common/utils/immutable-utils/immutable-utils\";\n\nenum InteractionKind { HOVER, HIGHLIGHT }\n\ninterface InteractionBase {\n  kind: InteractionKind;\n  datum: Datum;\n  key: string;\n}\n\nexport interface Hover extends InteractionBase {\n  kind: InteractionKind.HOVER;\n}\n\nexport const createHover = (key: string, datum: Datum): Hover => ({\n  kind: InteractionKind.HOVER,\n  datum,\n  key\n});\n\nexport const isHover = (interaction?: Interaction): interaction is Hover => interaction && interaction.kind === InteractionKind.HOVER;\n\nexport interface Highlight extends InteractionBase {\n  kind: InteractionKind.HIGHLIGHT;\n}\n\nexport const createHighlight = (key: string, datum: Datum): Highlight => ({\n  kind: InteractionKind.HIGHLIGHT,\n  datum,\n  key\n});\n\nexport const isHighlight = (interaction?: Interaction): interaction is Highlight => interaction && interaction.kind === InteractionKind.HIGHLIGHT;\n\nexport type Interaction = Hover | Highlight;\n\nexport function equalInteractions(a: Interaction, b: Interaction): boolean {\n  return a.kind === b.kind\n    && a.key === b.key\n    && safeEquals(a.datum, b.datum);\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Nullary } from \"../../../../../common/utils/functional/functional\";\nimport { HighlightModal as BaseHighlightModal } from \"../../../../components/highlight-modal/highlight-modal\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { Highlight } from \"../interactions/interaction\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\n\ninterface HighlightModalProps {\n  interaction: Highlight;\n  dropHighlight: Nullary<void>;\n  acceptHighlight: Nullary<void>;\n  xScale: XScale;\n  yScale: LinearScale;\n  series: ConcreteSeries;\n  model: BarChartModel;\n  rect: ClientRect | DOMRect;\n}\n\nexport const HighlightModal: React.FunctionComponent<HighlightModalProps> = props => {\n  const {\n    model: { timezone, continuousSplit },\n    rect: { left, top },\n    interaction: { datum },\n    dropHighlight,\n    acceptHighlight,\n    yScale,\n    series,\n    xScale } = props;\n  const xValue = continuousSplit.selectValue<DomainValue>(datum);\n  const x = xScale.calculate(xValue) + (xScale.bandwidth() / 2);\n  const yValue = series.selectValue(datum);\n  const y = yScale(yValue);\n  return <BaseHighlightModal\n    title={continuousSplit.formatValue(datum, timezone)}\n    left={left + x}\n    top={top + y}\n    dropHighlight={dropHighlight}\n    acceptHighlight={acceptHighlight} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { Highlighter } from \"../../../../components/highlighter/highlighter\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { TOP_PADDING } from \"../bar/padding\";\nimport { Highlight } from \"../interactions/interaction\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\n\ninterface HighlightOverlayProps {\n  interaction: Highlight;\n  xScale: XScale;\n  yScale: LinearScale;\n  series: ConcreteSeries;\n  stage: Stage;\n  model: BarChartModel;\n}\n\nfunction getYValue(datum: Datum, series: ConcreteSeries, includePrevious: boolean): number {\n  if (!includePrevious) {\n    return series.selectValue(datum);\n  }\n  return Math.max(series.selectValue(datum), series.selectValue(datum, SeriesDerivation.PREVIOUS));\n}\n\nexport const HighlightOverlay: React.FunctionComponent<HighlightOverlayProps> = props => {\n  const { stage, yScale, series, xScale, model: { hasComparison, continuousSplit }, interaction: { datum } } = props;\n  const xValue = continuousSplit.selectValue<DomainValue>(datum);\n  const left = xScale.calculate(xValue);\n  const right = left + xScale.bandwidth();\n  const yValue = getYValue(datum, series, hasComparison);\n  const top = yScale(yValue) + stage.y - TOP_PADDING;\n  return <Highlighter left={left} right={right} top={top} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const SIDE_PADDING = 5;\nexport const TOP_PADDING = 5;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { Nullary } from \"../../../../../common/utils/functional/functional\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { HoverTooltip } from \"../hover-tooltip/hover-tooltip\";\nimport { Interaction, isHighlight, isHover } from \"../interactions/interaction\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { XScale } from \"../utils/x-scale\";\nimport { HighlightModal } from \"./highlight-modal\";\nimport { HighlightOverlay } from \"./highlight-overlay\";\n\ninterface ForegroundProps {\n  interaction: Interaction;\n  container: React.RefObject<HTMLDivElement>;\n  dropHighlight: Nullary<void>;\n  acceptHighlight: Nullary<void>;\n  xScale: XScale;\n  yScale: LinearScale;\n  series: ConcreteSeries;\n  model: BarChartModel;\n  stage: Stage;\n}\n\nexport const Foreground: React.FunctionComponent<ForegroundProps> = props => {\n  const { stage, dropHighlight, acceptHighlight, container, model, series, xScale, yScale, interaction } = props;\n  const rect = container.current.getBoundingClientRect();\n  return <React.Fragment>\n    {isHighlight(interaction) && <React.Fragment>\n      <HighlightModal\n        interaction={interaction}\n        dropHighlight={dropHighlight}\n        acceptHighlight={acceptHighlight}\n        xScale={xScale}\n        yScale={yScale}\n        model={model}\n        series={series}\n        rect={rect} />\n      <HighlightOverlay\n        interaction={interaction}\n        stage={stage}\n        xScale={xScale}\n        yScale={yScale}\n        series={series}\n        model={model} />\n    </React.Fragment>}\n    {isHover(interaction) && <HoverTooltip\n      rect={rect}\n      interaction={interaction}\n      xScale={xScale}\n      yScale={yScale}\n      series={series}\n      model={model} />}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { ScrollerLayout } from \"../../../../components/scroller/scroller\";\nimport { calculateSegmentStage } from \"./calculate-segment-stage\";\n\nconst Y_AXIS_WIDTH = 60;\nconst X_AXIS_HEIGHT = 40;\nconst LEFT_PADDING = 5;\nconst MARGINS: Margins = {\n  left: LEFT_PADDING,\n  right: Y_AXIS_WIDTH,\n  bottom: X_AXIS_HEIGHT\n};\n\ninterface Margins {\n  left: number;\n  right: number;\n  bottom: number;\n}\n\nexport interface BarChartLayout {\n  scroller: ScrollerLayout;\n  segment: Stage;\n}\n\nexport function calculateLayout(visualisationStage: Stage, domainLength: number, seriesCount: number): BarChartLayout {\n  const bodyStage = visualisationStage.within(MARGINS);\n  const segmentStage = calculateSegmentStage(bodyStage, domainLength, seriesCount);\n  const innerBodyHeight = segmentStage.height * seriesCount;\n  return {\n    scroller: {\n      bodyHeight: innerBodyHeight,\n      bodyWidth: segmentStage.width,\n      top: 0,\n      left: MARGINS.left,\n      right: MARGINS.right,\n      bottom: MARGINS.bottom\n    },\n    segment: segmentStage\n  };\n}\n\nconst TOP_MARGIN = 30;\nconst BOTTOM_MARGIN = 0;\n\nexport function calculateChartStage(segmentStage: Stage): Stage {\n  return segmentStage.within({ top: TOP_MARGIN, bottom: BOTTOM_MARGIN });\n}\n\nexport function calculateYAxisStage(segmentStage: Stage): Stage {\n  return Stage.fromJS({\n    x: 0,\n    y: TOP_MARGIN,\n    width: Y_AXIS_WIDTH,\n    height: segmentStage.height - TOP_MARGIN - BOTTOM_MARGIN\n  });\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Stage } from \"../../../../../common/models/stage/stage\";\n\nconst BAR_MIN_WIDTH = 30;\nconst MIN_CHART_HEIGHT = 200;\n\nexport function calculateSegmentStage(bodyStage: Stage, domainSize: number, seriesCount: number): Stage {\n  const width = Math.max(bodyStage.width, domainSize * BAR_MIN_WIDTH);\n  const availableHeight = bodyStage.height;\n  const heightFromEvenDivision = Math.floor(availableHeight / seriesCount);\n  const height = Math.max(MIN_CHART_HEIGHT, heightFromEvenDivision);\n  return Stage.fromSize(width, height);\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { datumsExtent, Extent, seriesSelectors } from \"../../../../utils/extent/extent\";\n\nexport function yExtent(datums: Datum[], series: ConcreteSeries, hasComparison: boolean): Extent {\n  return datumsExtent(datums, seriesSelectors(series, hasComparison));\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { useSettingsContext } from \"../../../../views/cube-view/settings-context\";\nimport { BaseBarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { SIDE_PADDING } from \"./padding\";\n\ninterface SingleBarProps {\n  datum: Datum;\n  yScale: LinearScale;\n  xScale: XScale;\n  series: ConcreteSeries;\n  model: BaseBarChartModel;\n}\n\nexport const SingleBar: React.FunctionComponent<SingleBarProps> = props => {\n  const { customization: { visualizationColors } } = useSettingsContext();\n  const { datum, xScale, yScale, model: { continuousSplit }, series } = props;\n  const [maxHeight] = yScale.range();\n  const x = continuousSplit.selectValue<DomainValue>(datum);\n  const xPos = xScale.calculate(x) + SIDE_PADDING;\n  const width = xScale.bandwidth() - (2 * SIDE_PADDING);\n  const y = series.selectValue(datum);\n  const yPos = yScale(y);\n  const height = maxHeight - yPos;\n  const fill = visualizationColors.main;\n\n  return <rect\n    className=\"bar-chart-bar\"\n    x={xPos}\n    y={yPos}\n    fill={fill}\n    width={width}\n    height={height} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { alphaMain } from \"../../../../../common/models/colors/colors\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../../common/models/series/concrete-series\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { useSettingsContext } from \"../../../../views/cube-view/settings-context\";\nimport { BaseBarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { SIDE_PADDING } from \"./padding\";\n\ninterface SingleTimeShiftBar {\n  datum: Datum;\n  yScale: LinearScale;\n  xScale: XScale;\n  series: ConcreteSeries;\n  model: BaseBarChartModel;\n}\n\nexport const SingleTimeShiftBar: React.FunctionComponent<SingleTimeShiftBar> = props => {\n  const { customization: { visualizationColors } } = useSettingsContext();\n  const { datum, xScale, yScale, model: { continuousSplit }, series } = props;\n  const [maxHeight] = yScale.range();\n  const x = continuousSplit.selectValue<DomainValue>(datum);\n  const xStart = xScale.calculate(x);\n  const rangeBand = xScale.bandwidth();\n  const fullWidth = rangeBand - 2 * SIDE_PADDING;\n  const barWidth = fullWidth * 2 / 3;\n\n  const yCurrent = series.selectValue(datum);\n  const yPrevious = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const yCurrentStart = yScale(yCurrent);\n  const yPreviousStart = yScale(yPrevious);\n\n  const currentFill = visualizationColors.main;\n  const previousFill = alphaMain(visualizationColors);\n\n  return <React.Fragment>\n    <rect\n      className=\"bar-chart-bar-previous\"\n      x={xStart + rangeBand - SIDE_PADDING - barWidth}\n      y={yPreviousStart}\n      fill={previousFill}\n      width={barWidth}\n      height={maxHeight - yPreviousStart} />\n    <rect\n      className=\"bar-chart-bar\"\n      x={xStart + SIDE_PADDING}\n      y={yCurrentStart}\n      fill={currentFill}\n      width={barWidth}\n      height={maxHeight - yCurrentStart} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../../common/models/series/concrete-series\";\nimport { cons, threadConditionally } from \"../../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../../config/constants\";\nimport { selectSplitDataset, selectSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\n\nexport function selectBase(datum: Datum, series: ConcreteSeries, period = SeriesDerivation.CURRENT): number {\n  return datum[stackBaseKey(series, period)] as number;\n}\n\nfunction stackBaseKey(series: ConcreteSeries, period = SeriesDerivation.CURRENT): string {\n  return `__stack_base_${series.plywoodKey(period)}`;\n}\n\nfunction stackBy(series: ConcreteSeries, period = SeriesDerivation.CURRENT) {\n  return (datum: Datum): Datum => {\n    const values = selectSplitDatums(datum);\n    const { y0, stacked } = values.reduce(({ y0, stacked }, value) => {\n      const y = series.selectValue(value, period);\n      const baseKey = stackBaseKey(series, period);\n\n      return {\n        y0: y + y0,\n        stacked: cons(stacked, { ...value, [baseKey]: y0 })\n      };\n\n    }, { y0: 0, stacked: [] });\n\n    const maxKey = series.plywoodKey(period);\n    return {\n      ...datum,\n      [maxKey]: y0,\n      [SPLIT]: selectSplitDataset(datum).changeData(stacked)\n    };\n  };\n}\n\nexport function stack(datums: Datum[], series: ConcreteSeries, includePrevious: boolean): Datum[] {\n  return datums.map(datum =>\n    threadConditionally(datum,\n      stackBy(series),\n      includePrevious && stackBy(series, SeriesDerivation.PREVIOUS)));\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { selectSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { StackedBarChartModel } from \"../utils/bar-chart-model\";\nimport { selectBase } from \"../utils/stack-layout\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { SIDE_PADDING } from \"./padding\";\n\ninterface StackedBarProps {\n  model: StackedBarChartModel;\n  datum: Datum;\n  yScale: LinearScale;\n  xScale: XScale;\n  series: ConcreteSeries;\n}\n\nexport const StackedBar: React.FunctionComponent<StackedBarProps> = props => {\n  const { datum, xScale, yScale, series, model: { colors, continuousSplit, nominalSplit } } = props;\n  const datums = selectSplitDatums(datum);\n\n  const x = continuousSplit.selectValue<DomainValue>(datum);\n  const xPos = xScale.calculate(x) + SIDE_PADDING;\n  const width = xScale.bandwidth() - (2 * SIDE_PADDING);\n  const color = (d: Datum) => colors.get(String(nominalSplit.selectValue(d)));\n  return <React.Fragment>\n    {datums.map(datum => {\n      const key = String(nominalSplit.selectValue(datum));\n      const y = series.selectValue(datum);\n      const y0 = selectBase(datum, series);\n      const yPos = yScale(y + y0);\n      const height = yScale(y0) - yScale(y + y0);\n\n      return <rect\n        className=\"bar-chart-bar-segment\"\n        key={String(key)}\n        x={xPos}\n        y={yPos}\n        width={width}\n        height={height}\n        fill={color(datum)}\n      />;\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../../common/models/series/concrete-series\";\nimport { selectSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\nimport { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { StackedBarChartModel } from \"../utils/bar-chart-model\";\nimport { selectBase } from \"../utils/stack-layout\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { SIDE_PADDING } from \"./padding\";\n\ninterface StackedTimeShiftBarProps {\n  model: StackedBarChartModel;\n  datum: Datum;\n  yScale: LinearScale;\n  xScale: XScale;\n  series: ConcreteSeries;\n}\n\nexport const StackedTimeShiftBar: React.FunctionComponent<StackedTimeShiftBarProps> = props => {\n  const { datum, xScale, yScale, series, model: { nominalSplit, continuousSplit, colors } } = props;\n  const datums = selectSplitDatums(datum);\n\n  const x = continuousSplit.selectValue<DomainValue>(datum);\n\n  const xStart = xScale.calculate(x);\n  const rangeBand = xScale.bandwidth();\n  const fullWidth = rangeBand - 2 * SIDE_PADDING;\n  const barWidth = fullWidth * 2 / 3;\n  const color = (d: Datum) => colors.get(String(nominalSplit.selectValue(d)));\n  return <React.Fragment>\n    {datums.map(datum => {\n      const key = `${nominalSplit.selectValue(datum)}--previous`;\n      const yPrevious = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n      const yPreviousBase = selectBase(datum, series, SeriesDerivation.PREVIOUS);\n      const yPreviousPos = yScale(yPrevious + yPreviousBase);\n      const previousHeight = yScale(yPreviousBase) - yScale(yPrevious + yPreviousBase);\n\n      const previousColor = d3.rgb(color(datum)).darker(0.8);\n\n      return <rect\n          className=\"bar-chart-bar-segment\"\n          key={String(key)}\n          x={xStart + rangeBand - SIDE_PADDING - barWidth}\n          y={yPreviousPos}\n          width={barWidth}\n          height={previousHeight}\n          opacity={0.8}\n          fill={previousColor.toString()}\n        />;\n    })}\n    {datums.map(datum => {\n      const key = `${nominalSplit.selectValue(datum)}--current`;\n      const yCurrent = series.selectValue(datum);\n      const yCurrentBase = selectBase(datum, series);\n      const yCurrentPos = yScale(yCurrent + yCurrentBase);\n      const currentHeight = yScale(yCurrentBase) - yScale(yCurrent + yCurrentBase);\n      const currentColor = color(datum);\n\n      return <rect\n        className=\"bar-chart-bar-previous-segment\"\n        key={key}\n        x={xStart + SIDE_PADDING}\n        y={yCurrentPos}\n        width={barWidth}\n        height={currentHeight}\n        fill={currentColor}\n      />;\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { VerticalAxis } from \"../../../../components/vertical-axis/vertical-axis\";\nimport { LinearScale, pickTicks } from \"../../../../utils/linear-scale/linear-scale\";\n\nexport const TICK_LENGTH = 10;\n\ninterface SingleYAxisProps {\n  series: ConcreteSeries;\n  scale: LinearScale;\n  stage: Stage;\n}\n\nexport const SingleYAxis: React.FunctionComponent<SingleYAxisProps> = props => {\n  const { scale, series, stage } = props;\n  return <div>\n    <svg viewBox={stage.getViewBox()}>\n      <g transform=\"translate(-1, 0)\">\n        <VerticalAxis\n          stage={stage}\n          ticks={pickTicks(scale)}\n          tickSize={TICK_LENGTH}\n          scale={scale}\n          formatter={series.formatter()} />\n      </g>\n    </svg>\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { BottomBorder, RightBorder } from \"../../../../components/grid-border/grid-border\";\nimport { GridLines } from \"../../../../components/grid-lines/grid-lines\";\nimport { LinearScale, pickTicks } from \"../../../../utils/linear-scale/linear-scale\";\nimport { TICK_LENGTH } from \"../y-axis/single-y-axis\";\n\ninterface BackgroundProps {\n  gridStage: Stage;\n  yScale: LinearScale;\n}\n\nexport const Background: React.FunctionComponent<BackgroundProps> = props => {\n  const { gridStage, yScale } = props;\n  const ticks = pickTicks(yScale);\n  return <React.Fragment>\n    <GridLines\n      orientation=\"horizontal\"\n      scale={yScale}\n      ticks={ticks}\n      stage={gridStage}\n    />\n    <BottomBorder stage={gridStage} tickLength={TICK_LENGTH} />\n    <RightBorder stage={gridStage}/>\n\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport getScale, { LinearScale } from \"../../../../utils/linear-scale/linear-scale\";\nimport { SingleBar } from \"../bar/single-bar\";\nimport { SingleTimeShiftBar } from \"../bar/single-time-shift-bar\";\nimport { StackedBar } from \"../bar/stacked-bar\";\nimport { StackedTimeShiftBar } from \"../bar/stacked-time-shift-bar\";\nimport { BarChartModel, isStacked } from \"../utils/bar-chart-model\";\nimport { XScale } from \"../utils/x-scale\";\nimport { yExtent } from \"../utils/y-extent\";\nimport { Background } from \"./background\";\n\ninterface BarProps {\n  model: BarChartModel;\n  datum: Datum;\n  yScale: LinearScale;\n  xScale: XScale;\n  series: ConcreteSeries;\n}\n\nconst Bar: React.FunctionComponent<BarProps> = props => {\n  const { model, ...rest } = props;\n  const showPrevious = model.hasComparison;\n  if (isStacked(model)) {\n    return showPrevious\n      ? <StackedTimeShiftBar {...rest} model={model} />\n      : <StackedBar {...rest} model={model} />;\n  }\n  return showPrevious\n    ? <SingleTimeShiftBar {...rest} model={model} />\n    : <SingleBar {...rest} model={model} />;\n};\n\ninterface BarsProps {\n  model: BarChartModel;\n  stage: Stage;\n  xScale: XScale;\n  series: ConcreteSeries;\n  datums: Datum[];\n}\n\nexport const Bars: React.FunctionComponent<BarsProps> = props => {\n  const { model, stage, xScale, series, datums } = props;\n  const extent = yExtent(datums, series, model.hasComparison);\n  const yScale = getScale(extent, stage.height);\n  if (!yScale) return null;\n  return <React.Fragment>\n    <svg viewBox={stage.getViewBox()}>\n      <Background gridStage={stage} yScale={yScale} />\n      <g transform={stage.getTransform()}>\n        {datums.map((datum: Datum, index: number) => <Bar\n          key={index}\n          datum={datum}\n          model={model}\n          yScale={yScale}\n          xScale={xScale}\n          series={series}\n        />)}\n      </g>\n    </svg>\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { Nullary } from \"../../../../../common/utils/functional/functional\";\nimport { VisMeasureLabel } from \"../../../../components/vis-measure-label/vis-measure-label\";\nimport getScale from \"../../../../utils/linear-scale/linear-scale\";\nimport { Foreground } from \"../foreground/foreground\";\nimport { Interaction } from \"../interactions/interaction\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { calculateChartStage } from \"../utils/layout\";\nimport { XScale } from \"../utils/x-scale\";\nimport { yExtent } from \"../utils/y-extent\";\nimport { Bars } from \"./bars\";\nimport \"./bars.scss\";\n\ninterface BarsContainerProps {\n  dropHighlight: Nullary<void>;\n  acceptHighlight: Nullary<void>;\n  interaction?: Interaction;\n  series: ConcreteSeries;\n  model: BarChartModel;\n  datums: Datum[];\n  totals: Datum;\n  xScale: XScale;\n  stage: Stage;\n  scrollLeft: number;\n}\n\nconst TOTAL_LABEL_OFFSET = 10;\n\nexport class BarsContainer extends React.Component<BarsContainerProps> {\n\n  private container = React.createRef<HTMLDivElement>();\n\n  render() {\n    const { dropHighlight, acceptHighlight, interaction, model, stage, scrollLeft, series, totals, datums, xScale } = this.props;\n    const hasComparison = model.hasComparison;\n    const chartStage = calculateChartStage(stage);\n    const extent = yExtent(datums, series, hasComparison);\n    const yScale = getScale(extent, chartStage.height);\n\n    return <React.Fragment>\n      <div\n        ref={this.container}\n        className=\"bar-chart-bars\"\n        style={stage.getWidthHeight()}>\n        <div className=\"bar-chart-total\" style={{ left: scrollLeft + TOTAL_LABEL_OFFSET }}>\n          <VisMeasureLabel\n            series={series}\n            datum={totals}\n            showPrevious={hasComparison} />\n        </div>\n        <Bars\n          model={model}\n          stage={chartStage}\n          xScale={xScale}\n          series={series}\n          datums={datums} />\n        {interaction && <Foreground\n          interaction={interaction}\n          container={this.container}\n          stage={chartStage}\n          dropHighlight={dropHighlight}\n          acceptHighlight={acceptHighlight}\n          model={model}\n          xScale={xScale}\n          series={series}\n          yScale={yScale} />}\n      </div>\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { StackedBarChartModel } from \"../utils/bar-chart-model\";\nimport \"./legend.scss\";\n\ninterface LegendProps {\n  model: StackedBarChartModel;\n}\n\ninterface LegendValuesProps {\n  colors: StackedBarChartModel[\"colors\"];\n}\n\nconst LegendValues: React.FunctionComponent<LegendValuesProps> = ({ colors }) => {\n  return <div className=\"legend-values\">\n    <table className=\"legend-values-table\">\n      <tbody>\n      {colors.entrySeq().toArray().map(([segment, color]) => {\n        const style = { background: color };\n        return <tr key={segment} className=\"legend-value\">\n          <td className=\"legend-value-color-cell\">\n            <div className=\"legend-value-color\" style={style} />\n          </td>\n          <td className=\"legend-value-label\">\n            <span className=\"legend-value-name\">{segment}</span>\n          </td>\n        </tr>;\n      })}\n      </tbody>\n    </table>\n  </div>;\n};\n\nexport const Legend: React.FunctionComponent<LegendProps> = props => {\n  const { model: { nominalSplit, nominalDimension, colors } } = props;\n  const title = nominalSplit.getTitle(nominalDimension);\n\n  return <div className=\"bar-chart-legend\">\n    <div className=\"legend-header\">\n      {title}\n    </div>\n    <LegendValues colors={colors} />\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { Nullary } from \"../../../../../common/utils/functional/functional\";\nimport { LegendSpot } from \"../../../../components/pinboard-panel/pinboard-panel\";\nimport { BarsContainer } from \"../bars/bars-container\";\nimport { Interaction } from \"../interactions/interaction\";\nimport { Legend } from \"../legend/Legend\";\nimport { BarChartModel, isStacked } from \"../utils/bar-chart-model\";\nimport { XScale } from \"../utils/x-scale\";\n\ninterface BarChartsProps {\n  interaction: Interaction;\n  dropHighlight: Nullary<void>;\n  acceptHighlight: Nullary<void>;\n  stage: Stage;\n  scrollLeft: number;\n  model: BarChartModel;\n  datums: Datum[];\n  totals: Datum;\n  xScale: XScale;\n}\n\nexport const BarCharts: React.FunctionComponent<BarChartsProps> = props => {\n  const { dropHighlight, acceptHighlight, interaction, model, datums, xScale, scrollLeft, stage, totals } = props;\n  const seriesList = model.series.toArray();\n  return <React.Fragment>\n    {isStacked(model) && <LegendSpot>\n      <Legend model={model}/>\n    </LegendSpot>}\n    {seriesList.map(series => {\n      const hasInteraction = !!interaction && interaction.key === series.plywoodKey();\n      return <BarsContainer\n        key={series.reactKey()}\n        stage={stage}\n        scrollLeft={scrollLeft}\n        interaction={hasInteraction && interaction}\n        series={series}\n        xScale={xScale}\n        datums={datums}\n        totals={totals}\n        model={model}\n        acceptHighlight={acceptHighlight}\n        dropHighlight={dropHighlight} />;\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { List } from \"immutable\";\nimport { Datum, Range, TimeRange } from \"plywood\";\nimport React from \"react\";\nimport { DateRange } from \"../../../../../common/models/date-range/date-range\";\nimport { FilterClause, FixedTimeFilterClause } from \"../../../../../common/models/filter-clause/filter-clause\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { Binary, Unary } from \"../../../../../common/utils/functional/functional\";\nimport { safeEquals } from \"../../../../../common/utils/immutable-utils/immutable-utils\";\nimport { ScrollerPart } from \"../../../../components/scroller/scroller\";\nimport { toPlywoodRange } from \"../../../../utils/highlight-clause/highlight-clause\";\nimport { Highlight } from \"../../../highlight-controller/highlight\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { BarChartLayout } from \"../utils/layout\";\nimport { DomainValue } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport { createHighlight, createHover, equalInteractions, Hover, Interaction } from \"./interaction\";\n\ninterface InteractionProps {\n  onClick?: (x: number, y: number, part: ScrollerPart) => void;\n  onMouseMove?: (x: number, y: number, part: ScrollerPart) => void;\n  onMouseLeave?: () => void;\n  onScroll?: (scrollTop: number, scrollLeft: number) => void;\n  scrollLeft: number;\n  scrollTop: number;\n  interaction: Interaction | null;\n}\n\ninterface InteractionControllerProps {\n  xScale: XScale;\n  model: BarChartModel;\n  datums: Datum[];\n  layout: BarChartLayout;\n  children: Unary<InteractionProps, React.ReactNode>;\n  highlight?: Highlight;\n  saveHighlight: Binary<List<FilterClause>, string, void>;\n}\n\ninterface InteractionControllerState {\n  hover?: Hover;\n  scrollLeft: number;\n  scrollTop: number;\n}\n\nexport class InteractionController extends React.Component<InteractionControllerProps, InteractionControllerState> {\n\n  state: InteractionControllerState = { hover: null, scrollLeft: 0, scrollTop: 0 };\n\n  saveScroll = (scrollTop: number, scrollLeft: number) => {\n    this.setState({\n      hover: null,\n      scrollLeft,\n      scrollTop\n    });\n  };\n\n  saveHover = (x: number, y: number, part: ScrollerPart) => {\n    const { highlight } = this.props;\n    if (highlight) return;\n    const value = this.getValueFromEvent(x, part);\n    if (!Range.isRange(value)) return;\n    const series = this.getSeriesFromEvent(y, part);\n    if (series === null) return;\n    const datum = this.findDatumByValue(value);\n    const hover = createHover(series.plywoodKey(), datum);\n    const { hover: oldHover } = this.state;\n    if (oldHover && equalInteractions(oldHover, hover)) return;\n    this.setState({ hover });\n  };\n\n  resetHover = () => {\n    const { hover } = this.state;\n    if (hover) {\n      this.setState({ hover: null });\n    }\n  };\n\n  handleClick = (x: number, y: number, part: ScrollerPart) => {\n    const value = this.getValueFromEvent(x, part);\n    if (!TimeRange.isTimeRange(value)) return;\n    this.setState({ hover: null });\n    const series = this.getSeriesFromEvent(y, part);\n    if (series === null) return;\n    const { saveHighlight, model } = this.props;\n    const { reference } = model.continuousSplit;\n    const values = List.of(new DateRange(value));\n    const clause = new FixedTimeFilterClause({ reference, values });\n    saveHighlight(List.of(clause), series.plywoodKey());\n  };\n\n  getValueFromEvent(x: number, part: ScrollerPart): DomainValue | null {\n    if (part !== \"body\") return null;\n    const { layout, xScale } = this.props;\n    return xScale.invert(x - layout.scroller.left);\n  }\n\n  findDatumByValue(value: DomainValue): Datum | null {\n    const { model: { continuousSplit }, datums } = this.props;\n    return datums.find(datum => safeEquals(value, continuousSplit.selectValue(datum)));\n  }\n\n  getSeriesFromEvent(y: number, part: ScrollerPart): ConcreteSeries | null {\n    if (part !== \"body\") return null;\n    const { layout: { segment: { height: seriesHeight } }, model: { series } } = this.props;\n    const index = Math.floor(y / seriesHeight);\n    return series.get(index) || null;\n  }\n\n  interaction(): Interaction | null {\n    const { highlight } = this.props;\n    if (highlight) {\n      const value = toPlywoodRange(highlight.clauses.first());\n      const datum = this.findDatumByValue(value);\n      return createHighlight(highlight.key, datum);\n    }\n    return this.state.hover;\n  }\n\n  render() {\n    const { children } = this.props;\n    const { scrollLeft, scrollTop } = this.state;\n    return children({\n      interaction: this.interaction(),\n      scrollLeft,\n      scrollTop,\n      onScroll: this.saveScroll,\n      onMouseLeave: this.resetHover,\n      onMouseMove: this.saveHover,\n      onClick: this.handleClick\n    });\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./spacer.scss\";\n\nexport const Spacer: React.FunctionComponent<{}> = props => {\n return <div className=\"spacer\" />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../../../common/models/series/concrete-series\";\nimport { mapSplitDatums } from \"../../../../utils/dataset/split/map-split-datums\";\nimport { StackedBarChartModel } from \"./bar-chart-model\";\nimport { stack } from \"./stack-layout\";\n\nconst reverse = (datums: Datum[]): Datum[] => datums.slice().reverse();\n\nconst reverseSplitDatums = (datum: Datum) => mapSplitDatums(datum, reverse);\n\nexport function stackDataset(dataset: Datum[], { series, hasComparison }: StackedBarChartModel): Datum[] {\n  const seriesList = series.toArray();\n  const reversedDatums = dataset.map(reverseSplitDatums);\n  return seriesList.reduce((datums: Datum[], series: ConcreteSeries) =>\n    stack(datums, series, hasComparison), reversedDatums);\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Datum } from \"plywood\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../config/constants\";\nimport { selectSplitDataset, selectSplitDatums } from \"../selectors/selectors\";\n\nexport function mapSplitDatums(datum: Datum, fn: Unary<Datum[], Datum[]>): Datum {\n  const datums = selectSplitDatums(datum);\n  return {\n    ...datum,\n    [SPLIT]: selectSplitDataset(datum).changeData(fn(datums))\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum, NumberRange, TimeRange } from \"plywood\";\nimport { Split } from \"../../../../../common/models/split/split\";\nimport { Binary, cons, replaceAt, Unary } from \"../../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../../config/constants\";\nimport { selectFirstSplitDatums, selectSplitDatums } from \"../../../../utils/dataset/selectors/selectors\";\nimport { BarChartModel, isStacked } from \"./bar-chart-model\";\n\nfunction rangeComparator(continuousSplit: Split): Binary<Datum, Datum, number> {\n  return (a: Datum, b: Datum) => {\n    const aRange = continuousSplit.selectValue<TimeRange | NumberRange>(a);\n    const bRange = continuousSplit.selectValue<TimeRange | NumberRange>(b);\n    /*\n      NOTE: Conflict of variance:\n      `aRange` has type `TimeRange | NumberRange` and as a result\n      argument of `aRange.compare` has type `TimeRange & NumberRange`.\n      Such type is impossible, thus error\n    */\n    return aRange.compare(bRange as TimeRange & NumberRange);\n  };\n}\n\nfunction equalBy(split: Split, datum: Datum): Unary<Datum, boolean> {\n  const value = split.selectValue(datum);\n  return (d: Datum) => {\n    const range = split.selectValue(d);\n    if (TimeRange.isTimeRange(value) && TimeRange.isTimeRange(range)) {\n      return value.equals(range);\n    }\n    if (NumberRange.isNumberRange(value) && NumberRange.isNumberRange(range)) {\n      return value.equals(range);\n    }\n    return false;\n  };\n}\n\nfunction constructDatum(continuousRef: string, range: TimeRange, splitData: Datum[]): Datum {\n  return {\n    [continuousRef]: range,\n    [SPLIT]: new Dataset({ data: splitData })\n  };\n}\n\nfunction createInnerDatum(continuousRef: string, datum: Datum): Datum {\n  const { [continuousRef]: continuousAttr, ...splitDatum } = datum;\n  return constructDatum(continuousRef, continuousAttr as TimeRange, [splitDatum]);\n}\n\nfunction mergeDatums(continuousRef: string, datum: Datum, newDatum: Datum): Datum {\n  const splitData = selectSplitDatums(datum);\n  const { [continuousRef]: continuousAttr, ...splitDatum } = newDatum;\n  return constructDatum(continuousRef, continuousAttr as TimeRange, [...splitData, splitDatum]);\n}\n\nexport function transposeDataset(dataset: Dataset, model: BarChartModel): Datum[] {\n  if (!isStacked(model)) return selectFirstSplitDatums(dataset);\n\n  const { continuousSplit } = model;\n  const { data } = dataset.flatten();\n\n  const result = data.reduce((coll: Datum[], currentDatum: Datum) => {\n    const idx = coll.findIndex(equalBy(continuousSplit, currentDatum));\n    const notFound = idx === -1;\n\n    if (notFound) {\n      return cons(coll, createInnerDatum(continuousSplit.reference, currentDatum));\n    }\n\n    return replaceAt(coll, idx, mergeDatums(continuousSplit.reference, coll[idx], currentDatum));\n  }, []);\n\n  return result.sort(rangeComparator(continuousSplit));\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { NumberRange, TimeRange } from \"plywood\";\nimport { DomainValue, XDomain } from \"./x-domain\";\n\nexport interface XScale {\n  calculate(x: DomainValue): number;\n  invert(x: number): DomainValue;\n  domain(): XDomain;\n  bandwidth(): number;\n}\n\nexport function createXScale(domain: XDomain, width: number): XScale {\n  const range: [number, number] = [0, width];\n  const stringifiedDomain = domain.map(formatDomainValue);\n  const ordinalScale = d3.scaleBand()\n    .domain(stringifiedDomain)\n    .rangeRound(range);\n\n  const quantizedScale = d3.scaleQuantize<DomainValue>()\n    .domain(range)\n    .range(domain);\n\n  return {\n    calculate: (value: DomainValue) => ordinalScale(formatDomainValue(value)),\n    domain: () => domain,\n    invert: (x: number) => quantizedScale(x),\n    bandwidth: () => ordinalScale.bandwidth()\n  };\n}\n\nfunction formatDomainValue(value: DomainValue): string {\n  if (TimeRange.isTimeRange(value)) {\n    const { start } = value;\n    return start.toISOString();\n  }\n  if (NumberRange.isNumberRange(value)) {\n    const { start } = value;\n    return start.toString(10);\n  }\n  return String(value);\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { isContinuousSplit } from \"../../../../../common/models/split/split\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport { formatShortSegment } from \"../../../../../common/utils/formatter/formatter\";\nimport { roundToHalfPx } from \"../../../../utils/dom/dom\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { DomainValue, XDomain } from \"../utils/x-domain\";\nimport { XScale } from \"../utils/x-scale\";\nimport \"./x-axis.scss\";\n\ninterface XAxisProps {\n  model: BarChartModel;\n  stage: Stage;\n  scale: XScale;\n}\n\nconst TICK_HEIGHT = 10;\nconst TICK_TEXT_OFFSET = 12;\n\nfunction calculateTicks(domain: XDomain, { continuousSplit }: BarChartModel): DomainValue[] {\n  if (isContinuousSplit(continuousSplit)) {\n    return domain.filter((_, idx) => idx % 8 === 0);\n  }\n  return domain;\n}\n\nexport const XAxis: React.FunctionComponent<XAxisProps> = props => {\n  const { model, stage, scale } = props;\n  const ticks = calculateTicks(scale.domain(), model);\n  return <svg width={stage.width} height={stage.height}>\n    <g className=\"bar-chart-x-axis\">\n      {ticks.map((value, index) => {\n        const x = roundToHalfPx(scale.calculate(value));\n        const textAnchor = index === 0 ? \"start\" : \"middle\";\n        return <g key={String(value)} transform={`translate(${x}, 0)`}>\n          <line x1={0} x2={0} y1={0} y2={TICK_HEIGHT} />\n          <text y={TICK_HEIGHT + TICK_TEXT_OFFSET} style={{ textAnchor }}>\n            {formatShortSegment(value, model.timezone)}\n          </text>\n        </g>;\n      })}\n    </g>\n  </svg>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Stage } from \"../../../../../common/models/stage/stage\";\nimport getScale from \"../../../../utils/linear-scale/linear-scale\";\nimport { BarChartModel } from \"../utils/bar-chart-model\";\nimport { calculateYAxisStage } from \"../utils/layout\";\nimport { yExtent } from \"../utils/y-extent\";\nimport { SingleYAxis } from \"./single-y-axis\";\n\ninterface YAxisProps {\n  stage: Stage;\n  datums: Datum[];\n  model: BarChartModel;\n}\n\nexport const YAxis: React.FunctionComponent<YAxisProps> = props => {\n  const { model, stage, datums } = props;\n  const axisStage = calculateYAxisStage(stage);\n  const seriesList = model.series.toArray();\n  return <React.Fragment>\n    {seriesList.map(series => {\n      const extent = yExtent(datums, series, model.hasComparison);\n      const scale = getScale(extent, axisStage.height);\n      return <div\n        style={stage.getWidthHeight()}\n        key={series.reactKey()}>\n        {scale && <SingleYAxis\n          series={series}\n          scale={scale}\n          stage={axisStage} />}\n      </div>;\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ChartProps } from \"../../../../common/models/chart-props/chart-props\";\nimport { Stage } from \"../../../../common/models/stage/stage\";\nimport { MessageCard } from \"../../../components/message-card/message-card\";\nimport { Scroller } from \"../../../components/scroller/scroller\";\nimport { SPLIT } from \"../../../config/constants\";\nimport { selectMainDatum } from \"../../../utils/dataset/selectors/selectors\";\nimport { useSettingsContext } from \"../../../views/cube-view/settings-context\";\nimport { BarCharts } from \"./bar-charts/bar-charts\";\nimport { InteractionController } from \"./interactions/interaction-controller\";\nimport { Spacer } from \"./spacer/spacer\";\nimport { create, isStacked } from \"./utils/bar-chart-model\";\nimport { calculateLayout } from \"./utils/layout\";\nimport { stackDataset } from \"./utils/stack-dataset\";\nimport { transposeDataset } from \"./utils/transpose-dataset\";\nimport { getXDomain } from \"./utils/x-domain\";\nimport { createXScale } from \"./utils/x-scale\";\nimport { XAxis } from \"./x-axis/x-axis\";\nimport { YAxis } from \"./y-axis/y-axis\";\n\nexport const BarChart: React.FunctionComponent<ChartProps> = props => {\n  const { customization } = useSettingsContext();\n  const { data: dataset, essence, stage, highlight, acceptHighlight, dropHighlight, saveHighlight } = props;\n  const model = create(essence, dataset, customization);\n\n  const transposedDataset = transposeDataset(dataset, model);\n  if (transposedDataset.length === 0) {\n    return <MessageCard title=\"No data found. Try different filters.\"/>;\n  }\n\n  const { [SPLIT]: split, ...totals } = selectMainDatum(dataset);\n  const data = isStacked(model) ? stackDataset(transposedDataset, model) : transposedDataset;\n  const seriesCount = model.series.count();\n  const domain = getXDomain(data, model);\n  const barChartLayout = calculateLayout(stage, domain.length, seriesCount);\n  const { scroller, segment } = barChartLayout;\n  const xScale = createXScale(domain, segment.width);\n\n  return <InteractionController\n    xScale={xScale}\n    model={model}\n    datums={data}\n    layout={barChartLayout}\n    saveHighlight={saveHighlight}\n    highlight={highlight}>\n    {({\n        onClick,\n        onScroll,\n        onMouseLeave,\n        onMouseMove,\n        interaction,\n        scrollLeft\n      }) => <Scroller\n      layout={scroller}\n      onMouseLeave={onMouseLeave}\n      onClick={onClick}\n      onScroll={onScroll}\n      onMouseMove={onMouseMove}\n      leftGutter={<Spacer />}\n      bottomLeftCorner={<Spacer />}\n      bottomRightCorner={<Spacer />}\n      body={<BarCharts\n        interaction={interaction}\n        datums={data}\n        totals={totals}\n        stage={segment}\n        scrollLeft={scrollLeft}\n        model={model}\n        xScale={xScale}\n        acceptHighlight={acceptHighlight}\n        dropHighlight={dropHighlight} />}\n      rightGutter={<YAxis\n        model={model}\n        datums={data}\n        stage={Stage.fromSize(scroller.right, segment.height)} />}\n      bottomGutter={<XAxis\n        model={model}\n        scale={xScale}\n        stage={Stage.fromSize(segment.width, scroller.bottom)}\n      />} />}\n  </InteractionController>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum, NumberRange, TimeRange } from \"plywood\";\nimport { BarChartModel } from \"./bar-chart-model\";\n\nexport type DomainValue = boolean | number | string | Date | NumberRange | TimeRange;\n\nexport type XDomain = DomainValue[];\n\nexport function getXDomain(datums: Datum[], { continuousSplit }: BarChartModel): XDomain {\n  return datums.map(datum => continuousSplit.selectValue<DomainValue>(datum));\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { PlywoodValue } from \"plywood\";\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./bucket-marks.scss\";\n\nconst TICK_HEIGHT = 5;\n\nexport interface BucketMarksProps {\n  stage: Stage;\n  ticks: PlywoodValue[];\n  scale: d3.ScaleBand<PlywoodValue>;\n}\n\nexport interface BucketMarksState {\n}\n\nexport class BucketMarks extends React.Component<BucketMarksProps, BucketMarksState> {\n\n  render() {\n    const { stage, ticks, scale } = this.props;\n    const stageWidth = stage.width;\n\n    const lines: JSX.Element[] = [];\n\n    function addLine(x: number, key: string) {\n      if (stageWidth < x) return;\n      lines.push(<line key={key} x1={x} y1={0} x2={x} y2={TICK_HEIGHT} />);\n    }\n\n    for (const tick of ticks) {\n      const x = roundToHalfPx(scale(tick));\n      addLine(x, \"_\" + tick);\n    }\n    if (ticks.length) {\n      const x = roundToHalfPx(scale(ticks[ticks.length - 1]) + scale.bandwidth());\n      addLine(x, \"last\");\n    }\n\n    return <g className=\"bucket-marks\" transform={stage.getTransform()}>\n      {lines}\n    </g>;\n  }\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface BarCoordinatesValue {\n  x: number;\n  y: number;\n  height: number;\n  width: number;\n\n  barOffset: number;\n  barWidth: number;\n  stepWidth: number;\n  children: BarCoordinates[];\n}\n\nexport class BarCoordinates {\n  public x: number;\n  public y: number;\n  public height: number;\n  public width: number;\n\n  public barOffset: number;\n  public barWidth: number;\n  public stepWidth: number;\n  public children: BarCoordinates[];\n\n  private hitboxMin: number;\n  private hitboxMax: number;\n\n  constructor(parameters: BarCoordinatesValue) {\n    this.x = parameters.x;\n    this.y = parameters.y;\n    this.height = parameters.height;\n    this.width = parameters.width;\n\n    this.barOffset = parameters.barOffset;\n    this.barWidth = parameters.barWidth;\n    this.stepWidth = parameters.stepWidth;\n    this.children = parameters.children;\n\n    this.hitboxMin = this.x - this.barOffset;\n    this.hitboxMax = this.x + this.barWidth + this.barOffset * 2;\n  }\n\n  isXWithin(x: number): boolean {\n    return x >= this.hitboxMin && x <= this.hitboxMax;\n  }\n\n  hasChildren(): boolean {\n    return this.children.length > 0;\n  }\n\n  get middleX(): number {\n    return this.x + this.barWidth * .5 + this.barOffset;\n  }\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { List, Set } from \"immutable\";\nimport { Dataset, Datum, NumberRange, PlywoodRange, PseudoDatum, Range } from \"plywood\";\nimport React from \"react\";\nimport { ChartProps } from \"../../../../common/models/chart-props/chart-props\";\nimport { DateRange } from \"../../../../common/models/date-range/date-range\";\nimport { canBucketByDefault, Dimension } from \"../../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../../common/models/dimension/dimensions\";\nimport {\n  BooleanFilterClause,\n  FilterClause,\n  FixedTimeFilterClause,\n  NumberFilterClause,\n  StringFilterAction,\n  StringFilterClause\n} from \"../../../../common/models/filter-clause/filter-clause\";\nimport { Measure } from \"../../../../common/models/measure/measure\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../common/models/series/concrete-series\";\nimport { Series } from \"../../../../common/models/series/series\";\nimport { SortDirection } from \"../../../../common/models/sort/sort\";\nimport { SplitType } from \"../../../../common/models/split/split\";\nimport { Splits } from \"../../../../common/models/splits/splits\";\nimport { Stage } from \"../../../../common/models/stage/stage\";\nimport { formatValue } from \"../../../../common/utils/formatter/formatter\";\nimport { BAR_CHART_MANIFEST } from \"../../../../common/visualization-manifests/bar-chart/bar-chart\";\nimport { BucketMarks } from \"../../../components/bucket-marks/bucket-marks\";\nimport { GridLines } from \"../../../components/grid-lines/grid-lines\";\nimport { HighlightModal } from \"../../../components/highlight-modal/highlight-modal\";\nimport { MeasureBubbleContent } from \"../../../components/measure-bubble-content/measure-bubble-content\";\nimport { Scroller, ScrollerLayout } from \"../../../components/scroller/scroller\";\nimport { SegmentBubble } from \"../../../components/segment-bubble/segment-bubble\";\nimport { VerticalAxis } from \"../../../components/vertical-axis/vertical-axis\";\nimport { VisMeasureLabel } from \"../../../components/vis-measure-label/vis-measure-label\";\nimport { SPLIT, VIS_H_PADDING } from \"../../../config/constants\";\nimport { classNames, roundToPx } from \"../../../utils/dom/dom\";\nimport { SettingsContext, SettingsContextValue } from \"../../../views/cube-view/settings-context\";\nimport { hasHighlightOn } from \"../../highlight-controller/highlight-controller\";\nimport { BarCoordinates } from \"../bar-coordinates\";\n\nconst X_AXIS_HEIGHT = 84;\nconst Y_AXIS_WIDTH = 60;\nconst CHART_TOP_PADDING = 10;\nconst CHART_BOTTOM_PADDING = 0;\nconst MIN_CHART_HEIGHT = 200;\nconst MAX_STEP_WIDTH = 140; // Note that the step is bar + empty space around it. The width of the rectangle is step * BAR_PROPORTION\nconst MIN_STEP_WIDTH = 20;\nconst BAR_PROPORTION = 0.8;\nconst BARS_MIN_PAD_LEFT = 30;\nconst BARS_MIN_PAD_RIGHT = 6;\nconst HOVER_BUBBLE_V_OFFSET = 8;\nconst SELECTION_PAD = 4;\n\nfunction getFilterFromDatum(splits: Splits, dataPath: Datum[]): List<FilterClause> {\n  return List(dataPath.map((datum, i) => {\n    const { type, reference } = splits.getSplit(i);\n    const segment: any = datum[reference];\n\n    switch (type) {\n      case SplitType.boolean:\n        return new BooleanFilterClause({ reference, values: Set.of(segment) });\n      case SplitType.number:\n        return new NumberFilterClause({ reference, values: List.of(segment) });\n      case SplitType.time:\n        return new FixedTimeFilterClause({ reference, values: List.of(new DateRange(segment)) });\n      case SplitType.string:\n        return new StringFilterClause({ reference, action: StringFilterAction.IN, values: Set.of(segment) });\n    }\n  }));\n}\n\nfunction padDataset(originalDataset: Dataset, dimension: Dimension, measures: Measure[]): Dataset {\n  const data = (originalDataset.data[0][SPLIT] as Dataset).data;\n  const dimensionName = dimension.name;\n\n  const firstBucket: PlywoodRange = data[0][dimensionName] as PlywoodRange;\n  if (!firstBucket) return originalDataset;\n  const start = Number(firstBucket.start);\n  const end = Number(firstBucket.end);\n\n  const size = end - start;\n\n  let i = start;\n  let j = 0;\n\n  const filledData: Datum[] = [];\n  data.forEach(d => {\n    const segmentValue = d[dimensionName];\n    const segmentStart = (segmentValue as PlywoodRange).start;\n    while (i < segmentStart) {\n      filledData[j] = {};\n      filledData[j][dimensionName] = NumberRange.fromJS({\n        start: i,\n        end: i + size\n      });\n      measures.forEach(m => {\n        filledData[j][m.name] = 0; // todo: what if effective zero is not 0?\n      });\n\n      if (d[SPLIT]) {\n        filledData[j][SPLIT] = new Dataset({\n          data: [],\n          attributes: []\n        });\n      }\n\n      j++;\n      i += size;\n    }\n    filledData[j] = d;\n    i += size;\n    j++;\n  });\n\n  const value = originalDataset.valueOf();\n  (value.data[0][SPLIT] as Dataset).data = filledData;\n  return new Dataset(value);\n}\n\nexport interface BubbleInfo {\n  series: ConcreteSeries;\n  chartIndex: number;\n  path: Datum[];\n  coordinates: BarCoordinates;\n  splitIndex?: number;\n  segmentLabel?: string;\n}\n\nexport interface BarChartState {\n  hoverInfo?: BubbleInfo;\n  selectionInfo?: BubbleInfo;\n  scrollerYPosition?: number;\n  scrollerXPosition?: number;\n  scrollTop: number;\n  scrollLeft: number;\n\n  // Precalculated stuff\n  flatData?: PseudoDatum[];\n  maxNumberOfLeaves?: number[];\n}\n\nexport class BarChart extends React.Component<ChartProps, BarChartState> {\n  static contextType = SettingsContext;\n  protected className = BAR_CHART_MANIFEST.name;\n\n  private coordinatesCache: BarCoordinates[][] = [];\n  private scroller = React.createRef<Scroller>();\n\n  state: BarChartState = this.initState();\n\n  context: SettingsContextValue;\n\n  componentDidUpdate() {\n    const { scrollerYPosition, scrollerXPosition } = this.state;\n\n    const scrollerComponent = this.scroller.current;\n    if (!scrollerComponent) return;\n\n    const rect = scrollerComponent.scroller.current.getBoundingClientRect();\n\n    if (scrollerYPosition !== rect.top || scrollerXPosition !== rect.left) {\n      this.setState({ scrollerYPosition: rect.top, scrollerXPosition: rect.left });\n    }\n  }\n\n  calculateMousePosition(x: number, y: number): BubbleInfo {\n    const { essence } = this.props;\n\n    const series = essence.getConcreteSeries();\n    const chartStage = this.getSingleChartStage();\n    const chartHeight = this.getOuterChartHeight(chartStage);\n\n    if (y >= chartHeight * series.size) return null; // on x axis\n    if (x >= chartStage.width) return null; // on y axis\n\n    const xScale = this.getPrimaryXScale();\n    const chartIndex = Math.floor(y / chartHeight);\n\n    const chartCoordinates = this.getBarsCoordinates(chartIndex, xScale);\n\n    const { path, coordinates } = this.findBarCoordinatesForX(x, chartCoordinates, []);\n\n    return {\n      path: this.findPathForIndices(path),\n      series: series.get(chartIndex),\n      chartIndex,\n      coordinates\n    };\n  }\n\n  findPathForIndices(indices: number[]): Datum[] {\n    const { data } = this.props;\n    const mySplitDataset = data.data[0][SPLIT] as Dataset;\n\n    const path: Datum[] = [];\n    let currentData: Dataset = mySplitDataset;\n    indices.forEach(i => {\n      const datum = currentData.data[i];\n      path.push(datum);\n      currentData = (datum[SPLIT] as Dataset);\n    });\n\n    return path;\n  }\n\n  findBarCoordinatesForX(x: number, coordinates: BarCoordinates[], currentPath: number[]): { path: number[], coordinates: BarCoordinates } {\n    for (let i = 0; i < coordinates.length; i++) {\n      if (coordinates[i].isXWithin(x)) {\n        currentPath.push(i);\n        if (coordinates[i].hasChildren()) {\n          return this.findBarCoordinatesForX(x, coordinates[i].children, currentPath);\n        } else {\n          return { path: currentPath, coordinates: coordinates[i] };\n        }\n      }\n    }\n\n    return { path: [], coordinates: null };\n  }\n\n  onScrollerScroll = (scrollTop: number, scrollLeft: number) => {\n    this.setState({\n      hoverInfo: null,\n      scrollLeft,\n      scrollTop\n    });\n  };\n\n  onMouseMove = (x: number, y: number) => {\n    this.setState({ hoverInfo: this.calculateMousePosition(x, y) });\n  };\n\n  onMouseLeave = () => {\n    this.setState({ hoverInfo: null });\n  };\n\n  onClick = (x: number, y: number) => {\n    const { essence, highlight, dropHighlight, saveHighlight } = this.props;\n\n    const selectionInfo = this.calculateMousePosition(x, y);\n\n    if (!selectionInfo) return;\n\n    if (!selectionInfo.coordinates) {\n      dropHighlight();\n      this.setState({ selectionInfo: null });\n      return;\n    }\n\n    const { path, chartIndex } = selectionInfo;\n\n    const { splits } = essence;\n    const series = essence.getConcreteSeries();\n\n    const rowHighlight = getFilterFromDatum(splits, path);\n\n    const currentSeries = series.get(chartIndex).definition;\n    if (hasHighlightOn(highlight, currentSeries.key())) {\n      if (rowHighlight.equals(highlight.clauses)) {\n        dropHighlight();\n        this.setState({ selectionInfo: null });\n        return;\n      }\n    }\n\n    this.setState({ selectionInfo });\n    saveHighlight(rowHighlight, series.get(chartIndex).definition.key());\n  };\n\n  getYExtent(data: Datum[], series: ConcreteSeries): number[] {\n    const getY = (d: Datum) => series.selectValue(d);\n    return d3.extent(data, getY);\n  }\n\n  getYScale(series: ConcreteSeries, yAxisStage: Stage): d3.ScaleLinear<number, number> {\n    const { essence } = this.props;\n    const { flatData } = this.state;\n\n    const splitLength = essence.splits.length();\n    const leafData = flatData.filter((d: Datum) => d[\"__nest\"] === splitLength - 1);\n\n    const extentY = this.getYExtent(leafData, series);\n\n    return d3.scaleLinear()\n      .domain([Math.min(extentY[0] * 1.1, 0), Math.max(extentY[1] * 1.1, 0)])\n      .range([yAxisStage.height, yAxisStage.y]);\n  }\n\n  hasValidYExtent(series: ConcreteSeries, data: Datum[]): boolean {\n    const [yMin, yMax] = this.getYExtent(data, series);\n    return !isNaN(yMin) && !isNaN(yMax);\n  }\n\n  getSingleChartStage(): Stage {\n    const xScale = this.getPrimaryXScale();\n    const { essence, stage } = this.props;\n\n    const { stepWidth } = this.getBarDimensions(xScale.bandwidth());\n    const xTicks = xScale.domain();\n    const width = xTicks.length > 0 ? roundToPx(xScale(xTicks[xTicks.length - 1])) + stepWidth : 0;\n\n    const measures = essence.getConcreteSeries();\n    const availableHeight = stage.height - X_AXIS_HEIGHT;\n    const height = Math.max(MIN_CHART_HEIGHT, Math.floor(availableHeight / measures.size));\n\n    return new Stage({\n      x: 0,\n      y: CHART_TOP_PADDING,\n      width: Math.max(width, stage.width - Y_AXIS_WIDTH - VIS_H_PADDING * 2),\n      height: height - CHART_TOP_PADDING - CHART_BOTTOM_PADDING\n    });\n  }\n\n  getOuterChartHeight(chartStage: Stage): number {\n    return chartStage.height + CHART_TOP_PADDING + CHART_BOTTOM_PADDING;\n  }\n\n  getAxisStages(chartStage: Stage): { xAxisStage: Stage, yAxisStage: Stage } {\n    const { essence, stage } = this.props;\n\n    const xHeight = Math.max(\n      stage.height - (CHART_TOP_PADDING + CHART_BOTTOM_PADDING + chartStage.height) * essence.getConcreteSeries().size,\n      X_AXIS_HEIGHT\n    );\n\n    return {\n      xAxisStage: new Stage({ x: chartStage.x, y: 0, height: xHeight, width: chartStage.width }),\n      yAxisStage: new Stage({ x: 0, y: chartStage.y, height: chartStage.height, width: Y_AXIS_WIDTH + VIS_H_PADDING })\n    };\n  }\n\n  getScrollerLayout(chartStage: Stage, xAxisStage: Stage, yAxisStage: Stage): ScrollerLayout {\n    const { essence } = this.props;\n    const measures = essence.getConcreteSeries().toArray();\n\n    const oneChartHeight = this.getOuterChartHeight(chartStage);\n\n    return {\n      // Inner dimensions\n      bodyWidth: chartStage.width,\n      bodyHeight: oneChartHeight * measures.length - CHART_BOTTOM_PADDING,\n\n      // Gutters\n      top: 0,\n      right: yAxisStage.width,\n      bottom: xAxisStage.height,\n      left: 0\n    };\n  }\n\n  getBubbleTopOffset(y: number, chartIndex: number, chartStage: Stage): number {\n    const { scrollTop, scrollerYPosition } = this.state;\n    const oneChartHeight = this.getOuterChartHeight(chartStage);\n    const chartsAboveMe = oneChartHeight * chartIndex;\n\n    return chartsAboveMe - scrollTop + scrollerYPosition + y - HOVER_BUBBLE_V_OFFSET + CHART_TOP_PADDING;\n  }\n\n  getBubbleLeftOffset(x: number): number {\n    const { scrollLeft, scrollerXPosition } = this.state;\n\n    return scrollerXPosition + x - scrollLeft;\n  }\n\n  canShowBubble(leftOffset: number, topOffset: number): boolean {\n    const { stage } = this.props;\n    const { scrollerYPosition, scrollerXPosition } = this.state;\n\n    if (topOffset <= 0) return false;\n    if (topOffset > scrollerYPosition + stage.height - X_AXIS_HEIGHT) return false;\n    if (leftOffset <= 0) return false;\n    if (leftOffset > scrollerXPosition + stage.width - Y_AXIS_WIDTH) return false;\n\n    return true;\n  }\n\n  renderSelectionBubble(hoverInfo: BubbleInfo): JSX.Element {\n    const { dropHighlight, acceptHighlight } = this.props;\n    const { series, path, chartIndex, segmentLabel, coordinates } = hoverInfo;\n    const chartStage = this.getSingleChartStage();\n    const leftOffset = this.getBubbleLeftOffset(coordinates.middleX);\n    const topOffset = this.getBubbleTopOffset(coordinates.y, chartIndex, chartStage);\n    if (!this.canShowBubble(leftOffset, topOffset)) return null;\n\n    const segmentValue = series.formatValue(path[path.length - 1]);\n    return <HighlightModal\n      left={leftOffset}\n      top={topOffset}\n      dropHighlight={dropHighlight}\n      acceptHighlight={acceptHighlight}\n      title={segmentLabel}>\n      {segmentValue}\n    </HighlightModal>;\n  }\n\n  renderHoverBubble(hoverInfo: BubbleInfo): JSX.Element {\n    const chartStage = this.getSingleChartStage();\n    const { series, path, chartIndex, segmentLabel, coordinates } = hoverInfo;\n\n    const leftOffset = this.getBubbleLeftOffset(coordinates.middleX);\n    const topOffset = this.getBubbleTopOffset(coordinates.y, chartIndex, chartStage);\n\n    if (!this.canShowBubble(leftOffset, topOffset)) return null;\n\n    const measureContent = this.renderMeasureLabel(path[path.length - 1], series);\n    return <SegmentBubble\n      top={topOffset}\n      left={leftOffset}\n      title={segmentLabel}\n      content={measureContent}\n    />;\n  }\n\n  private renderMeasureLabel(datum: Datum, series: ConcreteSeries): JSX.Element | string {\n    if (!this.props.essence.hasComparison()) {\n      return series.formatValue(datum);\n    }\n    const currentValue = series.selectValue(datum);\n    const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n    const formatter = series.formatter();\n    return <MeasureBubbleContent\n      lowerIsBetter={series.measure.lowerIsBetter}\n      formatter={formatter}\n      current={currentValue}\n      previous={previousValue}\n    />;\n  }\n\n  isSelected(path: Datum[], series: Series): boolean {\n    const { essence, highlight } = this.props;\n    const { splits } = essence;\n    return hasHighlightOn(highlight, series.key()) && highlight.clauses.equals(getFilterFromDatum(splits, path));\n  }\n\n  isFaded(): boolean {\n    return this.props.highlight !== null;\n  }\n\n  hasAnySelectionGoingOn(): boolean {\n    return this.props.highlight !== null;\n  }\n\n  isHovered(path: Datum[], series: ConcreteSeries): boolean {\n    const { essence } = this.props;\n    const { hoverInfo } = this.state;\n    const { splits } = essence;\n\n    if (this.hasAnySelectionGoingOn()) return false;\n    if (!hoverInfo) return false;\n    if (!hoverInfo.series.equals(series)) return false;\n\n    const filter = (path: Datum[]) => getFilterFromDatum(splits, path);\n\n    return filter(hoverInfo.path).equals(filter(path));\n  }\n\n  renderBars(\n    data: Datum[],\n    series: ConcreteSeries,\n    chartIndex: number,\n    chartStage: Stage,\n    xAxisStage: Stage,\n    coordinates: BarCoordinates[],\n    splitIndex = 0,\n    path: Datum[] = []\n  ): { bars: JSX.Element[], highlight: JSX.Element } {\n    const { essence } = this.props;\n    const { timezone } = essence;\n    const { customization: { visualizationColors } } = this.context;\n\n    const bars: JSX.Element[] = [];\n    let highlight: JSX.Element;\n\n    const dimension = findDimensionByName(essence.dataCube.dimensions, essence.splits.splits.get(splitIndex).reference);\n    const splitLength = essence.splits.length();\n\n    data.forEach((d, i) => {\n      const segmentValue = d[dimension.name];\n      const segmentValueStr = formatValue(segmentValue, timezone);\n      const subPath = path.concat(d);\n\n      let bar: any;\n      let bubble: JSX.Element = null;\n      const subCoordinates = coordinates[i];\n      const { x, y, height, barWidth, barOffset } = coordinates[i];\n\n      if (splitIndex < splitLength - 1) {\n        const subData: Datum[] = (d[SPLIT] as Dataset).data;\n        const subRender = this.renderBars(subData, series, chartIndex, chartStage, xAxisStage, subCoordinates.children, splitIndex + 1, subPath);\n\n        bar = subRender.bars;\n        if (!highlight && subRender.highlight) highlight = subRender.highlight;\n\n      } else {\n\n        const bubbleInfo: BubbleInfo = {\n          series,\n          chartIndex,\n          path: subPath,\n          coordinates: subCoordinates,\n          segmentLabel: segmentValueStr,\n          splitIndex\n        };\n\n        const isHovered = this.isHovered(subPath, series);\n        if (isHovered) {\n          bubble = this.renderHoverBubble(bubbleInfo);\n        }\n\n        const selected = this.isSelected(subPath, series.definition);\n        const faded = this.isFaded();\n        if (selected) {\n          bubble = this.renderSelectionBubble(bubbleInfo);\n          if (bubble) highlight = this.renderSelectionHighlight(chartStage, subCoordinates, chartIndex);\n        }\n\n        bar = <g\n          className={classNames(\"bar\", { \"selected\": selected, \"not-selected\": (!selected && faded), isHovered })}\n          key={String(segmentValue)}\n          transform={`translate(${roundToPx(x)}, 0)`}\n        >\n          <rect\n            className=\"background\"\n            width={roundToPx(barWidth)}\n            height={roundToPx(Math.abs(height))}\n            fill={visualizationColors.main}\n            x={barOffset}\n            y={roundToPx(y)}\n          />\n          {bubble}\n        </g>;\n\n      }\n\n      bars.push(bar);\n    });\n\n    return { bars, highlight };\n  }\n\n  renderSelectionHighlight(chartStage: Stage, coordinates: BarCoordinates, chartIndex: number): JSX.Element {\n    const { scrollLeft, scrollTop } = this.state;\n    const chartHeight = this.getOuterChartHeight(chartStage);\n    const { barWidth, height, barOffset, y, x } = coordinates;\n\n    const leftOffset = roundToPx(x) + barOffset - SELECTION_PAD + chartStage.x - scrollLeft;\n    const topOffset = roundToPx(y) - SELECTION_PAD + chartStage.y - scrollTop + chartHeight * chartIndex;\n\n    const style: React.CSSProperties = {\n      left: leftOffset,\n      top: topOffset,\n      width: roundToPx(barWidth + SELECTION_PAD * 2),\n      height: roundToPx(Math.abs(height) + SELECTION_PAD * 2)\n    };\n\n    return <div className=\"selection-highlight\" style={style}/>;\n  }\n\n  renderXAxis(data: Datum[], coordinates: BarCoordinates[], xAxisStage: Stage): JSX.Element {\n    const { essence } = this.props;\n    const xScale = this.getPrimaryXScale();\n    const xTicks = xScale.domain();\n\n    const split = essence.splits.splits.first();\n    const dimension = findDimensionByName(essence.dataCube.dimensions, split.reference);\n\n    const labels: JSX.Element[] = [];\n    if (canBucketByDefault(dimension)) {\n      const lastIndex = data.length - 1;\n      const ascending = split.sort.direction === SortDirection.ascending;\n      const leftThing = ascending ? \"start\" : \"end\";\n      const rightThing = ascending ? \"end\" : \"start\";\n      data.forEach((d, i) => {\n        const segmentValue = d[dimension.name];\n        let segmentValueStr = String(Range.isRange(segmentValue) ? (segmentValue as any)[leftThing] : \"\");\n        const coordinate = coordinates[i];\n\n        labels.push(<div\n          className=\"slanty-label continuous\"\n          key={i}\n          style={{ right: xAxisStage.width - coordinate.x }}\n        >{segmentValueStr}</div>);\n\n        if (i === lastIndex) {\n          segmentValueStr = String(Range.isRange(segmentValue) ? (segmentValue as any)[rightThing] : \"\");\n          labels.push(<div\n            className=\"slanty-label continuous\"\n            key=\"last-one\"\n            style={{ right: xAxisStage.width - (coordinate.x + coordinate.stepWidth) }}\n          >{segmentValueStr}</div>);\n        }\n      });\n    } else {\n      data.forEach((d, i) => {\n        const segmentValueStr = String(d[dimension.name]);\n        const coordinate = coordinates[i];\n\n        labels.push(<div\n          className=\"slanty-label categorical\"\n          key={segmentValueStr}\n          style={{ right: xAxisStage.width - (coordinate.x + coordinate.stepWidth / 2) }}\n        >{segmentValueStr}</div>);\n      });\n    }\n\n    return <div className=\"x-axis\" style={{ width: xAxisStage.width }}>\n      <svg style={xAxisStage.getWidthHeight()} viewBox={xAxisStage.getViewBox()}>\n        <BucketMarks stage={xAxisStage} ticks={xTicks} scale={xScale}/>\n      </svg>\n      {labels}\n    </div>;\n  }\n\n  getYAxisStuff(dataset: Dataset, series: ConcreteSeries, chartStage: Stage, chartIndex: number): {\n    yGridLines: JSX.Element, yAxis: JSX.Element, yScale: d3.ScaleLinear<number, number>\n  } {\n    const { yAxisStage } = this.getAxisStages(chartStage);\n\n    const yScale = this.getYScale(series, yAxisStage);\n    const yTicks = yScale.ticks(5);\n\n    const yGridLines: JSX.Element = <GridLines\n      orientation=\"horizontal\"\n      scale={yScale}\n      ticks={yTicks}\n      stage={chartStage}\n    />;\n\n    const axisStage = yAxisStage.changeY(yAxisStage.y + (chartStage.height + CHART_TOP_PADDING + CHART_BOTTOM_PADDING) * chartIndex);\n\n    const yAxis: JSX.Element = <VerticalAxis\n      formatter={series.formatter()}\n      key={series.reactKey()}\n      stage={axisStage}\n      ticks={yTicks}\n      tickSize={5}\n      scale={yScale}\n      hideZero={true}\n    />;\n\n    return { yGridLines, yAxis, yScale };\n  }\n\n  isChartVisible(chartIndex: number, xAxisStage: Stage): boolean {\n    const { stage } = this.props;\n    const { scrollTop } = this.state;\n\n    const chartStage = this.getSingleChartStage();\n    const chartHeight = this.getOuterChartHeight(chartStage);\n\n    const topY = chartIndex * chartHeight;\n    const viewPortHeight = stage.height - xAxisStage.height;\n    const hiddenAtBottom = topY - scrollTop >= viewPortHeight;\n\n    const bottomY = topY + chartHeight;\n    const hiddenAtTop = bottomY < scrollTop;\n\n    return !hiddenAtTop && !hiddenAtBottom;\n  }\n\n  renderChart(\n    dataset: Dataset,\n    coordinates: BarCoordinates[],\n    series: ConcreteSeries,\n    chartIndex: number,\n    chartStage: Stage\n  ): { yAxis: JSX.Element, chart: JSX.Element, highlight: JSX.Element } {\n    const { essence } = this.props;\n    const mySplitDataset = dataset.data[0][SPLIT] as Dataset;\n\n    const measureLabel = <VisMeasureLabel\n      series={series}\n      datum={dataset.data[0]}\n      showPrevious={essence.hasComparison()}/>;\n\n    // Invalid data, early return\n    if (!this.hasValidYExtent(series, mySplitDataset.data)) {\n      return {\n        chart: <div className=\"measure-bar-chart\" key={series.reactKey()} style={{ width: chartStage.width }}>\n          <svg style={chartStage.getWidthHeight(0, CHART_BOTTOM_PADDING)}\n               viewBox={chartStage.getViewBox(0, CHART_BOTTOM_PADDING)}/>\n          {measureLabel}\n        </div>,\n        yAxis: null,\n        highlight: null\n      };\n    }\n\n    const { xAxisStage } = this.getAxisStages(chartStage);\n\n    const { yAxis, yGridLines } = this.getYAxisStuff(mySplitDataset, series, chartStage, chartIndex);\n\n    let bars: JSX.Element[];\n    let highlight: JSX.Element;\n    if (this.isChartVisible(chartIndex, xAxisStage)) {\n      const renderedChart = this.renderBars(mySplitDataset.data, series, chartIndex, chartStage, xAxisStage, coordinates);\n      bars = renderedChart.bars;\n      highlight = renderedChart.highlight;\n    }\n\n    const chart = <div className=\"measure-bar-chart\" key={series.reactKey()} style={{ width: chartStage.width }}>\n      <svg style={chartStage.getWidthHeight(0, CHART_BOTTOM_PADDING)}\n           viewBox={chartStage.getViewBox(0, CHART_BOTTOM_PADDING)}>\n        {yGridLines}\n        <g className=\"bars\" transform={chartStage.getTransform()}>{bars}</g>\n      </svg>\n      {measureLabel}\n    </div>;\n\n    return { chart, yAxis, highlight };\n  }\n\n  private initState(): BarChartState {\n    const { essence, data } = this.props;\n    const { splits } = essence;\n    this.coordinatesCache = [];\n    if (!splits.length()) return {} as BarChartState;\n    const split = splits.splits.first();\n    const dimension = findDimensionByName(essence.dataCube.dimensions, split.reference);\n    const dimensionKind = dimension.kind;\n    const series = essence.getConcreteSeries().toArray();\n    // TODO: very suspicious\n    const paddedDataset = dimensionKind === \"number\" ? padDataset(data, dimension, series.map(s => s.measure)) : data;\n    const firstSplitDataSet = paddedDataset.data[0][SPLIT] as Dataset;\n    const flattened = firstSplitDataSet.flatten({\n      order: \"preorder\",\n      nestingName: \"__nest\"\n    });\n\n    const maxNumberOfLeaves = splits.splits.map(() => 0).toArray(); // initializing maxima to 0\n    this.maxNumberOfLeaves(firstSplitDataSet.data, maxNumberOfLeaves, 0);\n    const flatData = flattened.data;\n    return {\n      hoverInfo: null,\n      maxNumberOfLeaves,\n      flatData,\n      scrollTop: 0,\n      scrollLeft: 0\n    };\n  }\n\n  maxNumberOfLeaves(data: Datum[], maxima: number[], level: number) {\n    maxima[level] = Math.max(maxima[level], data.length);\n\n    if (data[0] && data[0][SPLIT] !== undefined) {\n      const n = data.length;\n      for (let i = 0; i < n; i++) {\n        this.maxNumberOfLeaves((data[i][SPLIT] as Dataset).data, maxima, level + 1);\n      }\n    }\n  }\n\n  getPrimaryXScale(): d3.ScaleBand<string> {\n    const { data } = this.props;\n    const { maxNumberOfLeaves } = this.state;\n    const dataset = (data.data[0][SPLIT] as Dataset).data;\n\n    const { essence } = this.props;\n    const { splits, dataCube } = essence;\n    const firstSplit = splits.splits.first();\n    const dimension = findDimensionByName(dataCube.dimensions, firstSplit.reference);\n\n    const getX = (d: Datum) => d[dimension.name] as string;\n\n    const { usedWidth, padLeft } = this.getXValues(maxNumberOfLeaves);\n\n    return d3.scaleBand()\n      .domain(dataset.map(getX))\n      .range([padLeft, padLeft + usedWidth]);\n  }\n\n  getBarDimensions(xRangeBand: number): { stepWidth: number, barWidth: number, barOffset: number } {\n    if (isNaN(xRangeBand)) xRangeBand = 0;\n    const stepWidth = xRangeBand;\n    const barWidth = Math.max(stepWidth * BAR_PROPORTION, 0);\n    const barOffset = (stepWidth - barWidth) / 2;\n\n    return { stepWidth, barWidth, barOffset };\n  }\n\n  getXValues(maxNumberOfLeaves: number[]): { padLeft: number, usedWidth: number } {\n    const { essence, stage } = this.props;\n    const overallWidth = stage.width - VIS_H_PADDING * 2 - Y_AXIS_WIDTH;\n\n    const numPrimarySteps = maxNumberOfLeaves[0];\n    const minStepWidth = MIN_STEP_WIDTH * maxNumberOfLeaves.slice(1).reduce(((a, b) => a * b), 1);\n\n    const maxAvailableWidth = overallWidth - BARS_MIN_PAD_LEFT - BARS_MIN_PAD_RIGHT;\n\n    let stepWidth: number;\n    if (minStepWidth * numPrimarySteps < maxAvailableWidth) {\n      stepWidth = Math.max(Math.min(maxAvailableWidth / numPrimarySteps, MAX_STEP_WIDTH * essence.splits.length()), MIN_STEP_WIDTH);\n    } else {\n      stepWidth = minStepWidth;\n    }\n\n    const usedWidth = stepWidth * maxNumberOfLeaves[0];\n    const padLeft = Math.max(BARS_MIN_PAD_LEFT, (overallWidth - usedWidth) / 2);\n\n    return { padLeft, usedWidth };\n  }\n\n  getBarsCoordinates(chartIndex: number, xScale: d3.ScaleBand<string>): BarCoordinates[] {\n    if (!!this.coordinatesCache[chartIndex]) {\n      return this.coordinatesCache[chartIndex];\n    }\n\n    const { data } = this.props;\n    const dataset = data.data[0][SPLIT] as Dataset;\n\n    const { essence } = this.props;\n    const { splits, dataCube } = essence;\n\n    const series = essence.getConcreteSeries().get(chartIndex);\n    const firstSplit = splits.splits.first();\n    const dimension = findDimensionByName(dataCube.dimensions, firstSplit.reference);\n\n    const chartStage = this.getSingleChartStage();\n    const yScale = this.getYScale(series, this.getAxisStages(chartStage).yAxisStage);\n\n    this.coordinatesCache[chartIndex] = this.getSubCoordinates(\n      dataset.data,\n      series,\n      chartStage,\n      (d: Datum) => d[dimension.name] as string,\n      xScale,\n      yScale\n    );\n\n    return this.coordinatesCache[chartIndex];\n  }\n\n  getSubCoordinates(\n    data: Datum[],\n    series: ConcreteSeries,\n    chartStage: Stage,\n    getX: (d: Datum, i: number) => string,\n    xScale: d3.ScaleBand<string>,\n    scaleY: d3.ScaleLinear<number, number>,\n    splitIndex = 1\n  ): BarCoordinates[] {\n    const { essence } = this.props;\n    const { maxNumberOfLeaves } = this.state;\n\n    const { stepWidth, barWidth, barOffset } = this.getBarDimensions(xScale.bandwidth());\n\n    const coordinates: BarCoordinates[] = data.map((d, i) => {\n      const x = xScale(getX(d, i));\n      const y = scaleY(series.selectValue(d));\n      const h = scaleY(0) - y;\n      const children: BarCoordinates[] = [];\n      const coordinate = new BarCoordinates({\n        x,\n        y: h >= 0 ? y : scaleY(0),\n        width: roundToPx(barWidth),\n        height: roundToPx(Math.abs(h)),\n        stepWidth,\n        barWidth,\n        barOffset,\n        children\n      });\n\n      if (splitIndex < essence.splits.length()) {\n        const subStage: Stage = new Stage({ x, y: chartStage.y, width: barWidth, height: chartStage.height });\n        const subGetX: any = (d: Datum, i: number) => String(i);\n        const subData: Datum[] = (d[SPLIT] as Dataset).data;\n        const subxScale = d3.scaleBand()\n          .domain(d3.range(0, maxNumberOfLeaves[splitIndex]).map(String))\n          .range([x + barOffset, x + subStage.width]);\n\n        coordinate.children = this.getSubCoordinates(subData, series, subStage, subGetX, subxScale, scaleY, splitIndex + 1);\n      }\n\n      return coordinate;\n    });\n\n    return coordinates;\n  }\n\n  renderRightGutter(seriesCount: number, yAxisStage: Stage, yAxes: JSX.Element[]): JSX.Element {\n    const yAxesStage = yAxisStage.changeHeight((yAxisStage.height + CHART_TOP_PADDING + CHART_BOTTOM_PADDING) * seriesCount);\n\n    return <svg style={yAxesStage.getWidthHeight()} viewBox={yAxesStage.getViewBox()}>\n      {yAxes}\n    </svg>;\n  }\n\n  renderSelectionContainer(selectionHighlight: JSX.Element, chartIndex: number, chartStage: Stage): JSX.Element {\n    return <div className=\"selection-highlight-container\">\n      {selectionHighlight}\n    </div>;\n  }\n\n  render() {\n    const { data, essence, stage } = this.props;\n    const { splits } = essence;\n\n    let scrollerLayout: ScrollerLayout;\n    const measureCharts: JSX.Element[] = [];\n    let xAxis: JSX.Element;\n    let rightGutter: JSX.Element;\n    let overlay: JSX.Element;\n\n    if (splits.length()) {\n      const xScale = this.getPrimaryXScale();\n      const yAxes: JSX.Element[] = [];\n      const series = essence.getConcreteSeries();\n\n      const chartStage = this.getSingleChartStage();\n      const { xAxisStage, yAxisStage } = this.getAxisStages(chartStage);\n      xAxis = this.renderXAxis((data.data[0][SPLIT] as Dataset).data, this.getBarsCoordinates(0, xScale), xAxisStage);\n\n      series.forEach((series, chartIndex) => {\n        const coordinates = this.getBarsCoordinates(chartIndex, xScale);\n        const { yAxis, chart, highlight } = this.renderChart(data, coordinates, series, chartIndex, chartStage);\n\n        measureCharts.push(chart);\n        yAxes.push(yAxis);\n        if (highlight) {\n          overlay = this.renderSelectionContainer(highlight, chartIndex, chartStage);\n        }\n      });\n\n      scrollerLayout = this.getScrollerLayout(chartStage, xAxisStage, yAxisStage);\n      rightGutter = this.renderRightGutter(series.count(), chartStage, yAxes);\n    }\n\n    return <div className=\"measure-bar-charts\" style={{ height: stage.height }}>\n      <Scroller\n        layout={scrollerLayout}\n        ref={this.scroller}\n\n        bottomGutter={xAxis}\n        rightGutter={rightGutter}\n\n        body={measureCharts}\n        overlay={overlay}\n\n        onClick={this.onClick}\n        onMouseMove={this.onMouseMove}\n        onMouseLeave={this.onMouseLeave}\n        onScroll={this.onScrollerScroll}\n      />\n    </div>;\n  }\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { or } from \"../../../common/utils/functional/functional\";\nimport { Predicates } from \"../../../common/utils/rules/predicates\";\nimport {\n  TimeSeriesVisualizationControls\n} from \"../../components/timeseries-visualization-controls/visualization-controls\";\nimport {\n  ChartPanel,\n  DefaultVisualizationControls,\n  VisualizationProps\n} from \"../../views/cube-view/center-panel/center-panel\";\nimport \"./bar-chart.scss\";\nimport { BarChart as ImprovedBarChart } from \"./improved-bar-chart/bar-chart\";\nimport { BarChart } from \"./old-bar-chart/old-bar-chart\";\n\nconst newVersionSupports = or(\n  Predicates.areExactSplitKinds(\"time\"),\n  Predicates.areExactSplitKinds(\"*\", \"time\"),\n  Predicates.areExactSplitKinds(\"number\"),\n  Predicates.areExactSplitKinds(\"*\", \"number\")\n);\n\nexport default function BarChartVisualization(props: VisualizationProps) {\n  if (newVersionSupports(props.essence)) {\n    return <React.Fragment>\n      <TimeSeriesVisualizationControls {...props} />\n      <ChartPanel {...props} chartComponent={ImprovedBarChart} />\n    </React.Fragment>;\n  }\n  return <React.Fragment>\n    <DefaultVisualizationControls {...props} />\n    <ChartPanel {...props} chartComponent={BarChart}/>\n  </React.Fragment>;\n}\n"],"sourceRoot":""}