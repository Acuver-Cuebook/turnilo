{"version":3,"sources":["webpack:///./src/client/utils/dataset/selectors/selectors.ts","webpack:///./src/client/components/tabular-scroller/dimensions.ts","webpack:///./src/client/components/tabular-scroller/visible-rows/visible-rows.tsx","webpack:///./src/client/components/tabular-scroller/utils/measure-columns-count.ts","webpack:///./src/client/components/tabular-scroller/sort-icon/sort-icon.tsx","webpack:///./src/client/components/tabular-scroller/splits/split-value.tsx","webpack:///./src/client/components/tabular-scroller/corner/corner.tsx","webpack:///./src/client/utils/react/with-props.tsx","webpack:///./src/client/components/tabular-scroller/utils/get-scales-for-columns.ts","webpack:///./src/client/components/tabular-scroller/visible-rows/visible-index-range.ts","webpack:///./src/client/components/tabular-scroller/measures/measure-background.tsx","webpack:///./src/client/components/tabular-scroller/measures/measure-cell.tsx","webpack:///./src/client/components/tabular-scroller/measures/measure-value.tsx","webpack:///./src/client/components/tabular-scroller/measures/measure-row.tsx","webpack:///./src/client/components/tabular-scroller/measures/measure-rows.tsx","webpack:///./src/client/components/tabular-scroller/header/measures/measure-header-cell.tsx","webpack:///./src/client/components/tabular-scroller/header/measures/measures-header.tsx","webpack:///./src/client/components/tabular-scroller/splits/flattened-splits.tsx","webpack:///./src/client/components/tabular-scroller/header/splits/split-columns.tsx","webpack:///./src/client/components/tabular-scroller/splits/flattened-split-columns.tsx","webpack:///./src/client/visualizations/grid/utils/hover-position.ts","webpack:///./src/client/visualizations/grid/utils/main-split.ts","webpack:///./src/client/visualizations/grid/interaction-controller.tsx","webpack:///./src/client/visualizations/grid/utils/total-datum.ts","webpack:///./src/client/visualizations/grid/split-labels.tsx","webpack:///./src/client/visualizations/grid/scrolled-grid.tsx","webpack:///./src/client/visualizations/grid/grid-split-menu.tsx","webpack:///./src/client/visualizations/grid/grid-split-tile.tsx","webpack:///./src/client/visualizations/grid/visualization-controls.tsx","webpack:///./src/client/visualizations/grid/grid.tsx"],"names":["selectMainDatum","dataset","data","selectSplitDataset","datum","SPLIT","selectDatums","selectSplitDatums","compose","selectFirstSplitDataset","selectFirstSplitDatums","HEADER_HEIGHT","INDENT_WIDTH","ROW_HEIGHT","SPACE_LEFT","MIN_DIMENSION_WIDTH","SEGMENT_WIDTH","MEASURE_WIDTH","SPACE_RIGHT","VisibleRows","props","renderRow","hoveredRowDatum","rowsData","visibleRowsIndexRange","highlightedRowIndex","start","end","visibleData","slice","Fragment","map","i","index","top","selected","highlight","dimmed","measureColumnsCount","essence","seriesCount","series","count","hasComparison","sortArrow","require","SortIcon","direction","svg","className","classNames","SplitValue","children","style","Corner","withProps","Component","extraProps","componentProps","getScalesForColumns","flatData","getConcreteSeries","groupBy","reactKey","seriesCollection","first","toMap","measureValues","d","selectValue","d3","domain","range","visibleIndexRange","rowCount","height","scrollTopOffset","Math","max","floor","min","ceil","MeasureBackground","width","MeasureCell","value","MeasureValue","barScale","showPrevious","cellWidth","currentValue","currentCell","key","formatValue","previousValue","SeriesDerivation","PREVIOUS","DELTA","lowerIsBetter","measure","formatter","MeasureRow","showBar","scales","concreteSeries","toArray","get","MeasureRows","rowWidth","showBarPredicate","hoverRow","rowStyle","MeasureHeaderCell","sort","title","sorted","sortDirection","commonSort","period","CURRENT","SeriesSort","reference","definition","MeasuresHeader","serie","currentMeasure","FlattenedSplits","splitLabel","SplitLabel","segmentWidth","segmentStyle","SplitColumnsHeader","splits","dataCube","split","findDimensionByName","dimensions","DimensionSort","FlattenedSplitColumns","timezone","formatSegment","seriesPosition","x","columnWidth","seriesList","xOffset","seriesIndex","nominalIndex","integerDivision","element","mainSplit","getSplit","InteractionController","React","scrollTop","this","setState","y","part","position","calculatePosition","setSortToDimension","dimension","setSortToSeries","getIdealColumnWidth","stage","availableWidth","SortDirection","descending","setSort","name","clicker","newSort","equals","set","ascending","changeSplits","replace","changeSort","VisStrategy","KeepAlways","splitColumnWidth","length","splitIndex","splitPosition","render","state","handleClick","setScrollTop","isTotalDatum","SplitLabels","ScrolledGrid","setSegmentWidth","datums","flatten","order","nestingName","filter","complement","rowsCount","visibleRowsRange","columnsCount","maxSegmentWidth","mainSort","layout","bodyWidth","bodyHeight","bottom","left","right","Direction","LEFT","onResize","onScroll","onClick","topGutter","leftGutter","topLeftCorner","body","GridSplitMenu","isContinuous","SplitGranularityMenu","granularity","granularityToString","bucket","saveSplit","createSplit","validate","validateSplit","containerStage","onClose","openOn","onSave","isValid","granularityChange","saveGranularity","GridControlMenu","initState","limit","sortOptions","DimensionSortOn","seriesSortOns","SortOn","fromSort","options","onChange","saveSort","selectedLimit","limits","GRID_LIMITS","includeNone","onLimitSelect","saveLimit","GridSplitTile","open","isOpened","removeSplit","updateSplit","openMenu","closeMenu","dragStart","enabled","getTitle","remove","e","stopPropagation","ref","setRef","disabled","toKey","draggable","onDragStart","GridSplitTilesRow","splitTileComponent","GridVisualizationControls","splitTilesRow","Grid","GridVisualization","chartComponent"],"mappings":"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","file":"grid.9c0962a35e7a88828f65.js","sourcesContent":["/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { compose } from \"../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const selectMainDatum = (dataset: Dataset): Datum =>\n  dataset.data[0];\n\nexport const selectSplitDataset = (datum: Datum): Dataset =>\n  datum[SPLIT] as Dataset;\n\nexport const selectDatums = (dataset: Dataset): Datum[] =>\n  dataset.data;\n\nexport const selectSplitDatums: (datum: Datum) => Datum[] =\n  compose(selectSplitDataset, selectDatums);\n\nexport const selectFirstSplitDataset: (dataset: Dataset) => Dataset =\n  compose(selectMainDatum, selectSplitDataset);\n\nexport const selectFirstSplitDatums: (dataset: Dataset) => Datum[] =\n  compose(selectFirstSplitDataset, selectDatums);\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const HEADER_HEIGHT = 38;\nexport const INDENT_WIDTH = 25;\nexport const ROW_HEIGHT = 30;\nexport const SPACE_LEFT = 10;\n\nexport const MIN_DIMENSION_WIDTH = 100;\nexport const SEGMENT_WIDTH = 300;\nexport const MEASURE_WIDTH = 130;\nexport const SPACE_RIGHT = 10;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum, PseudoDatum } from \"plywood\";\nimport React from \"react\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { ROW_HEIGHT } from \"../dimensions\";\n\ninterface RowProps {\n  highlight: boolean;\n  dimmed: boolean;\n  top: number;\n  index: number;\n  datum: PseudoDatum;\n}\n\ninterface VisibleRowsProps {\n  visibleRowsIndexRange: [number, number];\n  highlightedRowIndex: number | null;\n  rowsData: PseudoDatum[];\n  hoveredRowDatum?: Datum;\n  renderRow: Unary<RowProps, JSX.Element>;\n}\n\nexport const VisibleRows: React.FunctionComponent<VisibleRowsProps> = props => {\n  const { renderRow, hoveredRowDatum, rowsData, visibleRowsIndexRange, highlightedRowIndex } = props;\n\n  const [start, end] = visibleRowsIndexRange;\n  const visibleData = rowsData.slice(start, end);\n\n  return <React.Fragment>\n    {visibleData.map((datum, i) => {\n      const index = start + i;\n      const top = index * ROW_HEIGHT;\n      const selected = index === highlightedRowIndex;\n      const dimmed = !selected && highlightedRowIndex !== null;\n      const hovered = datum === hoveredRowDatum;\n\n      const highlight = selected || hovered;\n\n      const rowProps: RowProps = {\n        highlight,\n        dimmed,\n        top,\n        index,\n        datum\n      };\n\n      return renderRow(rowProps);\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Essence } from \"../../../../common/models/essence/essence\";\n\nexport function measureColumnsCount(essence: Essence): number {\n  const seriesCount = essence.series.series.count();\n  return essence.hasComparison() ? seriesCount * 3 : seriesCount;\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { SortDirection } from \"../../../../common/models/sort/sort\";\nimport { classNames } from \"../../../utils/dom/dom\";\nimport { SvgIcon } from \"../../svg-icon/svg-icon\";\nimport \"./sort-arrow.scss\";\n\nconst sortArrow = require(\"../../../icons/sort-arrow.svg\");\n\ninterface SortIconProps {\n  direction: SortDirection;\n}\n\nexport const SortIcon: React.FunctionComponent<SortIconProps> = ({ direction }) =>\n  <SvgIcon svg={sortArrow} className={classNames(\"sort-arrow\", direction)} />;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { classNames } from \"../../../utils/dom/dom\";\nimport \"./split-value.scss\";\n\ninterface SplitValueProps {\n  highlight: boolean;\n  dimmed: boolean;\n  className?: string;\n  style: React.CSSProperties;\n}\n\nexport const SplitValue: React.FunctionComponent<SplitValueProps> = ({ className, highlight, dimmed, children, style }) =>\n  <div\n    className={classNames(\"split-value\", className, { dimmed, highlight })}\n    style={style}\n  >{children}</div>;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./corner.scss\";\n\nexport const Corner: React.FunctionComponent<{}> = ({ children }) =>\n  <div className=\"corner\">\n    {children}\n  </div>;\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nexport function withProps<ComponentProps, ExtraProps>(Component: React.ComponentType<ComponentProps>, extraProps: ExtraProps): React.ComponentType<ComponentProps & ExtraProps> {\n  return function WrappedWithExtraProps(componentProps: ComponentProps) {\n    return <Component {...componentProps} {...extraProps} />;\n  };\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as d3 from \"d3\";\nimport { Map } from \"immutable\";\nimport { Datum, PseudoDatum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\n\nexport function getScalesForColumns(essence: Essence, flatData: PseudoDatum[]): Map<string, d3.ScaleLinear<number, number>> {\n  return essence.getConcreteSeries()\n    .groupBy(series => series.reactKey())\n    .map(seriesCollection => seriesCollection.first())\n    .toMap()\n    .map(series => {\n    const measureValues = flatData.map((d: Datum) => series.selectValue(d));\n\n    return d3.scaleLinear()\n      // Ensure that 0 is in there\n      .domain(d3.extent([0, ...measureValues]))\n      .range([0, 100]);\n  });\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ROW_HEIGHT } from \"../dimensions\";\n\nexport function visibleIndexRange(rowCount: number, height: number, scrollTopOffset: number): [number, number] {\n  return [\n    Math.max(0, Math.floor(scrollTopOffset / ROW_HEIGHT)),\n    Math.min(rowCount, Math.ceil((scrollTopOffset + height) / ROW_HEIGHT))\n  ];\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\nimport { classNames } from \"../../../utils/dom/dom\";\nimport \"./measure-background.scss\";\n\ninterface MeasureBackgroundProps {\n  width: number;\n  highlight: boolean;\n}\n\nexport const MeasureBackground: React.FunctionComponent<MeasureBackgroundProps> = ({ highlight, width }) =>\n  <div className=\"measure-background-container\">\n    <div className={classNames(\"measure-background\", { highlight })} style={{ width: width + \"%\" }} />\n  </div>;\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./measure-cell.scss\";\n\ninterface MeasureCellProps {\n  width: number;\n  value: string | JSX.Element;\n}\n\nexport const MeasureCell: React.FunctionComponent<MeasureCellProps> = props => {\n  const { width, value, children } = props;\n  return <div className=\"measure-cell\" style={{ width }}>\n    {children}\n    <div className=\"measure-label\">{value}</div>\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../common/models/series/concrete-series\";\nimport { Delta } from \"../../delta/delta\";\nimport { MeasureBackground } from \"./measure-background\";\nimport { MeasureCell } from \"./measure-cell\";\n\ninterface MeasureValueProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  barScale?: d3.ScaleLinear<number, number>;\n  cellWidth: number;\n  showPrevious: boolean;\n  highlight: boolean;\n}\n\nexport const MeasureValue: React.FunctionComponent<MeasureValueProps> = props => {\n  const { series, datum, barScale, highlight, showPrevious, cellWidth } = props;\n\n  const currentValue = series.selectValue(datum);\n\n  const currentCell = <MeasureCell\n    key={series.reactKey()}\n    width={cellWidth}\n    value={series.formatValue(datum)}\n  >\n    {barScale && <MeasureBackground highlight={highlight} width={barScale(currentValue)} />}\n  </MeasureCell>;\n\n  if (!showPrevious) {\n    return currentCell;\n  }\n\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n\n  return <React.Fragment>\n    {currentCell}\n    <MeasureCell\n      key={series.reactKey(SeriesDerivation.PREVIOUS)}\n      width={cellWidth}\n      value={series.formatValue(datum, SeriesDerivation.PREVIOUS)}>\n      {barScale && <MeasureBackground highlight={highlight} width={barScale(previousValue)} />}\n    </MeasureCell>\n    <MeasureCell\n      width={cellWidth}\n      key={series.reactKey(SeriesDerivation.DELTA)}\n      value={<Delta\n        currentValue={currentValue}\n        previousValue={previousValue}\n        lowerIsBetter={series.measure.lowerIsBetter}\n        formatter={series.formatter()}\n      />} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Map } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { classNames } from \"../../../utils/dom/dom\";\nimport \"./measure-row.scss\";\nimport { MeasureValue } from \"./measure-value\";\n\ninterface MeasureRowProps {\n  essence: Essence;\n  highlight: boolean;\n  dimmed: boolean;\n  style: React.CSSProperties;\n  datum: Datum;\n  cellWidth: number;\n  scales: Map<string, d3.ScaleLinear<number, number>>;\n  showBar: boolean;\n}\n\nexport const MeasureRow: React.FunctionComponent<MeasureRowProps> = props => {\n  const { datum, showBar, scales, cellWidth, highlight, dimmed, style, essence } = props;\n\n  const concreteSeries = essence.getConcreteSeries().toArray();\n\n  return <div\n    className={classNames(\"measure-row\", { highlight, dimmed })}\n    style={style}\n  >\n    {concreteSeries.map(series => {\n      return <MeasureValue\n        key={series.reactKey()}\n        series={series}\n        datum={datum}\n        highlight={highlight}\n        barScale={showBar ? scales.get(series.reactKey()) : null}\n        cellWidth={cellWidth}\n        showPrevious={essence.hasComparison()} />;\n    })}\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Map } from \"immutable\";\nimport { Datum, PseudoDatum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { Predicate } from \"../../../../common/utils/functional/functional\";\nimport { VisibleRows } from \"../visible-rows/visible-rows\";\nimport { MeasureRow } from \"./measure-row\";\n\ninterface MeasureRowsProps {\n  visibleRowsIndexRange: [number, number];\n  essence: Essence;\n  highlightedRowIndex: number | null;\n  scales: Map<string, d3.ScaleLinear<number, number>>;\n  data: PseudoDatum[];\n  hoverRow?: Datum;\n  cellWidth: number;\n  rowWidth: number;\n  showBarPredicate: Predicate<Datum>;\n}\n\nexport const MeasureRows: React.FunctionComponent<MeasureRowsProps> = props => {\n  const { rowWidth, showBarPredicate, essence, cellWidth, hoverRow, scales, data, visibleRowsIndexRange, highlightedRowIndex } = props;\n\n  return <VisibleRows\n    visibleRowsIndexRange={visibleRowsIndexRange}\n    highlightedRowIndex={highlightedRowIndex}\n    hoveredRowDatum={hoverRow}\n    rowsData={data}\n    renderRow={props => {\n      const { index, top, datum, highlight, dimmed } = props;\n      const rowStyle: React.CSSProperties = { top, width: rowWidth };\n      const showBar = showBarPredicate(datum);\n\n      return <MeasureRow\n        key={`row_${index}`}\n        essence={essence}\n        highlight={highlight}\n        dimmed={dimmed}\n        style={rowStyle}\n        datum={datum}\n        cellWidth={cellWidth}\n        showBar={showBar}\n        scales={scales} />;\n    }} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\nimport { SortDirection } from \"../../../../../common/models/sort/sort\";\nimport { classNames } from \"../../../../utils/dom/dom\";\nimport { SortIcon } from \"../../sort-icon/sort-icon\";\nimport \"./measure-header-cell.scss\";\n\ninterface MeasureHeaderCellProps {\n  width: number;\n  title: string;\n  sort: SortDirection | null;\n  className?: string;\n}\n\nexport const MeasureHeaderCell: React.FunctionComponent<MeasureHeaderCellProps> = ({ sort, width, title, className }) => {\n  const sorted = sort !== null;\n  return <div\n    className={classNames(\"measure-header-cell\", className, { sorted })}\n    style={{ width }}>\n    <div className=\"title-wrap\">{title}</div>\n    {sort && <SortIcon direction={sort} />}\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../../../common/models/series/concrete-series\";\nimport { SeriesSort, Sort, SortDirection } from \"../../../../../common/models/sort/sort\";\nimport { MeasureHeaderCell } from \"./measure-header-cell\";\n\ninterface MeasuresHeaderProps {\n  cellWidth: number;\n  series: ConcreteSeries[];\n  sort: Sort;\n  showPrevious: boolean;\n}\n\nfunction sortDirection(commonSort: Sort, series: ConcreteSeries, period = SeriesDerivation.CURRENT): SortDirection | null {\n  const isSortedBy = commonSort instanceof SeriesSort && commonSort.reference === series.definition.key() && commonSort.period === period;\n  return isSortedBy ? commonSort.direction : null;\n}\n\nexport const MeasuresHeader: React.FunctionComponent<MeasuresHeaderProps> = props => {\n  const { cellWidth, series, sort, showPrevious } = props;\n\n  return <React.Fragment>\n    {series.map(serie => {\n      const currentMeasure = <MeasureHeaderCell\n        key={serie.reactKey()}\n        width={cellWidth}\n        title={serie.title()}\n        sort={sortDirection(sort, serie)} />;\n\n      if (!showPrevious) {\n        return currentMeasure;\n      }\n\n      return <React.Fragment key={serie.reactKey()}>\n        {currentMeasure}\n        <MeasureHeaderCell\n          key={serie.reactKey(SeriesDerivation.PREVIOUS)}\n          width={cellWidth}\n          title={serie.title(SeriesDerivation.PREVIOUS)}\n          sort={sortDirection(sort, serie, SeriesDerivation.PREVIOUS)} />\n        <MeasureHeaderCell\n          className=\"measure-delta\"\n          key={serie.reactKey(SeriesDerivation.DELTA)}\n          width={cellWidth}\n          title=\"Difference\"\n          sort={sortDirection(sort, serie, SeriesDerivation.DELTA)} />\n      </React.Fragment>;\n    })}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum, PseudoDatum } from \"plywood\";\nimport React from \"react\";\nimport { SPACE_LEFT } from \"../dimensions\";\nimport { VisibleRows } from \"../visible-rows/visible-rows\";\nimport \"./flattened-splits.scss\";\nimport { SplitValue } from \"./split-value\";\n\nexport interface SplitLabelProps {\n  datum: Datum;\n}\n\ninterface FlattenedSplitsProps {\n  visibleRowsIndexRange: [number, number];\n  data: PseudoDatum[];\n  hoverRow?: Datum;\n  segmentWidth: number;\n  highlightedRowIndex: number | null;\n  splitLabel: React.ComponentType<SplitLabelProps>;\n}\n\nexport const FlattenedSplits: React.FunctionComponent<FlattenedSplitsProps> = props => {\n  const { splitLabel: SplitLabel, data, highlightedRowIndex, hoverRow, visibleRowsIndexRange, segmentWidth } = props;\n\n  return <div className=\"flattened-splits-rows\">\n    <VisibleRows\n      visibleRowsIndexRange={visibleRowsIndexRange}\n      highlightedRowIndex={highlightedRowIndex}\n      rowsData={data}\n      hoveredRowDatum={hoverRow}\n      renderRow={props => {\n        const { index, top, datum, highlight, dimmed } = props;\n        const segmentStyle = { width: segmentWidth - SPACE_LEFT, top };\n\n        return <SplitValue\n          key={`splits_${index}`}\n          className=\"flattened-splits-row\"\n          style={segmentStyle}\n          dimmed={dimmed}\n          highlight={highlight}>\n          <SplitLabel datum={datum} />\n        </SplitValue>;\n      }} />\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ClientDataCube } from \"../../../../../common/models/data-cube/data-cube\";\nimport { findDimensionByName } from \"../../../../../common/models/dimension/dimensions\";\nimport { DimensionSort, Sort, SortDirection } from \"../../../../../common/models/sort/sort\";\nimport { Split } from \"../../../../../common/models/split/split\";\nimport { Splits } from \"../../../../../common/models/splits/splits\";\nimport { Corner } from \"../../corner/corner\";\nimport { SortIcon } from \"../../sort-icon/sort-icon\";\nimport \"./split-columns.scss\";\n\ninterface SplitColumnsHeader {\n  dataCube: ClientDataCube;\n  sort?: Sort;\n  splits: Splits;\n}\n\nfunction sortDirection(split: Split, sort: Sort): SortDirection | null {\n  const isCurrentSort = sort instanceof DimensionSort && split.reference === sort.reference;\n  return isCurrentSort ? sort.direction : null;\n}\n\nexport const SplitColumnsHeader: React.FunctionComponent<SplitColumnsHeader> = ({ sort, splits, dataCube }) => {\n  return <Corner>\n    <div className=\"header-split-columns\">\n      {splits.splits.toArray().map(split => {\n        const { reference } = split;\n        const title = findDimensionByName(dataCube.dimensions, reference).title;\n        const direction = sortDirection(split, sort);\n        return <div className=\"header-split-column\" key={reference}>\n          <div className=\"header-split-column-title\">{title}</div>\n          {direction && <div className=\"header-split-column-sort-icon\">\n            <SortIcon direction={direction} />\n          </div>}\n        </div>;\n      })}\n    </div>\n  </Corner>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { List } from \"immutable\";\nimport { PseudoDatum } from \"plywood\";\nimport React from \"react\";\nimport { Split } from \"../../../../common/models/split/split\";\nimport { formatSegment } from \"../../../../common/utils/formatter/formatter\";\nimport \"./flattened-split-columns.scss\";\n\ninterface FlattenedSplitColumnsProps {\n  splits: List<Split>;\n  datum: PseudoDatum;\n  timezone: Timezone;\n}\n\nexport const FlattenedSplitColumns: React.FunctionComponent<FlattenedSplitColumnsProps> = ({ splits, datum, timezone }) =>\n  <React.Fragment>\n    {splits.map(split => {\n      const { reference } = split;\n      const value = split.selectValue(datum);\n      return <div key={reference} className=\"flattened-split-value\">{formatSegment(value, timezone)}</div>;\n    })}\n  </React.Fragment>;\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dimension } from \"../../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { SeriesDerivation } from \"../../../../common/models/series/concrete-series\";\nimport { Series } from \"../../../../common/models/series/series\";\nimport { integerDivision } from \"../../../../common/utils/general/general\";\n\ninterface WhiteSpace {\n  element: \"whitespace\";\n}\n\ninterface SeriesPosition {\n  element: \"series\";\n  series: Series;\n  period: SeriesDerivation;\n}\n\ninterface DimensionPosition {\n  element: \"dimension\";\n  dimension: Dimension;\n}\n\nexport type Position = WhiteSpace | SeriesPosition | DimensionPosition;\n\nexport function splitPosition(x: number, essence: Essence, segmentWidth: number): Position {\n  const splitCount = essence.splits.length();\n  const splitColumnWidth = segmentWidth / splitCount;\n  const splitIndex = Math.floor(x / splitColumnWidth);\n  const split = essence.splits.getSplit(splitIndex);\n  const dimension = findDimensionByName(essence.dataCube.dimensions, split.reference);\n  if (!dimension) {\n    return { element: \"whitespace\" };\n  }\n  return { element: \"dimension\", dimension };\n}\n\nfunction indexToPeriod(index: number): SeriesDerivation {\n  return [SeriesDerivation.CURRENT, SeriesDerivation.PREVIOUS, SeriesDerivation.DELTA][index % 3];\n}\n\nexport function seriesPosition(x: number, essence: Essence, segmentWidth: number, columnWidth: number): Position {\n  const seriesList = essence.series.series;\n  const xOffset = x - segmentWidth;\n  const seriesIndex = Math.floor(xOffset / columnWidth);\n  if (essence.hasComparison()) {\n    const nominalIndex = integerDivision(seriesIndex, 3);\n    const series = seriesList.get(nominalIndex);\n    if (!series) return { element: \"whitespace\" };\n    const period = indexToPeriod(seriesIndex);\n    return { element: \"series\", series, period };\n  }\n  const series = seriesList.get(seriesIndex);\n  if (!series) return { element: \"whitespace\" };\n  return { element: \"series\", series, period: SeriesDerivation.CURRENT };\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { Split } from \"../../../../common/models/split/split\";\n\nexport function mainSplit(essence: Essence): Split {\n  return essence.splits.getSplit(0);\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Clicker } from \"../../../common/models/clicker/clicker\";\nimport { Dimension } from \"../../../common/models/dimension/dimension\";\nimport { Essence, VisStrategy } from \"../../../common/models/essence/essence\";\nimport { SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { Series } from \"../../../common/models/series/series\";\nimport { DimensionSort, SeriesSort, Sort, SortDirection } from \"../../../common/models/sort/sort\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Binary, Ternary, Unary } from \"../../../common/utils/functional/functional\";\nimport { ScrollerPart } from \"../../components/scroller/scroller\";\nimport { MEASURE_WIDTH, SPACE_LEFT } from \"../../components/tabular-scroller/dimensions\";\nimport { measureColumnsCount } from \"../../components/tabular-scroller/utils/measure-columns-count\";\nimport { Position, seriesPosition, splitPosition } from \"./utils/hover-position\";\nimport { mainSplit } from \"./utils/main-split\";\n\ninterface InteractionsProps {\n  handleClick: Ternary<number, number, ScrollerPart, void>;\n  setScrollTop: Binary<number, number, void>;\n  columnWidth: number;\n  scrollTop: number;\n}\n\ninterface InteractionControllerProps {\n  essence: Essence;\n  clicker: Clicker;\n  stage: Stage;\n  children: Unary<InteractionsProps, React.ReactNode>;\n  segmentWidth: number;\n}\n\ninterface InteractionControllerState {\n  scrollTop: number;\n}\n\nexport class InteractionController extends React.Component<InteractionControllerProps, InteractionControllerState> {\n\n  state: InteractionControllerState = {\n    scrollTop: 0\n  };\n\n  setScrollTop = (scrollTop: number) => this.setState({ scrollTop });\n\n  private getIdealColumnWidth(): number {\n    const { stage, segmentWidth, essence } = this.props;\n    const availableWidth = stage.width - SPACE_LEFT - segmentWidth;\n    const count = measureColumnsCount(essence);\n\n    return count * MEASURE_WIDTH >= availableWidth ? MEASURE_WIDTH : availableWidth / count;\n  }\n\n  private setSortToSeries(series: Series, period: SeriesDerivation) {\n    const sort = new SeriesSort({ reference: series.key(), period, direction: SortDirection.descending });\n    this.setSort(sort);\n  }\n\n  private setSortToDimension(dimension: Dimension) {\n    const sort = new DimensionSort({ reference: dimension.name, direction: SortDirection.descending });\n    this.setSort(sort);\n  }\n\n  private setSort(sort: Sort) {\n    const { clicker, essence } = this.props;\n    const { splits } = essence;\n    const split = mainSplit(essence);\n    const newSort = split.sort.equals(sort)\n      // NOTE: this type assertion is needed, because set method on DimensionSort and SeriesSort has overspecialised return type\n      ? (sort as DimensionSort).set(\"direction\", SortDirection.ascending)\n      : sort;\n    clicker.changeSplits(splits.replace(split, split.changeSort(newSort)), VisStrategy.KeepAlways);\n  }\n\n  calculatePosition(x: number, y: number, part: ScrollerPart): Position {\n    const { segmentWidth, essence } = this.props;\n    switch (part) {\n      case \"top-left-corner\":\n        return splitPosition(x, essence, segmentWidth);\n      case \"top-gutter\":\n        return seriesPosition(x, essence, segmentWidth, this.getIdealColumnWidth());\n      default:\n        return { element: \"whitespace\" };\n    }\n  }\n\n  handleClick = (x: number, y: number, part: ScrollerPart) => {\n    const position = this.calculatePosition(x, y, part);\n\n    switch (position.element) {\n      case \"dimension\":\n        this.setSortToDimension(position.dimension);\n        break;\n      case \"series\":\n        this.setSortToSeries(position.series, position.period);\n        break;\n    }\n  }\n\n  render() {\n    const { children } = this.props;\n    const { scrollTop } = this.state;\n\n    return <React.Fragment>\n      {children({\n        columnWidth: this.getIdealColumnWidth(),\n        scrollTop,\n        handleClick: this.handleClick,\n        setScrollTop: this.setScrollTop\n      })}\n    </React.Fragment>;\n  }\n\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\n\nexport const NESTING_NAME = \"__nest\";\n\nexport function isTotalDatum(datum: Datum): boolean {\n  return datum[NESTING_NAME] === 0;\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { List } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { FlattenedSplitColumns } from \"../../components/tabular-scroller/splits/flattened-split-columns\";\nimport { isTotalDatum } from \"./utils/total-datum\";\n\ninterface SplitLabelsProps {\n  splits: List<Split>;\n  timezone: Timezone;\n  datum: Datum;\n}\n\nexport const SplitLabels: React.FunctionComponent<SplitLabelsProps> = props => {\n  const { splits, datum, timezone } = props;\n  if (isTotalDatum(datum)) {\n    return <div key=\"totals\" className=\"flattened-split-value\">Total</div>;\n  }\n  return <FlattenedSplitColumns splits={splits} datum={datum} timezone={timezone} />;\n};\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Binary, complement, Ternary, Unary } from \"../../../common/utils/functional/functional\";\nimport { Direction, ResizeHandle } from \"../../components/resize-handle/resize-handle\";\nimport { Scroller, ScrollerLayout, ScrollerPart } from \"../../components/scroller/scroller\";\nimport { HEADER_HEIGHT, ROW_HEIGHT, SEGMENT_WIDTH, SPACE_RIGHT } from \"../../components/tabular-scroller/dimensions\";\nimport { MeasuresHeader } from \"../../components/tabular-scroller/header/measures/measures-header\";\nimport { SplitColumnsHeader } from \"../../components/tabular-scroller/header/splits/split-columns\";\nimport { MeasureRows } from \"../../components/tabular-scroller/measures/measure-rows\";\nimport { FlattenedSplits } from \"../../components/tabular-scroller/splits/flattened-splits\";\nimport { getScalesForColumns } from \"../../components/tabular-scroller/utils/get-scales-for-columns\";\nimport { measureColumnsCount } from \"../../components/tabular-scroller/utils/measure-columns-count\";\nimport { visibleIndexRange } from \"../../components/tabular-scroller/visible-rows/visible-index-range\";\nimport { selectDatums } from \"../../utils/dataset/selectors/selectors\";\nimport { SplitLabels } from \"./split-labels\";\nimport { mainSplit } from \"./utils/main-split\";\nimport { isTotalDatum, NESTING_NAME } from \"./utils/total-datum\";\n\ninterface ScrolledGridProps {\n  essence: Essence;\n  data: Dataset;\n  stage: Stage;\n  handleClick: Ternary<number, number, ScrollerPart, void>;\n  setScrollTop: Binary<number, number, void>;\n  setSegmentWidth: Unary<number, void>;\n  columnWidth: number;\n  segmentWidth: number;\n  availableWidth: number;\n  scrollTop: number;\n}\n\nexport const ScrolledGrid: React.FunctionComponent<ScrolledGridProps> = props => {\n  const {\n    essence,\n    data,\n    scrollTop,\n    segmentWidth,\n    setScrollTop,\n    setSegmentWidth,\n    handleClick,\n    columnWidth,\n    stage,\n    availableWidth\n  } = props;\n\n  const datums = selectDatums(data.flatten({\n    order: \"preorder\",\n    nestingName: NESTING_NAME\n  }));\n  const scales = getScalesForColumns(essence, datums.filter(complement(isTotalDatum)));\n  const rowsCount = datums.length;\n  const visibleRowsRange = visibleIndexRange(rowsCount, stage.height, scrollTop);\n  const columnsCount = measureColumnsCount(essence);\n  const maxSegmentWidth = availableWidth || SEGMENT_WIDTH;\n  const mainSort = mainSplit(essence).sort;\n\n  const layout: ScrollerLayout = {\n    bodyWidth: columnWidth * columnsCount + SPACE_RIGHT,\n    bodyHeight: rowsCount * ROW_HEIGHT,\n    bottom: 0,\n    left: segmentWidth,\n    right: 0,\n    top: HEADER_HEIGHT\n  };\n\n  const { dataCube, splits } = essence;\n\n  return <React.Fragment>\n    <ResizeHandle\n      direction={Direction.LEFT}\n      onResize={setSegmentWidth}\n      min={SEGMENT_WIDTH}\n      max={maxSegmentWidth}\n      value={segmentWidth}\n    />\n    <Scroller\n      layout={layout}\n      onScroll={setScrollTop}\n      onClick={handleClick}\n      topGutter={<MeasuresHeader\n        cellWidth={columnWidth}\n        series={essence.getConcreteSeries().toArray()}\n        sort={mainSort}\n        showPrevious={essence.hasComparison()}/>}\n\n      leftGutter={<FlattenedSplits\n        visibleRowsIndexRange={visibleRowsRange}\n        data={datums}\n        splitLabel={({ datum }) =>\n          <SplitLabels\n            splits={essence.splits.splits}\n            timezone={essence.timezone}\n            datum={datum}/>}\n        segmentWidth={segmentWidth}\n        highlightedRowIndex={null}/>}\n\n      topLeftCorner={<SplitColumnsHeader\n        dataCube={dataCube}\n        sort={mainSort}\n        splits={splits}/>}\n\n      body={datums && <MeasureRows\n        visibleRowsIndexRange={visibleRowsRange}\n        essence={essence}\n        highlightedRowIndex={null}\n        scales={scales}\n        data={datums}\n        showBarPredicate={complement(isTotalDatum)}\n        cellWidth={columnWidth}\n        rowWidth={columnWidth * columnsCount}/>}\n    />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { isContinuous } from \"../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../common/models/dimension/dimensions\";\nimport { granularityToString } from \"../../../common/models/granularity/granularity\";\nimport { DimensionSortOn, SortOn } from \"../../../common/models/sort-on/sort-on\";\nimport { Sort } from \"../../../common/models/sort/sort\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { GRID_LIMITS } from \"../../../common/visualization-manifests/grid/grid\";\nimport { GranularityPicker } from \"../../components/split-menu/granularity-picker\";\nimport { LimitDropdown } from \"../../components/split-menu/limit-dropdown\";\nimport { SortDropdown } from \"../../components/split-menu/sort-dropdown\";\nimport { SplitMenuProps } from \"../../components/split-menu/split-menu\";\nimport { createSplit, SplitMenuBase, validateSplit } from \"../../components/split-menu/split-menu-base\";\nimport { mainSplit } from \"./utils/main-split\";\n\nexport const GridSplitMenu: React.FunctionComponent<SplitMenuProps> = props => {\n  const { essence, split, dimension } = props;\n  const controlSplit = split.equals(mainSplit(essence));\n  if (controlSplit) {\n    return <GridControlMenu {...props} />;\n  }\n  if (isContinuous(dimension)) {\n    return <SplitGranularityMenu {...props} />;\n  }\n  return null;\n};\n\ninterface SplitGranularityMenuState {\n  granularity: string;\n}\n\nclass SplitGranularityMenu extends React.Component<SplitMenuProps, SplitGranularityMenuState> {\n\n  state: SplitGranularityMenuState = {\n    granularity: granularityToString(this.props.split.bucket)\n  };\n\n  saveGranularity = (granularity: string) => this.setState({ granularity });\n\n  saveSplit = () => {\n    const { split, saveSplit } = this.props;\n    saveSplit(split, this.createSplit());\n  };\n\n  private createSplit(): Split {\n    const { split, dimension } = this.props;\n    const { granularity } = this.state;\n    return createSplit({ split, dimension, granularity });\n  }\n\n  validate() {\n    const { dimension, split } = this.props;\n    const { granularity } = this.state;\n    return validateSplit({ split, dimension, granularity });\n  }\n\n  render() {\n    const { containerStage, dimension, onClose, openOn } = this.props;\n    const { granularity } = this.state;\n    return <SplitMenuBase\n      openOn={openOn}\n      containerStage={containerStage}\n      onClose={onClose}\n      onSave={this.saveSplit}\n      dimension={dimension}\n      isValid={this.validate()}>\n      <GranularityPicker\n        dimension={dimension}\n        granularity={granularity}\n        granularityChange={this.saveGranularity}/>\n    </SplitMenuBase>;\n  }\n}\n\ninterface GridControlMenuProps {\n  granularity?: string;\n  sort?: Sort;\n  limit?: number;\n}\n\nclass GridControlMenu extends React.Component<SplitMenuProps, GridControlMenuProps> {\n\n  state: GridControlMenuProps = this.initState();\n\n  private initState(): GridControlMenuProps {\n    const { split: { bucket, sort, limit } } = this.props;\n    return {\n      sort,\n      limit,\n      granularity: bucket && granularityToString(bucket)\n    };\n  }\n\n  saveGranularity = (granularity: string) => this.setState({ granularity });\n\n  saveSort = (sort: Sort) => this.setState({ sort });\n\n  saveLimit = (limit: number) => this.setState({ limit });\n\n  saveSplit = () => {\n    const { split, saveSplit } = this.props;\n    saveSplit(split, this.createSplit());\n  };\n\n  private createSplit(): Split {\n    const { split, dimension } = this.props;\n    const { limit, sort, granularity } = this.state;\n    return createSplit({ split, dimension, limit, sort, granularity });\n  }\n\n  validate() {\n    const { dimension, split } = this.props;\n    const { limit, sort, granularity } = this.state;\n    return validateSplit({ split, dimension, limit, sort, granularity });\n  }\n\n  render() {\n    const { containerStage, dimension, onClose, essence, openOn } = this.props;\n    const { granularity, sort, limit } = this.state;\n    const { dimensions } = essence.dataCube;\n    const sortOptions = [\n      ...essence.splits.splits.toArray().map(({ reference }) => new DimensionSortOn(findDimensionByName(dimensions, reference))),\n      ...essence.seriesSortOns(true).toArray()\n    ];\n    return <SplitMenuBase\n      openOn={openOn}\n      containerStage={containerStage}\n      onClose={onClose}\n      onSave={this.saveSplit}\n      dimension={dimension}\n      isValid={this.validate()}>\n      <GranularityPicker\n        dimension={dimension}\n        granularity={granularity}\n        granularityChange={this.saveGranularity}/>\n      <SortDropdown\n        direction={sort.direction}\n        selected={SortOn.fromSort(sort, essence)}\n        options={sortOptions}\n        onChange={this.saveSort}/>\n      <LimitDropdown\n        selectedLimit={limit}\n        limits={GRID_LIMITS}\n        includeNone={false}\n        onLimitSelect={this.saveLimit}/>\n    </SplitMenuBase>;\n }\n}\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { isContinuous } from \"../../../common/models/dimension/dimension\";\nimport { SplitTileBaseProps } from \"../../components/split-tile/split-tile\";\nimport { SvgIcon } from \"../../components/svg-icon/svg-icon\";\nimport { WithRef } from \"../../components/with-ref/with-ref\";\nimport { classNames } from \"../../utils/dom/dom\";\nimport { GridSplitMenu } from \"./grid-split-menu\";\nimport { mainSplit } from \"./utils/main-split\";\n\nexport const GridSplitTile: React.FunctionComponent<SplitTileBaseProps> = props => {\n  const { essence, open: isOpened, split, dimension, style, removeSplit, updateSplit, openMenu, closeMenu, dragStart, containerStage } = props;\n\n  const enabled = split.equals(mainSplit(essence)) || isContinuous(dimension);\n\n  const title = split.getTitle(dimension);\n\n  const remove = (e: React.MouseEvent<HTMLElement>) => {\n    e.stopPropagation();\n    removeSplit(split);\n  };\n\n  const open = () => {\n    if (!enabled) return;\n    openMenu(split);\n  };\n\n  return <WithRef>\n    {({ ref: openOn, setRef }) => <React.Fragment>\n      <div\n        className={classNames(\"tile dimension\", { disabled: !enabled })}\n        key={split.toKey()}\n        ref={setRef}\n        draggable={true}\n        onClick={open}\n        onDragStart={e => dragStart(dimension.title, split, e)}\n        style={style}\n        title={title}\n      >\n        <div className=\"reading\">{title}</div>\n        <div className=\"remove\"\n             onClick={remove}>\n          <SvgIcon svg={require(\"../../icons/x.svg\")} />\n        </div>\n      </div>\n      {enabled && isOpened && openOn && <GridSplitMenu\n        saveSplit={updateSplit}\n        essence={essence}\n        openOn={openOn}\n        containerStage={containerStage}\n        onClose={closeMenu}\n        dimension={dimension}\n        split={split} />}\n    </React.Fragment>}\n  </WithRef>;\n};\n","/*\n * Copyright 2017-2021 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\nimport { SplitTilesRow, SplitTilesRowBaseProps } from \"../../components/split-tile/split-tiles-row\";\nimport { VisualizationControls, VisualizationControlsBaseProps } from \"../../views/cube-view/center-panel/center-panel\";\nimport { GridSplitTile } from \"./grid-split-tile\";\n\nfunction GridSplitTilesRow(props: SplitTilesRowBaseProps) {\n  return <SplitTilesRow {...props} splitTileComponent={GridSplitTile} />;\n}\n\nexport const GridVisualizationControls: React.FunctionComponent<VisualizationControlsBaseProps> = props => {\n  return <VisualizationControls{...props} splitTilesRow={GridSplitTilesRow} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ChartProps } from \"../../../common/models/chart-props/chart-props\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { MIN_DIMENSION_WIDTH, SEGMENT_WIDTH } from \"../../components/tabular-scroller/dimensions\";\nimport { withProps } from \"../../utils/react/with-props\";\nimport { ChartPanel, VisualizationProps } from \"../../views/cube-view/center-panel/center-panel\";\nimport \"./grid.scss\";\nimport { InteractionController } from \"./interaction-controller\";\nimport { ScrolledGrid } from \"./scrolled-grid\";\nimport { GridVisualizationControls } from \"./visualization-controls\";\n\ninterface GridProps extends ChartProps {\n  setSegmentWidth: Unary<number, void>;\n  segmentWidth: number;\n}\n\nconst Grid: React.FunctionComponent<GridProps> = props => {\n  const { essence, segmentWidth, setSegmentWidth, stage, clicker, data } = props;\n  const availableWidth = stage.width - MIN_DIMENSION_WIDTH;\n\n  return <div className=\"grid-container\">\n    <InteractionController\n      essence={essence}\n      clicker={clicker}\n      stage={stage}\n      segmentWidth={segmentWidth}\n    >\n      {({\n          columnWidth,\n          scrollTop,\n          setScrollTop,\n          handleClick\n        }) =>\n        <ScrolledGrid\n          essence={essence}\n          data={data}\n          stage={stage}\n          handleClick={handleClick}\n          setScrollTop={setScrollTop}\n          setSegmentWidth={setSegmentWidth}\n          availableWidth={availableWidth}\n          columnWidth={columnWidth}\n          segmentWidth={segmentWidth}\n          scrollTop={scrollTop}/>}\n    </InteractionController>\n  </div>;\n};\n\ninterface GridVisualizationState {\n  segmentWidth: number;\n}\n\nexport default class GridVisualization extends React.Component<VisualizationProps, GridVisualizationState> {\n  state: GridVisualizationState = {\n    segmentWidth: SEGMENT_WIDTH\n  };\n\n  setSegmentWidth = (segmentWidth: number) => {\n    this.setState({ segmentWidth });\n  }\n\n  render() {\n    const { segmentWidth } = this.state;\n    return <React.Fragment>\n      <GridVisualizationControls {...this.props} />\n      <ChartPanel {...this.props}\n                  chartComponent={withProps(Grid, { segmentWidth, setSegmentWidth: this.setSegmentWidth })}/>\n    </React.Fragment>;\n  }\n}\n"],"sourceRoot":""}