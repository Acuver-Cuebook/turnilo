{"version":3,"sources":["webpack:///./src/client/components/bubble-title/bubble-title.tsx","webpack:///./src/client/components/series-bubble-content/series-bubble-content.tsx","webpack:///./src/client/components/modal-bubble/modal-bubble.tsx","webpack:///./src/client/components/highlight-modal/highlight-modal.tsx","webpack:///./src/client/components/segment-bubble/segment-bubble.tsx","webpack:///./src/client/components/measure-bubble-content/measure-bubble-content.tsx","webpack:///./src/client/components/color-legend/color-legend.tsx","webpack:///./src/client/utils/dataset/sparse-dataset/dataset.ts","webpack:///./src/client/visualizations/heat-map/heatmap-corner.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-highlight-indicator.tsx","webpack:///./src/client/visualizations/heat-map/utils/highlight-modal-position.ts","webpack:///./src/client/visualizations/heat-map/heatmap-highlight-modal.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-hover-indicator.tsx","webpack:///./src/client/visualizations/heat-map/utils/nested-dataset.ts","webpack:///./src/client/visualizations/heat-map/utils/datum-by-position.ts","webpack:///./src/client/visualizations/heat-map/utils/modal-title.ts","webpack:///./src/client/visualizations/heat-map/heatmap-hover-tooltip.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-labels.tsx","webpack:///./src/client/utils/equal-props/equal-props.ts","webpack:///./src/client/visualizations/heat-map/heatmap-rectangle-row.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-rectangles.tsx","webpack:///./src/client/visualizations/heat-map/utils/create-highlight-clauses.ts","webpack:///./src/client/visualizations/heat-map/utils/get-highlight-position.ts","webpack:///./src/client/visualizations/heat-map/utils/get-hover-position.ts","webpack:///./src/client/visualizations/heat-map/labeled-heatmap.tsx","webpack:///./src/client/visualizations/heat-map/utils/scroller-layout.ts","webpack:///./src/client/visualizations/heat-map/utils/scales.ts","webpack:///./src/client/visualizations/heat-map/heat-map.tsx"],"names":["BubbleTitle","title","minWidth","clamp","length","className","style","SeriesBubbleContent","props","series","datum","showPrevious","Fragment","formatValue","currentValue","selectValue","previousValue","SeriesDerivation","PREVIOUS","formatter","lowerIsBetter","measure","current","previous","ModalBubble","el","modalRef","e","target","isInside","onClose","this","children","left","top","mouseDown","onMouseDown","classNames","ref","setModalRef","direction","React","Component","HighlightModal","acceptHighlight","dropHighlight","type","onClick","STRINGS","select","cancel","SegmentBubble","content","SegmentBubbleContent","MeasureBubbleContent","ColorLegend","width","height","colorScale","domain","min","max","isNaN","stripeLength","range","startColor","endColor","id","gradientTransform","offset","stopColor","transform","x","y","fill","x1","x2","y1","y2","tickLength","tickLabelLeftOffset","orderByValueDecreasing","countA","countB","orderByValueIncreasing","a","b","orderByTimeDimensionDecreasing","originalA","originalB","compare","orderByTimeDimensionIncreasing","orderByNumberRangeDimensionDecreasing","orderByNumberRangeDimensionIncreasing","datumKey","dataset","key","timezone","fillDatasetWithMissingValues","measureName","secondSplit","totals","identToOriginalKey","order","split","sort","SplitType","string","SortDirection","ascending","time","number","splitToFillOrder","secondSplitName","reference","data","nestedDataset","SPLIT","nestedDatum","value","ident","undefined","sortedIdents","Object","keys","map","newDataset","identToNestedDatum","reduce","datumsByIdent","filledNestedDataset","Number","changeData","HeatmapCorner","essence","dataCube","splits","row","get","column","rowTitle","getTitle","findDimensionByName","dimensions","columnTitle","RowHighlight","tileSize","ColumnHighlight","tileGap","HeatmapHighlightIndicator","position","calculateLeft","layout","stage","scroll","TILE_SIZE","TILE_GAP","Math","bodyWidth","calculateTop","bodyHeight","HeatmapHighlightModal","HeatmapHoverIndicator","hoverPosition","d","getDataColumn","dataColumn","datumByPosition","dataRow","modalTitle","datums","references","toArray","zip","filter","formatSegment","join","HeatmapHoverTooltip","getConcreteSeries","first","TooltipWithBounds","hasComparison","HeatmapLabels","createRef","container","onMaxLabelSize","noop","Array","from","querySelectorAll","maxWidth","element","offsetWidth","labels","orientation","hoveredLabel","highlightedLabel","labelSize","label","index","highlight","hover","equalProps","oldProps","newProps","every","isEqualable","equals","HeatMapRectangleRow","bins","bin","color","fillOpacity","opacity","PureComponent","HeatMapRectangles","nextProps","xScale","yScale","gap","HeatmapRect","count","binWidth","binHeight","heatmap","splitSelection","dimensionName","dimension","labelIndex","floor","firstSplitSelection","topOffset","secondSplitSelection","leftOffset","splitSelectionToClause","kind","name","StringFilterClause","action","StringFilterAction","IN","values","Set","of","String","BooleanFilterClause","FixedTimeFilterClause","List","NumberFilterClause","isClickablePart","part","createHighlightClauses","selections","pickSplitSelections","isTruthy","findDatumIndexByClause","clause","findIndex","FilterTypes","BOOLEAN","NUMBER","STRING","FIXED_TIME","RELATIVE_TIME","Error","clausePredicate","getHoverPosition","xOffset","yOffset","invert","MIN_LEFT_LABELS_WIDTH","MAX_LEFT_LABELS_WIDTH","MIN_TOP_LABELS_HEIGHT","MAX_TOP_LABELS_HEIGHT","formatSegments","fieldName","LabelledHeatmap","leftLabelsWidth","topLabelsHeight","scrollLeft","scrollTop","setState","maxLabelWidth","maxLabelHeight","saveHighlight","clauses","state","right","bottom","scrollerLayout","firstSplit","leftLabels","topLabels","highlightPosition","columnSplitReference","rowSplitReference","columnClause","find","rowClause","getHighlightPosition","handleHighlight","onMouseMove","saveHover","onMouseLeave","resetHover","onScroll","saveScroll","topLeftCorner","topGutter","saveTopLabelHeight","leftGutter","saveLeftLabelWidth","body","leftLabelName","topLabelName","scales","mainColor","bucketSizeMax","d3","dataLength","scaleLinear","seriesSelector","colorMin","colorMax","HeatMapVisualization","chartComponent","HeatMap","HEAT_MAP_MANIFEST","memoizeOne","plywoodKey","visualizationColors","context","customization","prepareDataset","getScales","main","SettingsContext"],"mappings":"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","file":"heatmap.ed28c8879cf025c74f34.js","sourcesContent":["/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { clamp } from \"../../utils/dom/dom\";\n\nconst PER_LETTER_PIXELS = 8;\nconst MIN_TITLE_WIDTH = 80;\nconst MAX_TITLE_WIDTH = 300;\n\ninterface BubbleTitleProps {\n  title: string;\n}\n\nexport const BubbleTitle: React.FunctionComponent<BubbleTitleProps> = ({ title }) => {\n  const minWidth = clamp(title.length * PER_LETTER_PIXELS, MIN_TITLE_WIDTH, MAX_TITLE_WIDTH);\n  return <div className=\"title\" style={{ minWidth }}>{title}</div>;\n};\n","/*\n * Copyright 2017-2020 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { MeasureBubbleContent } from \"../measure-bubble-content/measure-bubble-content\";\n\ninterface SeriesBubbleContentProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nexport const SeriesBubbleContent: React.FunctionComponent<SeriesBubbleContentProps> = props => {\n  const { series, datum, showPrevious } = props;\n  if (!showPrevious) {\n    return <React.Fragment>\n      {series.formatValue(datum)}\n    </React.Fragment>;\n  }\n  const currentValue = series.selectValue(datum);\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <MeasureBubbleContent\n    lowerIsBetter={series.measure.lowerIsBetter}\n    formatter={formatter}\n    current={currentValue}\n    previous={previousValue}\n  />;\n};\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { classNames, isInside } from \"../../utils/dom/dom\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { GlobalEventListener } from \"../global-event-listener/global-event-listener\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./modal-bubble.scss\";\n\ninterface ModalProps {\n  left: number;\n  top: number;\n  onClose: Fn;\n  className?: string;\n}\n\nexport class ModalBubble extends React.Component<ModalProps, {}> {\n\n  modalRef: HTMLDivElement;\n\n  setModalRef = (el: HTMLDivElement) => {\n    this.modalRef = el;\n  };\n\n  onMouseDown = (e: MouseEvent) => {\n    const target = e.target as Element;\n    if (isInside(target, this.modalRef)) return;\n    this.props.onClose();\n  };\n\n  render() {\n    const { className, children, left, top } = this.props;\n    return <React.Fragment>\n      <GlobalEventListener mouseDown={this.onMouseDown} />\n      <BodyPortal left={left} top={top}>\n        <div className={classNames(\"modal-bubble\", className)} ref={this.setModalRef}>\n          {children}\n          <Shpitz direction=\"up\" />\n        </div>\n      </BodyPortal>\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { STRINGS } from \"../../config/constants\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Button } from \"../button/button\";\nimport { ModalBubble } from \"../modal-bubble/modal-bubble\";\nimport \"./highlight-modal.scss\";\n\ninterface HighlightModalProps {\n  title: string;\n  left: number;\n  top: number;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\nexport const HighlightModal: React.FunctionComponent<HighlightModalProps> = ({ title, children, left, top, acceptHighlight, dropHighlight }) =>\n  <ModalBubble className=\"highlight-modal\" left={left} top={top} onClose={dropHighlight}>\n    <BubbleTitle title={title} />\n    <div className=\"value\">{children}</div>\n    <div className=\"actions\">\n      <Button type=\"primary\" className=\"accept mini\" onClick={acceptHighlight} title={STRINGS.select} />\n      <Button type=\"secondary\" className=\"drop mini\" onClick={dropHighlight} title={STRINGS.cancel} />\n    </div>\n  </ModalBubble>;\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ReactNode } from \"react\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./segment-bubble.scss\";\n\nconst OFFSET_V = -10;\n\nexport interface SegmentBubbleProps extends SegmentBubbleContentProps {\n  left: number;\n  top: number;\n}\n\nexport const SegmentBubble: React.FunctionComponent<SegmentBubbleProps> = (props: SegmentBubbleProps) => {\n  const { left, top, title, content } = props;\n  return <BodyPortal left={left} top={top + OFFSET_V}>\n    <div className=\"segment-bubble\">\n      <SegmentBubbleContent title={title} content={content} />\n      <Shpitz direction=\"up\" />\n    </div>\n  </BodyPortal>;\n};\n\nexport interface SegmentBubbleContentProps {\n  title: string;\n  content?: ReactNode;\n}\n\nexport const SegmentBubbleContent: React.FunctionComponent<SegmentBubbleContentProps> = ({ title, content }: SegmentBubbleContentProps) => (\n  <div className=\"segment-bubble-text\">\n    <BubbleTitle title={title} />\n    {content ? <div className=\"content\">{content}</div> : null}\n  </div>\n);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Delta } from \"../delta/delta\";\nimport \"./measure-bubble-content.scss\";\n\nexport interface MeasureBubbleContentProps {\n  current: number;\n  previous: number;\n  formatter: Unary<number, string>;\n  lowerIsBetter?: boolean;\n}\n\nexport const MeasureBubbleContent: React.FunctionComponent<MeasureBubbleContentProps> = ({ lowerIsBetter, formatter, current, previous }) => {\n  const currentValue = formatter(current);\n  const previousValue = formatter(previous);\n  return <React.Fragment>\n    <strong className=\"current-value\">{currentValue}</strong>\n    <span className=\"previous-value\">{previousValue}</span>\n    <Delta formatter={formatter} currentValue={current} previousValue={previous} lowerIsBetter={lowerIsBetter} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport \"./color-legend.scss\";\n\ninterface ColorLegendProps {\n  width?: number;\n  height?: number;\n  title: string;\n  formatter: Unary<number, string>;\n  colorScale: d3.ScaleLinear<string, string>;\n}\n\nconst leftMargin = 5;\nconst topMargin = 10;\nconst bottomMargin = 5;\nconst tickLabelTopOffset = 4;\nconst tickLabelLeftOffset = 7;\nconst tickLength = 5;\nconst stripeWidth = 30;\nconst stripeHeight = 200;\nconst panelWidth = 100;\n\nexport const ColorLegend: React.FunctionComponent<ColorLegendProps> = ({ title, width = panelWidth, height = stripeHeight, formatter, colorScale }) => {\n  const [min, max] = colorScale.domain();\n  if (isNaN(min) || isNaN(max)) return null;\n\n  const stripeLength = height - topMargin - bottomMargin;\n  const [startColor, endColor] = colorScale.range();\n\n  return <div className=\"color-legend\">\n    <div className=\"color-legend-header\">\n      {title}\n    </div>\n    <div className=\"color-legend-stripe\">\n      <svg\n        className=\"color-legend\"\n        width={`${width}px`}\n        height={`${height}px`}>\n        <defs>\n          <linearGradient id=\"color-stripe\" gradientTransform=\"rotate(90)\">\n            <stop offset=\"0%\" stopColor={endColor}/>\n            <stop offset=\"10%\" stopColor={endColor}/>\n            <stop offset=\"90%\" stopColor={startColor}/>\n            <stop offset=\"100%\" stopColor={startColor}/>\n          </linearGradient>\n        </defs>\n        <g transform={`translate(${leftMargin}, ${topMargin})`}>\n          <rect className=\"color-legend-stripe\"\n            x={0}\n            y={0}\n            width={stripeWidth}\n            height={stripeLength}\n            fill=\"url(#color-stripe)\"/>\n          <line className=\"color-legend-stripe-axis\"\n            x1={0.5}\n            x2={0.5}\n            y1={0}\n            y2={stripeLength}/>\n          <g className=\"color-upper-bound\">\n            <line className=\"color-upper-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={0.5}\n              y2={0.5}/>\n            <text className=\"color-upper-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={tickLabelTopOffset}>\n              {formatter(max)}\n            </text>\n          </g>\n          <g className=\"color-lower-bound\">\n            <line className=\"color-lower-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={stripeLength + 0.5}\n              y2={stripeLength + 0.5}/>\n            <text className=\"color-lower-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={stripeLength + tickLabelTopOffset}>\n              {formatter(min)}\n            </text>\n          </g>\n        </g>\n      </svg>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { Dataset, Datum, NumberRange, TimeRange } from \"plywood\";\nimport { SortDirection } from \"../../../../common/models/sort/sort\";\nimport { Split, SplitType } from \"../../../../common/models/split/split\";\nimport { formatValue } from \"../../../../common/utils/formatter/formatter\";\nimport { SPLIT } from \"../../../config/constants\";\n\ntype Order<D> = (a: [string, number, D], b: [string, number, D]) => number;\n\nexport const orderByValueDecreasing: Order<unknown> = ([_, countA], [__, countB]) => {\n  if (countA < countB) {\n    return 1;\n  }\n\n  if (countA > countB) {\n    return -1;\n  }\n\n  return 0;\n};\n\nexport const orderByValueIncreasing: Order<unknown> = (a, b) => {\n  return -orderByValueDecreasing(a, b);\n};\n\nexport const orderByTimeDimensionDecreasing: Order<TimeRange> = ([_, __, originalA], [___, ____, originalB]) => -originalA.compare(originalB);\nexport const orderByTimeDimensionIncreasing: Order<TimeRange> = ([_, __, originalA], [___, ____, originalB]) => originalA.compare(originalB);\n\nexport const orderByNumberRangeDimensionDecreasing: Order<NumberRange> = ([_, __, originalA], [___, ____, originalB]) => -originalA.compare(originalB);\nexport const orderByNumberRangeDimensionIncreasing: Order<NumberRange> = ([_, __, originalA], [___, ____, originalB]) => originalA.compare(originalB);\n\nconst datumKey = (dataset: Datum, key: string, timezone: Timezone): string =>\n  formatValue(dataset[key], timezone);\n\nconst splitToFillOrder = (split: Split): Order<unknown> => {\n  const sort = split.sort;\n  switch (split.type) {\n    case SplitType.string:\n    default:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByValueIncreasing;\n      } else {\n        return orderByValueDecreasing;\n      }\n    case SplitType.time:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByTimeDimensionIncreasing;\n      } else {\n        return orderByTimeDimensionDecreasing;\n      }\n    case SplitType.number:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByNumberRangeDimensionIncreasing;\n      } else {\n        return orderByNumberRangeDimensionDecreasing;\n      }\n  }\n};\n\nexport const fillDatasetWithMissingValues = (dataset: Dataset, measureName: string, secondSplit: Split, timezone: Timezone): Dataset => {\n  const totals: { [ident: string]: number } = {};\n  const identToOriginalKey: { [ident: string]: any } = {};\n  const order = splitToFillOrder(secondSplit);\n  const secondSplitName = secondSplit.reference;\n\n  for (const datum of dataset.data) {\n    const nestedDataset = (datum[SPLIT] as Dataset).data;\n\n    for (const nestedDatum of nestedDataset) {\n      const value = nestedDatum[measureName] as number;\n      const ident = datumKey(nestedDatum, secondSplitName, timezone);\n\n      if (totals[ident] !== undefined) {\n        totals[ident] += value;\n      } else {\n        totals[ident] = value;\n        identToOriginalKey[ident] = nestedDatum[secondSplitName];\n      }\n    }\n  }\n\n  const sortedIdents = Object.keys(totals)\n    .map(ident => [ident, totals[ident], identToOriginalKey[ident]] as [string, number, any])\n    .sort(order)\n    .map(([ident]) => ident);\n\n  const newDataset = dataset.data.map(datum => {\n\n    const identToNestedDatum = (datum[SPLIT] as Dataset).data.reduce((datumsByIdent, datum) => {\n      const ident = datumKey(datum, secondSplitName, timezone);\n      datumsByIdent[ident] = datum;\n      return datumsByIdent;\n    }, {} as {[index: string]: Datum});\n\n    const filledNestedDataset = sortedIdents.map(ident => {\n      const nestedDatum = identToNestedDatum[ident];\n\n      if (nestedDatum) {\n        return {\n          ...nestedDatum,\n          [measureName]: Number.isNaN(Number(nestedDatum[measureName])) ? 0 : nestedDatum[measureName]\n        };\n      } else {\n        return {\n          [secondSplitName]: identToOriginalKey[ident],\n          [measureName]: 0\n        } as Datum;\n      }\n    });\n\n    return {\n      ...datum,\n      [SPLIT]: (datum[SPLIT] as Dataset).changeData(filledNestedDataset)\n    } as Datum;\n  });\n\n  return dataset.changeData(newDataset);\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { findDimensionByName } from \"../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport \"./heatmap-corner.scss\";\n\ninterface HeatmapCornerProps {\n  essence: Essence;\n  width: number;\n  height: number;\n}\n\nconst labelMargin = 20;\n// Around half of font-size with handpicked offset to accommodate rounding errors and rotation artifacts\nconst rotationAxisOffset = 7;\n\nexport const HeatmapCorner: React.FunctionComponent<HeatmapCornerProps> = ({ width, height, essence }) => {\n  const { dataCube, splits: { splits } } = essence;\n\n  const row = splits.get(0);\n  const column = splits.get(1);\n  const rowTitle = row.getTitle(findDimensionByName(dataCube.dimensions, row.reference));\n  const columnTitle = column.getTitle(findDimensionByName(dataCube.dimensions, column.reference));\n\n  return <div className=\"heatmap-corner\">\n    <div className=\"heatmap-corner-row-title\">\n      <span className=\"heatmap-corner-overflow-label\"\n            style={{ width: `${width - labelMargin}px` }}>\n        {rowTitle}\n      </span>\n    </div>\n    <div className=\"heatmap-corner-column-title\"\n         style={{ left: `${width - labelMargin + rotationAxisOffset}px` }}>\n      <span className=\"heatmap-corner-overflow-label\"\n            style={{ width: `${height - labelMargin}px` }}>\n        {columnTitle}\n      </span>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./heatmap-highlight-indicator.scss\";\nimport { HighlightPosition } from \"./utils/get-highlight-position\";\n\ninterface RowHighlightProps {\n  width: number;\n  row: number;\n  tileSize: number;\n}\n\nconst RowHighlight: React.FunctionComponent<RowHighlightProps> = props => {\n  const { row, width, tileSize } = props;\n  const top = row * tileSize;\n  return <div className=\"heatmap-highlighter heatmap-highlighter-row\" style={{\n    top: `${top}px`,\n    width: `${width}px`\n  }} />;\n};\n\ninterface ColumnHighlightProps {\n  height: number;\n  column: number;\n  tileSize: number;\n  tileGap: number;\n}\n\nconst ColumnHighlight: React.FunctionComponent<ColumnHighlightProps> = props => {\n  const { column, tileSize, height, tileGap } = props;\n  const left = column * tileSize + tileGap;\n  return <div className=\"heatmap-highlighter heatmap-highlighter-column\" style={{\n    left: `${left}px`,\n    height: `${height}px`\n  }} />;\n};\n\ninterface HeatmapHighlightIndicatorProps {\n  tileSize: number;\n  tileGap: number;\n  position: HighlightPosition;\n  width: number;\n  height: number;\n}\n\nexport const HeatmapHighlightIndicator: React.FunctionComponent<HeatmapHighlightIndicatorProps> = props => {\n  const { position: { row, column }, width, height, tileGap, tileSize } = props;\n\n  return <React.Fragment>\n    {row && <RowHighlight\n      row={row}\n      width={width}\n      tileSize={tileSize} />}\n    {column && <ColumnHighlight\n      column={column}\n      tileGap={tileGap}\n      height={height}\n      tileSize={tileSize} />}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HeatmapHighlightModalProps } from \"../heatmap-highlight-modal\";\nimport { TILE_GAP, TILE_SIZE } from \"../labeled-heatmap\";\n\nexport type CoordinatesProps = Pick<HeatmapHighlightModalProps, \"position\" | \"layout\" | \"stage\" | \"scroll\">;\n\nexport function calculateLeft(props: CoordinatesProps): number {\n  const { position: { column }, layout, stage, scroll } = props;\n  if (column !== null) {\n    return column * TILE_SIZE + TILE_GAP + layout.left + 20 + stage.x - scroll.left;\n  }\n  return stage.x + Math.min(stage.width / 2, layout.left + (layout.bodyWidth / 2));\n}\n\nexport function calculateTop(props: CoordinatesProps): number {\n  const { position: { row }, layout, stage, scroll } = props;\n  if (row !== null) {\n    return row * TILE_SIZE + layout.top + stage.y - 5 - scroll.top;\n  }\n  return stage.y + Math.min(stage.height / 2, layout.top + (layout.bodyHeight / 2));\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { HighlightModal } from \"../../components/highlight-modal/highlight-modal\";\nimport { ScrollerLayout } from \"../../components/scroller/scroller\";\nimport { HighlightPosition } from \"./utils/get-highlight-position\";\nimport { calculateLeft, calculateTop } from \"./utils/highlight-modal-position\";\n\nexport interface HeatmapHighlightModalProps {\n  title: string;\n  stage: Stage;\n  layout: ScrollerLayout;\n  scroll: { left: number, top: number };\n  position: HighlightPosition;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\nexport const HeatmapHighlightModal: React.FunctionComponent<HeatmapHighlightModalProps> = props => {\n  const { title, children, acceptHighlight, dropHighlight } = props;\n  return <HighlightModal\n    title={title}\n    left={calculateLeft(props)}\n    top={calculateTop(props)}\n    dropHighlight={dropHighlight}\n    acceptHighlight={acceptHighlight}>\n    {children}\n  </HighlightModal>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./heatmap-hover-indicator.scss\";\nimport { HoverPosition } from \"./utils/get-hover-position\";\n\ninterface HeatmapHoverIndicator {\n  tileSize: number;\n  tileGap: number;\n  hoverPosition: HoverPosition;\n}\n\nexport const HeatmapHoverIndicator: React.FunctionComponent<HeatmapHoverIndicator> = ({ tileGap, tileSize, hoverPosition }) => {\n  const { column, row } = hoverPosition;\n  const top = row * tileSize;\n  const left = column * tileSize + tileGap;\n  const position: React.CSSProperties = {\n    top: `${top}px`,\n    left: `${left}px`\n  };\n  return <div className=\"heatmap-hover-indicator\" style={position} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const nestedDataset = (d: Datum) => (d && d[SPLIT] && (d[SPLIT] as Dataset).data) || [];\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { nestedDataset } from \"./nested-dataset\";\n\ninterface Position {\n  row: number | null;\n  column: number | null;\n}\n\nfunction getDataColumn(dataset: Datum, column: number): Datum {\n  const dataColumn = nestedDataset(dataset)[column];\n  return dataColumn ? dataColumn : null;\n}\n\nexport default function datumByPosition(dataset: Datum[], position: Position): [Datum, Datum] {\n  const { column, row } = position;\n  const dataRow = dataset[row];\n  if (!dataRow) return [null, getDataColumn(dataset[0], column)];\n  return [dataRow, getDataColumn(dataRow, column)];\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { formatSegment } from \"../../../../common/utils/formatter/formatter\";\nimport { zip } from \"../../../../common/utils/functional/functional\";\nimport datumByPosition from \"./datum-by-position\";\nimport { HighlightPosition } from \"./get-highlight-position\";\nimport { HoverPosition } from \"./get-hover-position\";\n\nexport function modalTitle(position: HighlightPosition | HoverPosition, dataset: Datum[], essence: Essence): string {\n  const { timezone, splits: { splits } } = essence;\n  const datums = datumByPosition(dataset, position);\n  const references = splits.toArray().map(split => split.reference);\n  const segments = zip(datums, references);\n\n  return segments\n    .filter(([datum]) => datum)\n    .map(([datum, split]) => formatSegment(datum[split], timezone))\n    .join(\" - \");\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TooltipWithBounds } from \"@visx/tooltip\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport { SegmentBubbleContent } from \"../../components/segment-bubble/segment-bubble\";\nimport { SeriesBubbleContent } from \"../../components/series-bubble-content/series-bubble-content\";\nimport datumByPosition from \"./utils/datum-by-position\";\nimport { HoverPosition } from \"./utils/get-hover-position\";\nimport { modalTitle } from \"./utils/modal-title\";\n\ninterface HeatmapHoverTooltip {\n  dataset: Datum[];\n  position: HoverPosition;\n  essence: Essence;\n  scroll: { left: number, top: number };\n}\n\nexport const HeatmapHoverTooltip: React.FunctionComponent<HeatmapHoverTooltip> = props => {\n  const { dataset, essence, scroll, position: { column, row, top, left } } = props;\n  const [, datum] = datumByPosition(dataset, { row, column });\n  if (!datum) return null;\n\n  const series = essence.getConcreteSeries().first();\n  return <TooltipWithBounds\n    key={`${row}-${column}`}\n    top={top - scroll.top}\n    left={left - scroll.left}>\n    <SegmentBubbleContent\n      title={modalTitle({ row, column }, dataset, essence)}\n      content={<SeriesBubbleContent\n        datum={datum}\n        showPrevious={essence.hasComparison()}\n        series={series} />}\n    />\n  </TooltipWithBounds>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { noop } from \"../../../common/utils/functional/functional\";\nimport { classNames } from \"../../utils/dom/dom\";\nimport \"./heatmap-labels.scss\";\n\ninterface HeatmapLabelsProps {\n  labels: string[];\n  orientation: \"top\" | \"left\";\n  hoveredLabel: number;\n  highlightedLabel: number;\n  labelSize?: number;\n\n  onMaxLabelSize?(maxLabelSize: number): void;\n}\n\nconst heatmapLabelClassName = \"heatmap-label\";\n\nexport class HeatmapLabels extends React.Component<HeatmapLabelsProps> {\n  private container = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    if (this.container.current === null) {\n      return;\n    }\n\n    const { onMaxLabelSize = noop } = this.props;\n\n    const maxWidth = Array.from(this.container.current.querySelectorAll(`.${heatmapLabelClassName}`))\n      .reduce((maxWidth, element: HTMLSpanElement) => Math.max(element.offsetWidth, maxWidth), 0);\n\n    onMaxLabelSize(maxWidth + 10 /* consider elements padding */);\n  }\n\n  render() {\n    const { labels, orientation, hoveredLabel, highlightedLabel, labelSize } = this.props;\n\n    return (\n      <div ref={this.container} className={`${orientation}-labels`}>\n        {labels.map((label, index) => {\n          const highlight = highlightedLabel === index;\n          const hover = !highlight && hoveredLabel === index;\n          return <span\n            key={label}\n            className={classNames(\"heatmap-label-wrapper\", { \"heatmap-label-hovered\": hover, \"heatmap-label-highlight\": highlight })}>\n            <span className={heatmapLabelClassName} style={labelSize ? { width: labelSize } : undefined}>\n              <span className=\"heatmap-label-overflow-container\">{label}</span>\n            </span>\n          </span>;\n        })}\n      </div>\n    );\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEqualable } from \"../../../common/utils/immutable-utils/immutable-utils\";\n\nfunction equals(a: any, b: unknown): boolean {\n  if (a === null) {\n    return a === b;\n  }\n  if (isEqualable(a)) {\n    return a.equals(b);\n  }\n  return a === b;\n}\n\nexport function equalProps<T extends object>(oldProps: T, newProps: T): boolean {\n  const keys = Object.keys(oldProps) as Array<keyof T>;\n  return keys.every(key => equals(oldProps[key], newProps[key]));\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RectCell } from \"@visx/heatmap/lib/heatmaps/HeatmapRect\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\n\ninterface HeatMapRectangleRowProps {\n  bins: Array<RectCell<Datum, Datum>>;\n}\n\nexport class HeatMapRectangleRow extends React.PureComponent<HeatMapRectangleRowProps> {\n  render() {\n    const { bins } = this.props;\n    return bins.map(bin => <rect\n      key={`heatmap-rect-${bin.row}-${bin.column}`}\n      width={bin.width}\n      height={bin.height}\n      x={bin.y}\n      y={bin.x}\n      fill={bin.color}\n      fillOpacity={bin.opacity}\n    />);\n  }\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HeatmapRect } from \"@visx/heatmap\";\nimport { Dataset, Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { SPLIT } from \"../../config/constants\";\nimport { equalProps } from \"../../utils/equal-props/equal-props\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { HeatMapRectangleRow } from \"./heatmap-rectangle-row\";\nimport \"./heatmap-rectangles.scss\";\nimport { ColorScale } from \"./utils/scales\";\n\nexport interface HeatMapRectanglesProps {\n  dataset: Datum[];\n  series: ConcreteSeries;\n  colorScale: ColorScale;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  tileSize: number;\n  gap: number;\n  leftLabelName: string;\n  topLabelName: string;\n}\n\nconst bins = (d: Datum) => (d[SPLIT] as Dataset).data;\n\nexport class HeatMapRectangles extends React.Component<HeatMapRectanglesProps> {\n\n  shouldComponentUpdate(nextProps: Readonly<HeatMapRectanglesProps>): boolean {\n    return !equalProps(this.props, nextProps);\n  }\n\n  render() {\n    const { series, colorScale, xScale, yScale, gap, tileSize, dataset } = this.props;\n\n    const [height] = yScale.range();\n    const [, width] = xScale.range();\n\n    return (\n      <div className=\"heatmap-rectangles-container\">\n        <svg width={width} height={height}>\n          <rect x={0} y={0} width={width} height={height} fill=\"#fff\" />\n          <HeatmapRect\n            bins={bins}\n            count={d => series.selectValue(d)}\n            data={dataset}\n            xScale={xScale}\n            yScale={yScale}\n            colorScale={colorScale}\n            binWidth={tileSize}\n            binHeight={tileSize}\n            gap={gap}\n          >\n            {heatmap => heatmap.map(bins => (\n              <HeatMapRectangleRow\n                key={`heatmap-rect-row-${bins[0].column}`}\n                bins={bins} />\n            ))}\n          </HeatmapRect>\n        </svg>\n      </div>\n    );\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { List, Set } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport { ClientDataCube } from \"../../../../common/models/data-cube/data-cube\";\nimport { DateRange } from \"../../../../common/models/date-range/date-range\";\nimport { Dimension } from \"../../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport {\n  BooleanFilterClause,\n  FilterClause,\n  FixedTimeFilterClause,\n  NumberFilterClause,\n  NumberRange,\n  StringFilterAction,\n  StringFilterClause\n} from \"../../../../common/models/filter-clause/filter-clause\";\nimport { Split } from \"../../../../common/models/split/split\";\nimport { isTruthy } from \"../../../../common/utils/general/general\";\nimport { Booleanish } from \"../../../components/filter-menu/boolean-filter-menu/boolean-filter-menu\";\nimport { ScrollerPart } from \"../../../components/scroller/scroller\";\nimport { TILE_SIZE } from \"../labeled-heatmap\";\nimport { nestedDataset } from \"./nested-dataset\";\n\ninterface SplitSelection {\n  value: unknown;\n  dimension: Dimension;\n}\n\nfunction splitSelection(split: Split, offset: number, dataCube: ClientDataCube, dataset: Datum[]): SplitSelection {\n  const dimensionName = split.reference;\n  const dimension = findDimensionByName(dataCube.dimensions, dimensionName);\n  const labelIndex = Math.floor(offset / TILE_SIZE);\n  if (labelIndex > dataset.length - 1) {\n    return null;\n  }\n  const value = dataset[labelIndex][dimensionName];\n  return { value, dimension };\n}\n\nfunction firstSplitSelection(topOffset: number, essence: Essence, dataset: Datum[]): SplitSelection {\n  const { dataCube, splits: { splits } } = essence;\n  const split = splits.get(0);\n  return splitSelection(split, topOffset, dataCube, dataset);\n}\n\nfunction secondSplitSelection(leftOffset: number, essence: Essence, dataset: Datum[]): SplitSelection {\n  const { dataCube, splits: { splits } } = essence;\n  const split = splits.get(1);\n  return splitSelection(split, leftOffset, dataCube, nestedDataset(dataset[0]));\n}\n\nfunction splitSelectionToClause({ value, dimension: { kind, name: reference } }: SplitSelection): FilterClause {\n  switch (kind) {\n    case \"string\":\n      return new StringFilterClause({ reference, action: StringFilterAction.IN, values: Set.of(String(value)) });\n    case \"boolean\":\n      return new BooleanFilterClause({ reference, values: Set.of(value as Booleanish) });\n    case \"time\":\n      return new FixedTimeFilterClause({ reference, values: List.of(value as DateRange) });\n    case \"number\":\n      return new NumberFilterClause({ reference, values: List.of(value as NumberRange) });\n  }\n}\n\ntype ClickablePart = \"body\" | \"top-gutter\" | \"left-gutter\";\n\nexport function isClickablePart(part: ScrollerPart): part is ClickablePart {\n  return part === \"body\" || part === \"top-gutter\" || part === \"left-gutter\";\n}\n\ninterface Position {\n  part: ClickablePart;\n  x: number;\n  y: number;\n}\n\nfunction pickSplitSelections({ x, y, part }: Position, essence: Essence, dataset: Datum[]): SplitSelection[] {\n  switch (part) {\n    case \"top-gutter\":\n      return [secondSplitSelection(x, essence, dataset)];\n    case \"left-gutter\":\n      return [firstSplitSelection(y, essence, dataset)];\n    case \"body\":\n      return [firstSplitSelection(y, essence, dataset), secondSplitSelection(x, essence, dataset)];\n  }\n}\n\nexport default function createHighlightClauses(position: Position, essence: Essence, dataset: Datum[]): FilterClause[] {\n  const selections = pickSplitSelections(position, essence, dataset);\n  if (selections.every(isTruthy)) {\n    return selections.map(splitSelectionToClause);\n  }\n  return [];\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { BooleanFilterClause, FilterClause, FilterTypes, FixedTimeFilterClause, NumberFilterClause, StringFilterClause } from \"../../../../common/models/filter-clause/filter-clause\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { Highlight } from \"../../highlight-controller/highlight\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nfunction clausePredicate(clause: FilterClause): Unary<Datum, boolean> {\n  switch (clause.type) {\n    case FilterTypes.BOOLEAN:\n      return datum => datum[clause.reference] === (clause as BooleanFilterClause).values.first();\n    case FilterTypes.NUMBER:\n      return datum => (clause as NumberFilterClause).values.first().equals(datum[clause.reference]);\n    case FilterTypes.STRING:\n      return datum => String(datum[clause.reference]) === (clause as StringFilterClause).values.first();\n    case FilterTypes.FIXED_TIME:\n      return datum => (clause as FixedTimeFilterClause).values.first().equals(datum[clause.reference]);\n    case FilterTypes.RELATIVE_TIME:\n      throw new Error(\"Unsupported filter type for highlights\");\n  }\n}\n\nfunction findDatumIndexByClause(data: Datum[], clause: FilterClause): number {\n  return data.findIndex(clausePredicate(clause));\n}\n\nexport interface HighlightPosition {\n  row: number | null;\n  column: number | null;\n}\n\nexport default function getHighlightPosition(\n  highlight: Highlight,\n  essence: Essence,\n  dataset: Datum[]\n): HighlightPosition {\n  if (!highlight) return null;\n  const { splits: { splits } } = essence;\n  const { clauses } = highlight;\n\n  const firstSplit = splits.get(0);\n  const secondSplit = splits.get(1);\n  const columnSplitReference = secondSplit.reference;\n  const rowSplitReference = firstSplit.reference;\n  const columnClause = clauses.find(({ reference }) => reference === columnSplitReference);\n  const rowClause = clauses.find(({ reference }) => reference === rowSplitReference);\n  const row = rowClause ? findDatumIndexByClause(dataset, rowClause) : null;\n  const column = columnClause ? findDatumIndexByClause(nestedDataset(dataset[row || 0]), columnClause) : null;\n\n  return {\n    row,\n    column\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScrollerLayout, ScrollerPart } from \"../../../components/scroller/scroller\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\n\nexport interface HoverPosition {\n  row: number;\n  column: number;\n  top: number;\n  left: number;\n}\n\nexport default function getHoverPosition(xScale: LinearScale, yScale: LinearScale, x: number, y: number, part: ScrollerPart, { left, top }: ScrollerLayout): HoverPosition | null {\n  if (part !== \"body\") return null;\n\n  const xOffset = x - left;\n  const yOffset = y - top;\n  const width = xScale.range()[1];\n  const height = yScale.range()[0];\n\n  if (xOffset > width || yOffset > height) return null;\n\n  const column = Math.floor(xScale.invert(xOffset));\n  const row = Math.floor(yScale.invert(yOffset));\n  return {\n    top: y,\n    left: x,\n    row,\n    column\n  };\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { List } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport { FilterClause } from \"../../../common/models/filter-clause/filter-clause\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { formatSegment } from \"../../../common/utils/formatter/formatter\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { ColorLegend } from \"../../components/color-legend/color-legend\";\nimport { LegendSpot } from \"../../components/pinboard-panel/pinboard-panel\";\nimport { Scroller, ScrollerLayout, ScrollerPart } from \"../../components/scroller/scroller\";\nimport { clamp } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { Highlight } from \"../highlight-controller/highlight\";\nimport \"./heat-map.scss\";\nimport { HeatmapCorner } from \"./heatmap-corner\";\nimport { HeatmapHighlightIndicator } from \"./heatmap-highlight-indicator\";\nimport { HeatmapHighlightModal } from \"./heatmap-highlight-modal\";\nimport { HeatmapHoverIndicator } from \"./heatmap-hover-indicator\";\nimport { HeatmapHoverTooltip } from \"./heatmap-hover-tooltip\";\nimport { HeatmapLabels } from \"./heatmap-labels\";\nimport { HeatMapRectangles } from \"./heatmap-rectangles\";\nimport createHighlightClauses, { isClickablePart } from \"./utils/create-highlight-clauses\";\nimport getHighlightPosition from \"./utils/get-highlight-position\";\nimport getHoverPosition, { HoverPosition } from \"./utils/get-hover-position\";\nimport { modalTitle } from \"./utils/modal-title\";\nimport { nestedDataset } from \"./utils/nested-dataset\";\nimport { ColorScale } from \"./utils/scales\";\nimport scrollerLayout from \"./utils/scroller-layout\";\n\ninterface LabelledHeatmapProps {\n  stage: Stage;\n  essence: Essence;\n  dataset: Datum[];\n  xScale: LinearScale;\n  yScale: LinearScale;\n  colorScale: ColorScale;\n\n  highlight: Highlight | null;\n  saveHighlight: Unary<List<FilterClause>, void>;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\ninterface LabelledHeatmapState {\n  scrollLeft: number;\n  scrollTop: number;\n  hoverPosition: HoverPosition | null;\n  leftLabelsWidth: number;\n  topLabelsHeight: number;\n}\n\nexport const TILE_SIZE = 25;\nexport const TILE_GAP = 2;\nexport const MIN_LEFT_LABELS_WIDTH = 100;\nexport const MAX_LEFT_LABELS_WIDTH = 200;\nexport const MIN_TOP_LABELS_HEIGHT = 100;\nexport const MAX_TOP_LABELS_HEIGHT = 150;\n\nfunction formatSegments(dataset: Datum[], fieldName: string, timezone: Timezone): string[] {\n  return dataset.map(datum => formatSegment(datum[fieldName], timezone));\n}\n\nexport class LabelledHeatmap extends React.PureComponent<LabelledHeatmapProps, LabelledHeatmapState> {\n  state: LabelledHeatmapState = {\n    hoverPosition: null,\n    leftLabelsWidth: 0,\n    topLabelsHeight: 0,\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n\n  saveHover = (x: number, y: number, part: ScrollerPart) => {\n    const { xScale, yScale } = this.props;\n    const hoverPosition = getHoverPosition(xScale, yScale, x, y, part, this.layout());\n    this.setState({ hoverPosition });\n  };\n\n  resetHover = () => this.setState({ hoverPosition: null });\n\n  saveScroll = (scrollTop: number, scrollLeft: number) => this.setState({ scrollLeft, scrollTop });\n\n  saveLeftLabelWidth = (maxLabelWidth: number) => this.setState({ leftLabelsWidth: clamp(maxLabelWidth, MIN_LEFT_LABELS_WIDTH, MAX_LEFT_LABELS_WIDTH) });\n\n  saveTopLabelHeight = (maxLabelHeight: number) => this.setState({ topLabelsHeight: clamp(maxLabelHeight, MIN_TOP_LABELS_HEIGHT, MAX_TOP_LABELS_HEIGHT) });\n\n  handleHighlight = (x: number, y: number, part: ScrollerPart) => {\n    if (!isClickablePart(part)) return;\n    const { saveHighlight, essence, dataset } = this.props;\n    const layout = this.layout();\n    const clauses = createHighlightClauses({ x: x - layout.left, y: y - layout.top, part }, essence, dataset);\n    if (clauses.length > 0) {\n      saveHighlight(List(clauses));\n    }\n  };\n\n  private layout(): ScrollerLayout {\n    const { topLabelsHeight, leftLabelsWidth } = this.state;\n    const { dataset } = this.props;\n    return scrollerLayout(dataset, topLabelsHeight, leftLabelsWidth);\n  }\n\n  render() {\n    const { stage, colorScale, xScale, yScale, dataset, essence, highlight, acceptHighlight, dropHighlight } = this.props;\n    const { scrollLeft, scrollTop, hoverPosition, topLabelsHeight } = this.state;\n\n    const series = essence.getConcreteSeries().first();\n    const { splits: { splits }, timezone } = essence;\n    const firstSplit = splits.get(0);\n    const secondSplit = splits.get(1);\n\n    const leftLabels = formatSegments(dataset, firstSplit.reference, timezone);\n    const topLabels = formatSegments(nestedDataset(dataset[0]), secondSplit.reference, timezone);\n\n    const highlightPosition = getHighlightPosition(highlight, essence, dataset);\n\n    const layout = this.layout();\n\n    return <React.Fragment>\n      <Scroller\n        onClick={this.handleHighlight}\n        onMouseMove={this.saveHover}\n        onMouseLeave={this.resetHover}\n        onScroll={this.saveScroll}\n\n        layout={layout}\n\n        topLeftCorner={<HeatmapCorner\n          width={layout.left}\n          height={layout.top}\n          essence={essence}/>}\n\n        topGutter={<HeatmapLabels\n          orientation=\"top\"\n          labels={topLabels}\n          hoveredLabel={hoverPosition ? hoverPosition.column : -1}\n          highlightedLabel={highlightPosition ? highlightPosition.column : -1}\n          onMaxLabelSize={this.saveTopLabelHeight}\n          labelSize={topLabelsHeight} />}\n\n        leftGutter={<HeatmapLabels\n          orientation=\"left\"\n          labels={leftLabels}\n          hoveredLabel={hoverPosition ? hoverPosition.row : -1}\n          highlightedLabel={highlightPosition ? highlightPosition.row : -1}\n          onMaxLabelSize={this.saveLeftLabelWidth} />}\n\n        body={<React.Fragment>\n          <HeatMapRectangles\n            key=\"heatmap\"\n            dataset={dataset}\n            series={series}\n            xScale={xScale}\n            yScale={yScale}\n            colorScale={colorScale}\n            tileSize={TILE_SIZE}\n            gap={TILE_GAP}\n            leftLabelName={firstSplit.reference}\n            topLabelName={secondSplit.reference} />\n          {highlightPosition && <HeatmapHighlightIndicator\n            position={highlightPosition}\n            height={layout.bodyHeight}\n            width={layout.bodyWidth}\n            tileSize={TILE_SIZE}\n            tileGap={TILE_GAP} />}\n          {hoverPosition && <HeatmapHoverIndicator\n            tileSize={TILE_SIZE}\n            tileGap={TILE_GAP}\n            hoverPosition={hoverPosition} />}\n        </React.Fragment>}\n      />\n      <LegendSpot>\n        <ColorLegend\n          title={series.title()}\n          formatter={series.formatter()}\n          colorScale={colorScale} />\n      </LegendSpot>\n      {highlightPosition && <HeatmapHighlightModal\n        title={modalTitle(highlightPosition, dataset, essence)}\n        position={highlightPosition}\n        stage={stage}\n        layout={layout}\n        scroll={{ left: scrollLeft, top: scrollTop }}\n        dropHighlight={dropHighlight}\n        acceptHighlight={acceptHighlight} />}\n      {hoverPosition && <HeatmapHoverTooltip\n        scroll={{ left: scrollLeft, top: scrollTop }}\n        dataset={dataset}\n        position={hoverPosition}\n        essence={essence} />}\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { ScrollerLayout } from \"../../../components/scroller/scroller\";\nimport { clamp } from \"../../../utils/dom/dom\";\nimport { MAX_LEFT_LABELS_WIDTH, MAX_TOP_LABELS_HEIGHT, MIN_LEFT_LABELS_WIDTH, MIN_TOP_LABELS_HEIGHT, TILE_SIZE } from \"../labeled-heatmap\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nexport default function scrollerLayout(dataset: Datum[], topLabelsHeight: number, leftLabelsWidth: number): ScrollerLayout {\n  const top =  clamp(topLabelsHeight, MIN_TOP_LABELS_HEIGHT, MAX_TOP_LABELS_HEIGHT);\n  const left =  clamp(leftLabelsWidth, MIN_LEFT_LABELS_WIDTH, MAX_LEFT_LABELS_WIDTH);\n  const height = dataset.length * TILE_SIZE;\n  const width = nestedDataset(dataset[0]).length * TILE_SIZE;\n\n  return {\n    bodyHeight: height,\n    bodyWidth: width,\n    top,\n    left,\n    right: 0,\n    bottom: 0\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { scaleLinear } from \"@visx/scale\";\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../../common/models/series/concrete-series\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nexport type ColorScale = d3.ScaleLinear<string, string>;\n\nconst white = \"#fff\";\n\ninterface Scales {\n  x: LinearScale;\n  y: LinearScale;\n  color: ColorScale;\n}\n\nfunction seriesSelector(series: ConcreteSeries): Unary<Datum, number> {\n  return (d: Datum) => series.selectValue(d);\n}\n\nexport default function scales(dataset: Datum[], tileSize: number, mainColor: string, series: ConcreteSeries): Scales {\n  const bucketSizeMax = d3.max(dataset, d => nestedDataset(d).length) || 0; // d3.max returns undefined if collection is empty\n  const dataLength = dataset.length;\n\n  const width = bucketSizeMax * tileSize;\n  const height = dataLength * tileSize;\n\n  const x = scaleLinear({\n    domain: [0, bucketSizeMax],\n    range: [0, width]\n  });\n\n  const y = scaleLinear({\n    domain: [dataLength, 0],\n    range: [height, 0]\n  });\n\n  const select = seriesSelector(series);\n\n  const colorMin = d3.min(dataset, d => d3.min(nestedDataset(d), select));\n  const colorMax = d3.max(dataset, d => d3.max(nestedDataset(d), select));\n\n  const color = scaleLinear<string>({\n    range: [white, mainColor],\n    domain: [Math.min(colorMin, 0), colorMax]\n  });\n\n  return { x, y, color };\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// For some reason tsc compiler does not see this file.\n// Remove when issue is identified.\n// tslint:disable-next-line: no-reference\n/// <reference path=\"../../index.d.ts\" />\n\nimport { Timezone } from \"chronoshift\";\nimport memoizeOne from \"memoize-one\";\nimport { Dataset } from \"plywood\";\nimport React from \"react\";\nimport { ChartProps } from \"../../../common/models/chart-props/chart-props\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { HEAT_MAP_MANIFEST } from \"../../../common/visualization-manifests/heat-map/heat-map\";\nimport { SPLIT } from \"../../config/constants\";\nimport { fillDatasetWithMissingValues } from \"../../utils/dataset/sparse-dataset/dataset\";\nimport {\n  ChartPanel,\n  DefaultVisualizationControls,\n  VisualizationProps\n} from \"../../views/cube-view/center-panel/center-panel\";\nimport { SettingsContext, SettingsContextValue } from \"../../views/cube-view/settings-context\";\nimport \"./heat-map.scss\";\nimport { LabelledHeatmap, TILE_SIZE } from \"./labeled-heatmap\";\nimport scales from \"./utils/scales\";\n\nexport default function HeatMapVisualization(props: VisualizationProps) {\n  return <React.Fragment>\n    <DefaultVisualizationControls {...props} />\n    <ChartPanel {...props} chartComponent={HeatMap}/>\n  </React.Fragment>;\n}\n\nclass HeatMap extends React.Component<ChartProps> {\n  static contextType = SettingsContext;\n  protected className = HEAT_MAP_MANIFEST.name;\n\n  context: SettingsContextValue;\n\n  getScales = memoizeOne(scales);\n  prepareDataset = memoizeOne(\n    (data: Dataset, series: ConcreteSeries, split: Split, timezone: Timezone) =>\n      fillDatasetWithMissingValues((data.data[0][SPLIT] as Dataset), series.plywoodKey(), split, timezone),\n    ([nextData], [oldData]) => nextData === oldData);\n\n  render() {\n    const { customization: { visualizationColors } } = this.context;\n    const { essence, stage, highlight, data, saveHighlight, acceptHighlight, dropHighlight } = this.props;\n    const { timezone, splits: { splits } } = essence;\n    const series = essence.getConcreteSeries().first();\n    const secondSplit = splits.get(1);\n    const dataset = this.prepareDataset(data, series, secondSplit, timezone);\n\n    const { x, y, color } = this.getScales(dataset.data, TILE_SIZE, visualizationColors.main, series);\n\n    return <div className=\"heatmap-container\" style={{ height: stage.height }}>\n      <LabelledHeatmap\n        stage={stage}\n        dataset={dataset.data}\n        xScale={x}\n        yScale={y}\n        colorScale={color}\n        saveHighlight={saveHighlight}\n        highlight={highlight}\n        acceptHighlight={acceptHighlight}\n        dropHighlight={dropHighlight}\n        essence={essence}\n      />\n    </div>;\n  }\n}\n"],"sourceRoot":""}