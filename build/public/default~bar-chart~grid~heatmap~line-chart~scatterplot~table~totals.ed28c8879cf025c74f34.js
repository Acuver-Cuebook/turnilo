(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{676:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(120),r=a(0),i=a.n(r),s=a(14);function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case-1:return t?"delta-positive":"delta-negative";case 0:return"delta-neutral";case 1:return t?"delta-negative":"delta-positive"}}var l=Object(n.c)(".1%");var o=function(e){var t=e.lowerIsBetter,a=e.currentValue,n=e.previousValue,r=e.formatter,o=function(e,t){if(Object(s.l)(e)||Object(s.l)(t))return null;var a=e-t;return{deltaSign:a?a<0?-1:1:0,deltaRatio:Math.abs(a/t),delta:a}}(a,n);if(null===o)return i.a.createElement("span",{className:"delta-neutral"},"-");var u,m=o.delta,f=o.deltaRatio,d=o.deltaSign;return i.a.createElement("span",{className:c(d,t)},function(e){switch(e){case-1:return"▼";case 0:return"";case 1:return"▲"}}(d),r(Math.abs(m)),(u=f,isFinite(u)?" (".concat(l(u),")"):null))}},677:function(e,t,a){"use strict";a.d(t,"b",(function(){return _t})),a.d(t,"c",(function(){return Ht})),a.d(t,"a",(function(){return Jt}));var n=a(0),r=a.n(n),i=a(3),s=a(4),c=a(6),l=a(7),o=a(18),u=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"drop-indicator"},r.a.createElement("div",{className:"white-out"}),r.a.createElement("div",{className:"action"},r.a.createElement(o.a,{svg:a(390)})))}}]),n}(r.a.Component),m=a(2),f=a(1),d=a(30),p=a(13),v=a(197),h=a(11),b=a(8),O=a(64),g=a(97),j=a(244),S=a(713),E=a(720),y=function(e){var t=e.appendFilter,a=e.menuStage,n=e.essence,i=n.filter,s=n.dataCube,c=Object(p.a)(s.dimensions).filter((function(e){return!i.getClauseForDimension(e)})).map((function(e){return{key:e.name,label:e.title,value:e}}));return r.a.createElement(E.a,{tiles:c,onSelect:t,containerStage:a})},k=a(34);function C(e,t,a){return[].concat(Object(k.a)(e.slice(0,t)),[a],Object(k.a)(e.slice(t)))}var w=a(703),N=a(12),M=a(121),D=a(142),F=a(9),T=a(32),x=a(123),R=a(46),L=a(67),P=a(242),I=a(57),V=a(166),A=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"state",e.initialValues()),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.actionEnabled()){var t=e.props,a=t.saveClause,n=t.onClose;a(e.constructClause()),n()}})),Object(f.a)(Object(m.a)(e),"onCancelClick",(function(){(0,e.props.onClose)()})),Object(f.a)(Object(m.a)(e),"selectValue",(function(t){var a=e.state.selectedValues,n=a.has(t)?a.remove(t):a.add(t);e.setState({selectedValues:n})})),Object(f.a)(Object(m.a)(e),"renderRow",(function(t){var a=e.state.selectedValues;return r.a.createElement("div",{className:"row",key:String(t),title:String(t),onClick:function(){return e.selectValue(t)}},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement(P.a,{selected:a.has(t)}),r.a.createElement("span",{className:"label"},String(t))))})),e}return Object(s.a)(a,[{key:"initialValues",value:function(){var e=this.props,t=e.essence.filter,a=e.dimension,n=t.getClauseForDimension(a);if(!n)return{selectedValues:F.f.of(),values:[]};if(!(n instanceof N.a))throw new Error("Expected boolean filter clause, got: ".concat(n));return{selectedValues:n.values,values:[]}}},{key:"componentDidMount",value:function(){this.fetchData()}},{key:"fetchData",value:function(){var e=this,t=this.context.booleanFilterQuery,a=this.props,n=a.essence,r=a.dimension;this.setState({loading:!0}),t(n,r).then((function(t){e.setState({loading:!1,values:t.data.map((function(e){return e[r.name]})),error:null})}),(function(t){e.setState({loading:!1,values:[],error:t})}))}},{key:"constructClause",value:function(){var e=this.state.selectedValues;if(e.isEmpty())return null;var t=this.props.dimension;return new N.a({reference:t.name,values:e})}},{key:"actionEnabled",value:function(){var e=this.props,t=e.essence.filter,a=e.dimension,n=this.constructClause(),r=t.getClauseForDimension(a);return n&&!n.equals(r)}},{key:"render",value:function(){var e=this.props,t=e.onClose,a=e.containerStage,n=e.openOn,i=this.state,s=i.values,c=i.error,l=i.loading;return r.a.createElement(R.a,{className:"boolean-filter-menu",direction:"down",containerStage:a,stage:T.a.fromSize(250,210),openOn:n,onClose:t},r.a.createElement("div",{className:"menu-table"},r.a.createElement("div",{className:"rows"},s.map(this.renderRow)),c&&r.a.createElement(V.a,{error:c}),l&&r.a.createElement(I.a,null)),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",title:h.m.ok,onClick:this.onOkClick,disabled:!this.actionEnabled()}),r.a.createElement(L.a,{type:"secondary",title:h.m.cancel,onClick:this.onCancelClick})))}}]),a}(r.a.Component);Object(f.a)(A,"contextType",x.a);var z=a(74),q=a(124),U=[{label:h.m.include,value:z.c.INCLUDE,svg:a(385),checkType:"check"},{label:h.m.exclude,value:z.c.EXCLUDE,svg:a(384),checkType:"cross"},{label:h.m.contains,value:z.c.CONTAINS,svg:a(383)},{label:h.m.regex,value:z.c.REGEX,svg:a(386)}],B=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(f.a)(Object(m.a)(e),"onSelectOption",(function(t){e.props.onSelectOption(t.value)})),Object(f.a)(Object(m.a)(e),"renderFilterOption",(function(e){return r.a.createElement("span",{className:"filter-option"},r.a.createElement(o.a,{className:"icon",svg:e.svg}),r.a.createElement("span",{className:"option-label"},e.label))})),e}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.selectedOption,a=e.filterOptions,n=void 0===a?U:a,i=n.find((function(e){return e.value===t}))||n[0];return r.a.createElement("div",{className:"filter-options-dropdown"},r.a.createElement(q.a,{menuClassName:"filter-options",items:n,selectedItem:i,equal:function(e,t){return e.value===t.value},keyItem:function(e){return e.value},renderItem:this.renderFilterOption,renderSelectedItem:function(e){return r.a.createElement(o.a,{className:"icon",svg:e.svg})},onSelect:this.onSelectOption}))}}],[{key:"getFilterOptions",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return U.filter((function(e){return-1!==t.indexOf(e.value)}))}}]),a}(r.a.Component),Q=a(14),G=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"mounted",void 0),Object(f.a)(Object(m.a)(e),"state",{anchor:null}),Object(f.a)(Object(m.a)(e),"onGlobalMouseMove",(function(t){var a=e.props,n=a.onChange,r=a.leftBound,i=a.rightBound,s=e.state.anchor,c=Object(b.f)(t)-s;n(Object(b.a)(c,r,i))})),Object(f.a)(Object(m.a)(e),"onMouseDown",(function(t){var a=e.props,n=a.offset,r=a.positionLeft,i=Object(b.f)(t)-n-r;e.setState({anchor:i}),t.preventDefault(),window.addEventListener("mouseup",e.onGlobalMouseUp),window.addEventListener("mousemove",e.onGlobalMouseMove)})),Object(f.a)(Object(m.a)(e),"onGlobalMouseUp",(function(){window.removeEventListener("mouseup",e.onGlobalMouseUp),window.removeEventListener("mousemove",e.onGlobalMouseMove)})),e}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.positionLeft,a=e.isAny,n=e.isBeyondMin,i=e.isBeyondMax,s={left:t};return r.a.createElement("div",{className:Object(b.b)("range-handle",{empty:a,"beyond min":n,"beyond max":i}),style:s,onMouseDown:this.onMouseDown})}}]),a}(r.a.Component);function K(e){return e+16}function X(e){return e&&e>16?e-16:0}function W(e){return e+8}var _=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),n=t.call(this,e),Object(f.a)(Object(m.a)(n),"context",void 0),Object(f.a)(Object(m.a)(n),"mounted",void 0),Object(f.a)(Object(m.a)(n),"picker",r.a.createRef()),Object(f.a)(Object(m.a)(n),"updateStart",(function(e){var t=n.props.onRangeStartChange,a=e-n.state.leftOffset;t(n.relativePositionToValue(K(a),"start"))})),Object(f.a)(Object(m.a)(n),"updateEnd",(function(e){var t=n.props.onRangeEndChange,a=e-n.state.leftOffset;t(n.relativePositionToValue(a,"end"))})),n.state={min:null,max:null,step:null,loading:!1,error:null},n}return Object(s.a)(a,[{key:"fetchData",value:function(e,t,a,n){var r=this,i=this.context.numberFilterQuery;this.setState({loading:!0}),i(e,a).then((function(e){if(r.mounted){var t=e.data[0].Min,a=e.data[0].Max,i=Object(Q.o)(a)&&Object(Q.o)(t)&&isFinite(a)&&isFinite(t)?(a-t)/n:1;r.setState({min:t,max:a,loading:!1,step:0!==i&&isFinite(i)?i:1})}}),(function(e){r.mounted&&r.setState({loading:!1,error:e})}))}},{key:"componentDidMount",value:function(){this.mounted=!0;var e=this.picker.current.getBoundingClientRect(),t=this.props,a=t.essence,n=t.timekeeper,r=t.dimension,i=e.left,s=e.width;this.setState({leftOffset:i,rightBound:s}),this.fetchData(a,n,r,s)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"relativePositionToValue",value:function(e,t){var a=this.state,n=a.step,r=a.min,i=a.max,s=a.rightBound;if(e<=K(0)&&"start"===t)return null;if(e>=s&&"end"===t)return null;var c,l,o=i-r!=0?i-r:Math.abs(i);return Object(Q.t)(e*n,(c=o,(l=Object(Q.g)(c/300))>3?Math.min(l,4):3))}},{key:"valueToRelativePosition",value:function(e){return e/this.state.step}},{key:"onBarClick",value:function(e,t,a){var n=this.state.leftOffset,r=Object(b.f)(a),i=r-n;if(i<8)return this.updateStart(n);var s=K(e)+5,c=X(t)+5,l=i>t+16,o=i<t&&i>s;if(i<e)this.updateStart(r-16);else if(l)this.updateEnd(r);else if(o){var u=c-i,m=i-s;return void(u<m?this.updateEnd(c+n-u):this.updateStart(s+n+m-16))}}},{key:"render",value:function(){var e=this.props,t=e.start,a=e.end,n=e.exclude,i=this.state,s=i.min,c=i.max,l=i.loading,o=i.error,u=i.step,m=i.rightBound,f=i.leftOffset,d=null;if(m&&u&&isFinite(c)&&isFinite(s)){var p=null===t?0:X(this.valueToRelativePosition(t)),v=null===a?m:this.valueToRelativePosition(a),h=X(m),O=Object(b.a)(v,K(p),h),g=t?Object(b.a)(p,0,X(O)):0,j={left:W(g),width:O-g},S=f+m;d=r.a.createElement("div",{className:"range-slider",onMouseDown:this.onBarClick.bind(this,g,O)},r.a.createElement("div",{className:"range-bar full"}),r.a.createElement("div",{className:"range-bar selected",style:j}),r.a.createElement(G,{positionLeft:g,onChange:this.updateStart,isAny:null===t,isBeyondMin:null!==t&&t<s,leftBound:f,rightBound:f+X(O),offset:f}),r.a.createElement(G,{positionLeft:O,onChange:this.updateEnd,isAny:null===a,isBeyondMax:null!==a&&c<a,leftBound:f+K(g),rightBound:S,offset:f}))}return r.a.createElement("div",{className:Object(b.b)("number-range-picker",{inverted:n}),ref:this.picker},d,l&&r.a.createElement(I.a,null),o&&r.a.createElement(V.a,{error:o}))}}]),a}(r.a.Component);function H(e){return null===e?h.m.any:""+e}function J(e){var t=parseFloat(e);return isNaN(t)?null:t}Object(f.a)(_,"contextType",x.a);var Y=B.getFilterOptions(z.c.INCLUDE,z.c.EXCLUDE),Z=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{leftOffset:null,rightBound:null,start:null,end:null}),Object(f.a)(Object(m.a)(e),"globalKeyDownListener",(function(t){Object(b.c)(t)&&e.onOkClick()})),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.actionEnabled()){var t=e.props,a=t.saveClause,n=t.onClose;a(e.constructClause()),n()}})),Object(f.a)(Object(m.a)(e),"onCancelClick",(function(){(0,e.props.onClose)()})),Object(f.a)(Object(m.a)(e),"onRangeInputStartChange",(function(t){var a=t.target.value;e.setState({start:J(a)})})),Object(f.a)(Object(m.a)(e),"onRangeInputEndChange",(function(t){var a=t.target.value;e.setState({end:J(a)})})),Object(f.a)(Object(m.a)(e),"onRangeStartChange",(function(t){e.setState({start:t})})),Object(f.a)(Object(m.a)(e),"onRangeEndChange",(function(t){e.setState({end:t})})),Object(f.a)(Object(m.a)(e),"onSelectFilterOption",(function(t){e.setState({filterMode:t})})),e}return Object(s.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.props,t=e.essence,a=e.dimension,n=t.filter.getClauseForDimension(a);if(n){if(!(n instanceof N.d))throw new Error("Expected number filter. Got: ".concat(n));if(0!==n.values.count()){var r=n.values.first(),i=r.start,s=r.end;this.setState({start:i,end:s,filterMode:t.filter.getModeForDimension(a)||z.c.INCLUDE})}}}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.globalKeyDownListener)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.globalKeyDownListener)}},{key:"constructClause",value:function(){var e=this.props.dimension,t=this.state,a=t.start,n=t.end,r=t.filterMode;return isNaN(a)||isNaN(n)||null===a&&null===n||null!==a&&null!==n&&a>n?null:new N.d({reference:e.name,not:r===z.c.EXCLUDE,values:F.a.of(new N.e({start:a,end:n,bounds:a===n?"[]":"[)"}))})}},{key:"actionEnabled",value:function(){var e=this.props,t=e.essence.filter,a=e.dimension,n=this.constructClause(),r=t.getClauseForDimension(a);return Boolean(n)&&!n.equals(r)}},{key:"render",value:function(){var e=this.props,t=e.essence,a=e.timekeeper,n=e.dimension,i=e.onClose,s=e.containerStage,c=e.openOn,l=this.state,o=l.end,u=l.start,m=l.filterMode,f=T.a.fromSize(250,410);return r.a.createElement(R.a,{className:"number-filter-menu",direction:"down",containerStage:s,stage:f,openOn:c,onClose:i},r.a.createElement("div",{className:"side-by-side"},r.a.createElement("div",{className:"group"},r.a.createElement("label",{className:"input-top-label"},"Type"),r.a.createElement(B,{selectedOption:m,onSelectOption:this.onSelectFilterOption,filterOptions:Y})),r.a.createElement("div",{className:"group"},r.a.createElement("label",{className:"input-top-label"},"Min"),r.a.createElement("input",{value:H(u),onChange:this.onRangeInputStartChange})),r.a.createElement("div",{className:"group"},r.a.createElement("label",{className:"input-top-label"},"Max"),r.a.createElement("input",{value:H(o),onChange:this.onRangeInputEndChange}))),r.a.createElement(_,{onRangeEndChange:this.onRangeEndChange,onRangeStartChange:this.onRangeStartChange,start:u,end:o,dimension:n,essence:t,timekeeper:a,exclude:m===z.c.EXCLUDE}),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",title:h.m.ok,onClick:this.onOkClick,disabled:!this.actionEnabled()}),r.a.createElement(L.a,{type:"secondary",title:h.m.cancel,onClick:this.onCancelClick})))}}]),a}(r.a.Component),$=a(15),ee=a(86),te=a(24),ae=a(132),ne=a(133),re=a(164),ie=a(98),se=function(e){return r.a.createElement("div",{className:"error-notice"},e)},ce=function(e){var t=e.content,a=e.highlight;return r.a.createElement("div",{className:"row no-select",title:t},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement(ie.a,{className:"label",text:t,highlight:a})))};function le(e,t,a){return a?e.filter(function(e,t){switch(e){case z.c.CONTAINS:return function(e){return String(e).includes(t)};case z.c.REGEX:var a=t.replace(/\\[^\\]]/g,"\\\\"),n=new RegExp(a);return function(e){return n.test(String(e))}}}(t,a)):e}var oe=function(e){var t=e.regexErrorMessage,a=e.searchText,n=e.dataset,i=e.filterMode,s=e.dimension,c=e.limit;if(t)return se(t);var l=n.data;if(a&&0===l.length)return se('No results for "'.concat(a,'"'));var o=le(l.slice(0,c).map((function(e){return e[s.name]})),i,a);return r.a.createElement(r.a.Fragment,null,a&&r.a.createElement("div",{className:"matching-values-message"},"Matching Values"),o.map((function(e){return r.a.createElement(ce,{content:String(e),highlight:a,key:String(e)})})))};var ue=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"lastSearchText",void 0),Object(f.a)(Object(m.a)(e),"initialSearchText",(function(){var t=e.props,a=t.essence,n=t.dimension,r=a.filter.getClauseForDimension(n);return r&&r instanceof N.h&&r.action!==N.g.IN?r.values.first():""})),Object(f.a)(Object(m.a)(e),"state",{dataset:ee.g,searchText:e.initialSearchText()}),Object(f.a)(Object(m.a)(e),"updateSearchText",(function(t){return e.setState({searchText:t})})),Object(f.a)(Object(m.a)(e),"queryFilter",(function(t,a){var n=e.context.stringFilterQuery,r=e.state.searchText;return n(t,a).then((function(t){return e.lastSearchText!==r?null:Object(ee.f)(t)})).catch((function(t){return e.lastSearchText!==r?null:(Object(ae.b)(t),Object(ee.b)(t))}))})),Object(f.a)(Object(m.a)(e),"debouncedQueryFilter",Object(te.h)(e.queryFilter,h.k)),Object(f.a)(Object(m.a)(e),"globalKeyDownListener",(function(t){Object(b.c)(t)&&e.onOkClick()})),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.actionEnabled()){var t=e.props,a=t.saveClause,n=t.onClose;a(e.constructClause()),n()}})),Object(f.a)(Object(m.a)(e),"onCancelClick",(function(){e.props.onClose()})),e}return Object(s.a)(a,[{key:"loadRows",value:function(){var e=this;this.regexErrorMessage()||(this.setState({dataset:ee.g}),this.sendQueryFilter().then((function(t){t&&e.setState({dataset:t})})))}},{key:"sendQueryFilter",value:function(){var e=this.state.searchText;return this.lastSearchText=e,this.debouncedQueryFilter(this.props.essence,this.constructClause())}},{key:"regexErrorMessage",value:function(){var e=this.props.filterMode,t=this.state.searchText;return e===z.c.REGEX&&t&&function(e){try{new RegExp(e)}catch(e){return e.message}return null}(t)}},{key:"UNSAFE_componentWillMount",value:function(){this.loadRows()}},{key:"componentWillUnmount",value:function(){this.debouncedQueryFilter.cancel()}},{key:"componentDidUpdate",value:function(e,t){this.state.searchText!==t.searchText&&this.loadRows()}},{key:"constructClause",value:function(){var e=this.props,t=e.dimension,a=e.filterMode,n=this.state.searchText,r=t.name;switch(a){case z.c.CONTAINS:return new N.h({reference:r,values:F.f.of(n),action:N.g.CONTAINS});case z.c.REGEX:return new N.h({reference:r,values:F.f.of(n),action:N.g.MATCH})}}},{key:"actionEnabled",value:function(){var e=this.props,t=e.essence.filter,a=e.dimension;if(this.regexErrorMessage())return!1;var n=this.constructClause();if(!n.values.first())return!1;var r=t.getClauseForDimension(a);return!n.equals(r)}},{key:"render",value:function(){var e=this.props,t=e.filterMode,a=e.dimension,n=this.state,i=n.dataset,s=n.searchText,c=Object(ee.d)(i)&&i.dataset.data.length>100;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{keyDown:this.globalKeyDownListener}),r.a.createElement("div",{className:"search-box"},r.a.createElement(ne.a,{placeholder:"Search",focusOnMount:!0,value:s,onChange:this.updateSearchText})),r.a.createElement("div",{className:"preview-string-filter-menu"},r.a.createElement("div",{className:Object(b.b)("menu-table",c?"has-more":"no-more")},r.a.createElement("div",{className:"rows"},Object(ee.d)(i)&&r.a.createElement(oe,{dimension:a,dataset:i.dataset,searchText:s,regexErrorMessage:this.regexErrorMessage(),limit:100,filterMode:t}),Object(ee.c)(i)?r.a.createElement(V.a,{error:i.error}):null,Object(ee.e)(i)?r.a.createElement(I.a,null):null)),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",title:h.m.ok,onClick:this.onOkClick,disabled:!this.actionEnabled()}),r.a.createElement(L.a,{type:"secondary",title:h.m.cancel,onClick:this.onCancelClick}))))}}]),a}(r.a.Component);function me(e){e&&e.focus()}Object(f.a)(ue,"contextType",x.a);var fe=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{value:""}),Object(f.a)(Object(m.a)(e),"values",(function(){var t=e.state.value;return Object(F.f)(t.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0})))})),Object(f.a)(Object(m.a)(e),"select",(function(){var t=e.props,a=t.onClose,n=t.onSelect,r=e.values();r.isEmpty()||(n(Object(F.f)(r)),a())})),Object(f.a)(Object(m.a)(e),"cancel",(function(){return e.props.onClose()})),Object(f.a)(Object(m.a)(e),"saveValue",(function(t){var a=t.target.value;return e.setState({value:a})})),e}return Object(s.a)(a,[{key:"render",value:function(){var e=this.state.value,t=this.values().isEmpty();return r.a.createElement("div",null,r.a.createElement("textarea",{ref:me,className:"paste-field",value:e,onChange:this.saveValue}),r.a.createElement("div",{className:"paste-actions"},r.a.createElement(L.a,{type:"primary",title:"Select",disabled:t,onClick:this.select}),r.a.createElement(L.a,{type:"secondary",title:"Cancel",onClick:this.cancel})))}}]),a}(r.a.Component),de=function(e){var t=e.value,a=e.selected,n=e.checkboxStyle,i=e.highlight,s=e.onRowSelect,c=String(t);return r.a.createElement("div",{className:Object(b.b)("string-value",{selected:a}),title:c,onClick:function(e){return s(t,function(e){return e.altKey||e.ctrlKey||e.metaKey}(e))}},r.a.createElement("div",{className:"value-wrapper"},r.a.createElement(P.a,{type:n,selected:a}),r.a.createElement(ie.a,{className:"label",text:c,highlight:i})))};var pe=function(e){var t,a,n=e.onRowSelect,i=e.filterMode,s=e.dataset,c=e.dimension,l=e.searchText,o=e.promotedValues,u=e.selectedValues,m=s.data.map((function(e){return e[c.name]})),f=function(e,t){if(!t)return e;var a=t.toLowerCase();return e.filter((function(e){return-1!==String(e).toLowerCase().indexOf(a)}))}((t=m,a=o,[].concat(Object(k.a)(a),Object(k.a)(t.filter((function(e){return!a.contains(e)}))))),l);if(l&&0===f.length)return r.a.createElement("div",{className:"no-string-values"},'No results for "'.concat(l,'"'));var d=i===z.c.EXCLUDE?"cross":"check";return r.a.createElement(r.a.Fragment,null,f.map((function(e){return r.a.createElement(de,{key:String(e),value:e,onRowSelect:n,selected:u&&u.contains(e),checkboxStyle:d,highlight:l})})))};function ve(e,t){return e.has(t)?e.remove(t):e.add(t)}var he=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"lastSearchText",void 0),Object(f.a)(Object(m.a)(e),"state",{pasteModeEnabled:!1,dataset:ee.g,selectedValues:e.initialSelection(),searchText:""}),Object(f.a)(Object(m.a)(e),"queryFilter",(function(t,a){var n=e.state.searchText;return(0,e.context.stringFilterQuery)(t,a).then((function(t){return e.lastSearchText!==n?null:Object(ee.f)(t)})).catch((function(t){return e.lastSearchText!==n?null:(Object(ae.b)(t),Object(ee.b)(t))}))})),Object(f.a)(Object(m.a)(e),"debouncedQueryFilter",Object(te.h)(e.queryFilter,h.k)),Object(f.a)(Object(m.a)(e),"globalKeyDownListener",(function(t){!e.state.pasteModeEnabled&&Object(b.c)(t)&&e.onOkClick()})),Object(f.a)(Object(m.a)(e),"updateSearchText",(function(t){return e.setState({searchText:t})})),Object(f.a)(Object(m.a)(e),"onValueClick",(function(t,a){var n=e.state.selectedValues;if(a){var r=n.contains(t)&&1===n.count();return e.setState({selectedValues:r?F.f.of():F.f.of(t)})}return e.setState({selectedValues:ve(n,t)})})),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.isFilterValid()){var t=e.props,a=t.saveClause,n=t.onClose;a(e.constructClause()),n()}})),Object(f.a)(Object(m.a)(e),"enablePasteMode",(function(){return e.setState({pasteModeEnabled:!0})})),Object(f.a)(Object(m.a)(e),"disablePasteMode",(function(){return e.setState({pasteModeEnabled:!1})})),Object(f.a)(Object(m.a)(e),"selectValues",(function(t){return e.setState({selectedValues:t})})),e}return Object(s.a)(n,[{key:"loadRows",value:function(){var e=this;this.setState({dataset:ee.g}),this.sendQueryFilter().then((function(t){t&&e.setState({dataset:t})})).catch((function(t){e.setState({dataset:Object(ee.b)(new Error("Unknown error"))})}))}},{key:"sendQueryFilter",value:function(){var e=this.state.searchText;return this.lastSearchText=e,this.debouncedQueryFilter(this.props.essence,this.constructSearchTextClause())}},{key:"UNSAFE_componentWillMount",value:function(){this.loadRows()}},{key:"initialSelection",value:function(){var e=this.props,t=e.essence.filter,a=e.dimension,n=t.getClauseForDimension(a);if(!n)return Object(F.f)();if(!(n instanceof N.h))throw new Error("Expected string filter clause, got: ".concat(n));return n.action===N.g.IN?n.values:Object(F.f)()}},{key:"componentWillUnmount",value:function(){this.debouncedQueryFilter.cancel()}},{key:"componentDidUpdate",value:function(e,t){this.state.searchText!==t.searchText&&this.loadRows()}},{key:"constructClause",value:function(){var e=this.props,t=e.dimension,a=e.filterMode,n=this.state.selectedValues,r=t.name;return n.isEmpty()?null:new N.h({action:N.g.IN,reference:r,values:n,not:a===z.c.EXCLUDE})}},{key:"constructSearchTextClause",value:function(){var e=this.props.dimension.name,t=this.state.searchText;return new N.h({action:N.g.CONTAINS,reference:e,values:F.f.of(t),ignoreCase:!0})}},{key:"isFilterValid",value:function(){if(this.state.selectedValues.isEmpty())return!1;var e=this.props,t=e.essence.filter,a=e.dimension,n=this.constructClause(),r=t.getClauseForDimension(a);return n&&!n.equals(r)}},{key:"renderSelectMode",value:function(){var e=this.props,t=e.filterMode,n=e.onClose,i=e.dimension,s=this.state,c=s.dataset,l=s.selectedValues,u=s.searchText;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"paste-icon",onClick:this.enablePasteMode,title:"Paste multiple values"},r.a.createElement(o.a,{svg:a(389)})),r.a.createElement("div",{className:"search-box"},r.a.createElement(ne.a,{placeholder:"Search",focusOnMount:!0,value:u,onChange:this.updateSearchText})),r.a.createElement("div",{className:Object(b.b)("selectable-string-filter-menu",t)},r.a.createElement("div",{className:"menu-table"},r.a.createElement("div",{className:"rows"},Object(ee.d)(c)&&r.a.createElement(pe,{onRowSelect:this.onValueClick,dimension:i,dataset:c.dataset,searchText:u,selectedValues:l,promotedValues:this.initialSelection(),filterMode:t}),Object(ee.c)(c)&&r.a.createElement(V.a,{error:c.error}),Object(ee.e)(c)&&r.a.createElement(I.a,null))),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",title:h.m.ok,onClick:this.onOkClick,disabled:!this.isFilterValid()}),r.a.createElement(L.a,{type:"secondary",title:h.m.cancel,onClick:n}))))}},{key:"renderImportMode",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"paste-prompt"},"Paste values separated by newlines"),r.a.createElement("div",{className:"paste-form"},r.a.createElement(fe,{onSelect:this.selectValues,onClose:this.disablePasteMode})))}},{key:"render",value:function(){var e=this.state.pasteModeEnabled;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{keyDown:this.globalKeyDownListener}),e?this.renderImportMode():this.renderSelectMode())}}]),n}(r.a.Component);Object(f.a)(he,"contextType",x.a);var be=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"initialFilterMode",(function(){var t=e.props,a=t.essence.filter,n=t.dimension;return a.getModeForDimension(n)||z.c.INCLUDE})),Object(f.a)(Object(m.a)(e),"state",{filterMode:e.initialFilterMode()}),Object(f.a)(Object(m.a)(e),"onSelectFilterOption",(function(t){return e.setState({filterMode:t})})),e}return Object(s.a)(a,[{key:"getFilterOptions",value:function(){var e=this.props.dimension.kind,t=B.getFilterOptions(z.c.INCLUDE,z.c.EXCLUDE);return"boolean"!==e&&(t=t.concat(B.getFilterOptions(z.c.REGEX,z.c.CONTAINS))),t}},{key:"renderFilterControls",value:function(){var e=this.props,t=e.dimension,a=e.saveClause,n=e.essence,i=e.timekeeper,s=e.onClose,c=this.state.filterMode,l={dimension:t,essence:n,timekeeper:i,onClose:s,saveClause:a};switch(c){case z.c.EXCLUDE:case z.c.INCLUDE:var o=Object($.a)(Object($.a)({},l),{},{filterMode:c});return r.a.createElement(he,o);case z.c.REGEX:case z.c.CONTAINS:var u=Object($.a)(Object($.a)({},l),{},{filterMode:c});return r.a.createElement(ue,Object.assign({key:c},u))}}},{key:"render",value:function(){var e=this.props,t=e.dimension,a=e.onClose,n=e.containerStage,i=e.openOn,s=this.state.filterMode;return t?r.a.createElement(R.a,{className:"string-filter-menu",direction:"down",containerStage:n,stage:T.a.fromSize(300,410),openOn:i,onClose:a},r.a.createElement("div",{className:"string-filter-content"},r.a.createElement(B,{selectedOption:s,onSelectOption:this.onSelectFilterOption,filterOptions:this.getFilterOptions()}),this.renderFilterControls())):null}}]),a}(r.a.Component),Oe=a(721),ge=a(16),je=a(70),Se=a(49),Ee=a(5),ye=a(43),ke=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{dateString:"",timeString:""}),Object(f.a)(Object(m.a)(e),"dateChange",(function(t){var a=Object(ye.n)(t.target.value);e.setState({dateString:a}),Object(ye.q)(a)&&e.changeDate(a,e.state.timeString)})),Object(f.a)(Object(m.a)(e),"timeChange",(function(t){var a=Object(ye.o)(t.target.value);e.setState({timeString:a}),Object(ye.r)(a)&&e.changeDate(e.state.dateString,a)})),e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.time,a=e.timezone;this.updateStateFromTime(t,a)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.time,a=e.timezone;this.updateStateFromTime(t,a)}},{key:"updateStateFromTime",value:function(e,t){e&&(isNaN(e.valueOf())?this.setState({dateString:""}):this.setState({dateString:Object(ye.d)(e,t),timeString:Object(ye.f)(e,t)}))}},{key:"changeDate",value:function(e,t){var a=this.props,n=a.timezone,r=a.onChange,i=Object(ye.a)(e,t,n);i&&i.isValid()&&r(i.toDate())}},{key:"render",value:function(){var e=this.props,t=e.hide,a=e.label,n=this.state,i=n.dateString,s=n.timeString,c=t?"":i,l=t?"":s;return r.a.createElement("div",{className:"date-range-input"},r.a.createElement("div",{className:"label"},a),r.a.createElement("input",{placeholder:"YYYY-MM-DD",className:"date-field",value:c,onChange:this.dateChange}),r.a.createElement("input",{placeholder:"HH:MM",className:"time-field",value:l,onChange:this.timeChange}))}}]),a}(r.a.Component);function Ce(e,t,a){var n=function(e,t,a){var n=[],r=Object(ye.m)(e,t),i=r.clone().add(1,"month"),s=[],c=r.clone().startOf("day");for(;c.isBefore(i);)c.day()===a.weekStart&&s.length>0&&(n.push(s),s=[]),s.push(c.toDate()),c=c.add(1,"day");s.length>0&&n.push(s);return n}(e,t,a),r=n[0],i=n[n.length-1],s=n.slice(1,-1);return[Ne(r,t)].concat(Object(k.a)(s),[we(i,t)])}function we(e,t){var a=e[e.length-1],n=7-e.length;return[].concat(Object(k.a)(e),Object(k.a)(function(e,t,a){return Object(te.n)(0,t).map((function(t){return ge.day.shift(e,a,t+1)}))}(a,n,t)))}function Ne(e,t){var a=e[0],n=7-e.length;return[].concat(Object(k.a)(function(e,t,a){return Object(te.n)(0,t).map((function(n){return ge.day.shift(e,a,-t+n)}))}(a,n,t)),Object(k.a)(e))}var Me=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{activeMonthStartDate:ge.month.floor(e.props.startTime||new Date,e.props.timezone),hoverTimeRange:null,selectionSet:!0}),Object(f.a)(Object(m.a)(e),"goToPreviousMonth",(function(){return e.navigateToMonth(-1)})),Object(f.a)(Object(m.a)(e),"goToNextMonth",(function(){return e.navigateToMonth(1)})),Object(f.a)(Object(m.a)(e),"onCalendarMouseLeave",(function(){e.setState({hoverTimeRange:null})})),e}return Object(s.a)(n,[{key:"navigateToMonth",value:function(e){var t=this.props.timezone,a=this.state.activeMonthStartDate,n=ge.month.shift(a,t,e);this.setState({activeMonthStartDate:n})}},{key:"calculateHoverTimeRange",value:function(e){var t=this.props,a=t.startTime,n=t.endTime,r=null;if(a&&!n){var i=a,s=e;e<a&&(i=e,s=a),r=new Ee.TimeRange({start:i,end:s,bounds:"[]"})}this.setState({hoverTimeRange:r})}},{key:"selectNewRange",value:function(e,t){var a=this.props,n=a.onStartChange,r=a.onEndChange,i=a.timezone;n(e),t&&(t=ge.day.shift(t,i,1)),r(t)}},{key:"selectDay",value:function(e){var t=this.props.startTime;if(this.state.selectionSet)this.setState({hoverTimeRange:null,selectionSet:!1}),this.selectNewRange(e,null);else{var a=e<t;Object(ye.b)(e,t)?this.selectNewRange(t,t):a?this.selectNewRange(e,t):this.selectNewRange(t,e),this.setState({selectionSet:!0})}}},{key:"getIsSelectable",value:function(e){var t=this.state,a=t.hoverTimeRange,n=t.selectionSet;return a&&a.contains(e)&&!n}},{key:"renderDays",value:function(e,t){var a=this,n=this.props,i=n.startTime,s=n.endTime,c=n.maxTime,l=n.timezone,o=ge.day.floor(i,l),u=s&&ge.day.shift(s,l,-1),m=ge.month.shift(t,l,1);return e.map((function(e,n){return r.a.createElement("div",{className:"week",key:n}," ",e.map((function(e,n){var f=e<t,d=e>=m,p=e>c,v=o<=e&&e<s,h=Object(ye.b)(e,i),O=Object(ye.b)(e,u),g=Object(b.b)("day","value",{past:f,future:d,"beyond-max-range":p,selectable:a.getIsSelectable(e),selected:v,"selected-edge":h||O});return r.a.createElement("div",{className:g,key:n,onClick:a.selectDay.bind(a,e),onMouseEnter:a.calculateHoverTimeRange.bind(a,e)},Object(ye.l)(e,l))})))}))}},{key:"renderCalendar",value:function(e){var t=this.props,a=Ce(e,t.timezone,t.locale);return this.renderDays(a,e)}},{key:"renderCalendarNav",value:function(e){var t=this.props.timezone;return r.a.createElement("div",{className:"calendar-nav"},r.a.createElement("div",{className:"caret left",onClick:this.goToPreviousMonth},r.a.createElement(o.a,{svg:a(387)})),Object(ye.k)(e,t),r.a.createElement("div",{className:"caret right",onClick:this.goToNextMonth},r.a.createElement(o.a,{svg:a(388)})))}},{key:"render",value:function(){var e=this.props,t=e.locale,a=e.startTime,n=e.endTime,i=e.timezone,s=e.onStartChange,c=e.onEndChange,l=this.state,o=l.activeMonthStartDate,u=l.selectionSet;if(!o)return null;var m=Object(te.g)(t.shortDays,t.weekStart);return r.a.createElement("div",{className:"date-range-picker"},r.a.createElement("div",null,r.a.createElement(ke,{label:"Start",type:"start",time:a,timezone:i,onChange:s}),r.a.createElement(ke,{label:"End",type:"end",time:n,timezone:i,onChange:c,hide:!u})),r.a.createElement("div",{className:"calendar",onMouseLeave:this.onCalendarMouseLeave},this.renderCalendarNav(o),r.a.createElement("div",{className:"week"},m.map((function(e,t){return r.a.createElement("div",{className:"day label",key:e+t},r.a.createElement("span",{className:"space"}),e)}))),this.renderCalendar(o)))}}]),n}(r.a.Component),De=a(689),Fe=a(158);function Te(e){var t=e.shift,a=e.time,n=e.timezone;if(null===a||!a.start||!a.end)return null;var r=function(e){try{return ge.Duration.fromJS(e)}catch(e){return null}}(t);if(null===r)return null;var i=a.shift(r,n);return Object(ye.i)(i,n)}function xe(e){return[{name:"Off",identity:null}].concat(Object(k.a)(e.timeShiftDurations.map((function(e){return{name:Object(Fe.e)(e.toJS()),identity:e.toJS()}}))))}var Re=function(e){var t=e.onShiftChange,a=e.dimension,n=e.shift,i=Te(e);return r.a.createElement(r.a.Fragment,null,r.a.createElement(De.a,{title:h.m.timeShift,presets:xe(a),selected:n,onChange:t,errorMessage:Object(Se.b)(n)?null:h.m.invalidDurationFormat,placeholder:h.m.timeShiftExamples}),i?r.a.createElement("div",{className:"preview"},i):null)},Le=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"initialState",(function(){var t=e.props,a=t.essence,n=t.timekeeper,r=t.dimension.name,i=a.timeShift.toJS(),s=a.getEffectiveFilter(n).clauseForReference(r);if(s&&s instanceof N.c&&!s.values.isEmpty()){var c=s.values.get(0);return{start:c.start,end:c.end,shift:i}}return{start:null,end:null,shift:i}})),Object(f.a)(Object(m.a)(e),"onStartChange",(function(t){return e.setState({start:t})})),Object(f.a)(Object(m.a)(e),"onEndChange",(function(t){return e.setState({end:t})})),Object(f.a)(Object(m.a)(e),"setTimeShift",(function(t){return e.setState({shift:t})})),Object(f.a)(Object(m.a)(e),"state",e.initialState()),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.validate()){var t=e.props,a=t.saveClause,n=t.clicker,r=t.onClose;a(e.constructFixedClause()),n.changeComparisonShift(e.constructTimeShift()),r()}})),e}return Object(s.a)(a,[{key:"createDateRange",value:function(){var e=this.state,t=e.start,a=e.end;if(!t)return null;var n=this.props.essence.timezone,r=a||ge.day.shift(t,n,1);return t>=r?null:new je.a({start:t,end:r})}},{key:"constructFixedClause",value:function(){var e=this.props.dimension.name,t=F.a.of(this.createDateRange());return new N.c({reference:e,values:t})}},{key:"constructTimeShift",value:function(){return Se.a.fromJS(this.state.shift)}},{key:"doesTimeShiftOverlap",value:function(){var e=this.constructTimeShift();if(e.isEmpty())return!1;var t=this.props.essence.timezone,a=this.createDateRange(),n=e.valueOf(),r=a.shift(n,t);return a.intersects(r)}},{key:"validateOverlap",value:function(){return this.isTimeShiftValid()&&this.areDatesValid()&&this.doesTimeShiftOverlap()?h.m.overlappingPeriods:null}},{key:"isTimeShiftValid",value:function(){return Object(Se.b)(this.state.shift)}},{key:"areDatesValid",value:function(){return null!==this.createDateRange()}},{key:"isFormValid",value:function(){return this.areDatesValid()&&this.isTimeShiftValid()&&!this.doesTimeShiftOverlap()}},{key:"isFilterDifferent",value:function(){var e=this.props,t=e.essence,a=t.filter,n=t.timeShift,r=e.dimension,i=this.constructTimeShift(),s=a.getClauseForDimension(r),c=this.constructFixedClause();return!s.equals(c)||!n.equals(i)}},{key:"validate",value:function(){return this.isFormValid()&&this.isFilterDifferent()}},{key:"render",value:function(){var e=this.props,t=e.locale,a=e.essence,n=a.timezone,i=a.dataCube,s=e.timekeeper,c=e.dimension,l=e.onClose;if(!c)return null;var o=this.state,u=o.shift,m=o.start,f=o.end,p=this.validateOverlap();return r.a.createElement("div",null,r.a.createElement(Me,{locale:t,startTime:m,endTime:f,maxTime:Object(d.f)(i,s),timezone:n,onStartChange:this.onStartChange,onEndChange:this.onEndChange}),r.a.createElement("div",{className:"cont"},r.a.createElement(Re,{dimension:c,shift:u,time:this.createDateRange(),onShiftChange:this.setTimeShift,timezone:n}),p&&r.a.createElement("div",{className:"overlap-error-message"},p)),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",onClick:this.onOkClick,disabled:!this.validate(),title:h.m.ok}),r.a.createElement(L.a,{type:"secondary",onClick:l,title:h.m.cancel})))}}]),a}(r.a.Component),Pe=a(188);function Ie(e,t){var a=e.filter.getClauseForDimension(t),n=e.timeShift.toJS();if(a instanceof N.f){var r=a.duration,i=a.period;return{timeShift:n,filterDuration:r.toJS(),filterPeriod:i}}return{filterPeriod:null,filterDuration:null,timeShift:n}}var Ve=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"setFilter",(function(t,a){return e.setState({filterDuration:a,filterPeriod:t})})),Object(f.a)(Object(m.a)(e),"setTimeShift",(function(t){return e.setState({timeShift:t})})),Object(f.a)(Object(m.a)(e),"state",Ie(e.props.essence,e.props.dimension)),Object(f.a)(Object(m.a)(e),"saveTimeFilter",(function(){if(e.validate()){var t=e.props,a=t.clicker,n=t.saveClause,r=t.onClose;n(e.constructRelativeClause()),a.changeComparisonShift(e.constructTimeShift()),r()}})),e}return Object(s.a)(a,[{key:"constructTimeShift",value:function(){return Se.a.fromJS(this.state.timeShift)}},{key:"constructRelativeClause",value:function(){var e=this.props.dimension.name,t=this.state,a=t.filterPeriod,n=t.filterDuration;if(!Object(Pe.b)(n))return null;var r=ge.Duration.fromJS(n);return new N.f({period:a,duration:r,reference:e})}},{key:"doesTimeShiftOverlap",value:function(){var e=this.constructTimeShift();if(e.isEmpty())return!1;var t=e.valueOf();return ge.Duration.fromJS(this.state.filterDuration).getCanonicalLength()>t.getCanonicalLength()}},{key:"isTimeShiftValid",value:function(){return Object(Se.b)(this.state.timeShift)}},{key:"isDurationValid",value:function(){return Object(Pe.b)(this.state.filterDuration)}},{key:"validateOverlap",value:function(){return this.isTimeShiftValid()&&this.isDurationValid()&&this.doesTimeShiftOverlap()?h.m.overlappingPeriods:null}},{key:"isFormValid",value:function(){return this.state.filterPeriod&&this.isDurationValid()&&this.isTimeShiftValid()&&!this.doesTimeShiftOverlap()}},{key:"isFilterDifferent",value:function(){var e=this.props,t=e.essence,a=t.filter,n=t.timeShift,r=e.dimension,i=this.constructTimeShift(),s=a.getClauseForDimension(r),c=this.constructRelativeClause();return!s.equals(c)||!n.equals(i)}},{key:"validate",value:function(){return this.isFormValid()&&this.isFilterDifferent()}},{key:"renderLatestPresets",value:function(){var e=this,t=this.props.dimension,a=this.state,n=a.filterDuration,i=a.filterPeriod,s=t.latestPeriodDurations.map((function(e){return{name:Object(Fe.e)(e.toJS()),identity:e.toJS()}})),c=i===N.i.LATEST;return r.a.createElement(De.a,{title:h.m.latest,presets:s,errorMessage:c&&!Object(Pe.b)(n)&&h.m.invalidDurationFormat,selected:c?n:void 0,onChange:function(t){return e.setFilter(N.i.LATEST,t)},placeholder:h.m.durationsExamples})}},{key:"renderButtonGroup",value:function(e,t){var a=this,n=this.state,i=n.filterDuration,s=n.filterPeriod,c=t===s,l=Object(Fe.d)(t).map((function(e){var n=e.duration,r=e.name;return{title:r,key:r,isSelected:c&&i===n,onClick:function(){return a.setFilter(t,n)}}}));return r.a.createElement(Oe.a,{title:e,groupMembers:l})}},{key:"getFilterRange",value:function(){var e=this.constructRelativeClause();if(!e)return null;var t=this.props,a=t.essence,n=t.timekeeper;return a.evaluateSelection(e,n).values.get(0)}},{key:"render",value:function(){var e=this.props,t=e.essence,a=e.dimension;if(!a)return null;var n=this.state.timeShift,i=t.timezone,s=this.getFilterRange(),c=s?Object(ye.i)(s,i):h.m.noFilter,l=this.validateOverlap();return r.a.createElement("div",{className:"cont"},Object(d.i)(t.dataCube,a.expression)&&this.renderLatestPresets(),this.renderButtonGroup(h.m.current,N.i.CURRENT),this.renderButtonGroup(h.m.previous,N.i.PREVIOUS),r.a.createElement("div",{className:"preview preview--with-spacing"},c),r.a.createElement(Re,{dimension:a,shift:n,time:s,timezone:t.timezone,onShiftChange:this.setTimeShift}),l&&r.a.createElement("div",{className:"overlap-error-message"},l),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",onClick:this.saveTimeFilter,disabled:!this.validate(),title:h.m.ok}),r.a.createElement(L.a,{type:"secondary",onClick:this.props.onClose,title:h.m.cancel})))}}]),a}(r.a.Component);function Ae(e){return e===ze.RELATIVE?h.m.relative:h.m.fixed}var ze,qe=function(e){var t=e.selectedTab,a=e.onTabSelect,n=[ze.RELATIVE,ze.FIXED].map((function(e){return{isSelected:t===e,title:Ae(e),key:e,onClick:function(){return a(e)}}}));return r.a.createElement(Oe.a,{groupMembers:n})};function Ue(e){return e.timeFilter()instanceof N.f?ze.RELATIVE:ze.FIXED}!function(e){e.RELATIVE="relative",e.FIXED="fixed"}(ze||(ze={}));var Be=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{tab:Ue(e.props.essence)}),Object(f.a)(Object(m.a)(e),"selectTab",(function(t){return e.setState({tab:t})})),e}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.essence,a=e.saveClause,n=e.timekeeper,i=e.clicker,s=e.dimension,c=e.onClose,l=e.containerStage,o=e.locale,u=e.openOn;if(!s)return null;var m=this.state.tab,f=T.a.fromSize(250,410),d=m===ze.RELATIVE,p={saveClause:a,essence:t,dimension:s,timekeeper:n,onClose:c,clicker:i,locale:o};return r.a.createElement(R.a,{className:"time-filter-menu",direction:"down",containerStage:l,stage:f,openOn:u,onClose:c},r.a.createElement(qe,{selectedTab:m,onTabSelect:this.selectTab}),d?r.a.createElement(Ve,p):r.a.createElement(Le,p))}}]),a}(r.a.Component),Qe=["dimension"],Ge=function(e){var t=e.dimension,a=Object(D.a)(e,Qe);if(!t)return null;switch(t.kind){case"time":return r.a.createElement(Be,Object.assign({dimension:t},a));case"boolean":return r.a.createElement(A,Object.assign({dimension:t},a));case"number":return r.a.createElement(Z,Object.assign({dimension:t},a));default:return r.a.createElement(be,Object.assign({dimension:t},a))}},Ke=a(683),Xe=a(368),We=a(329);function _e(e,t,a){var n=Object(M.e)(e,t,a.timezone),r=n.title,i=n.values,s=Object(We.a)(e,a);return"".concat(r," ").concat(i," ").concat(s||"")}var He=function(e){var t=e.clause,n=e.open,i=e.dimension,s=e.style,c=e.removeClause,l=e.saveClause,u=e.openFilterMenu,m=e.closeFilterMenu,f=e.dragStart,d=e.stage,p=e.essence,v=e.locale,h=e.timekeeper,O=e.clicker,g=t&&!Object(N.k)(t)&&t.not;return r.a.createElement(Ke.a,null,(function(e){var j=e.ref,S=e.setRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Object(b.b)("tile dimension",{selected:n,excluded:g,included:!g}),draggable:!0,ref:S,onClick:function(){return u(t)},onDragStart:function(e){return f(i,t,e)},style:s,title:_e(i,t,p)},r.a.createElement(Xe.a,{dimension:i,clause:t,essence:p}),c&&r.a.createElement("div",{className:"remove",onClick:function(){return c(t)}},r.a.createElement(o.a,{svg:a(194)}))),n&&j&&r.a.createElement(Ge,{containerStage:d,essence:p,timekeeper:h,locale:v,clicker:O,saveClause:l,openOn:j,dimension:i,onClose:m}))}))},Je=function(e){var t=e.closeItem,a=e.saveClause,n=e.essence,i=e.timekeeper,s=e.locale,c=e.clicker,l=e.stage,o=e.dimension,u=e.style;return r.a.createElement(Ke.a,null,(function(e){var m=e.ref,f=e.setRef;return r.a.createElement("div",{className:"tile dimension selected included",ref:f,style:u},r.a.createElement("div",{className:"reading"},o.title),m&&r.a.createElement(Ge,{essence:n,timekeeper:i,locale:s,clicker:c,saveClause:a,openOn:m,dimension:o,containerStage:l,onClose:t}))}))},Ye=function(e){var t=e.menuStage,a=e.maxItems,n=e.essence,i=e.clicker,s=e.timekeeper,c=e.locale,l=e.removeFilter,o=e.openedFilterMenu,u=e.openFilterMenu,m=e.closeFilterMenu,f=e.dragStart,d=e.partialFilter,v=e.removePartialFilter,h=e.overflowOpen,O=e.closeOverflowMenu,j=e.openOverflowMenu,S=n.filter.clauses.toArray(),E=n.dataCube.dimensions;function y(e){i.changeFilter(n.filter.setClause(e))}var N=function(e){if(!d)return e;var a=d.dimension,l=d.position,o=r.a.createElement(Je,{key:"partial-filter-tile",dimension:a,essence:n,timekeeper:s,locale:c,clicker:i,saveClause:function(e){return function(e,t){var a=n.filter,r=t.isInsert()?a.insertByIndex(t.insert,e):a.replaceByIndex(t.replace,e);i.changeFilter(r)}(e,d.position)},stage:t,closeItem:v});return C(e,l.getIndex(),o)}(S.map((function(e){var a=Object(p.d)(E,e.reference),d=a.name===n.getTimeDimension().name;return r.a.createElement(He,{key:e.reference,stage:t,essence:n,timekeeper:s,clicker:i,locale:c,clause:e,open:e.equals(o),dimension:a,removeClause:d?void 0:l,saveClause:y,openFilterMenu:u,closeFilterMenu:m,dragStart:f})}))),M=N.slice(0,a).map((function(e,t){return r.a.cloneElement(e,{style:Object(b.o)(t*g.a,0)})})),D=N.slice(a);if(D.length<=0)return r.a.createElement(r.a.Fragment,null,M);var F=S.slice(a).some((function(e){return e.equals(o)})),T=D.some((function(e){return e.type===Je})),x=h||F||T,R=r.a.createElement(w.a,{key:"overflow-menu",className:"dimension",x:M.length*g.a,items:D,open:x,openOverflowMenu:j,closeOverflowMenu:O});return r.a.createElement(r.a.Fragment,null,[].concat(Object(k.a)(M),[R]))},Ze=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"state",{}),Object(f.a)(Object(m.a)(e),"items",r.a.createRef()),Object(f.a)(Object(m.a)(e),"openFilterMenu",(function(t){return e.setState({openedClause:t})})),Object(f.a)(Object(m.a)(e),"closeFilterMenu",(function(){return e.setState({openedClause:null})})),Object(f.a)(Object(m.a)(e),"openOverflowMenu",(function(){return e.setState({overflowOpen:!0})})),Object(f.a)(Object(m.a)(e),"closeOverflowMenu",(function(){return e.setState({overflowOpen:!1})})),Object(f.a)(Object(m.a)(e),"dragStart",(function(t,a,n){var r=t.title,i=n.dataTransfer;i.effectAllowed="all",Object(b.m)(i,"text/plain",r),O.a.setDragFilter(a),Object(b.n)(i,r),e.closeOverflowMenu()})),Object(f.a)(Object(m.a)(e),"dragEnter",(function(t){e.canDrop()&&(t.preventDefault(),e.setState({dragPosition:e.calculateDragPosition(t)}))})),Object(f.a)(Object(m.a)(e),"dragOver",(function(t){if(e.canDrop()){t.preventDefault();var a=e.calculateDragPosition(t);a.equals(e.state.dragPosition)||e.setState({dragPosition:a})}})),Object(f.a)(Object(m.a)(e),"dragLeave",(function(){e.canDrop()&&e.setState({dragPosition:null})})),Object(f.a)(Object(m.a)(e),"drop",(function(t){if(e.canDrop()){t.preventDefault(),e.setState({dragPosition:null});var a=e.calculateDragPosition(t);switch(O.a.dragging.type){case O.b.DIMENSION:e.dropDimension(O.a.draggingDimension(),a);break;case O.b.FILTER:e.dropFilter(O.a.draggingFilter(),a);break;case O.b.SPLIT:e.dropSplit(O.a.draggingSplit(),a)}}})),Object(f.a)(Object(m.a)(e),"appendFilter",(function(t){var a=e.context.essence;(0,e.props.addPartialFilter)(t,v.a.insertAt(a.filter.length()))})),Object(f.a)(Object(m.a)(e),"removeFilter",(function(t){var a=e.context,n=a.essence;a.clicker.changeFilter(n.filter.removeClause(t.reference)),e.closeOverflowMenu()})),e}return Object(s.a)(a,[{key:"maxItems",value:function(){var e=this.context.essence.filter,t=this.props.menuStage;return t&&Object(g.b)(t.width,e.length())}},{key:"canDrop",value:function(){var e=this.context.essence.filter;switch(O.a.dragging.type){case O.b.DIMENSION:return!e.getClauseForDimension(O.a.draggingDimension());case O.b.SPLIT:return!e.clauseForReference(O.a.draggingSplit().reference);case O.b.FILTER:return!0;case O.b.MEASURE:case O.b.SERIES:case O.b.NONE:return!1}}},{key:"calculateDragPosition",value:function(e){var t=this.context.essence.filter.length(),a=this.items.current.getBoundingClientRect(),n=Object(b.f)(e)-a.left,r=v.a.calculateFromOffset(n,t,h.d,h.c);return r.replace===this.maxItems()?v.a.insertAt(r.replace):r}},{key:"dropSplit",value:function(e,t){var a=this.context.essence.dataCube.dimensions,n=Object(p.d)(a,e.reference);this.dropDimension(n,t)}},{key:"dropDimension",value:function(e,t){var a=this.context.essence,n=a.filter,r=a.dataCube,i=this.props.addPartialFilter;if(t.isReplace()){var s=n.clauses.get(t.replace);if(s&&s.reference===Object(d.h)(r))return}i(e,t)}},{key:"dropFilter",value:function(e,t){var a=this.context,n=a.clicker,r=a.essence.filter,i=t.isReplace()?r.replaceByIndex(t.replace,e):r.insertByIndex(t.insert,e);r.equals(i)||n.changeFilter(i)}},{key:"render",value:function(){var e=this.state,t=e.dragPosition,a=e.openedClause,n=e.overflowOpen,i=this.props,s=i.menuStage,c=i.timekeeper,l=i.locale,o=i.partialFilter,u=i.removePartialFilter,m=this.context,f=m.essence,d=m.clicker;return r.a.createElement("div",{className:"tile-row filter-tile-row",onDragEnter:this.dragEnter},r.a.createElement("div",{className:"title"},h.m.filter),r.a.createElement("div",{className:"items",ref:this.items},r.a.createElement(Ye,{menuStage:s,maxItems:this.maxItems(),essence:f,clicker:d,timekeeper:c,locale:l,removeFilter:this.removeFilter,openFilterMenu:this.openFilterMenu,closeFilterMenu:this.closeFilterMenu,dragStart:this.dragStart,removePartialFilter:u,partialFilter:o,overflowOpen:n,closeOverflowMenu:this.closeOverflowMenu,openedFilterMenu:a,openOverflowMenu:this.openOverflowMenu})),r.a.createElement(y,{menuStage:s,essence:f,appendFilter:this.appendFilter}),r.a.createElement(S.a,{dragOver:this.dragOver,dragLeave:this.dragLeave,drop:this.drop,dragPosition:t}))}}]),a}(r.a.Component);Object(f.a)(Ze,"contextType",j.a);var $e=a(71),et=a(714),tt=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"onResolutionClick",value:function(e){var t=this.props.clicker,a=e.adjustment,n=a.splits,r=a.series;null!=r&&t.changeSeriesList(r),null!=n&&t.changeSplits(n,$e.b.KeepAlways)}},{key:"render",value:function(){var e=this,t=this.props.essence.visResolve;if(!t.isManual())return null;var a=t.resolutions.map((function(t,a){return r.a.createElement("li",{className:"resolution-item",key:a,onClick:e.onResolutionClick.bind(e,t)},t.description)}));return r.a.createElement(et.a,{title:t.message},r.a.createElement("ul",{className:"manual-fallback"},a))}}]),a}(r.a.Component),at=a(40),nt=a(135),rt=a(235),it=a(21),st=function(e){var t=e.appendMeasureSeries,a=e.menuStage,n=e.essence,i=n.dataCube,s=n.series,c=Object(it.a)(i.measures).filter((function(e){return!s.hasMeasure(e)})).map((function(e){return{key:e.name,label:e.title,value:e}}));return r.a.createElement(E.a,{containerStage:a,onSelect:t,tiles:c})},ct=a(134),lt=a(159),ot=a(90),ut=a(35),mt=a(79),ft=a(266),dt=a(41);function pt(e,t){switch(e.type){case dt.e.DEFAULT:return t;case dt.e.EXACT:return dt.h;case dt.e.PERCENT:return dt.j;case dt.e.CUSTOM:return e.value}}var vt=function(e){var t=e.format,a=e.measure,n=e.formatChange,i=a.format,s=Object(te.d)({name:"Default",identity:i},i!==dt.h&&{name:"Exact",identity:dt.h},{name:"Percent",identity:dt.j});return r.a.createElement(r.a.Fragment,null,r.a.createElement(De.a,{presets:s,title:h.m.format,selected:pt(t,i),placeholder:"Custom format e.g. ".concat(dt.i),onChange:function(e){n(function(e,t){switch(e){case t:return dt.a;case dt.h:return dt.b;case dt.j:return dt.c;default:return Object(dt.f)(e)}}(e,i))}}),t.type===dt.e.CUSTOM&&r.a.createElement("div",{className:"format-hint"},"You can use custom numbro format to present measure values. Please refer to the ",r.a.createElement("a",{target:"_blank",className:"documentation-link",href:"https://numbrojs.com/old-format.html"},"numbro documentation")),r.a.createElement("div",{className:"preview"},r.a.createElement("span",{className:"value"},23667.25431," → "),r.a.createElement("span",{className:"formatted"},Object(dt.k)(t,a)(23667.25431))))},ht=[{id:ut.a.ADD,label:"Add"},{id:ut.a.SUBTRACT,label:"Subtract"},{id:ut.a.MULTIPLY,label:"Multiply"},{id:ut.a.DIVIDE,label:"Divide"}],bt=function(e){return e.label},Ot=function(e){return e.title},gt=function(e){return e?e.title:"Select measure"};var jt=function(e){var t=e.measure,a=e.measures,n=e.initialSeries,i=e.series,s=e.seriesList,c=e.onChange;function l(e){c(e,function(e){var t=e.expression;return t instanceof ct.a&&Object(Q.o)(t.reference)}(e))}var o=s.removeSeries(n).getSeriesWithKey(i.key()),u=i.expression,m=ht.find((function(e){return e.id===u.operation})),f=Object(it.e)(a,u.reference),d=Object(te.r)(a.byName).filter((function(e){return e.name!==t.name&&!Object(mt.c)(e)}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"operation-select__title"},"Select operation"),r.a.createElement(q.a,{className:"operation-select",items:ht,renderItem:bt,equal:function(e,t){return e.id===t.id},selectedItem:m,onSelect:function(e){var t=e.id;l(i.setIn(["expression","operation"],t))}}),r.a.createElement("div",{className:"operand-select__title"},"Select measure"),r.a.createElement(q.a,{className:"operand-select",items:d,renderItem:Ot,renderSelectedItem:gt,equal:function(e,t){return e.name===t.name},selectedItem:f,onSelect:function(e){var t=e.name;l(i.setIn(["expression","reference"],t))}}),o&&r.a.createElement("div",{className:"arithmetic-operation-warning"},'"',function(e,t,a){return new ft.a(e,t,a).title()}(o,t,a),'" is already defined'),r.a.createElement(vt,{measure:t,format:i.format,formatChange:function(e){l(i.set("format",e))}}))},St=function(e){var t=e.measure,a=e.series,n=e.onChange;return r.a.createElement(r.a.Fragment,null,r.a.createElement(vt,{measure:t,format:a.format,formatChange:function(e){n(a.set("format",e),!0)}}))},Et=[{id:ut.a.PERCENT_OF_PARENT,label:"Percent of parent"},{id:ut.a.PERCENT_OF_TOTAL,label:"Percent of total"}];var yt=function(e){return e.label},kt=function(e){var t=e.series,a=e.seriesList,n=e.measure,i=e.onChange,s=a.getExpressionSeriesFor(n.name).filter((function(e){return!e.equals(t)})).filter((function(e){return e.expression instanceof lt.a})).map((function(e){return e.expression.operation})).toSet();function c(e){i(e,function(e){return e.expression instanceof lt.a}(e))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{className:"percent-operation-picker",items:Et.filter((function(e){var t=e.id;return!s.has(t)})),renderItem:yt,renderSelectedItem:yt,equal:function(e,t){return e.id===t.id},selectedItem:t.expression&&Et.find((function(e){return e.id===t.expression.operation})),onSelect:function(e){var a,n=e.id;c(t.set("expression",(a=n,new lt.a({operation:a}))))}}),r.a.createElement(vt,{measure:n,format:t.format,formatChange:function(e){c(t.set("format",e))}}))},Ct=a(728);function wt(e){var t=parseFloat(e);return isNaN(t)?0:t}function Nt(e){return e.toString()}var Mt=function(e){return r.a.createElement(Ct.a,Object.assign({},e,{parseCustomValue:wt,formatCustomValue:Nt}))},Dt=[{identity:50,name:"50"},{identity:75,name:"75"},{identity:90,name:"90"},{identity:95,name:"95"},{identity:99,name:"99"}],Ft=function(e){var t=e.seriesList,a=e.initialSeries,n=e.measure,i=e.series,s=e.onChange,c=t.removeSeries(a);function l(e){return e.percentile<=0||e.percentile>=100?"Percentile must be a number greater than 0 and lower than 100":c.hasSeriesWithKey(e.key())?"This percentile is already define for this measure":null}function o(e){s(e,function(e){return null===l(e)}(e))}var u=l(i);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"percentile-picker"},r.a.createElement(Mt,{title:"Percentile",placeholder:"Type percentile e.g. 55",selected:i.percentile,presets:Dt,errorMessage:u,onChange:function(e){o(i.set("percentile",e))}})),r.a.createElement(vt,{measure:n,format:i.format,formatChange:function(e){o(i.set("format",e))}}))},Tt=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{series:e.props.initialSeries,isValid:!0}),Object(f.a)(Object(m.a)(e),"globalKeyDownListener",(function(t){return Object(b.c)(t)&&e.onOkClick()})),Object(f.a)(Object(m.a)(e),"saveSeries",(function(t,a){return e.setState({series:t,isValid:a})})),Object(f.a)(Object(m.a)(e),"onCancelClick",(function(){return e.props.onClose()})),Object(f.a)(Object(m.a)(e),"onOkClick",(function(){if(e.validate()){var t=e.props,a=t.saveSeries,n=t.onClose;a(e.state.series),n()}})),e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.globalKeyDownListener)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.globalKeyDownListener)}},{key:"validate",value:function(){var e=this.state,t=e.isValid,a=e.series,n=this.props,r=n.initialSeries,i=n.seriesList,s=!r.equals(a),c=i.series.filter((function(e){return!e.equals(r)})),l=!Object(Q.o)(c.find((function(e){return e.key()===a.key()})));return t&&s&&l}},{key:"render",value:function(){var e=this.props,t=e.measure,a=e.measures,n=e.initialSeries,i=e.seriesList,s=e.containerStage,c=e.onClose,l=e.openOn,o=this.state.series;return r.a.createElement(R.a,{className:"series-menu",direction:"down",containerStage:s,stage:T.a.fromSize(250,240),openOn:l,onClose:c},o instanceof at.a&&r.a.createElement(St,{series:o,measure:t,onChange:this.saveSeries}),o instanceof ot.a&&o.expression instanceof lt.a&&r.a.createElement(kt,{seriesList:i,series:o,measure:t,onChange:this.saveSeries}),o instanceof ot.a&&o.expression instanceof ct.a&&r.a.createElement(jt,{seriesList:i,series:o,initialSeries:n,measure:t,measures:a,onChange:this.saveSeries}),o instanceof nt.a&&r.a.createElement(Ft,{seriesList:i,measure:t,onChange:this.saveSeries,initialSeries:n,series:o}),r.a.createElement("div",{className:"button-bar"},r.a.createElement(L.a,{className:"ok",type:"primary",disabled:!this.validate(),onClick:this.onOkClick,title:h.m.ok}),r.a.createElement(L.a,{type:"secondary",onClick:this.onCancelClick,title:h.m.cancel})))}}]),a}(r.a.Component),xt=function(e){var t=e.series,a=e.measures,n=e.seriesList,i=e.containerStage,s=e.saveSeries,c=e.closeItem,l=e.style,o=e.measure;return r.a.createElement(Ke.a,null,(function(e){var u=e.ref,m=e.setRef;return r.a.createElement("div",{className:"tile measure",ref:m,style:l},r.a.createElement("div",{className:"reading"},o.title),u&&r.a.createElement(Tt,{key:"placeholder-series",measures:a,seriesList:n,openOn:u,containerStage:i,onClose:c,initialSeries:t,measure:o,saveSeries:s}))}))},Rt=function(e){var t=e.seriesList,n=e.measures,i=e.open,s=e.item,c=e.style,l=e.updateSeries,u=e.removeSeries,m=e.openSeriesMenu,f=e.closeSeriesMenu,d=e.dragStart,p=e.containerStage,v=s.definition,h=s.measure,b=s.title(),O=function(e){return l(v,e)},g=function(e){e.stopPropagation(),u(v)};return r.a.createElement(Ke.a,null,(function(e){var s=e.ref,l=e.setRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tile measure",draggable:!0,ref:l,onClick:function(){return m(v)},onDragStart:function(e){return d(h.title,v,e)},style:c,title:b},r.a.createElement("div",{className:"reading"},b),r.a.createElement("div",{className:"remove",onClick:g},r.a.createElement(o.a,{svg:a(194)}))),i&&s&&r.a.createElement(Tt,{key:v.key(),openOn:s,seriesList:t,measures:n,containerStage:p,onClose:f,initialSeries:v,measure:h,saveSeries:O}))}))},Lt=function(e){var t=e.openedSeriesMenu,a=e.menuStage,n=e.removeSeries,i=e.dragStart,s=e.closeSeriesMenu,c=e.updateSeries,l=e.removePlaceholderSeries,o=e.savePlaceholderSeries,u=e.openOverflowMenu,m=e.closeOverflowMenu,f=e.essence,d=e.openSeriesMenu,p=e.overflowOpen,v=e.partialSeries,h=e.maxItems,O=f.getConcreteSeries().toArray();var j=function(e){if(!v)return e;var t=v.series,n=v.position,i=Object(it.e)(f.dataCube.measures,t.reference),s=r.a.createElement(xt,{key:"placeholder-series-tile",measure:i,seriesList:f.series,measures:f.dataCube.measures,series:t,containerStage:a,saveSeries:o,closeItem:l});return C(e,n.getIndex(),s)}(O.map((function(e){return r.a.createElement(Rt,{seriesList:f.series,measures:f.dataCube.measures,key:e.definition.key(),item:e,open:e.definition.equals(t),closeSeriesMenu:s,removeSeries:n,dragStart:i,containerStage:a,openSeriesMenu:d,updateSeries:c})}))),S=j.slice(0,h).map((function(e,t){return r.a.cloneElement(e,{style:Object(b.o)(t*g.a,0)})})),E=j.slice(h);if(E.length<=0)return r.a.createElement(r.a.Fragment,null,S);var y=O.slice(h).some((function(e){return e.definition.equals(t)})),N=E.some((function(e){return e.type===xt})),M=p||y||N,D=r.a.createElement(w.a,{key:"overflow-menu",items:E,open:M,openOverflowMenu:u,x:S.length*g.a,closeOverflowMenu:m,className:"measure"});return r.a.createElement(r.a.Fragment,null,[].concat(Object(k.a)(S),[D]))},Pt=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"state",{}),Object(f.a)(Object(m.a)(e),"items",r.a.createRef()),Object(f.a)(Object(m.a)(e),"openSeriesMenu",(function(t){return e.setState({openedSeries:t})})),Object(f.a)(Object(m.a)(e),"closeSeriesMenu",(function(){return e.setState({openedSeries:null})})),Object(f.a)(Object(m.a)(e),"openOverflowMenu",(function(){return e.setState({overflowOpen:!0})})),Object(f.a)(Object(m.a)(e),"closeOverflowMenu",(function(){return e.setState({overflowOpen:!1})})),Object(f.a)(Object(m.a)(e),"updateSeries",(function(t,a){var n=e.context,r=n.essence;n.clicker.changeSeriesList(r.series.replaceSeries(t,a))})),Object(f.a)(Object(m.a)(e),"savePlaceholderSeries",(function(t){var a=e.props.removePartialSeries;e.context.clicker.addSeries(t),a()})),Object(f.a)(Object(m.a)(e),"removeSeries",(function(t){e.context.clicker.removeSeries(t),e.closeOverflowMenu()})),Object(f.a)(Object(m.a)(e),"dragStart",(function(t,a,n){var r=n.dataTransfer;r.effectAllowed="all",Object(b.m)(r,"text/plain",t),O.a.setDragSeries(a),Object(b.n)(r,t),e.closeOverflowMenu()})),Object(f.a)(Object(m.a)(e),"dragEnter",(function(t){e.canDrop()&&(t.preventDefault(),e.setState({dragPosition:e.calculateDragPosition(t)}))})),Object(f.a)(Object(m.a)(e),"dragOver",(function(t){if(e.canDrop()){t.preventDefault();var a=e.calculateDragPosition(t);a.equals(e.state.dragPosition)||e.setState({dragPosition:a})}})),Object(f.a)(Object(m.a)(e),"dragLeave",(function(){e.canDrop()&&e.setState({dragPosition:null})})),Object(f.a)(Object(m.a)(e),"drop",(function(t){e.canDrop()&&(t.preventDefault(),e.setState({dragPosition:null}),O.a.isDraggingSeries()?e.rearrangeSeries(O.a.draggingSeries(),e.calculateDragPosition(t)):e.dropNewSeries(Object(rt.b)(O.a.draggingMeasure()),e.calculateDragPosition(t)))})),Object(f.a)(Object(m.a)(e),"appendMeasureSeries",(function(t){var a=e.props.addPartialSeries,n=e.context,r=n.clicker,i=n.essence,s=Object(rt.b)(t),c=s instanceof at.a,l=s instanceof nt.a&&!e.context.essence.series.hasSeries(s);c||l?r.addSeries(s):a(s,v.a.insertAt(i.series.count()))})),e}return Object(s.a)(a,[{key:"maxItems",value:function(){var e=this.context.essence.series,t=this.props.menuStage;return t&&Object(g.b)(t.width,e.count())}},{key:"canDrop",value:function(){var e=this.context.essence.series,t=O.a.draggingMeasure();return t?!e.hasMeasure(t):O.a.isDraggingSeries()}},{key:"calculateDragPosition",value:function(e){var t=this.context.essence.series.count(),a=this.items.current.getBoundingClientRect(),n=Object(b.f)(e)-a.left,r=v.a.calculateFromOffset(n,t,h.d,h.c);return r.replace===this.maxItems()?v.a.insertAt(r.replace):r}},{key:"dropNewSeries",value:function(e,t){var a=this.props.addPartialSeries,n=this.context,r=n.clicker,i=n.essence.series;e instanceof nt.a&&i.hasSeries(e)?t.isReplace()?(r.removeSeries(i.series.get(t.replace)),a(e,t)):a(e,t):this.rearrangeSeries(e,t)}},{key:"rearrangeSeries",value:function(e,t){var a=this.context,n=a.clicker,r=a.essence;t.isReplace()?n.changeSeriesList(r.series.replaceByIndex(t.replace,e)):n.changeSeriesList(r.series.insertByIndex(t.insert,e))}},{key:"render",value:function(){var e=this.state,t=e.dragPosition,a=e.openedSeries,n=e.overflowOpen,i=this.context.essence,s=this.props,c=s.menuStage,l=s.removePartialSeries,o=s.partialSeries;return r.a.createElement("div",{className:"tile-row series-tile-row",onDragEnter:this.dragEnter},r.a.createElement("div",{className:"title"},h.m.series),r.a.createElement("div",{className:"items",ref:this.items},r.a.createElement(Lt,{menuStage:c,partialSeries:o,maxItems:this.maxItems(),essence:i,removeSeries:this.removeSeries,updateSeries:this.updateSeries,openSeriesMenu:this.openSeriesMenu,closeSeriesMenu:this.closeSeriesMenu,dragStart:this.dragStart,removePlaceholderSeries:l,savePlaceholderSeries:this.savePlaceholderSeries,overflowOpen:n,closeOverflowMenu:this.closeOverflowMenu,openOverflowMenu:this.openOverflowMenu,openedSeriesMenu:a})),r.a.createElement(st,{menuStage:c,essence:i,appendMeasureSeries:this.appendMeasureSeries}),r.a.createElement(S.a,{dragOver:this.dragOver,dragLeave:this.dragLeave,drop:this.drop,dragPosition:t}))}}]),a}(r.a.Component);Object(f.a)(Pt,"contextType",j.a);var It=a(696),Vt=a(245),At=a(100),zt={"bar-chart":null,"line-chart":function(e){var t=e.settings,a=e.onChange;return r.a.createElement("div",{className:"settings-row"},r.a.createElement(P.a,{selected:t.groupSeries,label:"Group series",onClick:function(){return a(t.update("groupSeries",(function(e){return!e})))}}))},heatmap:null,grid:null,totals:null,table:function(e){var t=e.settings,a=e.onChange;return r.a.createElement("div",{className:"settings-row"},r.a.createElement(P.a,{selected:t.collapseRows,label:"Collapse rows",onClick:function(){return a(t.update("collapseRows",(function(e){return!e})))}}))},scatterplot:function(e){var t=e.settings,a=e.onChange;return r.a.createElement("div",{className:"settings-row"},r.a.createElement(P.a,{selected:t.showSummary,label:"Show heatmap summary",onClick:function(){return a(t.update("showSummary",(function(e){return!e})))}}))}};function qt(e){return zt[e]}var Ut=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"state",{visualization:e.props.initialVisualization,visualizationSettings:e.props.initialSettings}),Object(f.a)(Object(m.a)(e),"save",(function(){var t=e.props,a=t.onSelect,n=t.onClose,r=e.state;a(r.visualization,r.visualizationSettings),n()})),Object(f.a)(Object(m.a)(e),"close",(function(){return e.props.onClose()})),Object(f.a)(Object(m.a)(e),"changeVisualization",(function(t){return e.setState({visualization:t,visualizationSettings:t.visualizationSettings.defaults})})),Object(f.a)(Object(m.a)(e),"changeSettings",(function(t){return e.setState({visualizationSettings:t})})),e}return Object(s.a)(a,[{key:"renderSettings",value:function(){var e=this.settingsComponent();return e?r.a.createElement("div",{className:"vis-settings"},r.a.createElement("div",{className:"vis-settings-title"},"Settings"),e):null}},{key:"settingsComponent",value:function(){var e=this.state,t=e.visualization,a=e.visualizationSettings;switch(t.name){case"table":var n=qt(t.name);return r.a.createElement(n,{onChange:this.changeSettings,settings:a});case"grid":case"heatmap":case"totals":case"bar-chart":return null;case"line-chart":var i=qt(t.name);return r.a.createElement(i,{onChange:this.changeSettings,settings:a});case"scatterplot":var s=qt(t.name);return r.a.createElement(s,{onChange:this.changeSettings,settings:a})}}},{key:"render",value:function(){var e=this,t=this.state.visualization;return r.a.createElement("div",{className:"vis-selector-menu"},r.a.createElement("div",{className:"vis-items"},At.a.map((function(a){return r.a.createElement(Vt.a,{key:a.name,visualization:a,selected:a.name===t.name,onClick:e.changeVisualization})}))),this.renderSettings(),r.a.createElement("div",{className:"ok-cancel-bar"},r.a.createElement(L.a,{type:"primary",title:h.m.ok,onClick:this.save}),r.a.createElement(L.a,{type:"secondary",title:h.m.cancel,onClick:this.close})))}}]),a}(r.a.Component),Bt=T.a.fromSize(268,176),Qt=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(f.a)(Object(m.a)(e),"selector",r.a.createRef()),Object(f.a)(Object(m.a)(e),"state",{openMenu:!1}),Object(f.a)(Object(m.a)(e),"openMenu",(function(t){var a=e.state.openMenu,n=t.currentTarget;a&&e.selector.current===n?e.closeMenu():e.setState({openMenu:!0})})),Object(f.a)(Object(m.a)(e),"closeMenu",(function(){return e.setState({openMenu:!1})})),Object(f.a)(Object(m.a)(e),"changeVisualization",(function(t,a){return e.props.clicker.changeVisualization(t,a)})),e}return Object(s.a)(a,[{key:"renderMenu",value:function(){if(!this.state.openMenu)return null;var e=this.props.essence;return r.a.createElement(R.a,{className:"vis-selector-menu-container",direction:"down",stage:Bt,openOn:this.selector.current,onClose:this.closeMenu},r.a.createElement(Ut,{initialVisualization:e.visualization,initialSettings:e.visualizationSettings,onClose:this.closeMenu,onSelect:this.changeVisualization}))}},{key:"render",value:function(){var e=this.props.essence.visualization,t=this.state.openMenu;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:this.selector,className:Object(b.b)("vis-selector",{active:t}),onClick:this.openMenu},r.a.createElement(Vt.a,{visualization:e,selected:!0})),this.renderMenu())}}]),a}(r.a.Component),Gt=a(369),Kt=a(183),Xt=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(f.a)(Object(m.a)(e),"context",void 0),Object(f.a)(Object(m.a)(e),"state",{dataset:ee.g}),Object(f.a)(Object(m.a)(e),"lastQueryEssence",null),Object(f.a)(Object(m.a)(e),"callExecutor",(function(t){return e.props.query(t).then((function(a){return e.wasUsedForLastQuery(t)?Object(ee.f)(a):null}),(function(a){return e.wasUsedForLastQuery(t)?(Object(ae.b)(a),Object(ee.b)(a)):null}))})),Object(f.a)(Object(m.a)(e),"debouncedCallExecutor",Object(te.h)(e.callExecutor,500)),e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.essence;this.loadData(e)}},{key:"componentWillUnmount",value:function(){this.lastQueryEssence=null,this.debouncedCallExecutor.cancel()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.shouldFetchData(e)&&this.visualisationNotResized(e)){var t=e.essence,a=Object(ee.d)(this.state.dataset),n=!t.equals(this.props.essence);this.loadData(t,a&&n)}}},{key:"loadData",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&this.handleDatasetLoad(ee.g),this.fetchData(e).then((function(e){e&&(Object(ee.c)(e)&&t.handleDatasetLoad(e),Object(ee.d)(e)&&t.handleDatasetLoad(e))}))}},{key:"fetchData",value:function(e){return this.lastQueryEssence=e,this.debouncedCallExecutor(e)}},{key:"wasUsedForLastQuery",value:function(e){return e.equals(this.lastQueryEssence)}},{key:"handleDatasetLoad",value:function(e){this.setState({dataset:e}),(0,this.context.setDataset)(Object(ee.d)(e)?e.dataset:null)}},{key:"shouldFetchData",value:function(e){return this.differentVisualizationDefinition(e)}},{key:"differentVisualizationDefinition",value:function(e){var t=this.props,a=t.essence,n=t.timekeeper,r=e.essence,i=e.timekeeper;return r.differentDataCube(a)||r.differentEffectiveFilter(a,n,i)||r.differentTimeShift(a)||r.differentSplits(a)||r.differentSeries(a)||r.differentSettings(a)||this.differentBucketingTimezone(r)||this.differentLastRefreshRequestTimestamp(e)}},{key:"differentBucketingTimezone",value:function(e){var t=this.props.essence;return!t.timezone.equals(e.timezone)&&e.splits.hasSplitOn(t.getTimeDimension())}},{key:"differentLastRefreshRequestTimestamp",value:function(e){return e.refreshRequestTimestamp!==this.props.refreshRequestTimestamp}},{key:"visualisationNotResized",value:function(e){return this.props.stage.equals(e.stage)}},{key:"render",value:function(){var e=this.props.children,t=this.state.dataset;switch(t.status){case ee.a.LOADING:return r.a.createElement(I.a,null);case ee.a.ERROR:return r.a.createElement(V.a,{error:t.error});case ee.a.LOADED:return e(t.dataset)}}}]),a}(r.a.Component);Object(f.a)(Xt,"contextType",Kt.a);var Wt=a(727),_t=function(e){return r.a.createElement(Ht,Object.assign({},e,{splitTilesRow:It.a}))},Ht=function(e){var t=e.splitTilesRow,a=e.addSeries,n=e.addFilter,i=e.clicker,s=e.essence,c=e.customization,l=e.timekeeper,o=e.stage,u=e.partialSeries,m=e.partialFilter,f=e.removeTile;return r.a.createElement(Gt.a,{tiles:r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze,{locale:c.locale,timekeeper:l,menuStage:o,partialFilter:m,removePartialFilter:f,addPartialFilter:n}),r.a.createElement(t,{clicker:i,essence:s,menuStage:o}),r.a.createElement(Pt,{removePartialSeries:f,partialSeries:u,menuStage:o,addPartialSeries:a})),selector:r.a.createElement(Qt,{clicker:i,essence:s})})},Jt=function(e){var t=e.chartComponent,a=e.essence,n=e.clicker,i=e.timekeeper,s=e.lastRefreshRequestTimestamp,c=e.stage,l=e.isDraggedOver,o=e.dragOver,m=e.dragEnter,f=e.dragLeave,d=e.drop;return r.a.createElement("div",{className:"center-main",onDragEnter:m},r.a.createElement("div",{className:"visualization"},r.a.createElement(Yt,{chartComponent:t,essence:a,clicker:n,timekeeper:i,lastRefreshRequestTimestamp:s,stage:c})),l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(u,null),r.a.createElement("div",{className:"drag-mask",onDragOver:o,onDragLeave:f,onDragExit:f,onDrop:d})))};function Yt(e){var t=e.chartComponent,a=e.essence,n=e.clicker,i=e.timekeeper,s=e.stage,c=e.lastRefreshRequestTimestamp;return a.visResolve.isManual()?r.a.createElement(tt,{clicker:n,essence:a}):r.a.createElement(Wt.a,{essence:a,clicker:n},(function(e){return r.a.createElement(x.a.Consumer,null,(function(l){var o=l.visualizationQuery;return r.a.createElement(Xt,{refreshRequestTimestamp:c,query:o,essence:a,timekeeper:i,stage:s},(function(c){return r.a.createElement("div",{className:Object(b.b)("visualization-root",a.visualization.name)},r.a.createElement(t,Object.assign({data:c,clicker:n,essence:a,timekeeper:i,stage:s},e)))}))}))}))}},683:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(3),r=a(4),i=a(2),s=a(6),c=a(7),l=a(1),o=a(0),u=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(l.a)(Object(i.a)(e),"state",{}),Object(l.a)(Object(i.a)(e),"setRef",(function(t){return e.setState({ref:t})})),e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.setRef,t=this.state.ref;return this.props.children({ref:t,setRef:e})}}]),a}(a.n(o).a.Component)},689:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(0),r=a.n(n),i=a(24),s=a(728),c=function(e){return r.a.createElement(s.a,Object.assign({},e,{parseCustomValue:i.j,formatCustomValue:i.j}))}},690:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(0),r=a.n(n),i=a(48),s=a(141),c=a(11),l=a(689),o=function(e){var t=e.dimension,a=e.granularity,n=e.granularityChange;if(!Object(i.e)(t))return null;var o=(t.granularities||Object(s.e)(t.kind,t.bucketedBy)).map((function(e){return{name:Object(s.b)(e),identity:Object(s.f)(e)}})),u="time"===t.kind?c.m.floorableDurationsExamples:"Bucket size";return r.a.createElement(l.a,{title:c.m.granularity,selected:a,errorMessage:Object(s.h)(t.kind,a),onChange:n,placeholder:u,presets:o})}},691:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(34),r=a(0),i=a.n(r),s=a(11),c=a(124);function l(e){return null===e?"None":String(e)}function o(e,t){return t?[].concat(Object(n.a)(e),[null]):e}var u=function(e){var t=e.onLimitSelect,a=e.limits,n=e.selectedLimit,r=e.includeNone;return i.a.createElement(c.a,{label:s.m.limit,items:o(a,r),selectedItem:n,renderItem:l,onSelect:t})}},692:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(0),r=a.n(n),i=a(52),s=a(19),c=a(11),l=a(124),o=a(18),u=function(e){var t=e.direction,n=e.options,u=e.selected,m=e.onChange;return r.a.createElement("div",{className:"sort-direction"},r.a.createElement(l.a,{label:c.m.sortBy,items:n,selectedItem:u,equal:i.c.equals,renderItem:i.c.getTitle,keyItem:i.c.getKey,onSelect:function(e){m(e.toSort(t))}}),r.a.createElement("div",{className:"direction "+t,onClick:function(){var e=t===s.c.descending?s.c.ascending:s.c.descending;m(u.toSort(e))}},r.a.createElement(o.a,{svg:a(381)})))}},693:function(e,t,a){"use strict";a.d(t,"c",(function(){return O})),a.d(t,"b",(function(){return g})),a.d(t,"a",(function(){return j}));var n=a(3),r=a(4),i=a(2),s=a(6),c=a(7),l=a(1),o=a(0),u=a.n(o),m=a(141),f=a(20),d=a(32),p=a(11),v=a(8),h=a(46),b=a(67);function O(e){var t=e.granularity,a=e.split,n=e.dimension.kind;if(!Object(m.g)(n,t))return!1;var r=g(e);return!a.equals(r)}function g(e){var t=e.split,a=t.type,n=t.reference,r=e.limit,i=e.granularity,s=e.sort,c=e.dimension.kind,l=Object(m.a)(i,c);return new f.a({type:a,reference:n,limit:r,sort:s,bucket:l})}var j=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(l.a)(Object(i.a)(e),"globalKeyDownListener",(function(t){return Object(v.c)(t)&&e.onOkClick()})),Object(l.a)(Object(i.a)(e),"onCancelClick",(function(){return e.props.onClose()})),Object(l.a)(Object(i.a)(e),"onOkClick",(function(){var t=e.props,a=t.isValid,n=t.onSave,r=t.onClose;a&&(n(),r())})),e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.globalKeyDownListener)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.globalKeyDownListener)}},{key:"render",value:function(){var e=this.props,t=e.containerStage,a=e.openOn,n=e.dimension,r=e.onClose,i=e.children,s=e.isValid;return n?u.a.createElement(h.a,{className:"split-menu",direction:"down",containerStage:t,stage:d.a.fromSize(250,240),openOn:a,onClose:r},i,u.a.createElement("div",{className:"button-bar"},u.a.createElement(b.a,{className:"ok",type:"primary",disabled:!s,onClick:this.onOkClick,title:p.m.ok}),u.a.createElement(b.a,{type:"secondary",onClick:this.onCancelClick,title:p.m.cancel}))):null}}]),a}(u.a.Component)},696:function(e,t,a){"use strict";a.d(t,"a",(function(){return w})),a.d(t,"b",(function(){return N}));var n=a(3),r=a(4),i=a(2),s=a(6),c=a(7),l=a(1),o=a(0),u=a.n(o),m=a(13),f=a(197),d=a(71),p=a(20),v=a(11),h=a(8),b=a(64),O=a(97),g=a(713),j=a(720),S=function(e){var t=e.appendSplit,a=e.menuStage,n=e.essence,r=n.dataCube,i=n.splits,s=Object(m.a)(r.dimensions).filter((function(e){return void 0===i.findSplitForDimension(e)})).map((function(e){return{key:e.name,label:e.title,value:e}}));return u.a.createElement(j.a,{containerStage:a,onSelect:t,tiles:s})},E=a(710),y=a(34),k=a(703),C=function(e){var t=e.splitTileComponent,a=e.overflowOpen,n=e.closeOverflowMenu,r=e.openOverflowMenu,i=e.essence,s=e.maxItems,c=e.removeSplit,l=e.updateSplit,o=e.openedSplit,f=e.openMenu,d=e.closeMenu,p=e.dragStart,v=e.menuStage,b=i.splits.splits.toArray(),g=b.map((function(e){var a=Object(m.d)(i.dataCube.dimensions,e.reference);return u.a.createElement(t,{key:e.toKey(),split:e,dimension:a,removeSplit:c,updateSplit:l,open:e.equals(o),openMenu:f,closeMenu:d,dragStart:p,containerStage:v,essence:i})})),j=g.slice(0,s).map((function(e,t){return u.a.cloneElement(e,{style:Object(h.o)(t*O.a,0)})})),S=g.slice(s);if(S.length<=0)return u.a.createElement(u.a.Fragment,null,j);var E=b.slice(s).some((function(e){return e.equals(o)})),C=a||E,w=u.a.createElement(k.a,{className:"dimension",key:"overflow-menu",items:S,open:C,openOverflowMenu:r,closeOverflowMenu:n,x:j.length*O.a});return u.a.createElement(u.a.Fragment,null,[].concat(Object(y.a)(j),[w]))},w=function(e){return u.a.createElement(N,Object.assign({},e,{splitTileComponent:E.a}))},N=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(l.a)(Object(i.a)(e),"items",u.a.createRef()),Object(l.a)(Object(i.a)(e),"state",{}),Object(l.a)(Object(i.a)(e),"openMenu",(function(t){return e.setState({openedSplit:t})})),Object(l.a)(Object(i.a)(e),"closeMenu",(function(){return e.setState({openedSplit:null})})),Object(l.a)(Object(i.a)(e),"openOverflowMenu",(function(){return e.setState({overflowOpen:!0})})),Object(l.a)(Object(i.a)(e),"closeOverflowMenu",(function(){return e.setState({overflowOpen:!1})})),Object(l.a)(Object(i.a)(e),"updateSplit",(function(t,a){var n=e.props,r=n.essence;n.clicker.changeSplits(r.splits.replace(t,a),d.b.UnfairGame)})),Object(l.a)(Object(i.a)(e),"removeSplit",(function(t){e.props.clicker.removeSplit(t,d.b.FairGame),e.closeOverflowMenu()})),Object(l.a)(Object(i.a)(e),"dragStart",(function(t,a,n){var r=n.dataTransfer;r.effectAllowed="all",Object(h.m)(r,"text/plain",t),b.a.setDragSplit(a),Object(h.n)(r,t),e.closeOverflowMenu()})),Object(l.a)(Object(i.a)(e),"dragEnter",(function(t){e.canDrop()&&(t.preventDefault(),e.setState({dragPosition:e.calculateDragPosition(t)}))})),Object(l.a)(Object(i.a)(e),"dragOver",(function(t){if(e.canDrop()){t.preventDefault();var a=e.calculateDragPosition(t);a.equals(e.state.dragPosition)||e.setState({dragPosition:a})}})),Object(l.a)(Object(i.a)(e),"dragLeave",(function(){e.canDrop()&&e.setState({dragPosition:null})})),Object(l.a)(Object(i.a)(e),"drop",(function(t){if(e.canDrop()){t.preventDefault(),e.setState({dragPosition:null});var a=e.draggingSplit();if(a){var n=e.calculateDragPosition(t);n.isReplace()?n.replace===e.maxItems()?e.insertSplit(a,n.replace):e.replaceSplit(a,n.replace):e.insertSplit(a,n.insert)}}})),Object(l.a)(Object(i.a)(e),"appendSplit",(function(t){e.props.clicker.addSplit(p.a.fromDimension(t),d.b.FairGame)})),Object(l.a)(Object(i.a)(e),"insertSplit",(function(t,a){var n=e.props,r=n.clicker,i=n.essence.splits;r.changeSplits(i.insertByIndex(a,t),d.b.FairGame)})),Object(l.a)(Object(i.a)(e),"replaceSplit",(function(t,a){var n=e.props,r=n.clicker,i=n.essence.splits;r.changeSplits(i.replaceByIndex(a,t),d.b.FairGame)})),e}return Object(r.a)(a,[{key:"maxItems",value:function(){var e=this.props,t=e.menuStage,a=e.essence.splits.splits;return t&&Object(O.b)(t.width,a.count())}},{key:"canDrop",value:function(){var e=this.props.essence,t=e.splits,a=e.dataCube;switch(b.a.dragging.type){case b.b.DIMENSION:return!t.hasSplitOn(b.a.draggingDimension());case b.b.FILTER:var n=Object(m.d)(a.dimensions,b.a.draggingFilter().reference);return!t.hasSplitOn(n);case b.b.SPLIT:return!0;case b.b.MEASURE:case b.b.SERIES:case b.b.NONE:return!1}}},{key:"calculateDragPosition",value:function(e){var t=this.props.essence.splits.length(),a=this.items.current.getBoundingClientRect(),n=Object(h.f)(e)-a.left,r=f.a.calculateFromOffset(n,t,v.d,v.c);return r.replace===this.maxItems()?new f.a({insert:r.replace}):r}},{key:"draggingSplit",value:function(){var e=this.props.essence.dataCube;switch(b.a.dragging.type){case b.b.DIMENSION:return p.a.fromDimension(b.a.draggingDimension());case b.b.FILTER:var t=Object(m.d)(e.dimensions,b.a.draggingFilter().reference);return p.a.fromDimension(t);case b.b.SPLIT:return b.a.draggingSplit()}throw new Error("Expected Dimension, Filter or Split, got ".concat(b.a.dragging.type))}},{key:"render",value:function(){var e=this.props,t=e.essence,a=e.menuStage,n=e.splitTileComponent,r=this.state,i=r.dragPosition,s=r.overflowOpen,c=r.openedSplit;return u.a.createElement("div",{className:"tile-row split-tile-row",onDragEnter:this.dragEnter},u.a.createElement("div",{className:"title"},v.m.split),u.a.createElement("div",{className:"items",ref:this.items},u.a.createElement(C,{essence:t,splitTileComponent:n,openedSplit:c,removeSplit:this.removeSplit,updateSplit:this.updateSplit,openMenu:this.openMenu,closeMenu:this.closeMenu,dragStart:this.dragStart,menuStage:a,maxItems:this.maxItems(),overflowOpen:s,closeOverflowMenu:this.closeOverflowMenu,openOverflowMenu:this.openOverflowMenu})),u.a.createElement(g.a,{dragOver:this.dragOver,dragLeave:this.dragLeave,drop:this.drop,dragPosition:i}),u.a.createElement(S,{appendSplit:this.appendSplit,menuStage:a,essence:t}))}}]),a}(u.a.Component)},703:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(0),r=a.n(n),i=a(32),s=a(11),c=a(8),l=a(46),o=a(683),u=29+s.c,m=function(e){var t=e.items,a=e.openOn,n=e.closeOverflowMenu,o=t.map((function(e,t){return r.a.cloneElement(e,{style:Object(c.o)(0,s.c+t*u)})}));return r.a.createElement(l.a,{className:"overflow-menu",direction:"down",stage:i.a.fromSize(208,s.c+t.length*u),fixedSize:!0,openOn:a,onClose:n},o)},f=function(e){var t=e.x,a=e.items,n=e.open,i=e.openOverflowMenu,s=e.className,l=e.closeOverflowMenu,u=Object(c.o)(t,0);return r.a.createElement(o.a,null,(function(e){var t=e.ref,o=e.setRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Object(c.b)("overflow",s),style:u,ref:o,onClick:i},r.a.createElement("div",{className:"count"},"+"+a.length)),n&&t&&r.a.createElement(m,{openOn:t,items:a,closeOverflowMenu:l}))}))}},710:function(e,t,a){"use strict";a.d(t,"a",(function(){return E})),a.d(t,"b",(function(){return y}));var n=a(0),r=a.n(n),i=a(34),s=a(3),c=a(4),l=a(2),o=a(6),u=a(7),m=a(1),f=a(48),d=a(141),p=a(52),v=a(690),h=a(691),b=a(692),O=a(693),g=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(m.a)(Object(l.a)(e),"state",{}),Object(m.a)(Object(l.a)(e),"saveGranularity",(function(t){return e.setState({granularity:t})})),Object(m.a)(Object(l.a)(e),"saveSort",(function(t){return e.setState({sort:t})})),Object(m.a)(Object(l.a)(e),"saveLimit",(function(t){return e.setState({limit:t})})),Object(m.a)(Object(l.a)(e),"saveSplit",(function(){var t=e.props,a=t.split;(0,t.saveSplit)(a,e.createSplit())})),e}return Object(c.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.split,t=e.bucket,a=e.sort,n=e.limit;this.setState({sort:a,limit:n,granularity:t&&Object(d.f)(t)})}},{key:"createSplit",value:function(){var e=this.props,t=e.split,a=e.dimension,n=this.state,r=n.limit,i=n.sort,s=n.granularity;return Object(O.b)({split:t,dimension:a,limit:r,sort:i,granularity:s})}},{key:"validate",value:function(){var e=this.props,t=e.dimension,a=e.split,n=this.state,r=n.limit,i=n.sort,s=n.granularity;return Object(O.c)({split:a,dimension:t,limit:r,sort:i,granularity:s})}},{key:"render",value:function(){var e=this.props,t=e.essence,a=e.containerStage,n=e.openOn,s=e.dimension,c=e.onClose,l=this.state,o=l.granularity,u=l.sort,m=l.limit,d=t.seriesSortOns(!0).toArray(),g=[new p.a(s)].concat(Object(i.a)(d)),j=p.c.fromSort(u,t);return r.a.createElement(O.a,{openOn:n,containerStage:a,onClose:c,onSave:this.saveSplit,dimension:s,isValid:this.validate()},r.a.createElement(v.a,{dimension:s,granularityChange:this.saveGranularity,granularity:o}),r.a.createElement(b.a,{direction:u.direction,selected:j,options:g,onChange:this.saveSort}),r.a.createElement(h.a,{onLimitSelect:this.saveLimit,selectedLimit:m,includeNone:Object(f.e)(s),limits:s.limits}))}}]),a}(r.a.Component),j=a(18),S=a(683),E=function(e){return r.a.createElement(y,Object.assign({},e,{splitMenuComponent:g}))},y=function(e){var t=e.splitMenuComponent,n=e.essence,i=e.open,s=e.split,c=e.dimension,l=e.style,o=e.removeSplit,u=e.updateSplit,m=e.openMenu,f=e.closeMenu,d=e.dragStart,p=e.containerStage,v=s.getTitle(c),h=function(e){e.stopPropagation(),o(s)};return r.a.createElement(S.a,null,(function(e){var o=e.ref,b=e.setRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tile dimension",key:s.toKey(),ref:b,draggable:!0,onClick:function(){return m(s)},onDragStart:function(e){return d(c.title,s,e)},style:l,title:v},r.a.createElement("div",{className:"reading"},v),r.a.createElement("div",{className:"remove",onClick:h},r.a.createElement(j.a,{svg:a(194)}))),i&&o&&r.a.createElement(t,{saveSplit:u,essence:n,openOn:o,containerStage:p,onClose:f,dimension:c,split:s}))}))}},713:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(0),r=a.n(n),i=a(3),s=a(4),c=a(6),l=a(7),o=a(11),u=a(18),m=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.dragPosition;if(!e)return null;var t,n=o.d+o.c,i=null;if(e.isInsert())t=e.insert*n-o.c/2;else{t=e.replace*n+o.d/2;var s=e.replace*n;i=r.a.createElement("div",{className:"drag-ghost-element",style:{left:s}})}return r.a.createElement("div",{className:"fancy-drag-indicator"},i,r.a.createElement(u.a,{className:"drag-ghost-arrow",svg:a(382),style:{left:t}}))}}]),n}(r.a.Component),f=function(e){var t=e.dragPosition,a=e.dragOver,n=e.drop,i=e.dragLeave;return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{dragPosition:t}),r.a.createElement("div",{className:"drag-mask",onDragOver:a,onDragLeave:i,onDragExit:i,onDrop:n})):null}},714:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(0),r=a.n(n),i=function(e){var t=e.title,a=e.children;return r.a.createElement("div",{className:"message-card"},r.a.createElement("div",{className:"message-card-title"},t),a)}},720:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(3),r=a(4),i=a(2),s=a(6),c=a(7),l=a(1),o=a(0),u=a.n(o),m=a(32),f=a(46),d=a(133),p=a(98),v=a(18),h=function(e){Object(s.a)(o,e);var t=Object(c.a)(o);function o(){var e;Object(n.a)(this,o);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),Object(l.a)(Object(i.a)(e),"state",{openMenu:!1,query:""}),Object(l.a)(Object(i.a)(e),"menuOpenOn",null),Object(l.a)(Object(i.a)(e),"mountAdd",(function(t){e.menuOpenOn=t})),Object(l.a)(Object(i.a)(e),"closeMenu",(function(){return e.setState({openMenu:!1})})),Object(l.a)(Object(i.a)(e),"openMenu",(function(){return e.setState({openMenu:!0})})),Object(l.a)(Object(i.a)(e),"setQuery",(function(t){return e.setState({query:t})})),Object(l.a)(Object(i.a)(e),"resetQuery",(function(){return e.setQuery("")})),Object(l.a)(Object(i.a)(e),"selectTile",(function(t){e.props.onSelect(t),e.resetQuery(),e.closeMenu()})),e}return Object(r.a)(o,[{key:"renderRows",value:function(e){var t=this,a=this.state.query;return e.map((function(e){var n=e.value,r=e.key,i=e.label;return u.a.createElement("div",{className:"tile-row",key:r,onClick:function(){return t.selectTile(n)}},u.a.createElement(p.a,{className:"label",text:i,highlight:a}))}))}},{key:"renderTable",value:function(){var e=this.props.tiles,t=this.state.query;if(0===t.length)return this.renderRows(e);var a=e.filter((function(e){return e.label.toLowerCase().includes(t.toLowerCase())}));return a.length>0?this.renderRows(a):u.a.createElement("div",{className:"tile-row no-results"},"No results for ",t)}},{key:"renderMenu",value:function(){var e=this.props.containerStage,t=this.state,a=t.openMenu,n=t.query;return a?u.a.createElement(f.a,{className:"add-tile-menu",direction:"down",stage:m.a.fromSize(250,410),containerStage:e,openOn:this.menuOpenOn,onClose:this.closeMenu},u.a.createElement("div",{className:"search-box"},u.a.createElement(d.a,{placeholder:"Search",focusOnMount:!0,value:n,onChange:this.setQuery})),u.a.createElement("div",{className:"tile-rows"},this.renderTable())):null}},{key:"render",value:function(){return u.a.createElement("div",{className:"add-tile"},u.a.createElement("div",{className:"add-button",ref:this.mountAdd,onClick:this.openMenu},u.a.createElement(v.a,{svg:a(167)})),this.renderMenu())}}]),o}(u.a.Component)},721:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(3),r=a(4),i=a(6),s=a(7),c=a(0),l=a.n(c),o=a(8),u=function(e){Object(i.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"renderMembers",value:function(){return this.props.groupMembers.map((function(e){return l.a.createElement("li",{className:Object(o.b)("group-member",e.className,{selected:e.isSelected}),key:e.key,onClick:e.onClick},e.title)}))}},{key:"render",value:function(){var e=this.props,t=e.title,a=e.className;return l.a.createElement("div",{className:Object(o.b)("button-group",a)},t?l.a.createElement("div",{className:"button-group-title"},t):null,l.a.createElement("ul",{className:"group-container"},this.renderMembers()))}}]),a}(l.a.Component)},727:function(e,t,a){"use strict";a.d(t,"b",(function(){return f})),a.d(t,"a",(function(){return d}));var n=a(3),r=a(4),i=a(2),s=a(6),c=a(7),l=a(1),o=a(0),u=a.n(o),m=Object(r.a)((function e(t,a){Object(n.a)(this,e)}));function f(e,t){return!!e&&e.key===t}var d=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),Object(l.a)(Object(i.a)(e),"state",{highlight:null}),Object(l.a)(Object(i.a)(e),"dropHighlight",(function(){return e.setState({highlight:null})})),Object(l.a)(Object(i.a)(e),"acceptHighlight",(function(){var t=e.state.highlight;if(null!==t){var a=e.props,n=a.essence;a.clicker.changeFilter(n.filter.mergeClauses(t.clauses)),e.setState({highlight:null})}})),Object(l.a)(Object(i.a)(e),"saveHighlight",(function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new m(t,a);e.setState({highlight:n})})),e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.children,t=this.state.highlight;return e({dropHighlight:this.dropHighlight,acceptHighlight:this.acceptHighlight,saveHighlight:this.saveHighlight,highlight:t})}}]),a}(u.a.Component)},728:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(34),r=a(3),i=a(4),s=a(2),c=a(6),l=a(7),o=a(1),u=a(0),m=a.n(u),f=a(8),d=a(721),p=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,i=new Array(n),c=0;c<n;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i)),Object(o.a)(Object(s.a)(e),"state",e.initialState()),Object(o.a)(Object(s.a)(e),"customValueUpdate",(function(t){var a=e.props,n=a.onChange,r=a.parseCustomValue,i=t.currentTarget.value;n(r(i)),e.setState({customValue:i})})),Object(o.a)(Object(s.a)(e),"pickCustom",(function(){var t=e.props,a=t.onChange,n=t.parseCustomValue;e.setState({customPicked:!0}),a(n(e.state.customValue))})),Object(o.a)(Object(s.a)(e),"pickPreset",(function(t){var a=e.props.onChange;e.setState({customPicked:!1}),a(t)})),e}return Object(i.a)(a,[{key:"initialState",value:function(){var e=this.props,t=e.selected,a=e.presets,n=e.formatCustomValue,r=a.some((function(e){return e.identity===t})),i=void 0!==t&&!r;return{customPicked:i,customValue:i?n(t):""}}},{key:"render",value:function(){var e=this,t=this.props,a=t.errorMessage,r=t.selected,i=t.presets,s=t.placeholder,c=t.title,l=t.parseCustomValue,o=this.state,u=o.customPicked,p=o.customValue,v=i.map((function(t){var a=t.name,n=t.identity;return{key:String(n),title:a,isSelected:!u&&n===r,onClick:function(){return e.pickPreset(n)}}})),h=u&&r===l(p),b={key:"custom",title:"…",onClick:this.pickCustom,isSelected:h},O=[].concat(Object(n.a)(v),[b]),g=h&&a&&p.length>0;return m.a.createElement(m.a.Fragment,null,m.a.createElement(d.a,{title:c,groupMembers:O}),h&&m.a.createElement("input",{type:"text",className:Object(f.b)("custom-input",{invalid:a}),placeholder:s,value:p,onChange:this.customValueUpdate}),g&&m.a.createElement("span",{className:"error-message"},a))}}]),a}(m.a.Component)}}]);
//# sourceMappingURL=default~bar-chart~grid~heatmap~line-chart~scatterplot~table~totals.ed28c8879cf025c74f34.js.map