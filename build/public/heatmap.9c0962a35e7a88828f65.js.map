{"version":3,"sources":["webpack:///./src/client/components/bubble-title/bubble-title.tsx","webpack:///./src/client/components/series-bubble-content/series-bubble-content.tsx","webpack:///./src/client/components/modal-bubble/modal-bubble.tsx","webpack:///./src/client/components/highlight-modal/highlight-modal.tsx","webpack:///./src/client/components/segment-bubble/segment-bubble.tsx","webpack:///./src/client/components/measure-bubble-content/measure-bubble-content.tsx","webpack:///./src/client/components/color-legend/color-legend.tsx","webpack:///./src/client/utils/dataset/sparse-dataset/dataset.ts","webpack:///./src/client/visualizations/heat-map/heatmap-corner.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-highlight-indicator.tsx","webpack:///./src/client/visualizations/heat-map/utils/highlight-modal-position.ts","webpack:///./src/client/visualizations/heat-map/heatmap-highlight-modal.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-hover-indicator.tsx","webpack:///./src/client/visualizations/heat-map/utils/nested-dataset.ts","webpack:///./src/client/visualizations/heat-map/utils/datum-by-position.ts","webpack:///./src/client/visualizations/heat-map/utils/modal-title.ts","webpack:///./src/client/visualizations/heat-map/heatmap-hover-tooltip.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-labels.tsx","webpack:///./src/client/utils/equal-props/equal-props.ts","webpack:///./src/client/visualizations/heat-map/heatmap-rectangle-row.tsx","webpack:///./src/client/visualizations/heat-map/heatmap-rectangles.tsx","webpack:///./src/client/visualizations/heat-map/utils/create-highlight-clauses.ts","webpack:///./src/client/visualizations/heat-map/utils/get-highlight-position.ts","webpack:///./src/client/visualizations/heat-map/labeled-heatmap.tsx","webpack:///./src/client/visualizations/heat-map/utils/get-hover-position.ts","webpack:///./src/client/visualizations/heat-map/utils/scroller-layout.ts","webpack:///./src/client/visualizations/heat-map/utils/scales.ts","webpack:///./src/client/visualizations/heat-map/heat-map.tsx"],"names":["BubbleTitle","title","minWidth","clamp","length","className","style","SeriesBubbleContent","props","series","datum","showPrevious","Fragment","formatValue","currentValue","selectValue","previousValue","SeriesDerivation","PREVIOUS","formatter","lowerIsBetter","measure","current","previous","ModalBubble","React","Component","el","this","modalRef","e","target","isInside","onClose","render","children","left","top","mouseDown","onMouseDown","classNames","ref","setModalRef","direction","HighlightModal","acceptHighlight","dropHighlight","type","onClick","STRINGS","select","cancel","SegmentBubble","content","SegmentBubbleContent","MeasureBubbleContent","ColorLegend","width","height","colorScale","min","max","domain","isNaN","stripeLength","startColor","endColor","range","id","gradientTransform","offset","stopColor","transform","x","y","fill","x1","x2","y1","y2","tickLength","tickLabelLeftOffset","orderByValueDecreasing","_","countA","__","countB","orderByValueIncreasing","a","b","orderByTimeDimensionDecreasing","originalA","___","____","originalB","compare","orderByTimeDimensionIncreasing","orderByNumberRangeDimensionDecreasing","orderByNumberRangeDimensionIncreasing","datumKey","dataset","key","timezone","fillDatasetWithMissingValues","measureName","secondSplit","totals","identToOriginalKey","order","split","sort","SplitType","string","SortDirection","ascending","time","number","splitToFillOrder","secondSplitName","reference","data","nestedDataset","SPLIT","nestedDatum","value","ident","undefined","sortedIdents","Object","keys","map","newDataset","identToNestedDatum","reduce","datumsByIdent","filledNestedDataset","Number","changeData","HeatmapCorner","essence","dataCube","splits","row","get","column","rowTitle","getTitle","findDimensionByName","dimensions","columnTitle","RowHighlight","tileSize","ColumnHighlight","tileGap","HeatmapHighlightIndicator","position","calculateLeft","layout","stage","scroll","TILE_SIZE","TILE_GAP","Math","bodyWidth","calculateTop","bodyHeight","HeatmapHighlightModal","HeatmapHoverIndicator","hoverPosition","d","getDataColumn","dataColumn","datumByPosition","dataRow","modalTitle","datums","references","toArray","zip","filter","formatSegment","join","HeatmapHoverTooltip","getConcreteSeries","first","TooltipWithBounds","hasComparison","HeatmapLabels","createRef","componentDidMount","container","onMaxLabelSize","noop","Array","from","querySelectorAll","maxWidth","element","offsetWidth","labels","orientation","hoveredLabel","highlightedLabel","labelSize","label","index","highlight","hover","equalProps","oldProps","newProps","every","equals","isEqualable","HeatMapRectangleRow","PureComponent","bins","bin","color","fillOpacity","opacity","HeatMapRectangles","shouldComponentUpdate","nextProps","xScale","yScale","gap","HeatmapRect","count","binWidth","binHeight","heatmap","splitSelection","dimensionName","dimension","labelIndex","floor","firstSplitSelection","topOffset","secondSplitSelection","leftOffset","splitSelectionToClause","kind","name","StringFilterClause","action","StringFilterAction","IN","values","Set","of","String","BooleanFilterClause","FixedTimeFilterClause","List","NumberFilterClause","createHighlightClauses","selections","part","pickSplitSelections","isTruthy","findDatumIndexByClause","clause","findIndex","FilterTypes","BOOLEAN","NUMBER","STRING","FIXED_TIME","RELATIVE_TIME","Error","clausePredicate","MIN_LEFT_LABELS_WIDTH","MAX_LEFT_LABELS_WIDTH","MIN_TOP_LABELS_HEIGHT","MAX_TOP_LABELS_HEIGHT","formatSegments","fieldName","LabelledHeatmap","leftLabelsWidth","topLabelsHeight","scrollLeft","scrollTop","xOffset","yOffset","invert","getHoverPosition","setState","maxLabelWidth","maxLabelHeight","isClickablePart","saveHighlight","clauses","state","right","bottom","scrollerLayout","firstSplit","leftLabels","topLabels","highlightPosition","columnSplitReference","rowSplitReference","columnClause","find","rowClause","getHighlightPosition","handleHighlight","onMouseMove","saveHover","onMouseLeave","resetHover","onScroll","saveScroll","topLeftCorner","topGutter","saveTopLabelHeight","leftGutter","saveLeftLabelWidth","body","leftLabelName","topLabelName","scales","mainColor","bucketSizeMax","d3","dataLength","scaleLinear","seriesSelector","colorMin","colorMax","HeatMapVisualization","chartComponent","HeatMap","HEAT_MAP_MANIFEST","memoizeOne","plywoodKey","nextData","oldData","customization","visualizationColors","context","prepareDataset","getScales","main","SettingsContext"],"mappings":"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","file":"heatmap.9c0962a35e7a88828f65.js","sourcesContent":["/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { clamp } from \"../../utils/dom/dom\";\n\nconst PER_LETTER_PIXELS = 8;\nconst MIN_TITLE_WIDTH = 80;\nconst MAX_TITLE_WIDTH = 300;\n\ninterface BubbleTitleProps {\n  title: string;\n}\n\nexport const BubbleTitle: React.FunctionComponent<BubbleTitleProps> = ({ title }) => {\n  const minWidth = clamp(title.length * PER_LETTER_PIXELS, MIN_TITLE_WIDTH, MAX_TITLE_WIDTH);\n  return <div className=\"title\" style={{ minWidth }}>{title}</div>;\n};\n","/*\n * Copyright 2017-2020 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { MeasureBubbleContent } from \"../measure-bubble-content/measure-bubble-content\";\n\ninterface SeriesBubbleContentProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nexport const SeriesBubbleContent: React.FunctionComponent<SeriesBubbleContentProps> = props => {\n  const { series, datum, showPrevious } = props;\n  if (!showPrevious) {\n    return <React.Fragment>\n      {series.formatValue(datum)}\n    </React.Fragment>;\n  }\n  const currentValue = series.selectValue(datum);\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <MeasureBubbleContent\n    lowerIsBetter={series.measure.lowerIsBetter}\n    formatter={formatter}\n    current={currentValue}\n    previous={previousValue}\n  />;\n};\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { classNames, isInside } from \"../../utils/dom/dom\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { GlobalEventListener } from \"../global-event-listener/global-event-listener\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./modal-bubble.scss\";\n\ninterface ModalProps {\n  left: number;\n  top: number;\n  onClose: Fn;\n  className?: string;\n}\n\nexport class ModalBubble extends React.Component<ModalProps, {}> {\n\n  modalRef: HTMLDivElement;\n\n  setModalRef = (el: HTMLDivElement) => {\n    this.modalRef = el;\n  };\n\n  onMouseDown = (e: MouseEvent) => {\n    const target = e.target as Element;\n    if (isInside(target, this.modalRef)) return;\n    this.props.onClose();\n  };\n\n  render() {\n    const { className, children, left, top } = this.props;\n    return <React.Fragment>\n      <GlobalEventListener mouseDown={this.onMouseDown} />\n      <BodyPortal left={left} top={top}>\n        <div className={classNames(\"modal-bubble\", className)} ref={this.setModalRef}>\n          {children}\n          <Shpitz direction=\"up\" />\n        </div>\n      </BodyPortal>\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { STRINGS } from \"../../config/constants\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Button } from \"../button/button\";\nimport { ModalBubble } from \"../modal-bubble/modal-bubble\";\nimport \"./highlight-modal.scss\";\n\ninterface HighlightModalProps {\n  title: string;\n  left: number;\n  top: number;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\nexport const HighlightModal: React.FunctionComponent<HighlightModalProps> = ({ title, children, left, top, acceptHighlight, dropHighlight }) =>\n  <ModalBubble className=\"highlight-modal\" left={left} top={top} onClose={dropHighlight}>\n    <BubbleTitle title={title} />\n    <div className=\"value\">{children}</div>\n    <div className=\"actions\">\n      <Button type=\"primary\" className=\"accept mini\" onClick={acceptHighlight} title={STRINGS.select} />\n      <Button type=\"secondary\" className=\"drop mini\" onClick={dropHighlight} title={STRINGS.cancel} />\n    </div>\n  </ModalBubble>;\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ReactNode } from \"react\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./segment-bubble.scss\";\n\nconst OFFSET_V = -10;\n\nexport interface SegmentBubbleProps extends SegmentBubbleContentProps {\n  left: number;\n  top: number;\n}\n\nexport const SegmentBubble: React.FunctionComponent<SegmentBubbleProps> = (props: SegmentBubbleProps) => {\n  const { left, top, title, content } = props;\n  return <BodyPortal left={left} top={top + OFFSET_V}>\n    <div className=\"segment-bubble\">\n      <SegmentBubbleContent title={title} content={content} />\n      <Shpitz direction=\"up\" />\n    </div>\n  </BodyPortal>;\n};\n\nexport interface SegmentBubbleContentProps {\n  title: string;\n  content?: ReactNode;\n}\n\nexport const SegmentBubbleContent: React.FunctionComponent<SegmentBubbleContentProps> = ({ title, content }: SegmentBubbleContentProps) => (\n  <div className=\"segment-bubble-text\">\n    <BubbleTitle title={title} />\n    {content ? <div className=\"content\">{content}</div> : null}\n  </div>\n);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Delta } from \"../delta/delta\";\nimport \"./measure-bubble-content.scss\";\n\nexport interface MeasureBubbleContentProps {\n  current: number;\n  previous: number;\n  formatter: Unary<number, string>;\n  lowerIsBetter?: boolean;\n}\n\nexport const MeasureBubbleContent: React.FunctionComponent<MeasureBubbleContentProps> = ({ lowerIsBetter, formatter, current, previous }) => {\n  const currentValue = formatter(current);\n  const previousValue = formatter(previous);\n  return <React.Fragment>\n    <strong className=\"current-value\">{currentValue}</strong>\n    <span className=\"previous-value\">{previousValue}</span>\n    <Delta formatter={formatter} currentValue={current} previousValue={previous} lowerIsBetter={lowerIsBetter} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport \"./color-legend.scss\";\n\ninterface ColorLegendProps {\n  width?: number;\n  height?: number;\n  title: string;\n  formatter: Unary<number, string>;\n  colorScale: d3.ScaleLinear<string, string>;\n}\n\nconst leftMargin = 5;\nconst topMargin = 10;\nconst bottomMargin = 5;\nconst tickLabelTopOffset = 4;\nconst tickLabelLeftOffset = 7;\nconst tickLength = 5;\nconst stripeWidth = 30;\nconst stripeHeight = 200;\nconst panelWidth = 100;\n\nexport const ColorLegend: React.FunctionComponent<ColorLegendProps> = ({ title, width = panelWidth, height = stripeHeight, formatter, colorScale }) => {\n  const [min, max] = colorScale.domain();\n  if (isNaN(min) || isNaN(max)) return null;\n\n  const stripeLength = height - topMargin - bottomMargin;\n  const [startColor, endColor] = colorScale.range();\n\n  return <div className=\"color-legend\">\n    <div className=\"color-legend-header\">\n      {title}\n    </div>\n    <div className=\"color-legend-stripe\">\n      <svg\n        className=\"color-legend\"\n        width={`${width}px`}\n        height={`${height}px`}>\n        <defs>\n          <linearGradient id=\"color-stripe\" gradientTransform=\"rotate(90)\">\n            <stop offset=\"0%\" stopColor={endColor}/>\n            <stop offset=\"10%\" stopColor={endColor}/>\n            <stop offset=\"90%\" stopColor={startColor}/>\n            <stop offset=\"100%\" stopColor={startColor}/>\n          </linearGradient>\n        </defs>\n        <g transform={`translate(${leftMargin}, ${topMargin})`}>\n          <rect className=\"color-legend-stripe\"\n            x={0}\n            y={0}\n            width={stripeWidth}\n            height={stripeLength}\n            fill=\"url(#color-stripe)\"/>\n          <line className=\"color-legend-stripe-axis\"\n            x1={0.5}\n            x2={0.5}\n            y1={0}\n            y2={stripeLength}/>\n          <g className=\"color-upper-bound\">\n            <line className=\"color-upper-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={0.5}\n              y2={0.5}/>\n            <text className=\"color-upper-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={tickLabelTopOffset}>\n              {formatter(max)}\n            </text>\n          </g>\n          <g className=\"color-lower-bound\">\n            <line className=\"color-lower-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={stripeLength + 0.5}\n              y2={stripeLength + 0.5}/>\n            <text className=\"color-lower-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={stripeLength + tickLabelTopOffset}>\n              {formatter(min)}\n            </text>\n          </g>\n        </g>\n      </svg>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { Dataset, Datum, NumberRange, TimeRange } from \"plywood\";\nimport { SortDirection } from \"../../../../common/models/sort/sort\";\nimport { Split, SplitType } from \"../../../../common/models/split/split\";\nimport { formatValue } from \"../../../../common/utils/formatter/formatter\";\nimport { SPLIT } from \"../../../config/constants\";\n\ntype Order<D> = (a: [string, number, D], b: [string, number, D]) => number;\n\nexport const orderByValueDecreasing: Order<unknown> = ([_, countA], [__, countB]) => {\n  if (countA < countB) {\n    return 1;\n  }\n\n  if (countA > countB) {\n    return -1;\n  }\n\n  return 0;\n};\n\nexport const orderByValueIncreasing: Order<unknown> = (a, b) => {\n  return -orderByValueDecreasing(a, b);\n};\n\nexport const orderByTimeDimensionDecreasing: Order<TimeRange> = ([_, __, originalA], [___, ____, originalB]) => -originalA.compare(originalB);\nexport const orderByTimeDimensionIncreasing: Order<TimeRange> = ([_, __, originalA], [___, ____, originalB]) => originalA.compare(originalB);\n\nexport const orderByNumberRangeDimensionDecreasing: Order<NumberRange> = ([_, __, originalA], [___, ____, originalB]) => -originalA.compare(originalB);\nexport const orderByNumberRangeDimensionIncreasing: Order<NumberRange> = ([_, __, originalA], [___, ____, originalB]) => originalA.compare(originalB);\n\nconst datumKey = (dataset: Datum, key: string, timezone: Timezone): string =>\n  formatValue(dataset[key], timezone);\n\nconst splitToFillOrder = (split: Split): Order<unknown> => {\n  const sort = split.sort;\n  switch (split.type) {\n    case SplitType.string:\n    default:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByValueIncreasing;\n      } else {\n        return orderByValueDecreasing;\n      }\n    case SplitType.time:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByTimeDimensionIncreasing;\n      } else {\n        return orderByTimeDimensionDecreasing;\n      }\n    case SplitType.number:\n      if (sort.direction === SortDirection.ascending) {\n        return orderByNumberRangeDimensionIncreasing;\n      } else {\n        return orderByNumberRangeDimensionDecreasing;\n      }\n  }\n};\n\nexport const fillDatasetWithMissingValues = (dataset: Dataset, measureName: string, secondSplit: Split, timezone: Timezone): Dataset => {\n  const totals: { [ident: string]: number } = {};\n  const identToOriginalKey: { [ident: string]: any } = {};\n  const order = splitToFillOrder(secondSplit);\n  const secondSplitName = secondSplit.reference;\n\n  for (const datum of dataset.data) {\n    const nestedDataset = (datum[SPLIT] as Dataset).data;\n\n    for (const nestedDatum of nestedDataset) {\n      const value = nestedDatum[measureName] as number;\n      const ident = datumKey(nestedDatum, secondSplitName, timezone);\n\n      if (totals[ident] !== undefined) {\n        totals[ident] += value;\n      } else {\n        totals[ident] = value;\n        identToOriginalKey[ident] = nestedDatum[secondSplitName];\n      }\n    }\n  }\n\n  const sortedIdents = Object.keys(totals)\n    .map(ident => [ident, totals[ident], identToOriginalKey[ident]] as [string, number, any])\n    .sort(order)\n    .map(([ident]) => ident);\n\n  const newDataset = dataset.data.map(datum => {\n\n    const identToNestedDatum = (datum[SPLIT] as Dataset).data.reduce((datumsByIdent, datum) => {\n      const ident = datumKey(datum, secondSplitName, timezone);\n      datumsByIdent[ident] = datum;\n      return datumsByIdent;\n    }, {} as {[index: string]: Datum});\n\n    const filledNestedDataset = sortedIdents.map(ident => {\n      const nestedDatum = identToNestedDatum[ident];\n\n      if (nestedDatum) {\n        return {\n          ...nestedDatum,\n          [measureName]: Number.isNaN(Number(nestedDatum[measureName])) ? 0 : nestedDatum[measureName]\n        };\n      } else {\n        return {\n          [secondSplitName]: identToOriginalKey[ident],\n          [measureName]: 0\n        } as Datum;\n      }\n    });\n\n    return {\n      ...datum,\n      [SPLIT]: (datum[SPLIT] as Dataset).changeData(filledNestedDataset)\n    } as Datum;\n  });\n\n  return dataset.changeData(newDataset);\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { findDimensionByName } from \"../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport \"./heatmap-corner.scss\";\n\ninterface HeatmapCornerProps {\n  essence: Essence;\n  width: number;\n  height: number;\n}\n\nconst labelMargin = 20;\n// Around half of font-size with handpicked offset to accommodate rounding errors and rotation artifacts\nconst rotationAxisOffset = 7;\n\nexport const HeatmapCorner: React.FunctionComponent<HeatmapCornerProps> = ({ width, height, essence }) => {\n  const { dataCube, splits: { splits } } = essence;\n\n  const row = splits.get(0);\n  const column = splits.get(1);\n  const rowTitle = row.getTitle(findDimensionByName(dataCube.dimensions, row.reference));\n  const columnTitle = column.getTitle(findDimensionByName(dataCube.dimensions, column.reference));\n\n  return <div className=\"heatmap-corner\">\n    <div className=\"heatmap-corner-row-title\">\n      <span className=\"heatmap-corner-overflow-label\"\n            style={{ width: `${width - labelMargin}px` }}>\n        {rowTitle}\n      </span>\n    </div>\n    <div className=\"heatmap-corner-column-title\"\n         style={{ left: `${width - labelMargin + rotationAxisOffset}px` }}>\n      <span className=\"heatmap-corner-overflow-label\"\n            style={{ width: `${height - labelMargin}px` }}>\n        {columnTitle}\n      </span>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./heatmap-highlight-indicator.scss\";\nimport { HighlightPosition } from \"./utils/get-highlight-position\";\n\ninterface RowHighlightProps {\n  width: number;\n  row: number;\n  tileSize: number;\n}\n\nconst RowHighlight: React.FunctionComponent<RowHighlightProps> = props => {\n  const { row, width, tileSize } = props;\n  const top = row * tileSize;\n  return <div className=\"heatmap-highlighter heatmap-highlighter-row\" style={{\n    top: `${top}px`,\n    width: `${width}px`\n  }} />;\n};\n\ninterface ColumnHighlightProps {\n  height: number;\n  column: number;\n  tileSize: number;\n  tileGap: number;\n}\n\nconst ColumnHighlight: React.FunctionComponent<ColumnHighlightProps> = props => {\n  const { column, tileSize, height, tileGap } = props;\n  const left = column * tileSize + tileGap;\n  return <div className=\"heatmap-highlighter heatmap-highlighter-column\" style={{\n    left: `${left}px`,\n    height: `${height}px`\n  }} />;\n};\n\ninterface HeatmapHighlightIndicatorProps {\n  tileSize: number;\n  tileGap: number;\n  position: HighlightPosition;\n  width: number;\n  height: number;\n}\n\nexport const HeatmapHighlightIndicator: React.FunctionComponent<HeatmapHighlightIndicatorProps> = props => {\n  const { position: { row, column }, width, height, tileGap, tileSize } = props;\n\n  return <React.Fragment>\n    {row && <RowHighlight\n      row={row}\n      width={width}\n      tileSize={tileSize} />}\n    {column && <ColumnHighlight\n      column={column}\n      tileGap={tileGap}\n      height={height}\n      tileSize={tileSize} />}\n  </React.Fragment>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HeatmapHighlightModalProps } from \"../heatmap-highlight-modal\";\nimport { TILE_GAP, TILE_SIZE } from \"../labeled-heatmap\";\n\nexport type CoordinatesProps = Pick<HeatmapHighlightModalProps, \"position\" | \"layout\" | \"stage\" | \"scroll\">;\n\nexport function calculateLeft(props: CoordinatesProps): number {\n  const { position: { column }, layout, stage, scroll } = props;\n  if (column !== null) {\n    return column * TILE_SIZE + TILE_GAP + layout.left + 20 + stage.x - scroll.left;\n  }\n  return stage.x + Math.min(stage.width / 2, layout.left + (layout.bodyWidth / 2));\n}\n\nexport function calculateTop(props: CoordinatesProps): number {\n  const { position: { row }, layout, stage, scroll } = props;\n  if (row !== null) {\n    return row * TILE_SIZE + layout.top + stage.y - 5 - scroll.top;\n  }\n  return stage.y + Math.min(stage.height / 2, layout.top + (layout.bodyHeight / 2));\n}\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { HighlightModal } from \"../../components/highlight-modal/highlight-modal\";\nimport { ScrollerLayout } from \"../../components/scroller/scroller\";\nimport { HighlightPosition } from \"./utils/get-highlight-position\";\nimport { calculateLeft, calculateTop } from \"./utils/highlight-modal-position\";\n\nexport interface HeatmapHighlightModalProps {\n  title: string;\n  stage: Stage;\n  layout: ScrollerLayout;\n  scroll: { left: number, top: number };\n  position: HighlightPosition;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\nexport const HeatmapHighlightModal: React.FunctionComponent<HeatmapHighlightModalProps> = props => {\n  const { title, children, acceptHighlight, dropHighlight } = props;\n  return <HighlightModal\n    title={title}\n    left={calculateLeft(props)}\n    top={calculateTop(props)}\n    dropHighlight={dropHighlight}\n    acceptHighlight={acceptHighlight}>\n    {children}\n  </HighlightModal>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport \"./heatmap-hover-indicator.scss\";\nimport { HoverPosition } from \"./utils/get-hover-position\";\n\ninterface HeatmapHoverIndicator {\n  tileSize: number;\n  tileGap: number;\n  hoverPosition: HoverPosition;\n}\n\nexport const HeatmapHoverIndicator: React.FunctionComponent<HeatmapHoverIndicator> = ({ tileGap, tileSize, hoverPosition }) => {\n  const { column, row } = hoverPosition;\n  const top = row * tileSize;\n  const left = column * tileSize + tileGap;\n  const position: React.CSSProperties = {\n    top: `${top}px`,\n    left: `${left}px`\n  };\n  return <div className=\"heatmap-hover-indicator\" style={position} />;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const nestedDataset = (d: Datum) => (d && d[SPLIT] && (d[SPLIT] as Dataset).data) || [];\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { nestedDataset } from \"./nested-dataset\";\n\ninterface Position {\n  row: number | null;\n  column: number | null;\n}\n\nfunction getDataColumn(dataset: Datum, column: number): Datum {\n  const dataColumn = nestedDataset(dataset)[column];\n  return dataColumn ? dataColumn : null;\n}\n\nexport default function datumByPosition(dataset: Datum[], position: Position): [Datum, Datum] {\n  const { column, row } = position;\n  const dataRow = dataset[row];\n  if (!dataRow) return [null, getDataColumn(dataset[0], column)];\n  return [dataRow, getDataColumn(dataRow, column)];\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { formatSegment } from \"../../../../common/utils/formatter/formatter\";\nimport { zip } from \"../../../../common/utils/functional/functional\";\nimport datumByPosition from \"./datum-by-position\";\nimport { HighlightPosition } from \"./get-highlight-position\";\nimport { HoverPosition } from \"./get-hover-position\";\n\nexport function modalTitle(position: HighlightPosition | HoverPosition, dataset: Datum[], essence: Essence): string {\n  const { timezone, splits: { splits } } = essence;\n  const datums = datumByPosition(dataset, position);\n  const references = splits.toArray().map(split => split.reference);\n  const segments = zip(datums, references);\n\n  return segments\n    .filter(([datum]) => datum)\n    .map(([datum, split]) => formatSegment(datum[split], timezone))\n    .join(\" - \");\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TooltipWithBounds } from \"@visx/tooltip\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport { SegmentBubbleContent } from \"../../components/segment-bubble/segment-bubble\";\nimport { SeriesBubbleContent } from \"../../components/series-bubble-content/series-bubble-content\";\nimport datumByPosition from \"./utils/datum-by-position\";\nimport { HoverPosition } from \"./utils/get-hover-position\";\nimport { modalTitle } from \"./utils/modal-title\";\n\ninterface HeatmapHoverTooltip {\n  dataset: Datum[];\n  position: HoverPosition;\n  essence: Essence;\n  scroll: { left: number, top: number };\n}\n\nexport const HeatmapHoverTooltip: React.FunctionComponent<HeatmapHoverTooltip> = props => {\n  const { dataset, essence, scroll, position: { column, row, top, left } } = props;\n  const [, datum] = datumByPosition(dataset, { row, column });\n  if (!datum) return null;\n\n  const series = essence.getConcreteSeries().first();\n  return <TooltipWithBounds\n    key={`${row}-${column}`}\n    top={top - scroll.top}\n    left={left - scroll.left}>\n    <SegmentBubbleContent\n      title={modalTitle({ row, column }, dataset, essence)}\n      content={<SeriesBubbleContent\n        datum={datum}\n        showPrevious={essence.hasComparison()}\n        series={series} />}\n    />\n  </TooltipWithBounds>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { noop } from \"../../../common/utils/functional/functional\";\nimport { classNames } from \"../../utils/dom/dom\";\nimport \"./heatmap-labels.scss\";\n\ninterface HeatmapLabelsProps {\n  labels: string[];\n  orientation: \"top\" | \"left\";\n  hoveredLabel: number;\n  highlightedLabel: number;\n  labelSize?: number;\n\n  onMaxLabelSize?(maxLabelSize: number): void;\n}\n\nconst heatmapLabelClassName = \"heatmap-label\";\n\nexport class HeatmapLabels extends React.Component<HeatmapLabelsProps> {\n  private container = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    if (this.container.current === null) {\n      return;\n    }\n\n    const { onMaxLabelSize = noop } = this.props;\n\n    const maxWidth = Array.from(this.container.current.querySelectorAll(`.${heatmapLabelClassName}`))\n      .reduce((maxWidth, element: HTMLSpanElement) => Math.max(element.offsetWidth, maxWidth), 0);\n\n    onMaxLabelSize(maxWidth + 10 /* consider elements padding */);\n  }\n\n  render() {\n    const { labels, orientation, hoveredLabel, highlightedLabel, labelSize } = this.props;\n\n    return (\n      <div ref={this.container} className={`${orientation}-labels`}>\n        {labels.map((label, index) => {\n          const highlight = highlightedLabel === index;\n          const hover = !highlight && hoveredLabel === index;\n          return <span\n            key={label}\n            className={classNames(\"heatmap-label-wrapper\", { \"heatmap-label-hovered\": hover, \"heatmap-label-highlight\": highlight })}>\n            <span className={heatmapLabelClassName} style={labelSize ? { width: labelSize } : undefined}>\n              <span className=\"heatmap-label-overflow-container\">{label}</span>\n            </span>\n          </span>;\n        })}\n      </div>\n    );\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEqualable } from \"../../../common/utils/immutable-utils/immutable-utils\";\n\nfunction equals(a: any, b: unknown): boolean {\n  if (a === null) {\n    return a === b;\n  }\n  if (isEqualable(a)) {\n    return a.equals(b);\n  }\n  return a === b;\n}\n\nexport function equalProps<T extends object>(oldProps: T, newProps: T): boolean {\n  const keys = Object.keys(oldProps) as Array<keyof T>;\n  return keys.every(key => equals(oldProps[key], newProps[key]));\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RectCell } from \"@visx/heatmap/lib/heatmaps/HeatmapRect\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\n\ninterface HeatMapRectangleRowProps {\n  bins: Array<RectCell<Datum, Datum>>;\n}\n\nexport class HeatMapRectangleRow extends React.PureComponent<HeatMapRectangleRowProps> {\n  render() {\n    const { bins } = this.props;\n    return bins.map(bin => <rect\n      key={`heatmap-rect-${bin.row}-${bin.column}`}\n      width={bin.width}\n      height={bin.height}\n      x={bin.y}\n      y={bin.x}\n      fill={bin.color}\n      fillOpacity={bin.opacity}\n    />);\n  }\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HeatmapRect } from \"@visx/heatmap\";\nimport { Dataset, Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { SPLIT } from \"../../config/constants\";\nimport { equalProps } from \"../../utils/equal-props/equal-props\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { HeatMapRectangleRow } from \"./heatmap-rectangle-row\";\nimport \"./heatmap-rectangles.scss\";\nimport { ColorScale } from \"./utils/scales\";\n\nexport interface HeatMapRectanglesProps {\n  dataset: Datum[];\n  series: ConcreteSeries;\n  colorScale: ColorScale;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  tileSize: number;\n  gap: number;\n  leftLabelName: string;\n  topLabelName: string;\n}\n\nconst bins = (d: Datum) => (d[SPLIT] as Dataset).data;\n\nexport class HeatMapRectangles extends React.Component<HeatMapRectanglesProps> {\n\n  shouldComponentUpdate(nextProps: Readonly<HeatMapRectanglesProps>): boolean {\n    return !equalProps(this.props, nextProps);\n  }\n\n  render() {\n    const { series, colorScale, xScale, yScale, gap, tileSize, dataset } = this.props;\n\n    const [height] = yScale.range();\n    const [, width] = xScale.range();\n\n    return (\n      <div className=\"heatmap-rectangles-container\">\n        <svg width={width} height={height}>\n          <rect x={0} y={0} width={width} height={height} fill=\"#fff\" />\n          <HeatmapRect\n            bins={bins}\n            count={d => series.selectValue(d)}\n            data={dataset}\n            xScale={xScale}\n            yScale={yScale}\n            colorScale={colorScale}\n            binWidth={tileSize}\n            binHeight={tileSize}\n            gap={gap}\n          >\n            {heatmap => heatmap.map(bins => (\n              <HeatMapRectangleRow\n                key={`heatmap-rect-row-${bins[0].column}`}\n                bins={bins} />\n            ))}\n          </HeatmapRect>\n        </svg>\n      </div>\n    );\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { List, Set } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport { ClientDataCube } from \"../../../../common/models/data-cube/data-cube\";\nimport { DateRange } from \"../../../../common/models/date-range/date-range\";\nimport { Dimension } from \"../../../../common/models/dimension/dimension\";\nimport { findDimensionByName } from \"../../../../common/models/dimension/dimensions\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport {\n  BooleanFilterClause,\n  FilterClause,\n  FixedTimeFilterClause,\n  NumberFilterClause,\n  NumberRange,\n  StringFilterAction,\n  StringFilterClause\n} from \"../../../../common/models/filter-clause/filter-clause\";\nimport { Split } from \"../../../../common/models/split/split\";\nimport { isTruthy } from \"../../../../common/utils/general/general\";\nimport { Booleanish } from \"../../../components/filter-menu/boolean-filter-menu/boolean-filter-menu\";\nimport { ScrollerPart } from \"../../../components/scroller/scroller\";\nimport { TILE_SIZE } from \"../labeled-heatmap\";\nimport { nestedDataset } from \"./nested-dataset\";\n\ninterface SplitSelection {\n  value: unknown;\n  dimension: Dimension;\n}\n\nfunction splitSelection(split: Split, offset: number, dataCube: ClientDataCube, dataset: Datum[]): SplitSelection {\n  const dimensionName = split.reference;\n  const dimension = findDimensionByName(dataCube.dimensions, dimensionName);\n  const labelIndex = Math.floor(offset / TILE_SIZE);\n  if (labelIndex > dataset.length - 1) {\n    return null;\n  }\n  const value = dataset[labelIndex][dimensionName];\n  return { value, dimension };\n}\n\nfunction firstSplitSelection(topOffset: number, essence: Essence, dataset: Datum[]): SplitSelection {\n  const { dataCube, splits: { splits } } = essence;\n  const split = splits.get(0);\n  return splitSelection(split, topOffset, dataCube, dataset);\n}\n\nfunction secondSplitSelection(leftOffset: number, essence: Essence, dataset: Datum[]): SplitSelection {\n  const { dataCube, splits: { splits } } = essence;\n  const split = splits.get(1);\n  return splitSelection(split, leftOffset, dataCube, nestedDataset(dataset[0]));\n}\n\nfunction splitSelectionToClause({ value, dimension: { kind, name: reference } }: SplitSelection): FilterClause {\n  switch (kind) {\n    case \"string\":\n      return new StringFilterClause({ reference, action: StringFilterAction.IN, values: Set.of(String(value)) });\n    case \"boolean\":\n      return new BooleanFilterClause({ reference, values: Set.of(value as Booleanish) });\n    case \"time\":\n      return new FixedTimeFilterClause({ reference, values: List.of(value as DateRange) });\n    case \"number\":\n      return new NumberFilterClause({ reference, values: List.of(value as NumberRange) });\n  }\n}\n\ntype ClickablePart = \"body\" | \"top-gutter\" | \"left-gutter\";\n\nexport function isClickablePart(part: ScrollerPart): part is ClickablePart {\n  return part === \"body\" || part === \"top-gutter\" || part === \"left-gutter\";\n}\n\ninterface Position {\n  part: ClickablePart;\n  x: number;\n  y: number;\n}\n\nfunction pickSplitSelections({ x, y, part }: Position, essence: Essence, dataset: Datum[]): SplitSelection[] {\n  switch (part) {\n    case \"top-gutter\":\n      return [secondSplitSelection(x, essence, dataset)];\n    case \"left-gutter\":\n      return [firstSplitSelection(y, essence, dataset)];\n    case \"body\":\n      return [firstSplitSelection(y, essence, dataset), secondSplitSelection(x, essence, dataset)];\n  }\n}\n\nexport default function createHighlightClauses(position: Position, essence: Essence, dataset: Datum[]): FilterClause[] {\n  const selections = pickSplitSelections(position, essence, dataset);\n  if (selections.every(isTruthy)) {\n    return selections.map(splitSelectionToClause);\n  }\n  return [];\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { BooleanFilterClause, FilterClause, FilterTypes, FixedTimeFilterClause, NumberFilterClause, StringFilterClause } from \"../../../../common/models/filter-clause/filter-clause\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { Highlight } from \"../../highlight-controller/highlight\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nfunction clausePredicate(clause: FilterClause): Unary<Datum, boolean> {\n  switch (clause.type) {\n    case FilterTypes.BOOLEAN:\n      return datum => datum[clause.reference] === (clause as BooleanFilterClause).values.first();\n    case FilterTypes.NUMBER:\n      return datum => (clause as NumberFilterClause).values.first().equals(datum[clause.reference]);\n    case FilterTypes.STRING:\n      return datum => String(datum[clause.reference]) === (clause as StringFilterClause).values.first();\n    case FilterTypes.FIXED_TIME:\n      return datum => (clause as FixedTimeFilterClause).values.first().equals(datum[clause.reference]);\n    case FilterTypes.RELATIVE_TIME:\n      throw new Error(\"Unsupported filter type for highlights\");\n  }\n}\n\nfunction findDatumIndexByClause(data: Datum[], clause: FilterClause): number {\n  return data.findIndex(clausePredicate(clause));\n}\n\nexport interface HighlightPosition {\n  row: number | null;\n  column: number | null;\n}\n\nexport default function getHighlightPosition(\n  highlight: Highlight,\n  essence: Essence,\n  dataset: Datum[]\n): HighlightPosition {\n  if (!highlight) return null;\n  const { splits: { splits } } = essence;\n  const { clauses } = highlight;\n\n  const firstSplit = splits.get(0);\n  const secondSplit = splits.get(1);\n  const columnSplitReference = secondSplit.reference;\n  const rowSplitReference = firstSplit.reference;\n  const columnClause = clauses.find(({ reference }) => reference === columnSplitReference);\n  const rowClause = clauses.find(({ reference }) => reference === rowSplitReference);\n  const row = rowClause ? findDatumIndexByClause(dataset, rowClause) : null;\n  const column = columnClause ? findDatumIndexByClause(nestedDataset(dataset[row || 0]), columnClause) : null;\n\n  return {\n    row,\n    column\n  };\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Timezone } from \"chronoshift\";\nimport { List } from \"immutable\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { Essence } from \"../../../common/models/essence/essence\";\nimport { FilterClause } from \"../../../common/models/filter-clause/filter-clause\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { formatSegment } from \"../../../common/utils/formatter/formatter\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Fn } from \"../../../common/utils/general/general\";\nimport { ColorLegend } from \"../../components/color-legend/color-legend\";\nimport { LegendSpot } from \"../../components/pinboard-panel/pinboard-panel\";\nimport { Scroller, ScrollerLayout, ScrollerPart } from \"../../components/scroller/scroller\";\nimport { clamp } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { Highlight } from \"../highlight-controller/highlight\";\nimport \"./heat-map.scss\";\nimport { HeatmapCorner } from \"./heatmap-corner\";\nimport { HeatmapHighlightIndicator } from \"./heatmap-highlight-indicator\";\nimport { HeatmapHighlightModal } from \"./heatmap-highlight-modal\";\nimport { HeatmapHoverIndicator } from \"./heatmap-hover-indicator\";\nimport { HeatmapHoverTooltip } from \"./heatmap-hover-tooltip\";\nimport { HeatmapLabels } from \"./heatmap-labels\";\nimport { HeatMapRectangles } from \"./heatmap-rectangles\";\nimport createHighlightClauses, { isClickablePart } from \"./utils/create-highlight-clauses\";\nimport getHighlightPosition from \"./utils/get-highlight-position\";\nimport getHoverPosition, { HoverPosition } from \"./utils/get-hover-position\";\nimport { modalTitle } from \"./utils/modal-title\";\nimport { nestedDataset } from \"./utils/nested-dataset\";\nimport { ColorScale } from \"./utils/scales\";\nimport scrollerLayout from \"./utils/scroller-layout\";\n\ninterface LabelledHeatmapProps {\n  stage: Stage;\n  essence: Essence;\n  dataset: Datum[];\n  xScale: LinearScale;\n  yScale: LinearScale;\n  colorScale: ColorScale;\n\n  highlight: Highlight | null;\n  saveHighlight: Unary<List<FilterClause>, void>;\n  dropHighlight: Fn;\n  acceptHighlight: Fn;\n}\n\ninterface LabelledHeatmapState {\n  scrollLeft: number;\n  scrollTop: number;\n  hoverPosition: HoverPosition | null;\n  leftLabelsWidth: number;\n  topLabelsHeight: number;\n}\n\nexport const TILE_SIZE = 25;\nexport const TILE_GAP = 2;\nexport const MIN_LEFT_LABELS_WIDTH = 100;\nexport const MAX_LEFT_LABELS_WIDTH = 200;\nexport const MIN_TOP_LABELS_HEIGHT = 100;\nexport const MAX_TOP_LABELS_HEIGHT = 150;\n\nfunction formatSegments(dataset: Datum[], fieldName: string, timezone: Timezone): string[] {\n  return dataset.map(datum => formatSegment(datum[fieldName], timezone));\n}\n\nexport class LabelledHeatmap extends React.PureComponent<LabelledHeatmapProps, LabelledHeatmapState> {\n  state: LabelledHeatmapState = {\n    hoverPosition: null,\n    leftLabelsWidth: 0,\n    topLabelsHeight: 0,\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n\n  saveHover = (x: number, y: number, part: ScrollerPart) => {\n    const { xScale, yScale } = this.props;\n    const hoverPosition = getHoverPosition(xScale, yScale, x, y, part, this.layout());\n    this.setState({ hoverPosition });\n  };\n\n  resetHover = () => this.setState({ hoverPosition: null });\n\n  saveScroll = (scrollTop: number, scrollLeft: number) => this.setState({ scrollLeft, scrollTop });\n\n  saveLeftLabelWidth = (maxLabelWidth: number) => this.setState({ leftLabelsWidth: clamp(maxLabelWidth, MIN_LEFT_LABELS_WIDTH, MAX_LEFT_LABELS_WIDTH) });\n\n  saveTopLabelHeight = (maxLabelHeight: number) => this.setState({ topLabelsHeight: clamp(maxLabelHeight, MIN_TOP_LABELS_HEIGHT, MAX_TOP_LABELS_HEIGHT) });\n\n  handleHighlight = (x: number, y: number, part: ScrollerPart) => {\n    if (!isClickablePart(part)) return;\n    const { saveHighlight, essence, dataset } = this.props;\n    const layout = this.layout();\n    const clauses = createHighlightClauses({ x: x - layout.left, y: y - layout.top, part }, essence, dataset);\n    if (clauses.length > 0) {\n      saveHighlight(List(clauses));\n    }\n  };\n\n  private layout(): ScrollerLayout {\n    const { topLabelsHeight, leftLabelsWidth } = this.state;\n    const { dataset } = this.props;\n    return scrollerLayout(dataset, topLabelsHeight, leftLabelsWidth);\n  }\n\n  render() {\n    const { stage, colorScale, xScale, yScale, dataset, essence, highlight, acceptHighlight, dropHighlight } = this.props;\n    const { scrollLeft, scrollTop, hoverPosition, topLabelsHeight } = this.state;\n\n    const series = essence.getConcreteSeries().first();\n    const { splits: { splits }, timezone } = essence;\n    const firstSplit = splits.get(0);\n    const secondSplit = splits.get(1);\n\n    const leftLabels = formatSegments(dataset, firstSplit.reference, timezone);\n    const topLabels = formatSegments(nestedDataset(dataset[0]), secondSplit.reference, timezone);\n\n    const highlightPosition = getHighlightPosition(highlight, essence, dataset);\n\n    const layout = this.layout();\n\n    return <React.Fragment>\n      <Scroller\n        onClick={this.handleHighlight}\n        onMouseMove={this.saveHover}\n        onMouseLeave={this.resetHover}\n        onScroll={this.saveScroll}\n\n        layout={layout}\n\n        topLeftCorner={<HeatmapCorner\n          width={layout.left}\n          height={layout.top}\n          essence={essence}/>}\n\n        topGutter={<HeatmapLabels\n          orientation=\"top\"\n          labels={topLabels}\n          hoveredLabel={hoverPosition ? hoverPosition.column : -1}\n          highlightedLabel={highlightPosition ? highlightPosition.column : -1}\n          onMaxLabelSize={this.saveTopLabelHeight}\n          labelSize={topLabelsHeight} />}\n\n        leftGutter={<HeatmapLabels\n          orientation=\"left\"\n          labels={leftLabels}\n          hoveredLabel={hoverPosition ? hoverPosition.row : -1}\n          highlightedLabel={highlightPosition ? highlightPosition.row : -1}\n          onMaxLabelSize={this.saveLeftLabelWidth} />}\n\n        body={<React.Fragment>\n          <HeatMapRectangles\n            key=\"heatmap\"\n            dataset={dataset}\n            series={series}\n            xScale={xScale}\n            yScale={yScale}\n            colorScale={colorScale}\n            tileSize={TILE_SIZE}\n            gap={TILE_GAP}\n            leftLabelName={firstSplit.reference}\n            topLabelName={secondSplit.reference} />\n          {highlightPosition && <HeatmapHighlightIndicator\n            position={highlightPosition}\n            height={layout.bodyHeight}\n            width={layout.bodyWidth}\n            tileSize={TILE_SIZE}\n            tileGap={TILE_GAP} />}\n          {hoverPosition && <HeatmapHoverIndicator\n            tileSize={TILE_SIZE}\n            tileGap={TILE_GAP}\n            hoverPosition={hoverPosition} />}\n        </React.Fragment>}\n      />\n      <LegendSpot>\n        <ColorLegend\n          title={series.title()}\n          formatter={series.formatter()}\n          colorScale={colorScale} />\n      </LegendSpot>\n      {highlightPosition && <HeatmapHighlightModal\n        title={modalTitle(highlightPosition, dataset, essence)}\n        position={highlightPosition}\n        stage={stage}\n        layout={layout}\n        scroll={{ left: scrollLeft, top: scrollTop }}\n        dropHighlight={dropHighlight}\n        acceptHighlight={acceptHighlight} />}\n      {hoverPosition && <HeatmapHoverTooltip\n        scroll={{ left: scrollLeft, top: scrollTop }}\n        dataset={dataset}\n        position={hoverPosition}\n        essence={essence} />}\n    </React.Fragment>;\n  }\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScrollerLayout, ScrollerPart } from \"../../../components/scroller/scroller\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\n\nexport interface HoverPosition {\n  row: number;\n  column: number;\n  top: number;\n  left: number;\n}\n\nexport default function getHoverPosition(xScale: LinearScale, yScale: LinearScale, x: number, y: number, part: ScrollerPart, { left, top }: ScrollerLayout): HoverPosition | null {\n  if (part !== \"body\") return null;\n\n  const xOffset = x - left;\n  const yOffset = y - top;\n  const width = xScale.range()[1];\n  const height = yScale.range()[0];\n\n  if (xOffset > width || yOffset > height) return null;\n\n  const column = Math.floor(xScale.invert(xOffset));\n  const row = Math.floor(yScale.invert(yOffset));\n  return {\n    top: y,\n    left: x,\n    row,\n    column\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport { ScrollerLayout } from \"../../../components/scroller/scroller\";\nimport { clamp } from \"../../../utils/dom/dom\";\nimport { MAX_LEFT_LABELS_WIDTH, MAX_TOP_LABELS_HEIGHT, MIN_LEFT_LABELS_WIDTH, MIN_TOP_LABELS_HEIGHT, TILE_SIZE } from \"../labeled-heatmap\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nexport default function scrollerLayout(dataset: Datum[], topLabelsHeight: number, leftLabelsWidth: number): ScrollerLayout {\n  const top =  clamp(topLabelsHeight, MIN_TOP_LABELS_HEIGHT, MAX_TOP_LABELS_HEIGHT);\n  const left =  clamp(leftLabelsWidth, MIN_LEFT_LABELS_WIDTH, MAX_LEFT_LABELS_WIDTH);\n  const height = dataset.length * TILE_SIZE;\n  const width = nestedDataset(dataset[0]).length * TILE_SIZE;\n\n  return {\n    bodyHeight: height,\n    bodyWidth: width,\n    top,\n    left,\n    right: 0,\n    bottom: 0\n  };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { scaleLinear } from \"@visx/scale\";\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../../common/models/series/concrete-series\";\nimport { Unary } from \"../../../../common/utils/functional/functional\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\nimport { nestedDataset } from \"./nested-dataset\";\n\nexport type ColorScale = d3.ScaleLinear<string, string>;\n\nconst white = \"#fff\";\n\ninterface Scales {\n  x: LinearScale;\n  y: LinearScale;\n  color: ColorScale;\n}\n\nfunction seriesSelector(series: ConcreteSeries): Unary<Datum, number> {\n  return (d: Datum) => series.selectValue(d);\n}\n\nexport default function scales(dataset: Datum[], tileSize: number, mainColor: string, series: ConcreteSeries): Scales {\n  const bucketSizeMax = d3.max(dataset, d => nestedDataset(d).length) || 0; // d3.max returns undefined if collection is empty\n  const dataLength = dataset.length;\n\n  const width = bucketSizeMax * tileSize;\n  const height = dataLength * tileSize;\n\n  const x = scaleLinear({\n    domain: [0, bucketSizeMax],\n    range: [0, width]\n  });\n\n  const y = scaleLinear({\n    domain: [dataLength, 0],\n    range: [height, 0]\n  });\n\n  const select = seriesSelector(series);\n\n  const colorMin = d3.min(dataset, d => d3.min(nestedDataset(d), select));\n  const colorMax = d3.max(dataset, d => d3.max(nestedDataset(d), select));\n\n  const color = scaleLinear<string>({\n    range: [white, mainColor],\n    domain: [Math.min(colorMin, 0), colorMax]\n  });\n\n  return { x, y, color };\n}\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// For some reason tsc compiler does not see this file.\n// Remove when issue is identified.\n// tslint:disable-next-line: no-reference\n/// <reference path=\"../../index.d.ts\" />\n\nimport { Timezone } from \"chronoshift\";\nimport memoizeOne from \"memoize-one\";\nimport { Dataset } from \"plywood\";\nimport React from \"react\";\nimport { ChartProps } from \"../../../common/models/chart-props/chart-props\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { HEAT_MAP_MANIFEST } from \"../../../common/visualization-manifests/heat-map/heat-map\";\nimport { SPLIT } from \"../../config/constants\";\nimport { fillDatasetWithMissingValues } from \"../../utils/dataset/sparse-dataset/dataset\";\nimport {\n  ChartPanel,\n  DefaultVisualizationControls,\n  VisualizationProps\n} from \"../../views/cube-view/center-panel/center-panel\";\nimport { SettingsContext, SettingsContextValue } from \"../../views/cube-view/settings-context\";\nimport \"./heat-map.scss\";\nimport { LabelledHeatmap, TILE_SIZE } from \"./labeled-heatmap\";\nimport scales from \"./utils/scales\";\n\nexport default function HeatMapVisualization(props: VisualizationProps) {\n  return <React.Fragment>\n    <DefaultVisualizationControls {...props} />\n    <ChartPanel {...props} chartComponent={HeatMap}/>\n  </React.Fragment>;\n}\n\nclass HeatMap extends React.Component<ChartProps> {\n  static contextType = SettingsContext;\n  protected className = HEAT_MAP_MANIFEST.name;\n\n  context: SettingsContextValue;\n\n  getScales = memoizeOne(scales);\n  prepareDataset = memoizeOne(\n    (data: Dataset, series: ConcreteSeries, split: Split, timezone: Timezone) =>\n      fillDatasetWithMissingValues((data.data[0][SPLIT] as Dataset), series.plywoodKey(), split, timezone),\n    ([nextData], [oldData]) => nextData === oldData);\n\n  render() {\n    const { customization: { visualizationColors } } = this.context;\n    const { essence, stage, highlight, data, saveHighlight, acceptHighlight, dropHighlight } = this.props;\n    const { timezone, splits: { splits } } = essence;\n    const series = essence.getConcreteSeries().first();\n    const secondSplit = splits.get(1);\n    const dataset = this.prepareDataset(data, series, secondSplit, timezone);\n\n    const { x, y, color } = this.getScales(dataset.data, TILE_SIZE, visualizationColors.main, series);\n\n    return <div className=\"heatmap-container\" style={{ height: stage.height }}>\n      <LabelledHeatmap\n        stage={stage}\n        dataset={dataset.data}\n        xScale={x}\n        yScale={y}\n        colorScale={color}\n        saveHighlight={saveHighlight}\n        highlight={highlight}\n        acceptHighlight={acceptHighlight}\n        dropHighlight={dropHighlight}\n        essence={essence}\n      />\n    </div>;\n  }\n}\n"],"sourceRoot":""}