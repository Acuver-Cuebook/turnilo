{"version":3,"sources":["webpack:///./src/client/utils/dataset/selectors/selectors.ts","webpack:///./src/client/components/bubble-title/bubble-title.tsx","webpack:///./src/client/components/series-bubble-content/series-bubble-content.tsx","webpack:///./src/client/components/segment-bubble/segment-bubble.tsx","webpack:///./src/client/components/measure-bubble-content/measure-bubble-content.tsx","webpack:///./src/client/components/grid-lines/grid-lines.tsx","webpack:///./src/client/components/tooltip-within-stage/calculate-position.ts","webpack:///./src/client/components/tooltip-within-stage/tooltip-within-stage.tsx","webpack:///./src/client/components/color-legend/color-legend.tsx","webpack:///./src/client/visualizations/scatterplot/heatmap.tsx","webpack:///./src/client/visualizations/scatterplot/point.tsx","webpack:///./src/client/visualizations/scatterplot/tooltip.tsx","webpack:///./src/client/visualizations/scatterplot/utils/get-plotting-data.ts","webpack:///./src/client/visualizations/scatterplot/x-axis.tsx","webpack:///./src/client/visualizations/scatterplot/y-axis.tsx","webpack:///./src/client/visualizations/scatterplot/scatterplot.tsx"],"names":["selectMainDatum","dataset","data","selectSplitDataset","datum","SPLIT","selectDatums","selectSplitDatums","compose","selectFirstSplitDataset","selectFirstSplitDatums","BubbleTitle","title","minWidth","clamp","length","className","style","SeriesBubbleContent","props","series","showPrevious","Fragment","formatValue","currentValue","selectValue","previousValue","SeriesDerivation","PREVIOUS","formatter","lowerIsBetter","measure","current","previous","SegmentBubble","left","top","content","SegmentBubbleContent","direction","MeasureBubbleContent","GridLines","orientation","stage","ticks","scale","classNames","transform","getTransform","map","tick","value","roundToHalfPx","coordinates","x1","x2","width","y1","y2","height","lineCoordinates","key","String","calculatePosition","rect","initialTop","initialLeft","margin","stageBottom","y","stageRight","x","bottom","right","TooltipWithinStage","React","Component","createRef","componentDidMount","this","setState","self","getBoundingClientRect","render","children","state","ref","ColorLegend","colorScale","min","max","domain","isNaN","stripeLength","startColor","endColor","range","id","gradientTransform","offset","stopColor","fill","tickLength","tickLabelLeftOffset","Heatmap","xBinCount","yBinCount","xScale","yScale","xSeries","ySeries","xQuantile","d3","yQuantile","counts","Array","from","forEach","i","j","getCounts","countExtent","c","toString","row","count","Rectangle","fillColor","xRange","invertExtent","yRange","x0","y0","xPosition","yPosition","Point","setHover","resetHover","customization","visualizationColors","useSettingsContext","xValue","yValue","stroke","main","lightMain","cx","cy","r","onMouseEnter","onMouseLeave","Tooltip","split","timezone","isTruthy","preparePlottingData","essence","getConcreteSeries","toArray","scatterplotData","xExtent","getExtent","yExtent","plottingStage","ratio","Stage","fromJS","Y_AXIS_WIDTH","calculatePlottingStageBasedOnWidth","calculatePlottingStageBasedOnHeight","calculateRegularPlottingStage","calculatePlottingStage","nice","xTicks","yTicks","extent","rangeStart","rangeEnd","extendExtentIfNeeded","d","getTicksForAvailableSpace","size","filter","_","index","calculateXAxisStage","calculateYAxisStage","XAxis","tickSize","labelY","linePositionY","lines","labels","YAxis","linePositionX","labelX","Scatterplot","hoveredPoint","setHoveredPoint","useState","getPlottingData","memoizeOne","setPointHover","useCallback","resetPointHover","mainSplit","splits","first","showHeatmap","visualizationSettings","showSummary","xAxisLabelPosition","getXAxisLabelPosition","getWidthHeight","hasComparison","viewBox","getViewBox","ScatterplotVisualization","chartComponent"],"mappings":"0FAAA,+NAoBO,MAAMA,EAAmBC,GAC9BA,EAAQC,KAAK,GAEFC,EAAsBC,GACjCA,EAAMC,KAEKC,EAAgBL,GAC3BA,EAAQC,KAEGK,EACXC,YAAQL,EAAoBG,GAEjBG,EACXD,YAAQR,EAAiBG,GAEdO,EACXF,YAAQC,EAAyBH,I,iCCpCnC,6DAmBA,MAQaK,EAAyD,EAAGC,YACvE,MAAMC,EAAWC,YATO,EASDF,EAAMG,OARP,GACA,KAQtB,OAAO,yBAAKC,UAAU,QAAQC,MAAO,CAAEJ,aAAaD,K,iCC7BtD,uEA2BO,MAAMM,EAAyEC,IACpF,MAAM,OAAEC,EAAF,MAAUhB,EAAV,aAAiBiB,GAAiBF,EACxC,IAAKE,EACH,OAAO,kBAAC,IAAMC,SAAP,KACJF,EAAOG,YAAYnB,IAGxB,MAAMoB,EAAeJ,EAAOK,YAAYrB,GAClCsB,EAAgBN,EAAOK,YAAYrB,EAAOuB,IAAiBC,UAC3DC,EAAYT,EAAOS,YACzB,OAAO,kBAAC,IAAD,CACLC,cAAeV,EAAOW,QAAQD,cAC9BD,UAAWA,EACXG,QAASR,EACTS,SAAUP,M,mJCjBd,MAOaQ,EAA8Df,IACzE,MAAM,KAAEgB,EAAF,IAAQC,EAAR,MAAaxB,EAAb,QAAoByB,GAAYlB,EACtC,OAAO,kBAAC,IAAD,CAAYgB,KAAMA,EAAMC,IAAKA,GATrB,IAUb,yBAAKpB,UAAU,kBACb,kBAACsB,EAAD,CAAsB1B,MAAOA,EAAOyB,QAASA,IAC7C,kBAAC,IAAD,CAAQE,UAAU,UAUXD,EAA2E,EAAG1B,QAAOyB,aAChG,yBAAKrB,UAAU,uBACb,kBAAC,IAAD,CAAaJ,MAAOA,IACnByB,EAAU,yBAAKrB,UAAU,WAAWqB,GAAiB,O,gGCrBnD,MAAMG,EAA2E,EAAGV,gBAAeD,YAAWG,UAASC,eAC5H,MAAMT,EAAeK,EAAUG,GACzBN,EAAgBG,EAAUI,GAChC,OAAO,kBAAC,IAAMX,SAAP,KACL,4BAAQN,UAAU,iBAAiBQ,GACnC,0BAAMR,UAAU,kBAAkBU,GAClC,kBAAC,IAAD,CAAOG,UAAWA,EAAWL,aAAcQ,EAASN,cAAeO,EAAUH,cAAeA,O,8FCYzF,MAAMW,EAAqDtB,IAChE,MAAM,YAAEuB,EAAF,MAAeC,EAAf,MAAsBC,EAAtB,MAA6BC,GAAU1B,EAE7C,OAAO,uBAAGH,UAAW8B,YAAW,aAAcJ,GAAcK,UAAWJ,EAAMK,gBAC1EJ,EAAMK,IAAKC,IACV,MAAMC,EAAQC,YAAcP,EAAMK,IAC5BG,EAfZ,SAAyBX,EAAwCS,EAAeR,GAC9E,OAAQD,GACN,IAAK,aACH,MAAO,CAAEY,GAAI,EAAGC,GAAIZ,EAAMa,MAAOC,GAAIN,EAAOO,GAAIP,GAClD,IAAK,WACH,MAAO,CAAEG,GAAIH,EAAOI,GAAIJ,EAAOM,GAAI,EAAGC,GAAIf,EAAMgB,SAU5BC,CAAgBlB,EAAaS,EAAOR,GACxD,OAAO,wCAAMkB,IAAKC,OAAOZ,IAAWG,S,8FC9BnC,SAASU,EAAkB5C,EAAgC6C,GAChE,MAAQ5B,IAAK6B,EAAY9B,KAAM+B,EAAzB,MAAsCvB,EAAtC,OAA6CwB,EAAS,IAAOhD,EACnE,IAAK6C,EAAM,CAGT,MAAO,CAAE5B,IAFG6B,EAAaE,EAEXhC,KADD+B,EAAcC,GAI7B,MAAMC,EAAczB,EAAM0B,EAAI1B,EAAMgB,OAC9BW,EAAa3B,EAAM4B,EAAI5B,EAAMa,MAcnC,MAAO,CAAEpB,IAZG4B,EAAKQ,OAASJ,EACtBH,EAAaE,EAASH,EAAKL,OAC3BK,EAAK5B,IAAMO,EAAM0B,EACfJ,EAAaD,EAAKL,OAClBM,EAAaE,EAQLhC,KAND6B,EAAKS,MAAQH,EACtBJ,EAAcC,EAASH,EAAKR,MAC5BQ,EAAK7B,KAAOQ,EAAM4B,EAChBL,EAAcF,EAAKR,MACnBU,EAAcC,GCZf,MAAMO,UAA2BC,IAAMC,UAA4D,sDAEzFD,IAAME,aAFmF,yBAIvE,IAEjCC,oBACEC,KAAKC,SAAS,CACZhB,KAAMe,KAAKE,KAAKjD,QAAQkD,0BAI5BC,SACE,MAAM,SAAEC,GAAaL,KAAK5D,MAC1B,OAAO,yBACLH,UAAU,uBACVC,MAAO8C,EAAkBgB,KAAK5D,MAAO4D,KAAKM,MAAMrB,MAChDsB,IAAKP,KAAKE,MACTG,M,uFCrBP,MAUaG,EAAyD,EAAG3E,QAAO4C,QAF7D,IAEiFG,SAH/E,IAGsG9B,YAAW2D,iBACpI,MAAOC,EAAKC,GAAOF,EAAWG,SAC9B,GAAIC,MAAMH,IAAQG,MAAMF,GAAM,OAAO,KAErC,MAAMG,EAAelC,EAbL,GACG,GAaZmC,EAAYC,GAAYP,EAAWQ,QAE1C,OAAO,yBAAKhF,UAAU,gBACpB,yBAAKA,UAAU,uBACZJ,GAEH,yBAAKI,UAAU,uBACb,yBACEA,UAAU,eACVwC,MAAUA,EAAF,KACRG,OAAWA,EAAF,MACT,8BACE,oCAAgBsC,GAAG,eAAeC,kBAAkB,cAClD,0BAAMC,OAAO,KAAKC,UAAWL,IAC7B,0BAAMI,OAAO,MAAMC,UAAWL,IAC9B,0BAAMI,OAAO,MAAMC,UAAWN,IAC9B,0BAAMK,OAAO,OAAOC,UAAWN,MAGnC,uBAAG/C,UAAY,oBACb,0BAAM/B,UAAU,sBACduD,EAAG,EACHF,EAAG,EACHb,MAhCQ,GAiCRG,OAAQkC,EACRQ,KAAK,uBACP,0BAAMrF,UAAU,2BACdsC,GAAI,GACJC,GAAI,GACJE,GAAI,EACJC,GAAImC,IACN,uBAAG7E,UAAU,qBACX,0BAAMA,UAAU,yBACdsC,GAAI,EACJC,GAAI+C,GACJ7C,GAAI,GACJC,GAAI,KACN,0BAAM1C,UAAU,0BACduD,EAAGgC,GACHlC,EAnDa,GAoDZxC,EAAU6D,KAGf,uBAAG1E,UAAU,qBACX,0BAAMA,UAAU,yBACdsC,GAAI,EACJC,GAAI+C,GACJ7C,GAAIoC,EAAe,GACnBnC,GAAImC,EAAe,KACrB,0BAAM7E,UAAU,0BACduD,EAAGgC,GACHlC,EAAGwB,EA/DU,GAgEZhE,EAAU4D,W,6MC3DzB,MAGae,EAAiD,EAAGC,YAAWC,YAAWC,SAAQC,SAAQjE,QAAOzC,OAAM2G,UAASC,cAC3H,MAAMC,EAAYC,MAA2BrB,OAAOgB,EAAOhB,UAAUK,MAAMA,YAAM,EAAGS,IAC9EQ,EAAYD,MAA2BrB,OAAOiB,EAAOjB,UAAUK,MAAMA,YAAM,EAAGU,IAE9EQ,EAqCR,UAAmB,UAAET,EAAF,UAAaC,EAAb,QAAwBG,EAAxB,QAAiCC,EAAjC,UAA0CC,EAA1C,UAAqDE,EAArD,KAAgE/G,IACjF,MAAMgH,EAASC,MAAMC,KAAK,CAAErG,OAAQ0F,GAAa,IAAMU,MAAMC,KAAK,CAAErG,OAAQ2F,GAAa,IAAM,IAQ/F,OANAxG,EAAKmH,QAAQjH,IACX,MAAMkH,EAAIP,EAAUF,EAAQpF,YAAYrB,IAClCmH,EAAIN,EAAUH,EAAQrF,YAAYrB,IACxC8G,EAAOI,GAAGC,IAAM,IAGXL,EA9CQM,CAAU,CAAEf,YAAWC,YAAWxG,OAAM6G,YAAWF,UAASI,YAAWH,YAEhFW,EAAc,CAAC,EAAGT,IAAOE,EAAQQ,GAAKV,IAAOU,KAE7ClC,EAAawB,MAAyBrB,OAAO8B,GAAazB,MAAM,CAX9C,OACF,YAYtB,OAAO,kBAAC,IAAM1E,SAAP,KACL,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAaV,MAAM,wBAAwBiB,UAAWyF,GAAKA,EAAEK,SAAS,IAAKnC,WAAYA,KAEzF,uBAAGzC,UAAWJ,EAAMK,eAAgBhC,UAAU,WAC3CkG,EAAOjE,IAAI,CAAC2E,EAAKN,IAChBM,EAAI3E,IAAI,CAAC4E,EAAON,IACd,kBAACO,EAAD,CACEjE,IAAM,OAAMyD,KAAKC,IACjBZ,OAAQA,EACRC,OAAQA,EACRmB,UAAWvC,EAAWqC,GACtBG,OAAQjB,EAAUkB,aAAaX,GAC/BY,OAAQjB,EAAUgB,aAAaV,UAsC3C,MAAMO,EAAqD,EACzDE,SACAE,SACAvB,SACAC,SACAmB,gBAEA,MAAOI,EAAI7E,GAAM0E,GACVI,EAAI3E,GAAMyE,EACXG,EAAY1B,EAAOwB,GACnB3E,EAAQmD,EAAOrD,GAAM+E,EACrBC,EAAY1B,EAAOnD,GACnBE,EAASiD,EAAOwB,GAAME,EAE5B,OAAO,0BACLjC,KAAM0B,EACNxD,EAAG8D,EACH7E,MAAOA,EACPa,EAAGiE,EACH3E,OAAQA,K,sBCrFZ,MAGa4E,EAA6C,EAAGnI,QAAOuG,SAAQC,SAAQC,UAASC,UAAS0B,WAAUC,iBAC9G,MAAQC,eAAe,oBAAEC,IAA0BC,cAC7CC,EAAShC,EAAQpF,YAAYrB,GAC7B0I,EAAShC,EAAQrF,YAAYrB,GAE7B2I,EAASJ,EAAoBK,KAC7B3C,EAAO4C,YAAUN,GAEvB,OACE,oCACE,4BACEO,GAAIvC,EAAOkC,GACXM,GAAIvC,EAAOkC,GACXM,EAhBa,EAiBbpI,UAAU,QACV+H,OAAQA,EACR1C,KAAMA,IAER,4BACEgD,aAAc,IAAMb,EAASpI,GAC7BkJ,aAAc,IAAMb,IACpBS,GAAIvC,EAAOkC,GACXM,GAAIvC,EAAOkC,GACXM,EAzBkB,EA0BlBL,OAAO,OACP1C,KAAK,kB,sCCrBb,MAGakD,EAAiD,EAC5DnJ,QACAuC,QACAkE,UACAC,UACAH,SACAC,SACA4C,QACAC,WACApI,mBAEA,IAAKqI,YAAStJ,GAAQ,OAAO,KAE7B,MAAMiI,EAAY1B,EAAOE,EAAQpF,YAAYrB,IAftB,IAgBjBkI,EAAY1B,EAAOE,EAAQrF,YAAYrB,IAjBtB,GAmBvB,OAAO,kBAAC,IAAD,CAAoBgC,IAAKkG,EAAWnG,KAAMkG,EAAW1F,MAAOA,GACjE,kBAAC,IAAD,CACE/B,MAAO4I,EAAMjI,YAAYnB,EAAOqJ,GAChCpH,QAAS,oCACP,4BAAQrB,UAAU,gBAAgB6F,EAAQjG,SAC1C,6BACA,kBAAC,IAAD,CACER,MAAOA,EACPiB,aAAcA,EACdD,OAAQyF,IACV,6BACA,6BACA,4BAAQ7F,UAAU,gBAAgB8F,EAAQlG,SAAiB,6BAC3D,kBAAC,IAAD,CACER,MAAOA,EACPiB,aAAcA,EACdD,OAAQ0F,S,qBCnCX,SAAS6C,EAAoBzJ,EAAe0J,EAAkBjH,GACnE,MAAOkE,EAASC,GAAW8C,EAAQC,oBAAoBC,UACjDC,EAAkBrJ,YAAuBR,GACzC8J,EAAUC,EAAUF,EAAiBlD,GACrCqD,EAAUD,EAAUF,EAAiBjD,GAErCqD,EAuED,SAAgCxH,GACrC,MAAMyH,EAAQzH,EAAMa,MAAQb,EAAMgB,OAElC,OAAIyG,GAAS,EA9Bf,SAA4CzH,GAC1C,OAAO0H,IAAMC,OAAO,CAClB/F,EAAGgG,GACHlG,EAxEW,GAyEXb,MAAOb,EAAMa,MAvEI,GAuEmB,GACpCG,OAAQhB,EAAMa,MAzEI,GAyEoB,KAyBhBgH,CAAmC7H,GACvDyH,GAAS,EAtBf,SAA6CzH,GAC3C,OAAO0H,IAAMC,OAAO,CAClB/F,EAAGgG,GACHlG,EAjFW,GAkFXb,MAAOb,EAAMgB,OAhFI,GAgFoB,GACrCA,OAAQhB,EAAMgB,OAlFI,GAkFqB,KAiBjB8G,CAAoC9H,GAb9D,SAAuCA,GACrC,OAAO0H,IAAMC,OAAO,CAClB/F,EAAGgG,GACHlG,EA1FW,GA2FXb,MAAOb,EAAMa,MAzFI,GAyFmB,GACpCG,OAAQhB,EAAMgB,OA3FI,GA2FqB,KASlC+G,CAA8B/H,GA5EfgI,CAAuBhI,GACvCiE,EAASI,MAAiBrB,OAAOuE,GAASU,OAAO5E,MAAM,CAACmE,EAAcxG,OAAQ,IAC9EgD,EAASK,MAAiBrB,OAAOqE,GAASY,OAAO5E,MAAM,CAAC,EAAGmE,EAAc3G,QAEzEqH,EAASlE,EAAO/D,MAzBL,IA0BXkI,EAASlE,EAAOhE,MA1BL,IA4BjB,MAAO,CAAEiE,UAASC,UAASH,SAAQC,SAAQiE,SAAQC,SAAQX,gBAAeJ,mBAG5E,SAASE,EAAU/J,EAAekB,GAIhC,OAGK,SAA8B2J,GACnC,MAAOC,EAAYC,GAAYF,EAE/B,GAAIC,IAAeC,EACjB,OAAOF,EAKT,MAAO,CAFmBC,EA5CC,IA4CYA,EAChBC,EA7CI,IA6COA,GAX3BC,CAFSlE,IAAU9G,EADJiL,GAAa/J,EAAOK,YAAY0J,KAyBjD,SAASC,EAA0BxI,EAAiByI,GACzD,OAAIA,EA3DmB,IA4DdzI,EAGFA,EAAM0I,OAAO,CAACC,EAAGC,IAAUA,EAAQ,GAAM,GAsC3C,SAASC,EAAoB9I,GAClC,OAAO0H,IAAMC,OAAO,CAClB/F,EAAGgG,GACHlG,EAAG1B,EAAMgB,OA3GE,GA4GXH,MAAOb,EAAMa,MACbG,OA5GkB,KAgHf,SAAS+H,EAAoB/I,GAClC,OAAO0H,IAAMC,OAAO,CAClB/F,EAnHW,GAoHXF,EApHW,GAqHXb,MAnHiB,GAoHjBG,OAAQhB,EAAMgB,S,WCrHlB,MAUagI,EAA6C,EAAGhJ,QAAOC,QAAOC,QAAOhB,YAAW+J,eAC3F,MAAMC,EAASD,EAXK,GAYdE,EAAgB1I,YAAc,GAC9B2I,EAAQnJ,EAAMK,IAAKC,IACvB,MAAMqB,EAAInB,YAAcP,EAAMK,IAC9B,OAAO,0BAAMlC,UAAU,OAAO6C,IAAKC,OAAOZ,GAAOI,GAAIiB,EAAGd,GAAI,EAAGF,GAAIgB,EAAGb,GAAIkI,MAEtEI,EAASpJ,EAAMK,IAAKC,IACxB,MAAMqB,EAAI1B,EAAMK,GAChB,OAAO,0BAAMlC,UAAU,qBAAqB6C,IAAKC,OAAOZ,GAAOqB,EAAGA,EAAGF,EAAGwH,GAAShK,EAAUqB,MAG7F,OAAQ,uBAAGlC,UAAU,cAAc+B,UAAWJ,EAAMK,gBACjD+I,EACAC,EACD,0BAAMhL,UAAU,SAASyC,GAAIqI,EAAepI,GAAIoI,EAAexI,GAAI,EAAGC,GAAIZ,EAAMa,UCfvEyI,EAA6C,EAAGpK,YAAWc,QAAOiJ,WAAUhJ,QAAOC,YAC9F,MAAMqJ,EAAgB9I,YAAcT,EAAMa,OAEpCuI,EAAQnJ,EAAMK,IAAKC,IACvB,MAAMmB,EAAIjB,YAAcP,EAAMK,IAC9B,OAAO,0BAAMlC,UAAU,OAAO6C,IAAKC,OAAOZ,GAAOI,GAAIX,EAAMa,MAAQoI,EAAUnI,GAAIY,EAAGd,GAAIZ,EAAMa,MAAOE,GAAIW,MAGrG2H,EAASpJ,EAAMK,IAAKC,IACxB,MACMiJ,EADItJ,EAAMK,GAnBE,EAqBlB,OAAO,0BAAMlC,UAAU,QAAQ6C,IAAKC,OAAOZ,GAAOqB,EAAG,EAAGF,EAAG8H,GAAStK,EAAUqB,MAGhF,OAAO,uBAAGlC,UAAU,cAAc+B,UAAWJ,EAAMK,gBACjD,0BAAMhC,UAAU,SAASsC,GAAI4I,EAAezI,GAAI,EAAGF,GAAI2I,EAAexI,GAAIf,EAAMgB,SAC/EoI,EACAC,ICRQI,EAAmD,EAAGlM,OAAM0J,UAASjH,YAChF,MAAO0J,EAAcC,GAAmBC,mBAAuB,MAEzDC,EAAkBC,YAAW9C,GAE7B+C,EAAgBC,sBAAavM,GAAuBkM,EAAgBlM,GAAQ,CAACkM,IAE7EM,EAAkBD,sBAAY,IAAYL,EAAgB,MAAO,CAACA,IAElEO,EAAYjD,EAAQkD,OAAOA,OAAOC,QAClCC,EAAepD,EAAQqD,sBAA8CC,aAErE,OACJrC,EADI,OAEJC,EAFI,OAGJnE,EAHI,OAIJC,EAJI,QAKJC,EALI,QAMJC,EANI,cAOJqD,EAPI,gBAQJJ,GACEyC,EAAgBtM,EAAM0J,EAASjH,GAE7BwK,EHWD,SAA+BxK,EAAcwH,GAClD,MAAM1F,EAAQ9B,EAAMa,OAAS2G,EAAc3G,MAAQ2G,EAAc5F,GAGjE,MAAO,CAAEC,OAFM7B,EAAMgB,QAAUwG,EAAcxG,OAASwG,EAAc9F,EAlD1C,IAoDTI,SGfU2I,CAAsBzK,EAAOwH,GAExD,OAAO,yBAAKnJ,UAAU,wBAAwBC,MAAO0B,EAAM0K,kBACzD,0BAAMrM,UAAU,0BAA0BC,MAAO,CAAEmB,IAAK,GAAID,KAAM,KAAO2E,EAAQlG,SACjF,0BAAMI,UAAU,0BAA0BC,MAAO,CAAEuD,OAAQ2I,EAAmB3I,OAAQC,MAAO0I,EAAmB1I,QAAUoC,EAAQjG,SAClI,kBAAC2I,EAAD,CACEnJ,MAAOiM,EACP1J,MAAOwH,EACPrD,QAASA,EACTD,QAASA,EACTD,OAAQA,EACRD,OAAQA,EACR6C,MAAOqD,EACPpD,SAAUG,EAAQH,SAClBpI,aAAcuI,EAAQ0D,kBACxB,yBAAKC,QAAS5K,EAAM6K,cACjBR,GAAe,kBAACxG,EAAD,CACd7D,MAAOwH,EACPjK,KAAM6J,EACNtD,UAAWoE,EAAO9J,OAAS,EAC3B2F,UAAWoE,EAAO/J,OAAS,EAC3B4F,OAAQA,EACRE,QAASA,EACTD,OAAQA,EACRE,QAASA,IACX,kBAAC,IAAD,CAAWpE,YAAa,WAAYC,MAAOwH,EAAevH,MAAOiI,EAAQhI,MAAO8D,IAChF,kBAAC,IAAD,CAAWjE,YAAa,aAAcC,MAAOwH,EAAevH,MAAOkI,EAAQjI,MAAO+D,IAClF,kBAAC+E,EAAD,CACE9I,MAAO8D,EACPhE,MAAO8I,EAAoBtB,GAC3BvH,MAAOwI,EAA0BP,EAAQV,EAAc3G,OACvD3B,UAAWgF,EAAQhF,YACnB+J,SA3DU,KA4DZ,kBAACK,EAAD,CACEtJ,MAAO+I,EAAoBvB,GAC3BvH,MAAOwI,EAA0BN,EAAQX,EAAcxG,QACvDiI,SA/DU,GAgEV/I,MAAO+D,EACP/E,UAAWiF,EAAQjF,cACrB,uBAAGkB,UAAWoH,EAAcnH,gBACzB+G,EAAgB9G,IAAI7C,GAEjB,kBAACmI,EAAD,CACE1E,IAAM,SAAQgJ,EAAUpL,YAAYrB,GACpCA,MAAOA,EACPuG,OAAQA,EACRC,OAAQA,EACRC,QAASA,EACTC,QAASA,EACT0B,SAAUkE,EACVjE,WAAYmE,SAQX,SAASa,EAAyBtM,GAC/C,OAAO,kBAAC,IAAMG,SAAP,KACL,kBAAC,IAAiCH,GAClC,kBAAC,IAAD,iBAAgBA,EAAhB,CAAuBuM,eAAgBtB","file":"scatterplot.9c0962a35e7a88828f65.js","sourcesContent":["/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { compose } from \"../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const selectMainDatum = (dataset: Dataset): Datum =>\n  dataset.data[0];\n\nexport const selectSplitDataset = (datum: Datum): Dataset =>\n  datum[SPLIT] as Dataset;\n\nexport const selectDatums = (dataset: Dataset): Datum[] =>\n  dataset.data;\n\nexport const selectSplitDatums: (datum: Datum) => Datum[] =\n  compose(selectSplitDataset, selectDatums);\n\nexport const selectFirstSplitDataset: (dataset: Dataset) => Dataset =\n  compose(selectMainDatum, selectSplitDataset);\n\nexport const selectFirstSplitDatums: (dataset: Dataset) => Datum[] =\n  compose(selectFirstSplitDataset, selectDatums);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { clamp } from \"../../utils/dom/dom\";\n\nconst PER_LETTER_PIXELS = 8;\nconst MIN_TITLE_WIDTH = 80;\nconst MAX_TITLE_WIDTH = 300;\n\ninterface BubbleTitleProps {\n  title: string;\n}\n\nexport const BubbleTitle: React.FunctionComponent<BubbleTitleProps> = ({ title }) => {\n  const minWidth = clamp(title.length * PER_LETTER_PIXELS, MIN_TITLE_WIDTH, MAX_TITLE_WIDTH);\n  return <div className=\"title\" style={{ minWidth }}>{title}</div>;\n};\n","/*\n * Copyright 2017-2020 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { MeasureBubbleContent } from \"../measure-bubble-content/measure-bubble-content\";\n\ninterface SeriesBubbleContentProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nexport const SeriesBubbleContent: React.FunctionComponent<SeriesBubbleContentProps> = props => {\n  const { series, datum, showPrevious } = props;\n  if (!showPrevious) {\n    return <React.Fragment>\n      {series.formatValue(datum)}\n    </React.Fragment>;\n  }\n  const currentValue = series.selectValue(datum);\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <MeasureBubbleContent\n    lowerIsBetter={series.measure.lowerIsBetter}\n    formatter={formatter}\n    current={currentValue}\n    previous={previousValue}\n  />;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ReactNode } from \"react\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./segment-bubble.scss\";\n\nconst OFFSET_V = -10;\n\nexport interface SegmentBubbleProps extends SegmentBubbleContentProps {\n  left: number;\n  top: number;\n}\n\nexport const SegmentBubble: React.FunctionComponent<SegmentBubbleProps> = (props: SegmentBubbleProps) => {\n  const { left, top, title, content } = props;\n  return <BodyPortal left={left} top={top + OFFSET_V}>\n    <div className=\"segment-bubble\">\n      <SegmentBubbleContent title={title} content={content} />\n      <Shpitz direction=\"up\" />\n    </div>\n  </BodyPortal>;\n};\n\nexport interface SegmentBubbleContentProps {\n  title: string;\n  content?: ReactNode;\n}\n\nexport const SegmentBubbleContent: React.FunctionComponent<SegmentBubbleContentProps> = ({ title, content }: SegmentBubbleContentProps) => (\n  <div className=\"segment-bubble-text\">\n    <BubbleTitle title={title} />\n    {content ? <div className=\"content\">{content}</div> : null}\n  </div>\n);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Delta } from \"../delta/delta\";\nimport \"./measure-bubble-content.scss\";\n\nexport interface MeasureBubbleContentProps {\n  current: number;\n  previous: number;\n  formatter: Unary<number, string>;\n  lowerIsBetter?: boolean;\n}\n\nexport const MeasureBubbleContent: React.FunctionComponent<MeasureBubbleContentProps> = ({ lowerIsBetter, formatter, current, previous }) => {\n  const currentValue = formatter(current);\n  const previousValue = formatter(previous);\n  return <React.Fragment>\n    <strong className=\"current-value\">{currentValue}</strong>\n    <span className=\"previous-value\">{previousValue}</span>\n    <Delta formatter={formatter} currentValue={current} previousValue={previous} lowerIsBetter={lowerIsBetter} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { classNames, roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./grid-lines.scss\";\n\nexport interface GridLinesProps {\n  orientation: \"horizontal\" | \"vertical\";\n  stage: Stage;\n  ticks: unknown[];\n  scale: Unary<unknown, number>;\n}\n\ninterface Coordinates {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nfunction lineCoordinates(orientation: \"horizontal\" | \"vertical\", value: number, stage: Stage): Coordinates {\n  switch (orientation) {\n    case \"horizontal\":\n      return { x1: 0, x2: stage.width, y1: value, y2: value };\n    case \"vertical\":\n      return { x1: value, x2: value, y1: 0, y2: stage.height };\n  }\n}\n\nexport const GridLines: React.FunctionComponent<GridLinesProps> = props => {\n  const { orientation, stage, ticks, scale } = props;\n\n  return <g className={classNames(\"grid-lines\", orientation)} transform={stage.getTransform()}>\n    {ticks.map((tick: unknown) => {\n      const value = roundToHalfPx(scale(tick));\n      const coordinates = lineCoordinates(orientation, value, stage);\n      return <line key={String(tick)} {...coordinates} />;\n    })}\n  </g>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { TooltipWithinStageProps } from \"./tooltip-within-stage\";\n\nexport type Rect = ClientRect | DOMRect;\n\nexport type Position = Pick<React.CSSProperties, \"left\" | \"top\">;\n\nexport function calculatePosition(props: TooltipWithinStageProps, rect?: Rect): Position {\n  const { top: initialTop, left: initialLeft, stage, margin = 10 } = props;\n  if (!rect) {\n    const top = initialTop + margin;\n    const left = initialLeft + margin;\n    return { top, left };\n  }\n\n  const stageBottom = stage.y + stage.height;\n  const stageRight = stage.x + stage.width;\n\n  const top = rect.bottom > stageBottom\n    ? initialTop - margin - rect.height\n    : rect.top < stage.y\n      ? initialTop + rect.height\n      : initialTop + margin;\n\n  const left = rect.right > stageRight\n    ? initialLeft - margin - rect.width\n    : rect.left < stage.x\n      ? initialLeft + rect.width\n      : initialLeft + margin;\n\n  return { top, left };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { calculatePosition, Rect } from \"./calculate-position\";\nimport \"./tooltip-within-stage.scss\";\n\nexport interface TooltipWithinStageProps {\n  stage: Stage;\n  top: number;\n  left: number;\n  margin?: number;\n}\n\ninterface TooltipWithinStageState {\n  rect?: Rect;\n}\n\nexport class TooltipWithinStage extends React.Component<TooltipWithinStageProps, TooltipWithinStageState> {\n\n  private self = React.createRef<HTMLDivElement>();\n\n  state: TooltipWithinStageState = {};\n\n  componentDidMount() {\n    this.setState({\n      rect: this.self.current.getBoundingClientRect()\n    });\n  }\n\n  render() {\n    const { children } = this.props;\n    return <div\n      className=\"tooltip-within-stage\"\n      style={calculatePosition(this.props, this.state.rect)}\n      ref={this.self}>\n      {children}\n    </div>;\n  }\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport \"./color-legend.scss\";\n\ninterface ColorLegendProps {\n  width?: number;\n  height?: number;\n  title: string;\n  formatter: Unary<number, string>;\n  colorScale: d3.ScaleLinear<string, string>;\n}\n\nconst leftMargin = 5;\nconst topMargin = 10;\nconst bottomMargin = 5;\nconst tickLabelTopOffset = 4;\nconst tickLabelLeftOffset = 7;\nconst tickLength = 5;\nconst stripeWidth = 30;\nconst stripeHeight = 200;\nconst panelWidth = 100;\n\nexport const ColorLegend: React.FunctionComponent<ColorLegendProps> = ({ title, width = panelWidth, height = stripeHeight, formatter, colorScale }) => {\n  const [min, max] = colorScale.domain();\n  if (isNaN(min) || isNaN(max)) return null;\n\n  const stripeLength = height - topMargin - bottomMargin;\n  const [startColor, endColor] = colorScale.range();\n\n  return <div className=\"color-legend\">\n    <div className=\"color-legend-header\">\n      {title}\n    </div>\n    <div className=\"color-legend-stripe\">\n      <svg\n        className=\"color-legend\"\n        width={`${width}px`}\n        height={`${height}px`}>\n        <defs>\n          <linearGradient id=\"color-stripe\" gradientTransform=\"rotate(90)\">\n            <stop offset=\"0%\" stopColor={endColor}/>\n            <stop offset=\"10%\" stopColor={endColor}/>\n            <stop offset=\"90%\" stopColor={startColor}/>\n            <stop offset=\"100%\" stopColor={startColor}/>\n          </linearGradient>\n        </defs>\n        <g transform={`translate(${leftMargin}, ${topMargin})`}>\n          <rect className=\"color-legend-stripe\"\n            x={0}\n            y={0}\n            width={stripeWidth}\n            height={stripeLength}\n            fill=\"url(#color-stripe)\"/>\n          <line className=\"color-legend-stripe-axis\"\n            x1={0.5}\n            x2={0.5}\n            y1={0}\n            y2={stripeLength}/>\n          <g className=\"color-upper-bound\">\n            <line className=\"color-upper-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={0.5}\n              y2={0.5}/>\n            <text className=\"color-upper-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={tickLabelTopOffset}>\n              {formatter(max)}\n            </text>\n          </g>\n          <g className=\"color-lower-bound\">\n            <line className=\"color-lower-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={stripeLength + 0.5}\n              y2={stripeLength + 0.5}/>\n            <text className=\"color-lower-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={stripeLength + tickLabelTopOffset}>\n              {formatter(min)}\n            </text>\n          </g>\n        </g>\n      </svg>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { range } from \"../../../common/utils/functional/functional\";\nimport { ColorLegend } from \"../../components/color-legend/color-legend\";\nimport { LegendSpot } from \"../../components/pinboard-panel/pinboard-panel\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\ninterface HeatmapProps {\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xBinCount: number;\n  yBinCount: number;\n  data: Datum[];\n  stage: Stage;\n}\n\nconst COLOR_SCALE_START = \"#fff\";\nconst COLOR_SCALE_END = \"#90b5d0\";\n\nexport const Heatmap: React.FunctionComponent<HeatmapProps> = ({ xBinCount, yBinCount, xScale, yScale, stage, data, xSeries, ySeries }) => {\n  const xQuantile = d3.scaleQuantile<number>().domain(xScale.domain()).range(range(0, xBinCount));\n  const yQuantile = d3.scaleQuantile<number>().domain(yScale.domain()).range(range(0, yBinCount));\n\n  const counts = getCounts({ xBinCount, yBinCount, data, xQuantile, xSeries, yQuantile, ySeries });\n\n  const countExtent = [0, d3.max(counts, c => d3.max(c))];\n\n  const colorScale = d3.scaleLinear<string>().domain(countExtent).range([COLOR_SCALE_START, COLOR_SCALE_END]);\n\n  return <React.Fragment>\n    <LegendSpot>\n      <ColorLegend title=\"Count per summary bin\" formatter={i => i.toString(10)} colorScale={colorScale} />\n    </LegendSpot>\n    <g transform={stage.getTransform()} className=\"heatmap\">\n      {counts.map((row, i) =>\n        row.map((count, j) => (\n          <Rectangle\n            key={`key-${i}-${j}`}\n            xScale={xScale}\n            yScale={yScale}\n            fillColor={colorScale(count)}\n            xRange={xQuantile.invertExtent(i)}\n            yRange={yQuantile.invertExtent(j)} />\n        )))}\n    </g>\n  </React.Fragment>;\n};\n\ninterface GetCounts {\n  xBinCount: number;\n  yBinCount: number;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xQuantile: d3.ScaleQuantile<number>;\n  yQuantile: d3.ScaleQuantile<number>;\n  data: Datum[];\n}\n\ntype Counts = number[][];\n\nfunction getCounts({ xBinCount, yBinCount, xSeries, ySeries, xQuantile, yQuantile, data }: GetCounts): Counts {\n  const counts = Array.from({ length: xBinCount }, () => Array.from({ length: yBinCount }, () => 0));\n\n  data.forEach(datum => {\n    const i = xQuantile(xSeries.selectValue(datum));\n    const j = yQuantile(ySeries.selectValue(datum));\n    counts[i][j] += 1;\n  });\n\n  return counts;\n}\n\ninterface RectangleProps {\n  xRange: [number, number];\n  yRange: [number, number];\n  xScale: LinearScale;\n  yScale: LinearScale;\n  fillColor: string;\n}\n\nconst Rectangle: React.FunctionComponent<RectangleProps> = ({\n  xRange,\n  yRange,\n  xScale,\n  yScale,\n  fillColor\n}) => {\n  const [x0, x1] = xRange;\n  const [y0, y1] = yRange;\n  const xPosition = xScale(x0);\n  const width = xScale(x1) - xPosition;\n  const yPosition = yScale(y1);\n  const height = yScale(y0) - yPosition;\n\n  return <rect\n    fill={fillColor}\n    x={xPosition}\n    width={width}\n    y={yPosition}\n    height={height} />;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport \"./scatterplot.scss\";\n\nimport { lightMain } from \"../../../common/models/colors/colors\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { useSettingsContext } from \"../../views/cube-view/settings-context\";\n\ninterface PointProps {\n  datum: Datum;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  setHover(datum: Datum): void;\n  resetHover(): void;\n}\n\nconst POINT_RADIUS = 3;\nconst HOVER_AREA_RADIUS = 6;\n\nexport const Point: React.FunctionComponent<PointProps> = ({ datum, xScale, yScale, xSeries, ySeries, setHover, resetHover }) => {\n  const { customization: { visualizationColors } } = useSettingsContext();\n  const xValue = xSeries.selectValue(datum);\n  const yValue = ySeries.selectValue(datum);\n\n  const stroke = visualizationColors.main;\n  const fill = lightMain(visualizationColors);\n\n  return (\n    <>\n      <circle\n        cx={xScale(xValue)}\n        cy={yScale(yValue)}\n        r={POINT_RADIUS}\n        className=\"point\"\n        stroke={stroke}\n        fill={fill}\n      />\n      <circle\n        onMouseEnter={() => setHover(datum)}\n        onMouseLeave={() => resetHover()}\n        cx={xScale(xValue)}\n        cy={yScale(yValue)}\n        r={HOVER_AREA_RADIUS}\n        stroke=\"none\"\n        fill=\"transparent\"\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport \"./scatterplot.scss\";\n\nimport { Timezone } from \"chronoshift\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { isTruthy } from \"../../../common/utils/general/general\";\nimport { SegmentBubbleContent } from \"../../components/segment-bubble/segment-bubble\";\nimport { SeriesBubbleContent } from \"../../components/series-bubble-content/series-bubble-content\";\nimport { TooltipWithinStage } from \"../../components/tooltip-within-stage/tooltip-within-stage\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\ninterface TooltipProps {\n  split: Split;\n  datum: Datum;\n  stage: Stage;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  timezone: Timezone;\n  showPrevious: boolean;\n}\n\nconst TOOLTIP_OFFSET_Y = 50;\nconst TOOLTIP_OFFSET_X = 100;\n\nexport const Tooltip: React.FunctionComponent<TooltipProps> = ({\n  datum,\n  stage,\n  xSeries,\n  ySeries,\n  xScale,\n  yScale,\n  split,\n  timezone,\n  showPrevious\n}) => {\n  if (!isTruthy(datum)) return null;\n\n  const xPosition = xScale(xSeries.selectValue(datum)) + TOOLTIP_OFFSET_X;\n  const yPosition = yScale(ySeries.selectValue(datum)) + TOOLTIP_OFFSET_Y;\n\n  return <TooltipWithinStage top={yPosition} left={xPosition} stage={stage}>\n    <SegmentBubbleContent\n      title={split.formatValue(datum, timezone)}\n      content={<>\n        <strong className=\"series-title\">{xSeries.title()}</strong>\n        <br/>\n        <SeriesBubbleContent\n          datum={datum}\n          showPrevious={showPrevious}\n          series={xSeries} />\n        <br/>\n        <br/>\n        <strong className=\"series-title\">{ySeries.title()}</strong><br/>\n        <SeriesBubbleContent\n          datum={datum}\n          showPrevious={showPrevious}\n          series={ySeries} />\n      </>} />\n  </TooltipWithinStage>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as d3 from \"d3\";\nimport { Dataset, Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { ConcreteSeries } from \"../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../common/models/stage/stage\";\nimport { selectFirstSplitDatums } from \"../../../utils/dataset/selectors/selectors\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\n\nconst MARGIN = 40;\nconst X_AXIS_HEIGHT = 50;\nconst Y_AXIS_WIDTH = 50;\nconst BREAKPOINT_SMALL = 768;\nconst TICK_COUNT = 10;\nconst EXTENT_EXTEND_FACTOR = 0.05;\nconst X_AXIS_LABEL_OFFSET = 55;\n\ninterface PlottingData {\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xTicks: number[];\n  yTicks: number[];\n  plottingStage: Stage;\n  scatterplotData: Datum[];\n}\n\nexport function preparePlottingData(data: Dataset, essence: Essence, stage: Stage): PlottingData {\n  const [xSeries, ySeries] = essence.getConcreteSeries().toArray();\n  const scatterplotData = selectFirstSplitDatums(data);\n  const xExtent = getExtent(scatterplotData, xSeries);\n  const yExtent = getExtent(scatterplotData, ySeries);\n\n  const plottingStage = calculatePlottingStage(stage);\n  const yScale = d3.scaleLinear().domain(yExtent).nice().range([plottingStage.height, 0]);\n  const xScale = d3.scaleLinear().domain(xExtent).nice().range([0, plottingStage.width]);\n\n  const xTicks = xScale.ticks(TICK_COUNT);\n  const yTicks = yScale.ticks(TICK_COUNT);\n\n  return { xSeries, ySeries, xScale, yScale, xTicks, yTicks, plottingStage, scatterplotData };\n}\n\nfunction getExtent(data: Datum[], series: ConcreteSeries): number[] {\n  const selectValues = (d: Datum) => series.selectValue(d);\n  const extent =  d3.extent(data, selectValues);\n\n  return extendExtentIfNeeded(extent);\n}\n\nexport function extendExtentIfNeeded(extent: number[]): number[] {\n  const [rangeStart, rangeEnd] = extent;\n\n  if (rangeStart !== rangeEnd) {\n    return extent;\n  }\n\n  const loweredRangeStart = rangeStart - rangeStart * EXTENT_EXTEND_FACTOR;\n  const raisedRangeEnd = rangeEnd + rangeEnd * EXTENT_EXTEND_FACTOR;\n  return [loweredRangeStart, raisedRangeEnd];\n}\n\nexport function getXAxisLabelPosition(stage: Stage, plottingStage: Stage): {bottom: number, right: number} {\n  const right = stage.width - (plottingStage.width + plottingStage.x);\n  const bottom = stage.height - (plottingStage.height + plottingStage.y - X_AXIS_LABEL_OFFSET);\n\n  return { bottom, right };\n}\n\nexport function getTicksForAvailableSpace(ticks: number[], size: number): number[] {\n  if (size > BREAKPOINT_SMALL) {\n    return ticks;\n  }\n\n  return ticks.filter((_, index) => index % 2 === 0);\n}\n\nfunction calculatePlottingStageBasedOnWidth(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.width - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.width - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nfunction calculatePlottingStageBasedOnHeight(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.height - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.height - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nfunction calculateRegularPlottingStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.width - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.height - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nexport function calculatePlottingStage(stage: Stage): Stage {\n  const ratio = stage.width / stage.height;\n\n  if (ratio <= 1 ) return calculatePlottingStageBasedOnWidth(stage);\n  if (ratio >= 2 ) return calculatePlottingStageBasedOnHeight(stage);\n  return calculateRegularPlottingStage(stage);\n}\n\nexport function calculateXAxisStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: stage.height + MARGIN,\n    width: stage.width,\n    height: X_AXIS_HEIGHT\n  });\n}\n\nexport function calculateYAxisStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: MARGIN,\n    y: MARGIN,\n    width: Y_AXIS_WIDTH,\n    height: stage.height\n  });\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport \"./scatterplot.scss\";\n\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\nconst TEXT_OFFSET_X = 16;\n\ninterface XAxisProps {\n  stage: Stage;\n  ticks: number[];\n  tickSize: number;\n  scale: LinearScale;\n  formatter: Unary<number, string>;\n}\n\nexport const XAxis: React.FunctionComponent<XAxisProps> = ({ stage, ticks, scale, formatter, tickSize }) => {\n  const labelY = tickSize + TEXT_OFFSET_X;\n  const linePositionY = roundToHalfPx(0);\n  const lines = ticks.map((tick: number) => {\n    const x = roundToHalfPx(scale(tick));\n    return <line className=\"tick\" key={String(tick)} x1={x} y1={0} x2={x} y2={tickSize} />;\n  });\n  const labels = ticks.map((tick: number) => {\n    const x = scale(tick);\n    return <text className=\"label axis-label-x\" key={String(tick)} x={x} y={labelY}>{formatter(tick)}</text>;\n  });\n\n  return (<g className=\"axis axis-x\" transform={stage.getTransform()}>\n    {lines}\n    {labels}\n    <line className=\"border\" y1={linePositionY} y2={linePositionY} x1={0} x2={stage.width}/>\n  </g>);\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport \"./scatterplot.scss\";\n\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\nconst TEXT_OFFSET_Y = 4;\n\ninterface YAxisProps {\n  stage: Stage;\n  ticks: number[];\n  tickSize: number;\n  scale: LinearScale;\n  formatter: Unary<number, string>;\n}\n\nexport const YAxis: React.FunctionComponent<YAxisProps> = ({ formatter, stage, tickSize, ticks, scale }) => {\n  const linePositionX = roundToHalfPx(stage.width);\n\n  const lines = ticks.map((tick: number) => {\n    const y = roundToHalfPx(scale(tick));\n    return <line className=\"tick\" key={String(tick)} x1={stage.width - tickSize} y1={y} x2={stage.width} y2={y} />;\n  });\n\n  const labels = ticks.map((tick: number) => {\n    const y = scale(tick);\n    const labelX = y + TEXT_OFFSET_Y;\n    return <text className=\"label\" key={String(tick)} x={0} y={labelX}>{formatter(tick)}</text>;\n  });\n\n  return <g className=\"axis axis-y\" transform={stage.getTransform()}>\n    <line className=\"border\" x1={linePositionX} y1={0} x2={linePositionX} y2={stage.height} />\n    {lines}\n    {labels}\n  </g>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport memoizeOne from \"memoize-one\";\nimport { Datum } from \"plywood\";\nimport React, { useCallback, useState } from \"react\";\nimport { ChartProps } from \"../../../common/models/chart-props/chart-props\";\nimport { ScatterplotSettings } from \"../../../common/visualization-manifests/scatterplot/settings\";\nimport { GridLines } from \"../../components/grid-lines/grid-lines\";\nimport {\n  ChartPanel,\n  DefaultVisualizationControls,\n  VisualizationProps\n} from \"../../views/cube-view/center-panel/center-panel\";\nimport { Heatmap } from \"./heatmap\";\nimport { Point } from \"./point\";\nimport \"./scatterplot.scss\";\nimport { Tooltip } from \"./tooltip\";\nimport {\n  calculateXAxisStage,\n  calculateYAxisStage,\n  getTicksForAvailableSpace, getXAxisLabelPosition,\n  preparePlottingData\n} from \"./utils/get-plotting-data\";\nimport { XAxis } from \"./x-axis\";\nimport { YAxis } from \"./y-axis\";\n\nconst TICK_SIZE = 10;\n\ntype HoveredPoint = Datum | null;\n\nexport const Scatterplot: React.FunctionComponent<ChartProps> = ({ data, essence, stage }) => {\n  const [hoveredPoint, setHoveredPoint] = useState<HoveredPoint>(null);\n\n  const getPlottingData = memoizeOne(preparePlottingData);\n\n  const setPointHover = useCallback((datum: Datum): void => setHoveredPoint(datum), [setHoveredPoint]);\n\n  const resetPointHover = useCallback((): void => setHoveredPoint(null), [setHoveredPoint]);\n\n  const mainSplit = essence.splits.splits.first();\n  const showHeatmap = (essence.visualizationSettings as ScatterplotSettings).showSummary;\n\n  const {\n    xTicks,\n    yTicks,\n    xScale,\n    yScale,\n    xSeries,\n    ySeries,\n    plottingStage,\n    scatterplotData\n  } = getPlottingData(data, essence, stage);\n\n  const xAxisLabelPosition = getXAxisLabelPosition(stage, plottingStage);\n\n  return <div className=\"scatterplot-container\" style={stage.getWidthHeight()}>\n    <span className=\"axis-title axis-title-y\" style={{ top: 10, left: 10 }}>{ySeries.title()}</span>\n    <span className=\"axis-title axis-title-x\" style={{ bottom: xAxisLabelPosition.bottom, right: xAxisLabelPosition.right }}>{xSeries.title()}</span>\n    <Tooltip\n      datum={hoveredPoint}\n      stage={plottingStage}\n      ySeries={ySeries}\n      xSeries={xSeries}\n      yScale={yScale}\n      xScale={xScale}\n      split={mainSplit}\n      timezone={essence.timezone}\n      showPrevious={essence.hasComparison()}/>\n    <svg viewBox={stage.getViewBox()}>\n      {showHeatmap && <Heatmap\n        stage={plottingStage}\n        data={scatterplotData}\n        xBinCount={xTicks.length - 1}\n        yBinCount={yTicks.length - 1}\n        xScale={xScale}\n        xSeries={xSeries}\n        yScale={yScale}\n        ySeries={ySeries}/>}\n      <GridLines orientation={\"vertical\"} stage={plottingStage} ticks={xTicks} scale={xScale}/>\n      <GridLines orientation={\"horizontal\"} stage={plottingStage} ticks={yTicks} scale={yScale}/>\n      <XAxis\n        scale={xScale}\n        stage={calculateXAxisStage(plottingStage)}\n        ticks={getTicksForAvailableSpace(xTicks, plottingStage.width)}\n        formatter={xSeries.formatter()}\n        tickSize={TICK_SIZE}/>\n      <YAxis\n        stage={calculateYAxisStage(plottingStage)}\n        ticks={getTicksForAvailableSpace(yTicks, plottingStage.height)}\n        tickSize={TICK_SIZE}\n        scale={yScale}\n        formatter={ySeries.formatter()}/>\n      <g transform={plottingStage.getTransform()}>\n        {scatterplotData.map(datum => {\n          return (\n            <Point\n              key={`point-${mainSplit.selectValue(datum)}`}\n              datum={datum}\n              xScale={xScale}\n              yScale={yScale}\n              xSeries={xSeries}\n              ySeries={ySeries}\n              setHover={setPointHover}\n              resetHover={resetPointHover}/>\n          );\n        })}\n      </g>\n    </svg>\n  </div>;\n};\n\nexport default function ScatterplotVisualization(props: VisualizationProps) {\n  return <React.Fragment>\n    <DefaultVisualizationControls {...props} />\n    <ChartPanel {...props} chartComponent={Scatterplot}/>\n  </React.Fragment>;\n}\n"],"sourceRoot":""}