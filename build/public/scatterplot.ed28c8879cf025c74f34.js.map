{"version":3,"sources":["webpack:///./src/client/utils/dataset/selectors/selectors.ts","webpack:///./src/client/components/bubble-title/bubble-title.tsx","webpack:///./src/client/components/series-bubble-content/series-bubble-content.tsx","webpack:///./src/client/components/segment-bubble/segment-bubble.tsx","webpack:///./src/client/components/measure-bubble-content/measure-bubble-content.tsx","webpack:///./src/client/components/grid-lines/grid-lines.tsx","webpack:///./src/client/components/tooltip-within-stage/calculate-position.ts","webpack:///./src/client/components/tooltip-within-stage/tooltip-within-stage.tsx","webpack:///./src/client/components/color-legend/color-legend.tsx","webpack:///./src/client/visualizations/scatterplot/heatmap.tsx","webpack:///./src/client/visualizations/scatterplot/point.tsx","webpack:///./src/client/visualizations/scatterplot/tooltip.tsx","webpack:///./src/client/visualizations/scatterplot/utils/get-plotting-data.ts","webpack:///./src/client/visualizations/scatterplot/x-axis.tsx","webpack:///./src/client/visualizations/scatterplot/y-axis.tsx","webpack:///./src/client/visualizations/scatterplot/scatterplot.tsx"],"names":["selectMainDatum","dataset","data","selectSplitDataset","datum","SPLIT","selectDatums","selectSplitDatums","compose","selectFirstSplitDataset","selectFirstSplitDatums","BubbleTitle","title","minWidth","clamp","length","className","style","SeriesBubbleContent","props","series","showPrevious","Fragment","formatValue","currentValue","selectValue","previousValue","SeriesDerivation","PREVIOUS","formatter","lowerIsBetter","measure","current","previous","SegmentBubble","left","top","content","direction","SegmentBubbleContent","MeasureBubbleContent","GridLines","orientation","stage","ticks","scale","classNames","transform","getTransform","map","tick","value","roundToHalfPx","coordinates","x1","x2","width","y1","y2","height","lineCoordinates","key","String","calculatePosition","rect","initialTop","initialLeft","margin","stageBottom","y","stageRight","x","bottom","right","TooltipWithinStage","React","createRef","this","setState","self","getBoundingClientRect","children","state","ref","Component","ColorLegend","colorScale","domain","min","max","isNaN","stripeLength","range","startColor","endColor","id","gradientTransform","offset","stopColor","fill","tickLength","tickLabelLeftOffset","Heatmap","xBinCount","yBinCount","xScale","yScale","xSeries","ySeries","xQuantile","d3","yQuantile","counts","Array","from","forEach","i","j","getCounts","countExtent","c","toString","row","count","fillColor","xRange","invertExtent","yRange","Rectangle","x0","y0","xPosition","yPosition","Point","setHover","resetHover","visualizationColors","useSettingsContext","customization","xValue","yValue","stroke","main","lightMain","cx","cy","r","onMouseEnter","onMouseLeave","Tooltip","split","timezone","isTruthy","preparePlottingData","essence","getConcreteSeries","toArray","scatterplotData","xExtent","getExtent","yExtent","plottingStage","ratio","Stage","fromJS","Y_AXIS_WIDTH","calculatePlottingStageBasedOnWidth","calculatePlottingStageBasedOnHeight","calculateRegularPlottingStage","calculatePlottingStage","nice","xTicks","yTicks","extent","rangeStart","rangeEnd","extendExtentIfNeeded","d","getTicksForAvailableSpace","size","filter","_","index","calculateXAxisStage","calculateYAxisStage","XAxis","tickSize","labelY","linePositionY","lines","labels","YAxis","linePositionX","labelX","Scatterplot","useState","hoveredPoint","setHoveredPoint","getPlottingData","memoizeOne","setPointHover","useCallback","resetPointHover","mainSplit","splits","first","showHeatmap","visualizationSettings","showSummary","xAxisLabelPosition","getXAxisLabelPosition","getWidthHeight","hasComparison","viewBox","getViewBox","ScatterplotVisualization","chartComponent"],"mappings":"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","file":"scatterplot.ed28c8879cf025c74f34.js","sourcesContent":["/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dataset, Datum } from \"plywood\";\nimport { compose } from \"../../../../common/utils/functional/functional\";\nimport { SPLIT } from \"../../../config/constants\";\n\nexport const selectMainDatum = (dataset: Dataset): Datum =>\n  dataset.data[0];\n\nexport const selectSplitDataset = (datum: Datum): Dataset =>\n  datum[SPLIT] as Dataset;\n\nexport const selectDatums = (dataset: Dataset): Datum[] =>\n  dataset.data;\n\nexport const selectSplitDatums: (datum: Datum) => Datum[] =\n  compose(selectSplitDataset, selectDatums);\n\nexport const selectFirstSplitDataset: (dataset: Dataset) => Dataset =\n  compose(selectMainDatum, selectSplitDataset);\n\nexport const selectFirstSplitDatums: (dataset: Dataset) => Datum[] =\n  compose(selectFirstSplitDataset, selectDatums);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { clamp } from \"../../utils/dom/dom\";\n\nconst PER_LETTER_PIXELS = 8;\nconst MIN_TITLE_WIDTH = 80;\nconst MAX_TITLE_WIDTH = 300;\n\ninterface BubbleTitleProps {\n  title: string;\n}\n\nexport const BubbleTitle: React.FunctionComponent<BubbleTitleProps> = ({ title }) => {\n  const minWidth = clamp(title.length * PER_LETTER_PIXELS, MIN_TITLE_WIDTH, MAX_TITLE_WIDTH);\n  return <div className=\"title\" style={{ minWidth }}>{title}</div>;\n};\n","/*\n * Copyright 2017-2020 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries, SeriesDerivation } from \"../../../common/models/series/concrete-series\";\nimport { MeasureBubbleContent } from \"../measure-bubble-content/measure-bubble-content\";\n\ninterface SeriesBubbleContentProps {\n  series: ConcreteSeries;\n  datum: Datum;\n  showPrevious: boolean;\n}\n\nexport const SeriesBubbleContent: React.FunctionComponent<SeriesBubbleContentProps> = props => {\n  const { series, datum, showPrevious } = props;\n  if (!showPrevious) {\n    return <React.Fragment>\n      {series.formatValue(datum)}\n    </React.Fragment>;\n  }\n  const currentValue = series.selectValue(datum);\n  const previousValue = series.selectValue(datum, SeriesDerivation.PREVIOUS);\n  const formatter = series.formatter();\n  return <MeasureBubbleContent\n    lowerIsBetter={series.measure.lowerIsBetter}\n    formatter={formatter}\n    current={currentValue}\n    previous={previousValue}\n  />;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { ReactNode } from \"react\";\nimport { BodyPortal } from \"../body-portal/body-portal\";\nimport { BubbleTitle } from \"../bubble-title/bubble-title\";\nimport { Shpitz } from \"../shpitz/shpitz\";\nimport \"./segment-bubble.scss\";\n\nconst OFFSET_V = -10;\n\nexport interface SegmentBubbleProps extends SegmentBubbleContentProps {\n  left: number;\n  top: number;\n}\n\nexport const SegmentBubble: React.FunctionComponent<SegmentBubbleProps> = (props: SegmentBubbleProps) => {\n  const { left, top, title, content } = props;\n  return <BodyPortal left={left} top={top + OFFSET_V}>\n    <div className=\"segment-bubble\">\n      <SegmentBubbleContent title={title} content={content} />\n      <Shpitz direction=\"up\" />\n    </div>\n  </BodyPortal>;\n};\n\nexport interface SegmentBubbleContentProps {\n  title: string;\n  content?: ReactNode;\n}\n\nexport const SegmentBubbleContent: React.FunctionComponent<SegmentBubbleContentProps> = ({ title, content }: SegmentBubbleContentProps) => (\n  <div className=\"segment-bubble-text\">\n    <BubbleTitle title={title} />\n    {content ? <div className=\"content\">{content}</div> : null}\n  </div>\n);\n","/*\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { Delta } from \"../delta/delta\";\nimport \"./measure-bubble-content.scss\";\n\nexport interface MeasureBubbleContentProps {\n  current: number;\n  previous: number;\n  formatter: Unary<number, string>;\n  lowerIsBetter?: boolean;\n}\n\nexport const MeasureBubbleContent: React.FunctionComponent<MeasureBubbleContentProps> = ({ lowerIsBetter, formatter, current, previous }) => {\n  const currentValue = formatter(current);\n  const previousValue = formatter(previous);\n  return <React.Fragment>\n    <strong className=\"current-value\">{currentValue}</strong>\n    <span className=\"previous-value\">{previousValue}</span>\n    <Delta formatter={formatter} currentValue={current} previousValue={previous} lowerIsBetter={lowerIsBetter} />\n  </React.Fragment>;\n};\n","/*\n * Copyright 2015-2016 Imply Data, Inc.\n * Copyright 2017-2019 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { classNames, roundToHalfPx } from \"../../utils/dom/dom\";\nimport \"./grid-lines.scss\";\n\nexport interface GridLinesProps {\n  orientation: \"horizontal\" | \"vertical\";\n  stage: Stage;\n  ticks: unknown[];\n  scale: Unary<unknown, number>;\n}\n\ninterface Coordinates {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nfunction lineCoordinates(orientation: \"horizontal\" | \"vertical\", value: number, stage: Stage): Coordinates {\n  switch (orientation) {\n    case \"horizontal\":\n      return { x1: 0, x2: stage.width, y1: value, y2: value };\n    case \"vertical\":\n      return { x1: value, x2: value, y1: 0, y2: stage.height };\n  }\n}\n\nexport const GridLines: React.FunctionComponent<GridLinesProps> = props => {\n  const { orientation, stage, ticks, scale } = props;\n\n  return <g className={classNames(\"grid-lines\", orientation)} transform={stage.getTransform()}>\n    {ticks.map((tick: unknown) => {\n      const value = roundToHalfPx(scale(tick));\n      const coordinates = lineCoordinates(orientation, value, stage);\n      return <line key={String(tick)} {...coordinates} />;\n    })}\n  </g>;\n};\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { TooltipWithinStageProps } from \"./tooltip-within-stage\";\n\nexport type Rect = ClientRect | DOMRect;\n\nexport type Position = Pick<React.CSSProperties, \"left\" | \"top\">;\n\nexport function calculatePosition(props: TooltipWithinStageProps, rect?: Rect): Position {\n  const { top: initialTop, left: initialLeft, stage, margin = 10 } = props;\n  if (!rect) {\n    const top = initialTop + margin;\n    const left = initialLeft + margin;\n    return { top, left };\n  }\n\n  const stageBottom = stage.y + stage.height;\n  const stageRight = stage.x + stage.width;\n\n  const top = rect.bottom > stageBottom\n    ? initialTop - margin - rect.height\n    : rect.top < stage.y\n      ? initialTop + rect.height\n      : initialTop + margin;\n\n  const left = rect.right > stageRight\n    ? initialLeft - margin - rect.width\n    : rect.left < stage.x\n      ? initialLeft + rect.width\n      : initialLeft + margin;\n\n  return { top, left };\n}\n","/*\n * Copyright 2017-2018 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { calculatePosition, Rect } from \"./calculate-position\";\nimport \"./tooltip-within-stage.scss\";\n\nexport interface TooltipWithinStageProps {\n  stage: Stage;\n  top: number;\n  left: number;\n  margin?: number;\n}\n\ninterface TooltipWithinStageState {\n  rect?: Rect;\n}\n\nexport class TooltipWithinStage extends React.Component<TooltipWithinStageProps, TooltipWithinStageState> {\n\n  private self = React.createRef<HTMLDivElement>();\n\n  state: TooltipWithinStageState = {};\n\n  componentDidMount() {\n    this.setState({\n      rect: this.self.current.getBoundingClientRect()\n    });\n  }\n\n  render() {\n    const { children } = this.props;\n    return <div\n      className=\"tooltip-within-stage\"\n      style={calculatePosition(this.props, this.state.rect)}\n      ref={this.self}>\n      {children}\n    </div>;\n  }\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport \"./color-legend.scss\";\n\ninterface ColorLegendProps {\n  width?: number;\n  height?: number;\n  title: string;\n  formatter: Unary<number, string>;\n  colorScale: d3.ScaleLinear<string, string>;\n}\n\nconst leftMargin = 5;\nconst topMargin = 10;\nconst bottomMargin = 5;\nconst tickLabelTopOffset = 4;\nconst tickLabelLeftOffset = 7;\nconst tickLength = 5;\nconst stripeWidth = 30;\nconst stripeHeight = 200;\nconst panelWidth = 100;\n\nexport const ColorLegend: React.FunctionComponent<ColorLegendProps> = ({ title, width = panelWidth, height = stripeHeight, formatter, colorScale }) => {\n  const [min, max] = colorScale.domain();\n  if (isNaN(min) || isNaN(max)) return null;\n\n  const stripeLength = height - topMargin - bottomMargin;\n  const [startColor, endColor] = colorScale.range();\n\n  return <div className=\"color-legend\">\n    <div className=\"color-legend-header\">\n      {title}\n    </div>\n    <div className=\"color-legend-stripe\">\n      <svg\n        className=\"color-legend\"\n        width={`${width}px`}\n        height={`${height}px`}>\n        <defs>\n          <linearGradient id=\"color-stripe\" gradientTransform=\"rotate(90)\">\n            <stop offset=\"0%\" stopColor={endColor}/>\n            <stop offset=\"10%\" stopColor={endColor}/>\n            <stop offset=\"90%\" stopColor={startColor}/>\n            <stop offset=\"100%\" stopColor={startColor}/>\n          </linearGradient>\n        </defs>\n        <g transform={`translate(${leftMargin}, ${topMargin})`}>\n          <rect className=\"color-legend-stripe\"\n            x={0}\n            y={0}\n            width={stripeWidth}\n            height={stripeLength}\n            fill=\"url(#color-stripe)\"/>\n          <line className=\"color-legend-stripe-axis\"\n            x1={0.5}\n            x2={0.5}\n            y1={0}\n            y2={stripeLength}/>\n          <g className=\"color-upper-bound\">\n            <line className=\"color-upper-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={0.5}\n              y2={0.5}/>\n            <text className=\"color-upper-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={tickLabelTopOffset}>\n              {formatter(max)}\n            </text>\n          </g>\n          <g className=\"color-lower-bound\">\n            <line className=\"color-lower-bound-tick\"\n              x1={0}\n              x2={tickLength + stripeWidth}\n              y1={stripeLength + 0.5}\n              y2={stripeLength + 0.5}/>\n            <text className=\"color-lower-bound-value\"\n              x={tickLabelLeftOffset + stripeWidth}\n              y={stripeLength + tickLabelTopOffset}>\n              {formatter(min)}\n            </text>\n          </g>\n        </g>\n      </svg>\n    </div>\n  </div>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as d3 from \"d3\";\nimport { Datum } from \"plywood\";\nimport React from \"react\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { range } from \"../../../common/utils/functional/functional\";\nimport { ColorLegend } from \"../../components/color-legend/color-legend\";\nimport { LegendSpot } from \"../../components/pinboard-panel/pinboard-panel\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\ninterface HeatmapProps {\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xBinCount: number;\n  yBinCount: number;\n  data: Datum[];\n  stage: Stage;\n}\n\nconst COLOR_SCALE_START = \"#fff\";\nconst COLOR_SCALE_END = \"#90b5d0\";\n\nexport const Heatmap: React.FunctionComponent<HeatmapProps> = ({ xBinCount, yBinCount, xScale, yScale, stage, data, xSeries, ySeries }) => {\n  const xQuantile = d3.scaleQuantile<number>().domain(xScale.domain()).range(range(0, xBinCount));\n  const yQuantile = d3.scaleQuantile<number>().domain(yScale.domain()).range(range(0, yBinCount));\n\n  const counts = getCounts({ xBinCount, yBinCount, data, xQuantile, xSeries, yQuantile, ySeries });\n\n  const countExtent = [0, d3.max(counts, c => d3.max(c))];\n\n  const colorScale = d3.scaleLinear<string>().domain(countExtent).range([COLOR_SCALE_START, COLOR_SCALE_END]);\n\n  return <React.Fragment>\n    <LegendSpot>\n      <ColorLegend title=\"Count per summary bin\" formatter={i => i.toString(10)} colorScale={colorScale} />\n    </LegendSpot>\n    <g transform={stage.getTransform()} className=\"heatmap\">\n      {counts.map((row, i) =>\n        row.map((count, j) => (\n          <Rectangle\n            key={`key-${i}-${j}`}\n            xScale={xScale}\n            yScale={yScale}\n            fillColor={colorScale(count)}\n            xRange={xQuantile.invertExtent(i)}\n            yRange={yQuantile.invertExtent(j)} />\n        )))}\n    </g>\n  </React.Fragment>;\n};\n\ninterface GetCounts {\n  xBinCount: number;\n  yBinCount: number;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xQuantile: d3.ScaleQuantile<number>;\n  yQuantile: d3.ScaleQuantile<number>;\n  data: Datum[];\n}\n\ntype Counts = number[][];\n\nfunction getCounts({ xBinCount, yBinCount, xSeries, ySeries, xQuantile, yQuantile, data }: GetCounts): Counts {\n  const counts = Array.from({ length: xBinCount }, () => Array.from({ length: yBinCount }, () => 0));\n\n  data.forEach(datum => {\n    const i = xQuantile(xSeries.selectValue(datum));\n    const j = yQuantile(ySeries.selectValue(datum));\n    counts[i][j] += 1;\n  });\n\n  return counts;\n}\n\ninterface RectangleProps {\n  xRange: [number, number];\n  yRange: [number, number];\n  xScale: LinearScale;\n  yScale: LinearScale;\n  fillColor: string;\n}\n\nconst Rectangle: React.FunctionComponent<RectangleProps> = ({\n  xRange,\n  yRange,\n  xScale,\n  yScale,\n  fillColor\n}) => {\n  const [x0, x1] = xRange;\n  const [y0, y1] = yRange;\n  const xPosition = xScale(x0);\n  const width = xScale(x1) - xPosition;\n  const yPosition = yScale(y1);\n  const height = yScale(y0) - yPosition;\n\n  return <rect\n    fill={fillColor}\n    x={xPosition}\n    width={width}\n    y={yPosition}\n    height={height} />;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport \"./scatterplot.scss\";\n\nimport { lightMain } from \"../../../common/models/colors/colors\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\nimport { useSettingsContext } from \"../../views/cube-view/settings-context\";\n\ninterface PointProps {\n  datum: Datum;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  setHover(datum: Datum): void;\n  resetHover(): void;\n}\n\nconst POINT_RADIUS = 3;\nconst HOVER_AREA_RADIUS = 6;\n\nexport const Point: React.FunctionComponent<PointProps> = ({ datum, xScale, yScale, xSeries, ySeries, setHover, resetHover }) => {\n  const { customization: { visualizationColors } } = useSettingsContext();\n  const xValue = xSeries.selectValue(datum);\n  const yValue = ySeries.selectValue(datum);\n\n  const stroke = visualizationColors.main;\n  const fill = lightMain(visualizationColors);\n\n  return (\n    <>\n      <circle\n        cx={xScale(xValue)}\n        cy={yScale(yValue)}\n        r={POINT_RADIUS}\n        className=\"point\"\n        stroke={stroke}\n        fill={fill}\n      />\n      <circle\n        onMouseEnter={() => setHover(datum)}\n        onMouseLeave={() => resetHover()}\n        cx={xScale(xValue)}\n        cy={yScale(yValue)}\n        r={HOVER_AREA_RADIUS}\n        stroke=\"none\"\n        fill=\"transparent\"\n      />\n    </>\n  );\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport { Datum } from \"plywood\";\nimport { ConcreteSeries } from \"../../../common/models/series/concrete-series\";\nimport \"./scatterplot.scss\";\n\nimport { Timezone } from \"chronoshift\";\nimport { Split } from \"../../../common/models/split/split\";\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { isTruthy } from \"../../../common/utils/general/general\";\nimport { SegmentBubbleContent } from \"../../components/segment-bubble/segment-bubble\";\nimport { SeriesBubbleContent } from \"../../components/series-bubble-content/series-bubble-content\";\nimport { TooltipWithinStage } from \"../../components/tooltip-within-stage/tooltip-within-stage\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\ninterface TooltipProps {\n  split: Split;\n  datum: Datum;\n  stage: Stage;\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  timezone: Timezone;\n  showPrevious: boolean;\n}\n\nconst TOOLTIP_OFFSET_Y = 50;\nconst TOOLTIP_OFFSET_X = 100;\n\nexport const Tooltip: React.FunctionComponent<TooltipProps> = ({\n  datum,\n  stage,\n  xSeries,\n  ySeries,\n  xScale,\n  yScale,\n  split,\n  timezone,\n  showPrevious\n}) => {\n  if (!isTruthy(datum)) return null;\n\n  const xPosition = xScale(xSeries.selectValue(datum)) + TOOLTIP_OFFSET_X;\n  const yPosition = yScale(ySeries.selectValue(datum)) + TOOLTIP_OFFSET_Y;\n\n  return <TooltipWithinStage top={yPosition} left={xPosition} stage={stage}>\n    <SegmentBubbleContent\n      title={split.formatValue(datum, timezone)}\n      content={<>\n        <strong className=\"series-title\">{xSeries.title()}</strong>\n        <br/>\n        <SeriesBubbleContent\n          datum={datum}\n          showPrevious={showPrevious}\n          series={xSeries} />\n        <br/>\n        <br/>\n        <strong className=\"series-title\">{ySeries.title()}</strong><br/>\n        <SeriesBubbleContent\n          datum={datum}\n          showPrevious={showPrevious}\n          series={ySeries} />\n      </>} />\n  </TooltipWithinStage>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as d3 from \"d3\";\nimport { Dataset, Datum } from \"plywood\";\nimport { Essence } from \"../../../../common/models/essence/essence\";\nimport { ConcreteSeries } from \"../../../../common/models/series/concrete-series\";\nimport { Stage } from \"../../../../common/models/stage/stage\";\nimport { selectFirstSplitDatums } from \"../../../utils/dataset/selectors/selectors\";\nimport { LinearScale } from \"../../../utils/linear-scale/linear-scale\";\n\nconst MARGIN = 40;\nconst X_AXIS_HEIGHT = 50;\nconst Y_AXIS_WIDTH = 50;\nconst BREAKPOINT_SMALL = 768;\nconst TICK_COUNT = 10;\nconst EXTENT_EXTEND_FACTOR = 0.05;\nconst X_AXIS_LABEL_OFFSET = 55;\n\ninterface PlottingData {\n  xSeries: ConcreteSeries;\n  ySeries: ConcreteSeries;\n  xScale: LinearScale;\n  yScale: LinearScale;\n  xTicks: number[];\n  yTicks: number[];\n  plottingStage: Stage;\n  scatterplotData: Datum[];\n}\n\nexport function preparePlottingData(data: Dataset, essence: Essence, stage: Stage): PlottingData {\n  const [xSeries, ySeries] = essence.getConcreteSeries().toArray();\n  const scatterplotData = selectFirstSplitDatums(data);\n  const xExtent = getExtent(scatterplotData, xSeries);\n  const yExtent = getExtent(scatterplotData, ySeries);\n\n  const plottingStage = calculatePlottingStage(stage);\n  const yScale = d3.scaleLinear().domain(yExtent).nice().range([plottingStage.height, 0]);\n  const xScale = d3.scaleLinear().domain(xExtent).nice().range([0, plottingStage.width]);\n\n  const xTicks = xScale.ticks(TICK_COUNT);\n  const yTicks = yScale.ticks(TICK_COUNT);\n\n  return { xSeries, ySeries, xScale, yScale, xTicks, yTicks, plottingStage, scatterplotData };\n}\n\nfunction getExtent(data: Datum[], series: ConcreteSeries): number[] {\n  const selectValues = (d: Datum) => series.selectValue(d);\n  const extent =  d3.extent(data, selectValues);\n\n  return extendExtentIfNeeded(extent);\n}\n\nexport function extendExtentIfNeeded(extent: number[]): number[] {\n  const [rangeStart, rangeEnd] = extent;\n\n  if (rangeStart !== rangeEnd) {\n    return extent;\n  }\n\n  const loweredRangeStart = rangeStart - rangeStart * EXTENT_EXTEND_FACTOR;\n  const raisedRangeEnd = rangeEnd + rangeEnd * EXTENT_EXTEND_FACTOR;\n  return [loweredRangeStart, raisedRangeEnd];\n}\n\nexport function getXAxisLabelPosition(stage: Stage, plottingStage: Stage): {bottom: number, right: number} {\n  const right = stage.width - (plottingStage.width + plottingStage.x);\n  const bottom = stage.height - (plottingStage.height + plottingStage.y - X_AXIS_LABEL_OFFSET);\n\n  return { bottom, right };\n}\n\nexport function getTicksForAvailableSpace(ticks: number[], size: number): number[] {\n  if (size > BREAKPOINT_SMALL) {\n    return ticks;\n  }\n\n  return ticks.filter((_, index) => index % 2 === 0);\n}\n\nfunction calculatePlottingStageBasedOnWidth(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.width - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.width - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nfunction calculatePlottingStageBasedOnHeight(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.height - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.height - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nfunction calculateRegularPlottingStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: MARGIN,\n    width: stage.width - Y_AXIS_WIDTH - 2 * MARGIN,\n    height: stage.height - X_AXIS_HEIGHT - 2 * MARGIN\n  });\n}\n\nexport function calculatePlottingStage(stage: Stage): Stage {\n  const ratio = stage.width / stage.height;\n\n  if (ratio <= 1 ) return calculatePlottingStageBasedOnWidth(stage);\n  if (ratio >= 2 ) return calculatePlottingStageBasedOnHeight(stage);\n  return calculateRegularPlottingStage(stage);\n}\n\nexport function calculateXAxisStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: Y_AXIS_WIDTH + MARGIN,\n    y: stage.height + MARGIN,\n    width: stage.width,\n    height: X_AXIS_HEIGHT\n  });\n}\n\nexport function calculateYAxisStage(stage: Stage): Stage {\n  return Stage.fromJS({\n    x: MARGIN,\n    y: MARGIN,\n    width: Y_AXIS_WIDTH,\n    height: stage.height\n  });\n}\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport \"./scatterplot.scss\";\n\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\nconst TEXT_OFFSET_X = 16;\n\ninterface XAxisProps {\n  stage: Stage;\n  ticks: number[];\n  tickSize: number;\n  scale: LinearScale;\n  formatter: Unary<number, string>;\n}\n\nexport const XAxis: React.FunctionComponent<XAxisProps> = ({ stage, ticks, scale, formatter, tickSize }) => {\n  const labelY = tickSize + TEXT_OFFSET_X;\n  const linePositionY = roundToHalfPx(0);\n  const lines = ticks.map((tick: number) => {\n    const x = roundToHalfPx(scale(tick));\n    return <line className=\"tick\" key={String(tick)} x1={x} y1={0} x2={x} y2={tickSize} />;\n  });\n  const labels = ticks.map((tick: number) => {\n    const x = scale(tick);\n    return <text className=\"label axis-label-x\" key={String(tick)} x={x} y={labelY}>{formatter(tick)}</text>;\n  });\n\n  return (<g className=\"axis axis-x\" transform={stage.getTransform()}>\n    {lines}\n    {labels}\n    <line className=\"border\" y1={linePositionY} y2={linePositionY} x1={0} x2={stage.width}/>\n  </g>);\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from \"react\";\n\nimport \"./scatterplot.scss\";\n\nimport { Stage } from \"../../../common/models/stage/stage\";\nimport { Unary } from \"../../../common/utils/functional/functional\";\nimport { roundToHalfPx } from \"../../utils/dom/dom\";\nimport { LinearScale } from \"../../utils/linear-scale/linear-scale\";\n\nconst TEXT_OFFSET_Y = 4;\n\ninterface YAxisProps {\n  stage: Stage;\n  ticks: number[];\n  tickSize: number;\n  scale: LinearScale;\n  formatter: Unary<number, string>;\n}\n\nexport const YAxis: React.FunctionComponent<YAxisProps> = ({ formatter, stage, tickSize, ticks, scale }) => {\n  const linePositionX = roundToHalfPx(stage.width);\n\n  const lines = ticks.map((tick: number) => {\n    const y = roundToHalfPx(scale(tick));\n    return <line className=\"tick\" key={String(tick)} x1={stage.width - tickSize} y1={y} x2={stage.width} y2={y} />;\n  });\n\n  const labels = ticks.map((tick: number) => {\n    const y = scale(tick);\n    const labelX = y + TEXT_OFFSET_Y;\n    return <text className=\"label\" key={String(tick)} x={0} y={labelX}>{formatter(tick)}</text>;\n  });\n\n  return <g className=\"axis axis-y\" transform={stage.getTransform()}>\n    <line className=\"border\" x1={linePositionX} y1={0} x2={linePositionX} y2={stage.height} />\n    {lines}\n    {labels}\n  </g>;\n};\n","/*\n * Copyright 2017-2022 Allegro.pl\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport memoizeOne from \"memoize-one\";\nimport { Datum } from \"plywood\";\nimport React, { useCallback, useState } from \"react\";\nimport { ChartProps } from \"../../../common/models/chart-props/chart-props\";\nimport { ScatterplotSettings } from \"../../../common/visualization-manifests/scatterplot/settings\";\nimport { GridLines } from \"../../components/grid-lines/grid-lines\";\nimport {\n  ChartPanel,\n  DefaultVisualizationControls,\n  VisualizationProps\n} from \"../../views/cube-view/center-panel/center-panel\";\nimport { Heatmap } from \"./heatmap\";\nimport { Point } from \"./point\";\nimport \"./scatterplot.scss\";\nimport { Tooltip } from \"./tooltip\";\nimport {\n  calculateXAxisStage,\n  calculateYAxisStage,\n  getTicksForAvailableSpace, getXAxisLabelPosition,\n  preparePlottingData\n} from \"./utils/get-plotting-data\";\nimport { XAxis } from \"./x-axis\";\nimport { YAxis } from \"./y-axis\";\n\nconst TICK_SIZE = 10;\n\ntype HoveredPoint = Datum | null;\n\nexport const Scatterplot: React.FunctionComponent<ChartProps> = ({ data, essence, stage }) => {\n  const [hoveredPoint, setHoveredPoint] = useState<HoveredPoint>(null);\n\n  const getPlottingData = memoizeOne(preparePlottingData);\n\n  const setPointHover = useCallback((datum: Datum): void => setHoveredPoint(datum), [setHoveredPoint]);\n\n  const resetPointHover = useCallback((): void => setHoveredPoint(null), [setHoveredPoint]);\n\n  const mainSplit = essence.splits.splits.first();\n  const showHeatmap = (essence.visualizationSettings as ScatterplotSettings).showSummary;\n\n  const {\n    xTicks,\n    yTicks,\n    xScale,\n    yScale,\n    xSeries,\n    ySeries,\n    plottingStage,\n    scatterplotData\n  } = getPlottingData(data, essence, stage);\n\n  const xAxisLabelPosition = getXAxisLabelPosition(stage, plottingStage);\n\n  return <div className=\"scatterplot-container\" style={stage.getWidthHeight()}>\n    <span className=\"axis-title axis-title-y\" style={{ top: 10, left: 10 }}>{ySeries.title()}</span>\n    <span className=\"axis-title axis-title-x\" style={{ bottom: xAxisLabelPosition.bottom, right: xAxisLabelPosition.right }}>{xSeries.title()}</span>\n    <Tooltip\n      datum={hoveredPoint}\n      stage={plottingStage}\n      ySeries={ySeries}\n      xSeries={xSeries}\n      yScale={yScale}\n      xScale={xScale}\n      split={mainSplit}\n      timezone={essence.timezone}\n      showPrevious={essence.hasComparison()}/>\n    <svg viewBox={stage.getViewBox()}>\n      {showHeatmap && <Heatmap\n        stage={plottingStage}\n        data={scatterplotData}\n        xBinCount={xTicks.length - 1}\n        yBinCount={yTicks.length - 1}\n        xScale={xScale}\n        xSeries={xSeries}\n        yScale={yScale}\n        ySeries={ySeries}/>}\n      <GridLines orientation={\"vertical\"} stage={plottingStage} ticks={xTicks} scale={xScale}/>\n      <GridLines orientation={\"horizontal\"} stage={plottingStage} ticks={yTicks} scale={yScale}/>\n      <XAxis\n        scale={xScale}\n        stage={calculateXAxisStage(plottingStage)}\n        ticks={getTicksForAvailableSpace(xTicks, plottingStage.width)}\n        formatter={xSeries.formatter()}\n        tickSize={TICK_SIZE}/>\n      <YAxis\n        stage={calculateYAxisStage(plottingStage)}\n        ticks={getTicksForAvailableSpace(yTicks, plottingStage.height)}\n        tickSize={TICK_SIZE}\n        scale={yScale}\n        formatter={ySeries.formatter()}/>\n      <g transform={plottingStage.getTransform()}>\n        {scatterplotData.map(datum => {\n          return (\n            <Point\n              key={`point-${mainSplit.selectValue(datum)}`}\n              datum={datum}\n              xScale={xScale}\n              yScale={yScale}\n              xSeries={xSeries}\n              ySeries={ySeries}\n              setHover={setPointHover}\n              resetHover={resetPointHover}/>\n          );\n        })}\n      </g>\n    </svg>\n  </div>;\n};\n\nexport default function ScatterplotVisualization(props: VisualizationProps) {\n  return <React.Fragment>\n    <DefaultVisualizationControls {...props} />\n    <ChartPanel {...props} chartComponent={Scatterplot}/>\n  </React.Fragment>;\n}\n"],"sourceRoot":""}